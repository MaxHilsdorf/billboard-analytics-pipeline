[0m20:42:55.510943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10713a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191efc50>]}


============================== 20:42:55.513134 | 45ebcc41-75f6-4d32-bf72-c70102e99964 ==============================
[0m20:42:55.513134 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:42:55.513453 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:42:55.520800 [info ] [MainThread]: dbt version: 1.8.8
[0m20:42:55.521124 [info ] [MainThread]: python version: 3.13.0
[0m20:42:55.521343 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m20:42:55.521565 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m20:42:55.634332 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m20:42:55.634587 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m20:42:55.634727 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m20:42:55.634965 [info ] [MainThread]: adapter type: snowflake
[0m20:42:55.635082 [info ] [MainThread]: adapter version: 1.8.4
[0m20:42:55.674580 [info ] [MainThread]: Configuration:
[0m20:42:55.674873 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m20:42:55.675004 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m20:42:55.675122 [info ] [MainThread]: Required dependencies:
[0m20:42:55.675304 [debug] [MainThread]: Executing "git --help"
[0m20:42:55.691924 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m20:42:55.692543 [debug] [MainThread]: STDERR: "b''"
[0m20:42:55.692703 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m20:42:55.692857 [info ] [MainThread]: Connection:
[0m20:42:55.693007 [info ] [MainThread]:   account: https://lp42590.eu-central-1.snowflakecomputing.com
[0m20:42:55.693126 [info ] [MainThread]:   user: maxhilsdorf
[0m20:42:55.693228 [info ] [MainThread]:   database: BB_DATABASE
[0m20:42:55.693328 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m20:42:55.693426 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m20:42:55.693524 [info ] [MainThread]:   schema: BB_SCHEMA
[0m20:42:55.693622 [info ] [MainThread]:   authenticator: None
[0m20:42:55.693717 [info ] [MainThread]:   oauth_client_id: None
[0m20:42:55.693811 [info ] [MainThread]:   query_tag: None
[0m20:42:55.693914 [info ] [MainThread]:   client_session_keep_alive: False
[0m20:42:55.694011 [info ] [MainThread]:   host: None
[0m20:42:55.694106 [info ] [MainThread]:   port: None
[0m20:42:55.694200 [info ] [MainThread]:   proxy_host: None
[0m20:42:55.694293 [info ] [MainThread]:   proxy_port: None
[0m20:42:55.694388 [info ] [MainThread]:   protocol: None
[0m20:42:55.694483 [info ] [MainThread]:   connect_retries: 1
[0m20:42:55.694578 [info ] [MainThread]:   connect_timeout: None
[0m20:42:55.694672 [info ] [MainThread]:   retry_on_database_errors: False
[0m20:42:55.694767 [info ] [MainThread]:   retry_all: False
[0m20:42:55.694864 [info ] [MainThread]:   insecure_mode: False
[0m20:42:55.694956 [info ] [MainThread]:   reuse_connections: None
[0m20:42:55.695347 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:42:55.699137 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m20:42:55.700287 [debug] [MainThread]: Using snowflake connection "debug"
[0m20:42:55.700439 [debug] [MainThread]: On debug: select 1 as id
[0m20:42:55.700562 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:42:56.735846 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m20:42:56.736602 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m20:42:56.737094 [debug] [MainThread]: On debug: No close available on handle
[0m20:42:56.737546 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m20:42:56.738018 [info ] [MainThread]: [31m1 check failed:[0m
[0m20:42:56.738503 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m20:42:56.741511 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.26031, "process_user_time": 0.70662, "process_kernel_time": 0.121708, "process_mem_max_rss": "124239872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:42:56.742428 [debug] [MainThread]: Command `dbt debug` failed at 20:42:56.742284 after 1.26 seconds
[0m20:42:56.742926 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m20:42:56.743389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a44d0f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a3fef90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a043240>]}
[0m20:42:56.743938 [debug] [MainThread]: Flushing usage events
[0m20:43:40.450557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106526660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cb7c50>]}


============================== 20:43:40.453243 | 3358fbc7-f7ac-4ad1-95c2-92029c5b546b ==============================
[0m20:43:40.453243 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:43:40.453579 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m20:43:40.463968 [info ] [MainThread]: dbt version: 1.8.8
[0m20:43:40.464171 [info ] [MainThread]: python version: 3.13.0
[0m20:43:40.464301 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m20:43:40.464421 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m20:43:40.623689 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m20:43:40.623974 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m20:43:40.624113 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m20:43:40.624453 [info ] [MainThread]: adapter type: snowflake
[0m20:43:40.624580 [info ] [MainThread]: adapter version: 1.8.4
[0m20:43:40.663857 [info ] [MainThread]: Configuration:
[0m20:43:40.664142 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m20:43:40.664276 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m20:43:40.664402 [info ] [MainThread]: Required dependencies:
[0m20:43:40.664586 [debug] [MainThread]: Executing "git --help"
[0m20:43:40.682881 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m20:43:40.683575 [debug] [MainThread]: STDERR: "b''"
[0m20:43:40.683768 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m20:43:40.683925 [info ] [MainThread]: Connection:
[0m20:43:40.684094 [info ] [MainThread]:   account: lp42590.eu-central-1.snowflakecomputing.com
[0m20:43:40.684212 [info ] [MainThread]:   user: maxhilsdorf
[0m20:43:40.684317 [info ] [MainThread]:   database: BB_DATABASE
[0m20:43:40.684418 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m20:43:40.684517 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m20:43:40.684619 [info ] [MainThread]:   schema: BB_SCHEMA
[0m20:43:40.684719 [info ] [MainThread]:   authenticator: None
[0m20:43:40.684818 [info ] [MainThread]:   oauth_client_id: None
[0m20:43:40.684913 [info ] [MainThread]:   query_tag: None
[0m20:43:40.685015 [info ] [MainThread]:   client_session_keep_alive: False
[0m20:43:40.685115 [info ] [MainThread]:   host: None
[0m20:43:40.685213 [info ] [MainThread]:   port: None
[0m20:43:40.685307 [info ] [MainThread]:   proxy_host: None
[0m20:43:40.685405 [info ] [MainThread]:   proxy_port: None
[0m20:43:40.685501 [info ] [MainThread]:   protocol: None
[0m20:43:40.685596 [info ] [MainThread]:   connect_retries: 1
[0m20:43:40.685690 [info ] [MainThread]:   connect_timeout: None
[0m20:43:40.685784 [info ] [MainThread]:   retry_on_database_errors: False
[0m20:43:40.685880 [info ] [MainThread]:   retry_all: False
[0m20:43:40.685976 [info ] [MainThread]:   insecure_mode: False
[0m20:43:40.686071 [info ] [MainThread]:   reuse_connections: None
[0m20:43:40.686443 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:43:40.691024 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m20:43:40.692235 [debug] [MainThread]: Using snowflake connection "debug"
[0m20:43:40.692527 [debug] [MainThread]: On debug: select 1 as id
[0m20:43:40.692670 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:43:44.606330 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m20:43:44.606887 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m20:43:44.607255 [debug] [MainThread]: On debug: No close available on handle
[0m20:43:44.607629 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m20:43:44.607944 [info ] [MainThread]: [31m1 check failed:[0m
[0m20:43:44.608162 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting
  Verify that the hostnames and port numbers in SYSTEM$ALLOWLIST are added to your firewall's allowed list.
  To further troubleshoot your connection you may reference the following article: https://docs.snowflake.com/en/user-guide/client-connectivity-troubleshooting/overview.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m20:43:44.611204 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 4.1912847, "process_user_time": 0.958269, "process_kernel_time": 0.182346, "process_mem_max_rss": "134037504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:43:44.611855 [debug] [MainThread]: Command `dbt debug` failed at 20:43:44.611712 after 4.19 seconds
[0m20:43:44.612200 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m20:43:44.612510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d32c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f64050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112943240>]}
[0m20:43:44.612878 [debug] [MainThread]: Flushing usage events
[0m21:21:01.326849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10743e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094f3c50>]}


============================== 21:21:01.330161 | f000fc57-e498-4654-81af-c21fab8d2853 ==============================
[0m21:21:01.330161 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:21:01.330564 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m21:21:01.342814 [info ] [MainThread]: dbt version: 1.8.8
[0m21:21:01.343076 [info ] [MainThread]: python version: 3.13.0
[0m21:21:01.343284 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m21:21:01.343559 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m21:21:01.522682 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m21:21:01.522982 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m21:21:01.523125 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m21:21:01.523629 [info ] [MainThread]: adapter type: snowflake
[0m21:21:01.523809 [info ] [MainThread]: adapter version: 1.8.4
[0m21:21:01.563004 [info ] [MainThread]: Configuration:
[0m21:21:01.563275 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:21:01.563402 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:21:01.563512 [info ] [MainThread]: Required dependencies:
[0m21:21:01.563698 [debug] [MainThread]: Executing "git --help"
[0m21:21:01.594198 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:21:01.594813 [debug] [MainThread]: STDERR: "b''"
[0m21:21:01.594989 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:21:01.595137 [info ] [MainThread]: Connection:
[0m21:21:01.595286 [info ] [MainThread]:   account: lp42590.eu-central-1.snowflakecomputing.com
[0m21:21:01.595403 [info ] [MainThread]:   user: maxhilsdorf
[0m21:21:01.595508 [info ] [MainThread]:   database: BB_DATABASE
[0m21:21:01.595608 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m21:21:01.595710 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m21:21:01.595808 [info ] [MainThread]:   schema: BB_SCHEMA
[0m21:21:01.595986 [info ] [MainThread]:   authenticator: None
[0m21:21:01.596168 [info ] [MainThread]:   oauth_client_id: None
[0m21:21:01.596293 [info ] [MainThread]:   query_tag: None
[0m21:21:01.596408 [info ] [MainThread]:   client_session_keep_alive: False
[0m21:21:01.596519 [info ] [MainThread]:   host: None
[0m21:21:01.596623 [info ] [MainThread]:   port: None
[0m21:21:01.596726 [info ] [MainThread]:   proxy_host: None
[0m21:21:01.596829 [info ] [MainThread]:   proxy_port: None
[0m21:21:01.596927 [info ] [MainThread]:   protocol: None
[0m21:21:01.597025 [info ] [MainThread]:   connect_retries: 1
[0m21:21:01.597123 [info ] [MainThread]:   connect_timeout: None
[0m21:21:01.597219 [info ] [MainThread]:   retry_on_database_errors: False
[0m21:21:01.597316 [info ] [MainThread]:   retry_all: False
[0m21:21:01.597413 [info ] [MainThread]:   insecure_mode: False
[0m21:21:01.597509 [info ] [MainThread]:   reuse_connections: None
[0m21:21:01.597859 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:21:01.602231 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m21:21:01.603399 [debug] [MainThread]: Using snowflake connection "debug"
[0m21:21:01.603557 [debug] [MainThread]: On debug: select 1 as id
[0m21:21:01.603677 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:21:05.208700 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m21:21:05.209139 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m21:21:05.209401 [debug] [MainThread]: On debug: No close available on handle
[0m21:21:05.209666 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m21:21:05.209907 [info ] [MainThread]: [31m1 check failed:[0m
[0m21:21:05.210099 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting
  Verify that the hostnames and port numbers in SYSTEM$ALLOWLIST are added to your firewall's allowed list.
  To further troubleshoot your connection you may reference the following article: https://docs.snowflake.com/en/user-guide/client-connectivity-troubleshooting/overview.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m21:21:05.212394 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.920347, "process_user_time": 0.932267, "process_kernel_time": 0.212475, "process_mem_max_rss": "135184384", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:21:05.213071 [debug] [MainThread]: Command `dbt debug` failed at 21:21:05.212915 after 3.92 seconds
[0m21:21:05.213429 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:21:05.213708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d83f820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9dee70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac43240>]}
[0m21:21:05.214012 [debug] [MainThread]: Flushing usage events
[0m21:22:01.373760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baefc50>]}


============================== 21:22:01.377008 | a88ccab8-6e5d-4d58-9d5f-fab9e0eadb20 ==============================
[0m21:22:01.377008 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:22:01.377344 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:22:01.389205 [info ] [MainThread]: dbt version: 1.8.8
[0m21:22:01.389461 [info ] [MainThread]: python version: 3.13.0
[0m21:22:01.389598 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m21:22:01.389716 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m21:22:01.572125 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m21:22:01.572416 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m21:22:01.572554 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m21:22:01.573066 [info ] [MainThread]: adapter type: snowflake
[0m21:22:01.573246 [info ] [MainThread]: adapter version: 1.8.4
[0m21:22:01.612104 [info ] [MainThread]: Configuration:
[0m21:22:01.612380 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:22:01.612570 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:22:01.612752 [info ] [MainThread]: Required dependencies:
[0m21:22:01.613006 [debug] [MainThread]: Executing "git --help"
[0m21:22:01.630402 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:22:01.631068 [debug] [MainThread]: STDERR: "b''"
[0m21:22:01.631237 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:22:01.631378 [info ] [MainThread]: Connection:
[0m21:22:01.631539 [info ] [MainThread]:   account: lp42590.eu-central-1.snowflakecomputing.com
[0m21:22:01.631650 [info ] [MainThread]:   user: maxhilsdorf
[0m21:22:01.631757 [info ] [MainThread]:   database: BB_DATABASE
[0m21:22:01.631856 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m21:22:01.631960 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m21:22:01.632060 [info ] [MainThread]:   schema: BB_SCHEMA
[0m21:22:01.632160 [info ] [MainThread]:   authenticator: None
[0m21:22:01.632258 [info ] [MainThread]:   oauth_client_id: None
[0m21:22:01.632356 [info ] [MainThread]:   query_tag: None
[0m21:22:01.632455 [info ] [MainThread]:   client_session_keep_alive: False
[0m21:22:01.632556 [info ] [MainThread]:   host: None
[0m21:22:01.632655 [info ] [MainThread]:   port: None
[0m21:22:01.632753 [info ] [MainThread]:   proxy_host: None
[0m21:22:01.632850 [info ] [MainThread]:   proxy_port: None
[0m21:22:01.632947 [info ] [MainThread]:   protocol: None
[0m21:22:01.633041 [info ] [MainThread]:   connect_retries: 1
[0m21:22:01.633134 [info ] [MainThread]:   connect_timeout: None
[0m21:22:01.633230 [info ] [MainThread]:   retry_on_database_errors: False
[0m21:22:01.633324 [info ] [MainThread]:   retry_all: False
[0m21:22:01.633418 [info ] [MainThread]:   insecure_mode: False
[0m21:22:01.633516 [info ] [MainThread]:   reuse_connections: None
[0m21:22:01.634055 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:22:01.638756 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m21:22:01.639907 [debug] [MainThread]: Using snowflake connection "debug"
[0m21:22:01.640103 [debug] [MainThread]: On debug: select 1 as id
[0m21:22:01.640247 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:22:05.068927 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m21:22:05.069236 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m21:22:05.069423 [debug] [MainThread]: On debug: No close available on handle
[0m21:22:05.069603 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m21:22:05.069785 [info ] [MainThread]: [31m1 check failed:[0m
[0m21:22:05.069920 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting
  Verify that the hostnames and port numbers in SYSTEM$ALLOWLIST are added to your firewall's allowed list.
  To further troubleshoot your connection you may reference the following article: https://docs.snowflake.com/en/user-guide/client-connectivity-troubleshooting/overview.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m21:22:05.071794 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.735185, "process_user_time": 0.936224, "process_kernel_time": 0.225841, "process_mem_max_rss": "133971968", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:22:05.072279 [debug] [MainThread]: Command `dbt debug` failed at 21:22:05.072180 after 3.74 seconds
[0m21:22:05.072486 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:22:05.072676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d243820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ced2e70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca43240>]}
[0m21:22:05.072873 [debug] [MainThread]: Flushing usage events
[0m21:23:52.128985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f9e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104987ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104987c50>]}


============================== 21:23:52.131692 | a7602126-ad75-4e02-b9ad-edb1dda15514 ==============================
[0m21:23:52.131692 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:23:52.131996 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt debug', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:23:52.143193 [info ] [MainThread]: dbt version: 1.8.8
[0m21:23:52.143455 [info ] [MainThread]: python version: 3.13.0
[0m21:23:52.143588 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m21:23:52.143710 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m21:23:52.318653 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m21:23:52.318913 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m21:23:52.319045 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m21:23:52.319638 [info ] [MainThread]: adapter type: snowflake
[0m21:23:52.319889 [info ] [MainThread]: adapter version: 1.8.4
[0m21:23:52.359153 [info ] [MainThread]: Configuration:
[0m21:23:52.359432 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:23:52.359564 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:23:52.359677 [info ] [MainThread]: Required dependencies:
[0m21:23:52.359871 [debug] [MainThread]: Executing "git --help"
[0m21:23:52.378758 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:23:52.379361 [debug] [MainThread]: STDERR: "b''"
[0m21:23:52.379543 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:23:52.379739 [info ] [MainThread]: Connection:
[0m21:23:52.379969 [info ] [MainThread]:   account: YRYFJIL.IP80015
[0m21:23:52.380107 [info ] [MainThread]:   user: maxhilsdorf
[0m21:23:52.380221 [info ] [MainThread]:   database: BB_DATABASE
[0m21:23:52.380346 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m21:23:52.380456 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m21:23:52.380560 [info ] [MainThread]:   schema: BB_SCHEMA
[0m21:23:52.380661 [info ] [MainThread]:   authenticator: None
[0m21:23:52.380758 [info ] [MainThread]:   oauth_client_id: None
[0m21:23:52.380867 [info ] [MainThread]:   query_tag: None
[0m21:23:52.380967 [info ] [MainThread]:   client_session_keep_alive: False
[0m21:23:52.381066 [info ] [MainThread]:   host: None
[0m21:23:52.381163 [info ] [MainThread]:   port: None
[0m21:23:52.381260 [info ] [MainThread]:   proxy_host: None
[0m21:23:52.381356 [info ] [MainThread]:   proxy_port: None
[0m21:23:52.381449 [info ] [MainThread]:   protocol: None
[0m21:23:52.381699 [info ] [MainThread]:   connect_retries: 1
[0m21:23:52.381879 [info ] [MainThread]:   connect_timeout: None
[0m21:23:52.381996 [info ] [MainThread]:   retry_on_database_errors: False
[0m21:23:52.382096 [info ] [MainThread]:   retry_all: False
[0m21:23:52.382195 [info ] [MainThread]:   insecure_mode: False
[0m21:23:52.382292 [info ] [MainThread]:   reuse_connections: None
[0m21:23:52.382638 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:23:52.387310 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m21:23:52.388443 [debug] [MainThread]: Using snowflake connection "debug"
[0m21:23:52.388625 [debug] [MainThread]: On debug: select 1 as id
[0m21:23:52.388778 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:23:55.989227 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m21:23:55.989755 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m21:23:55.990065 [debug] [MainThread]: On debug: No close available on handle
[0m21:23:55.990377 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m21:23:55.990689 [info ] [MainThread]: [31m1 check failed:[0m
[0m21:23:55.990911 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting
  Verify that the hostnames and port numbers in SYSTEM$ALLOWLIST are added to your firewall's allowed list.
  To further troubleshoot your connection you may reference the following article: https://docs.snowflake.com/en/user-guide/client-connectivity-troubleshooting/overview.

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m21:23:55.993690 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.8953817, "process_user_time": 0.910567, "process_kernel_time": 0.184549, "process_mem_max_rss": "134971392", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:23:55.994280 [debug] [MainThread]: Command `dbt debug` failed at 21:23:55.994164 after 3.90 seconds
[0m21:23:55.994616 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:23:55.994923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ff490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059a7650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10544b240>]}
[0m21:23:55.995279 [debug] [MainThread]: Flushing usage events
[0m21:27:28.381526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105322660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0fc50>]}


============================== 21:27:28.384580 | e0e80375-d166-43d8-8fb9-65d26b6c95e3 ==============================
[0m21:27:28.384580 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:27:28.384925 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:27:28.395584 [info ] [MainThread]: dbt version: 1.8.8
[0m21:27:28.395800 [info ] [MainThread]: python version: 3.13.0
[0m21:27:28.395928 [info ] [MainThread]: python path: /Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/bin/python
[0m21:27:28.396041 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit-Mach-O
[0m21:27:28.559856 [info ] [MainThread]: Using profiles dir at /Users/maxhilsdorf/.dbt
[0m21:27:28.560153 [info ] [MainThread]: Using profiles.yml file at /Users/maxhilsdorf/.dbt/profiles.yml
[0m21:27:28.560294 [info ] [MainThread]: Using dbt_project.yml file at /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/dbt_project.yml
[0m21:27:28.560822 [info ] [MainThread]: adapter type: snowflake
[0m21:27:28.560949 [info ] [MainThread]: adapter version: 1.8.4
[0m21:27:28.599559 [info ] [MainThread]: Configuration:
[0m21:27:28.599918 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m21:27:28.600102 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m21:27:28.600350 [info ] [MainThread]: Required dependencies:
[0m21:27:28.600546 [debug] [MainThread]: Executing "git --help"
[0m21:27:28.618282 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m21:27:28.618947 [debug] [MainThread]: STDERR: "b''"
[0m21:27:28.619122 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m21:27:28.619269 [info ] [MainThread]: Connection:
[0m21:27:28.619434 [info ] [MainThread]:   account: lp42590.eu-central-1
[0m21:27:28.619548 [info ] [MainThread]:   user: maxhilsdorf
[0m21:27:28.619651 [info ] [MainThread]:   database: BB_DATABASE
[0m21:27:28.619750 [info ] [MainThread]:   warehouse: COMPUTE_WH
[0m21:27:28.619849 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m21:27:28.619948 [info ] [MainThread]:   schema: BB_SCHEMA
[0m21:27:28.620046 [info ] [MainThread]:   authenticator: None
[0m21:27:28.620155 [info ] [MainThread]:   oauth_client_id: None
[0m21:27:28.620253 [info ] [MainThread]:   query_tag: None
[0m21:27:28.620348 [info ] [MainThread]:   client_session_keep_alive: False
[0m21:27:28.620448 [info ] [MainThread]:   host: None
[0m21:27:28.620543 [info ] [MainThread]:   port: None
[0m21:27:28.620638 [info ] [MainThread]:   proxy_host: None
[0m21:27:28.620729 [info ] [MainThread]:   proxy_port: None
[0m21:27:28.620822 [info ] [MainThread]:   protocol: None
[0m21:27:28.620917 [info ] [MainThread]:   connect_retries: 1
[0m21:27:28.621009 [info ] [MainThread]:   connect_timeout: None
[0m21:27:28.621104 [info ] [MainThread]:   retry_on_database_errors: False
[0m21:27:28.621284 [info ] [MainThread]:   retry_all: False
[0m21:27:28.621592 [info ] [MainThread]:   insecure_mode: False
[0m21:27:28.621764 [info ] [MainThread]:   reuse_connections: None
[0m21:27:28.622186 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:27:28.626708 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m21:27:28.627782 [debug] [MainThread]: Using snowflake connection "debug"
[0m21:27:28.627925 [debug] [MainThread]: On debug: select 1 as id
[0m21:27:28.628039 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:27:29.365912 [debug] [MainThread]: SQL status: SUCCESS 1 in 0.738 seconds
[0m21:27:29.366903 [debug] [MainThread]: On debug: Close
[0m21:27:29.458365 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m21:27:29.458669 [info ] [MainThread]: [32mAll checks passed![0m
[0m21:27:29.460375 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 1.1102015, "process_user_time": 0.798947, "process_kernel_time": 0.173063, "process_mem_max_rss": "131219456", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:27:29.460689 [debug] [MainThread]: Command `dbt debug` succeeded at 21:27:29.460625 after 1.11 seconds
[0m21:27:29.460900 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m21:27:29.461086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110667e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11083b890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110343130>]}
[0m21:27:29.461287 [debug] [MainThread]: Flushing usage events
[0m21:42:36.121338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077b7c50>]}


============================== 21:42:36.123554 | 6cb659bc-166c-40d7-8372-cfae440d9891 ==============================
[0m21:42:36.123554 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:42:36.123850 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:42:36.290431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cfa190>]}
[0m21:42:36.314515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c786b0>]}
[0m21:42:36.315046 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:42:36.325955 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:42:36.326518 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m21:42:36.326708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109090350>]}
[0m21:42:36.984189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109218b90>]}
[0m21:42:37.034440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d7d90>]}
[0m21:42:37.034744 [info ] [MainThread]: Found 3 models, 4 data tests, 2 sources, 454 macros
[0m21:42:37.034915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092498b0>]}
[0m21:42:37.035847 [info ] [MainThread]: 
[0m21:42:37.036155 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:42:37.038331 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:42:37.046567 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:42:37.046799 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:42:37.046923 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:42:37.538208 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.491 seconds
[0m21:42:37.540275 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:42:37.655832 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:42:37.660367 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:42:37.660593 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:42:37.660739 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:42:37.992177 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.331 seconds
[0m21:42:37.995229 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:42:38.085813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c3290>]}
[0m21:42:38.086447 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:42:38.086683 [info ] [MainThread]: 
[0m21:42:38.089173 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:42:38.089446 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_model
[0m21:42:38.089771 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:42:38.090049 [info ] [Thread-2 (]: 2 of 3 START sql view model BB_SCHEMA.my_first_model ........................... [RUN]
[0m21:42:38.090305 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.my_first_dbt_model)
[0m21:42:38.090568 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_model'
[0m21:42:38.090736 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:42:38.090890 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_model
[0m21:42:38.095906 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_model"
[0m21:42:38.097706 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:42:38.098482 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_model
[0m21:42:38.098736 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:42:38.121903 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_model"
[0m21:42:38.128333 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:42:38.129377 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:42:38.129605 [debug] [Thread-1 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:42:38.129779 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:42:38.130508 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_model"
[0m21:42:38.130705 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_first_model
  
   as (
    -- models/my_first_model.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:42:38.130863 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:42:38.964127 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.833 seconds
[0m21:42:38.978092 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_model: Close
[0m21:42:39.073643 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4b17b0>]}
[0m21:42:39.074267 [info ] [Thread-2 (]: 2 of 3 OK created sql view model BB_SCHEMA.my_first_model ...................... [[32mSUCCESS 1[0m in 0.98s]
[0m21:42:39.074735 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_model
[0m21:42:39.301658 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.172 seconds
[0m21:42:39.304379 [debug] [Thread-1 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:42:39.395166 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a456850>]}
[0m21:42:39.395602 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.30s]
[0m21:42:39.395910 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:42:39.396272 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:42:39.396530 [info ] [Thread-3 (]: 3 of 3 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:42:39.396863 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:42:39.397065 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:42:39.398685 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:42:39.399171 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:42:39.400216 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:42:39.400634 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:42:39.400797 [debug] [Thread-3 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:42:39.400941 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:42:39.808054 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.407 seconds
[0m21:42:39.810675 [debug] [Thread-3 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:42:39.909945 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6cb659bc-166c-40d7-8372-cfae440d9891', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a502d50>]}
[0m21:42:39.910479 [info ] [Thread-3 (]: 3 of 3 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.51s]
[0m21:42:39.910782 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:42:39.911597 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:42:39.911789 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:42:39.911909 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_model' was properly closed.
[0m21:42:39.912011 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:42:39.912203 [info ] [MainThread]: 
[0m21:42:39.912353 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 2.88 seconds (2.88s).
[0m21:42:39.912768 [debug] [MainThread]: Command end result
[0m21:42:39.933083 [info ] [MainThread]: 
[0m21:42:39.933389 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:42:39.933532 [info ] [MainThread]: 
[0m21:42:39.933670 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:42:39.934692 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8423548, "process_user_time": 1.730411, "process_kernel_time": 0.189009, "process_mem_max_rss": "145031168", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:42:39.934970 [debug] [MainThread]: Command `dbt run` succeeded at 21:42:39.934926 after 3.84 seconds
[0m21:42:39.935157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077da350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034da120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107397530>]}
[0m21:42:39.935333 [debug] [MainThread]: Flushing usage events
[0m21:44:04.525393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cf3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cf3c50>]}


============================== 21:44:04.528139 | c7fed5e7-923f-4ada-856c-72f81e890e5c ==============================
[0m21:44:04.528139 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:44:04.528441 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:44:04.695344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132fa190>]}
[0m21:44:04.726709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132786b0>]}
[0m21:44:04.727418 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:44:04.739376 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:44:04.802955 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m21:44:04.803275 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/top_5.sql
[0m21:44:04.803412 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/my_first_model.sql
[0m21:44:04.921115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135eb850>]}
[0m21:44:04.981741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132b4320>]}
[0m21:44:04.982057 [info ] [MainThread]: Found 3 models, 4 data tests, 2 sources, 454 macros
[0m21:44:04.982243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114604ad0>]}
[0m21:44:04.983257 [info ] [MainThread]: 
[0m21:44:04.983595 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:44:04.985612 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:44:04.993856 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:44:04.994135 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:44:04.994269 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:44:05.560531 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.566 seconds
[0m21:44:05.571439 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:44:05.681002 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:44:05.692643 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:44:05.693133 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:44:05.693420 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:44:06.101166 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.408 seconds
[0m21:44:06.104213 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:44:06.208625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a69cc0>]}
[0m21:44:06.209298 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:44:06.209529 [info ] [MainThread]: 
[0m21:44:06.211813 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:44:06.212150 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:44:06.212536 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:44:06.212900 [info ] [Thread-2 (]: 2 of 3 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:44:06.213277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.my_first_dbt_model)
[0m21:44:06.213594 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:44:06.213846 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:44:06.214029 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:44:06.219931 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:44:06.221812 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:44:06.222614 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:44:06.229914 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:44:06.256697 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:44:06.255242 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:44:06.257797 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:44:06.258179 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:44:06.258414 [debug] [Thread-1 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:44:06.258640 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:44:06.258822 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:44:06.258973 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:44:06.875835 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.616 seconds
[0m21:44:06.901547 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:44:06.993871 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149a10d0>]}
[0m21:44:06.994923 [info ] [Thread-2 (]: 2 of 3 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.78s]
[0m21:44:06.995641 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:44:07.307388 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.048 seconds
[0m21:44:07.308852 [debug] [Thread-1 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:44:07.394337 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149aaa40>]}
[0m21:44:07.394866 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.18s]
[0m21:44:07.395216 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:44:07.395666 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:44:07.395977 [info ] [Thread-3 (]: 3 of 3 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:44:07.396335 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:44:07.396552 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:44:07.398449 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:44:07.398970 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:44:07.400302 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:44:07.401258 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:44:07.401474 [debug] [Thread-3 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:44:07.401776 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:44:07.836470 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.434 seconds
[0m21:44:07.844944 [debug] [Thread-3 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:44:07.943095 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7fed5e7-923f-4ada-856c-72f81e890e5c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149a67b0>]}
[0m21:44:07.944303 [info ] [Thread-3 (]: 3 of 3 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.55s]
[0m21:44:07.945109 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:44:07.947003 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:44:07.947360 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:44:07.947610 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:44:07.947848 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:44:07.948288 [info ] [MainThread]: 
[0m21:44:07.948635 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 2.96 seconds (2.96s).
[0m21:44:07.949760 [debug] [MainThread]: Command end result
[0m21:44:07.973801 [info ] [MainThread]: 
[0m21:44:07.974180 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:44:07.974380 [info ] [MainThread]: 
[0m21:44:07.974576 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:44:07.976007 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.481132, "process_user_time": 1.354234, "process_kernel_time": 0.197735, "process_mem_max_rss": "144179200", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:44:07.976343 [debug] [MainThread]: Command `dbt run` succeeded at 21:44:07.976282 after 3.48 seconds
[0m21:44:07.976580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113acec50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135a13d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d16350>]}
[0m21:44:07.976799 [debug] [MainThread]: Flushing usage events
[0m21:47:49.293240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029c2660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043abed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043abc50>]}


============================== 21:47:49.295478 | e60b903b-3564-4d32-b859-bba09ad898a3 ==============================
[0m21:47:49.295478 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:47:49.295799 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:47:49.467742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f22190>]}
[0m21:47:49.492341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ea46b0>]}
[0m21:47:49.493308 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:47:49.503068 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:47:49.561925 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m21:47:49.562334 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/hot_100_artists.sql
[0m21:47:49.670562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10527b850>]}
[0m21:47:49.716835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ee4320>]}
[0m21:47:49.717138 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:47:49.717300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10561d010>]}
[0m21:47:49.718454 [info ] [MainThread]: 
[0m21:47:49.718821 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:47:49.720854 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:47:49.729414 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:47:49.729660 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:47:49.729798 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:47:50.307465 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.577 seconds
[0m21:47:50.310838 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:47:50.414075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:47:50.423999 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:47:50.424370 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:47:50.424654 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:47:50.746988 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.322 seconds
[0m21:47:50.750315 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:47:50.854658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055472b0>]}
[0m21:47:50.855330 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:47:50.855657 [info ] [MainThread]: 
[0m21:47:50.858491 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:47:50.858887 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:47:50.859194 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:47:50.859621 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:47:50.860021 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:47:50.860362 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:47:50.860711 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:47:50.861213 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:47:50.861820 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:47:50.862351 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:47:50.862695 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:47:50.862946 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:47:50.870307 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:47:50.872057 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:47:50.873610 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:47:50.874451 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:47:50.874763 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:47:50.880791 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:47:50.897214 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:47:50.897590 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:47:50.908526 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:47:50.909310 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:47:50.909698 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:47:50.909901 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    BILLBOARD_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    ARTIST_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT *
FROM BILLBOARD_DATA
LEFT JOIN ARTIST_DATA
ON BILLBOARD_DATA.artist = ARTIST_DATA.artist_name;
[0m21:47:50.910197 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:47:50.910391 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:47:50.910571 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:47:50.910734 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:47:50.910888 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:47:50.911065 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:47:51.244021 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b7e923-0203-9722-0003-07620001e422
[0m21:47:51.244735 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 17 at position 50 unexpected ';'.
[0m21:47:51.245299 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:47:51.363283 [debug] [Thread-1 (]: Database Error in model hot_100_artists (models/hot_100_artists.sql)
  001003 (42000): SQL compilation error:
  syntax error line 17 at position 50 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:47:51.365244 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a5a90>]}
[0m21:47:51.365976 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_artists ................. [[31mERROR[0m in 0.50s]
[0m21:47:51.366599 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:47:51.417791 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.506 seconds
[0m21:47:51.438172 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:47:51.531969 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10410be30>]}
[0m21:47:51.532846 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.67s]
[0m21:47:51.533475 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:47:51.862043 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.950 seconds
[0m21:47:51.868536 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:47:51.964376 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059afed0>]}
[0m21:47:51.964842 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.10s]
[0m21:47:51.965162 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:47:51.965587 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:47:51.965935 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:47:51.966224 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:47:51.966432 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:47:51.967914 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:47:51.968440 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:47:51.970245 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:47:51.970699 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:47:51.970870 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:47:51.971030 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:47:52.385122 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.413 seconds
[0m21:47:52.391844 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:47:52.495189 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e60b903b-3564-4d32-b859-bba09ad898a3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051f4550>]}
[0m21:47:52.496236 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.53s]
[0m21:47:52.497068 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:47:52.499025 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:47:52.499420 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:47:52.499677 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:47:52.499909 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:47:52.500133 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:47:52.500506 [info ] [MainThread]: 
[0m21:47:52.500836 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.78 seconds (2.78s).
[0m21:47:52.501894 [debug] [MainThread]: Command end result
[0m21:47:52.534188 [info ] [MainThread]: 
[0m21:47:52.534641 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:47:52.534836 [info ] [MainThread]: 
[0m21:47:52.535095 [error] [MainThread]:   Database Error in model hot_100_artists (models/hot_100_artists.sql)
  001003 (42000): SQL compilation error:
  syntax error line 17 at position 50 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:47:52.535254 [info ] [MainThread]: 
[0m21:47:52.535392 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m21:47:52.536601 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.2742262, "process_user_time": 1.385072, "process_kernel_time": 0.186206, "process_mem_max_rss": "142983168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:47:52.536871 [debug] [MainThread]: Command `dbt run` failed at 21:47:52.536823 after 3.27 seconds
[0m21:47:52.537087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043ce350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c16120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103202510>]}
[0m21:47:52.537272 [debug] [MainThread]: Flushing usage events
[0m21:48:48.180399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10673a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090b7c50>]}


============================== 21:48:48.182604 | b6c3f029-45a9-49b7-8bfa-d1463b05c970 ==============================
[0m21:48:48.182604 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:48:48.182920 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:48:48.346048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cf6190>]}
[0m21:48:48.371635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c786b0>]}
[0m21:48:48.372232 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:48:48.382860 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:48:48.442704 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:48:48.443051 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:48:48.551617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a193950>]}
[0m21:48:48.595404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cb8320>]}
[0m21:48:48.595691 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:48:48.595856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c22d010>]}
[0m21:48:48.596830 [info ] [MainThread]: 
[0m21:48:48.597123 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:48:48.599141 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:48:48.607471 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:48:48.607715 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:48:48.607844 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:48:49.002653 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.395 seconds
[0m21:48:49.005593 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:48:49.105961 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:48:49.114460 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:48:49.114755 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:48:49.114975 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:48:49.484298 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.369 seconds
[0m21:48:49.487732 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:48:49.588950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c200530>]}
[0m21:48:49.589646 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:48:49.590004 [info ] [MainThread]: 
[0m21:48:49.593095 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:48:49.593599 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:48:49.593979 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:48:49.594509 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:48:49.594976 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:48:49.595572 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:48:49.596157 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:48:49.596530 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:48:49.596915 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:48:49.597232 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:48:49.597520 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:48:49.597789 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:48:49.605845 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:48:49.607995 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:48:49.609693 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:48:49.610485 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:48:49.610836 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:48:49.617515 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:48:49.647383 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:48:49.649748 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:48:49.651014 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:48:49.651733 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:48:49.652058 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:48:49.652424 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:48:49.652622 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    BILLBOARD_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    ARTIST_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT *
FROM BILLBOARD_DATA
LEFT JOIN ARTIST_DATA
ON BILLBOARD_DATA.artist = ARTIST_DATA.artist_name
  );
[0m21:48:49.652846 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:48:49.653046 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:48:49.653228 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:48:49.653381 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:48:49.653532 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:48:50.134443 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.481 seconds
[0m21:48:50.136214 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.483 seconds
[0m21:48:50.167498 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:48:50.168205 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:48:50.332427 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4a44d0>]}
[0m21:48:50.333430 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.73s]
[0m21:48:50.334076 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:48:50.516790 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4ac050>]}
[0m21:48:50.518083 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.92s]
[0m21:48:50.518753 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:48:50.624679 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.971 seconds
[0m21:48:50.628495 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:48:50.727109 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4dfc50>]}
[0m21:48:50.728208 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.13s]
[0m21:48:50.729001 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:48:50.730069 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:48:50.730637 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:48:50.731239 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:48:50.731612 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:48:50.735014 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:48:50.736295 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:48:50.738875 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:48:50.739764 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:48:50.740111 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:48:50.740565 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:48:51.159272 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.419 seconds
[0m21:48:51.162812 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:48:51.256560 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6c3f029-45a9-49b7-8bfa-d1463b05c970', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090f7450>]}
[0m21:48:51.257568 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.53s]
[0m21:48:51.258274 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:48:51.260109 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:48:51.260433 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:48:51.260688 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:48:51.260928 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:48:51.261153 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:48:51.261534 [info ] [MainThread]: 
[0m21:48:51.261860 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.66 seconds (2.66s).
[0m21:48:51.262848 [debug] [MainThread]: Command end result
[0m21:48:51.286535 [info ] [MainThread]: 
[0m21:48:51.286895 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:48:51.287101 [info ] [MainThread]: 
[0m21:48:51.287305 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:48:51.288776 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1393545, "process_user_time": 1.375557, "process_kernel_time": 0.187551, "process_mem_max_rss": "142622720", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:48:51.289164 [debug] [MainThread]: Command `dbt run` succeeded at 21:48:51.289097 after 3.14 seconds
[0m21:48:51.289416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090da350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1047ea120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b4f110>]}
[0m21:48:51.289646 [debug] [MainThread]: Flushing usage events
[0m21:53:01.704859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103c3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064efc50>]}


============================== 21:53:01.707090 | dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0 ==============================
[0m21:53:01.707090 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:53:01.707394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:53:01.866513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073fa190>]}
[0m21:53:01.888723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073786b0>]}
[0m21:53:01.889117 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:53:01.898937 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:53:01.956435 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:53:01.956813 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:53:02.057703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107687950>]}
[0m21:53:02.102186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073b4320>]}
[0m21:53:02.102467 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:53:02.102638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c31010>]}
[0m21:53:02.103574 [info ] [MainThread]: 
[0m21:53:02.103868 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:53:02.105869 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:53:02.114526 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:53:02.114777 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:53:02.114915 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:53:02.627022 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.512 seconds
[0m21:53:02.628873 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:53:02.727143 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:53:02.735276 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:53:02.735598 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:53:02.735843 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:53:03.133974 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.398 seconds
[0m21:53:03.140504 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:53:03.234985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c00530>]}
[0m21:53:03.235983 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:53:03.236443 [info ] [MainThread]: 
[0m21:53:03.240009 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:53:03.240541 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:53:03.240928 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:53:03.241487 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:53:03.242006 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:53:03.242669 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:53:03.243341 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:53:03.243728 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:53:03.244118 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:53:03.244436 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:53:03.244736 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:53:03.245007 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:53:03.253104 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:03.255279 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:53:03.257061 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:53:03.257829 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:53:03.278154 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:03.278657 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:53:03.285195 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:53:03.292273 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:53:03.292555 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:53:03.293045 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:03.293327 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:53:03.293531 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:53:03.294466 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:53:03.294656 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    BILLBOARD_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    ARTIST_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist_name,
    artist_data.country,
    artist_data.genre
FROM BILLBOARD_DATA
JOIN ARTIST_DATA
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:53:03.294966 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:53:03.295348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:53:03.295574 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:53:03.296253 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:53:03.650401 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b7e929-0203-971a-0003-07620001d496
[0m21:53:03.651016 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 15 at position 4
invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
[0m21:53:03.651494 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:53:03.755761 [debug] [Thread-1 (]: Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:53:03.757789 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11095c350>]}
[0m21:53:03.758510 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_artists ................. [[31mERROR[0m in 0.51s]
[0m21:53:03.759173 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:53:03.787489 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.491 seconds
[0m21:53:03.804828 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:53:03.890203 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10638be30>]}
[0m21:53:03.890882 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.65s]
[0m21:53:03.891416 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:53:04.088829 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.795 seconds
[0m21:53:04.093813 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:53:04.203461 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11096f890>]}
[0m21:53:04.204247 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 0.96s]
[0m21:53:04.204655 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:53:04.205394 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:53:04.205825 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:53:04.206123 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:53:04.206282 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:53:04.208162 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:04.209127 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:53:04.213035 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:04.214085 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:04.214443 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:53:04.214746 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:53:04.648893 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.434 seconds
[0m21:53:04.652431 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:53:04.756197 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcfd21a8-0a46-4d5c-94f4-9db696fe5fe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065364d0>]}
[0m21:53:04.757364 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.55s]
[0m21:53:04.758277 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:53:04.760384 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:53:04.760777 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:53:04.761088 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:53:04.761377 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:53:04.761648 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:53:04.762055 [info ] [MainThread]: 
[0m21:53:04.762370 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.66 seconds (2.66s).
[0m21:53:04.763709 [debug] [MainThread]: Command end result
[0m21:53:04.789812 [info ] [MainThread]: 
[0m21:53:04.790128 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:53:04.790316 [info ] [MainThread]: 
[0m21:53:04.790548 [error] [MainThread]:   Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:53:04.790737 [info ] [MainThread]: 
[0m21:53:04.790919 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m21:53:04.792344 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.1179156, "process_user_time": 1.379361, "process_kernel_time": 0.184485, "process_mem_max_rss": "145014784", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:53:04.792803 [debug] [MainThread]: Command `dbt run` failed at 21:53:04.792725 after 3.12 seconds
[0m21:53:04.793072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106516350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101186120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104657110>]}
[0m21:53:04.793286 [debug] [MainThread]: Flushing usage events
[0m21:53:27.169452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10493e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bb7c50>]}


============================== 21:53:27.171516 | 8c2c7299-1131-4349-bff4-20ad96f94e78 ==============================
[0m21:53:27.171516 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:53:27.171834 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:53:27.331148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078fa190>]}
[0m21:53:27.353388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078786b0>]}
[0m21:53:27.353836 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:53:27.363149 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:53:27.419138 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:53:27.419502 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:53:27.518241 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b87950>]}
[0m21:53:27.561992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078b0320>]}
[0m21:53:27.562295 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:53:27.562465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b05010>]}
[0m21:53:27.563454 [info ] [MainThread]: 
[0m21:53:27.563755 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:53:27.565957 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:53:27.593405 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:53:27.593676 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:53:27.593810 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:53:27.975339 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.381 seconds
[0m21:53:27.977461 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:53:28.089943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:53:28.099837 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:53:28.100247 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:53:28.100520 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:53:28.395489 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.295 seconds
[0m21:53:28.401652 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:53:28.490761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ad8530>]}
[0m21:53:28.491629 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:53:28.492068 [info ] [MainThread]: 
[0m21:53:28.495218 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:53:28.495692 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:53:28.496112 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:53:28.496639 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:53:28.497149 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:53:28.497632 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:53:28.498338 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:53:28.498845 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:53:28.499206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:53:28.499598 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:53:28.499898 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:53:28.500233 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:53:28.508139 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:28.510591 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:53:28.512682 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:53:28.513585 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:53:28.513915 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:53:28.520705 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:53:28.540938 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:53:28.549739 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:28.551243 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:53:28.551925 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:53:28.552142 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    SOURCE_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM SOURCE_DATA
LIMIT 5
  );
[0m21:53:28.552574 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:53:28.552740 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:53:28.553070 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:53:28.553250 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    BILLBOARD_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    ARTIST_DATA AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist_name,
    artist_data.country,
    artist_data.genre
FROM BILLBOARD_DATA
LEFT JOIN ARTIST_DATA
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:53:28.553853 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:53:28.554223 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:53:28.554414 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:53:28.907149 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b7e929-0203-971d-0003-07620001f4ae
[0m21:53:28.907792 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 15 at position 4
invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
[0m21:53:28.908275 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:53:29.001637 [debug] [Thread-1 (]: Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:53:29.003461 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fa4050>]}
[0m21:53:29.004141 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_artists ................. [[31mERROR[0m in 0.50s]
[0m21:53:29.004724 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:53:29.064861 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.512 seconds
[0m21:53:29.086895 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:53:29.182050 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106753e30>]}
[0m21:53:29.182855 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.68s]
[0m21:53:29.183341 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:53:29.773323 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.218 seconds
[0m21:53:29.777375 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:53:29.873430 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fe72f0>]}
[0m21:53:29.874560 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.37s]
[0m21:53:29.875217 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:53:29.876289 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:53:29.877011 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:53:29.877677 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:53:29.878063 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:53:29.881423 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:29.882593 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:53:29.885208 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:29.886492 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:53:29.887085 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:53:29.887470 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:53:30.334974 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.447 seconds
[0m21:53:30.337522 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:53:30.435415 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c2c7299-1131-4349-bff4-20ad96f94e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077eb750>]}
[0m21:53:30.436562 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.56s]
[0m21:53:30.437346 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:53:30.439013 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:53:30.439407 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:53:30.439693 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:53:30.439944 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:53:30.440190 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:53:30.440604 [info ] [MainThread]: 
[0m21:53:30.440951 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.88 seconds (2.88s).
[0m21:53:30.442060 [debug] [MainThread]: Command end result
[0m21:53:30.467539 [info ] [MainThread]: 
[0m21:53:30.467858 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:53:30.468042 [info ] [MainThread]: 
[0m21:53:30.468275 [error] [MainThread]:   Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:53:30.468459 [info ] [MainThread]: 
[0m21:53:30.468640 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m21:53:30.469999 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.329043, "process_user_time": 1.343195, "process_kernel_time": 0.182151, "process_mem_max_rss": "145850368", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:53:30.470332 [debug] [MainThread]: Command `dbt run` failed at 21:53:30.470275 after 3.33 seconds
[0m21:53:30.470559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bda350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1027ca120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105181f10>]}
[0m21:53:30.470989 [debug] [MainThread]: Flushing usage events
[0m21:54:48.483319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10343a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b3c50>]}


============================== 21:54:48.485875 | 0509db5f-7648-469b-9150-440916116c68 ==============================
[0m21:54:48.485875 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:54:48.486184 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:54:48.656136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074fa190>]}
[0m21:54:48.680156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074786b0>]}
[0m21:54:48.680684 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:54:48.689758 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:54:48.748792 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m21:54:48.749194 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:54:48.749376 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/top_5.sql
[0m21:54:48.860456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107787850>]}
[0m21:54:48.905968 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074baa80>]}
[0m21:54:48.906265 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:54:48.906428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b1d010>]}
[0m21:54:48.907412 [info ] [MainThread]: 
[0m21:54:48.907698 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:54:48.909811 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:54:48.918104 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:54:48.918299 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:54:48.918429 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:49.468768 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.550 seconds
[0m21:54:49.471002 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:54:49.567433 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:54:49.578327 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:54:49.578757 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:54:49.579060 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:54:49.994178 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.415 seconds
[0m21:54:49.998427 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:54:50.102788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10744f380>]}
[0m21:54:50.103673 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:54:50.104072 [info ] [MainThread]: 
[0m21:54:50.107585 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:54:50.108205 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:54:50.108614 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:54:50.109292 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:54:50.109952 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:54:50.110487 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:54:50.111069 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:54:50.111442 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:54:50.111823 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:54:50.112130 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:54:50.112423 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:54:50.112752 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:54:50.120908 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:54:50.123105 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:54:50.124823 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:54:50.125900 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:54:50.126299 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:54:50.126582 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:54:50.150584 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:54:50.152330 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:54:50.163966 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:54:50.164613 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:54:50.165091 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:54:50.165289 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m21:54:50.165666 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:54:50.165883 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist_name,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:54:50.166080 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:54:50.166263 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:54:50.166438 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:54:50.166623 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:54:50.508955 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b7e92a-0203-9721-0003-0762000214e2
[0m21:54:50.509377 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 15 at position 4
invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
[0m21:54:50.509717 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:54:50.600805 [debug] [Thread-1 (]: Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:54:50.601988 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e6d6d0>]}
[0m21:54:50.602421 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_artists ................. [[31mERROR[0m in 0.49s]
[0m21:54:50.602833 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:54:50.687876 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.522 seconds
[0m21:54:50.705576 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:54:50.792308 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10614fe30>]}
[0m21:54:50.792989 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.68s]
[0m21:54:50.793532 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:54:50.940375 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.773 seconds
[0m21:54:50.944104 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:54:51.039940 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ee6d50>]}
[0m21:54:51.040907 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 0.93s]
[0m21:54:51.041711 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:54:51.043060 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:54:51.043807 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:54:51.044510 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:54:51.044893 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:54:51.048355 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:54:51.049534 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:54:51.053408 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:54:51.054550 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:54:51.054895 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:54:51.055204 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:54:51.635825 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.580 seconds
[0m21:54:51.639116 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:54:51.737619 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0509db5f-7648-469b-9150-440916116c68', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b465d0>]}
[0m21:54:51.738859 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.69s]
[0m21:54:51.739734 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:54:51.741487 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:54:51.741848 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:54:51.742136 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:54:51.742385 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:54:51.742614 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:54:51.742995 [info ] [MainThread]: 
[0m21:54:51.743562 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.84 seconds (2.84s).
[0m21:54:51.744806 [debug] [MainThread]: Command end result
[0m21:54:51.772810 [info ] [MainThread]: 
[0m21:54:51.773173 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:54:51.773434 [info ] [MainThread]: 
[0m21:54:51.773763 [error] [MainThread]:   Database Error in model hot_100_artists (models/hot_100_artists.sql)
  000904 (42000): SQL compilation error: error line 15 at position 4
  invalid identifier 'BILLBOARD_DATA.ARTIST_NAME'
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:54:51.773975 [info ] [MainThread]: 
[0m21:54:51.774172 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m21:54:51.775400 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.3244023, "process_user_time": 1.396218, "process_kernel_time": 0.195765, "process_mem_max_rss": "145965056", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:54:51.775762 [debug] [MainThread]: Command `dbt run` failed at 21:54:51.775696 after 3.32 seconds
[0m21:54:51.776014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065da350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10118e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065cb4d0>]}
[0m21:54:51.776230 [debug] [MainThread]: Flushing usage events
[0m21:56:03.940030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10753a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121db7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121db7c50>]}


============================== 21:56:03.942245 | 58044289-5c82-4185-87df-c9d3de7856c3 ==============================
[0m21:56:03.942245 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:56:03.942556 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:56:04.101416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122afa190>]}
[0m21:56:04.123599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122a786b0>]}
[0m21:56:04.123995 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:56:04.133601 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:56:04.191041 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:56:04.191415 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:56:04.291614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122deb750>]}
[0m21:56:04.336572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122ab4320>]}
[0m21:56:04.336858 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:56:04.337024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123f35010>]}
[0m21:56:04.338005 [info ] [MainThread]: 
[0m21:56:04.338294 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:56:04.340340 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:56:04.348640 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:56:04.348880 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:56:04.349022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:05.073459 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.724 seconds
[0m21:56:05.074755 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:56:05.165172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:56:05.173055 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:56:05.173365 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:56:05.173572 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:56:05.519425 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.346 seconds
[0m21:56:05.522402 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:56:05.624624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123f00530>]}
[0m21:56:05.625378 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:56:05.625805 [info ] [MainThread]: 
[0m21:56:05.628387 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:56:05.628849 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:56:05.629196 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:56:05.629666 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:56:05.630032 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:56:05.630407 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:56:05.631072 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:56:05.631472 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:56:05.631796 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:56:05.632053 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:56:05.632300 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:56:05.632543 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:56:05.639926 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:56:05.642120 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:56:05.644103 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:05.644961 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:56:05.645310 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:56:05.645586 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:56:05.668854 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:56:05.669773 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:56:05.681748 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:05.682468 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:56:05.682927 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:56:05.683281 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:05.683458 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m21:56:05.683672 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:56:05.683867 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:56:05.684041 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:56:05.684195 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:56:05.684350 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:56:06.137213 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.452 seconds
[0m21:56:06.167437 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:56:06.169227 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.485 seconds
[0m21:56:06.170885 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:56:06.262465 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x123f9bad0>]}
[0m21:56:06.263486 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.63s]
[0m21:56:06.264265 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:56:06.267503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121a8fee0>]}
[0m21:56:06.268098 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.64s]
[0m21:56:06.268663 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:56:06.647293 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.962 seconds
[0m21:56:06.651851 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:56:06.756208 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1249e2fd0>]}
[0m21:56:06.757300 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.12s]
[0m21:56:06.757979 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:56:06.759032 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:56:06.759524 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:56:06.760060 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:56:06.760421 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:56:06.763619 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:06.764553 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:56:06.767237 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:06.768406 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:06.768724 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:56:06.769241 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:56:07.246978 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.478 seconds
[0m21:56:07.249619 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:56:07.339420 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '58044289-5c82-4185-87df-c9d3de7856c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124a9b950>]}
[0m21:56:07.340430 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.58s]
[0m21:56:07.341107 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:56:07.342890 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:56:07.343571 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:56:07.343937 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:56:07.344214 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:56:07.344464 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:56:07.344870 [info ] [MainThread]: 
[0m21:56:07.345186 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 3.01 seconds (3.01s).
[0m21:56:07.346409 [debug] [MainThread]: Command end result
[0m21:56:07.370374 [info ] [MainThread]: 
[0m21:56:07.370734 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:56:07.370931 [info ] [MainThread]: 
[0m21:56:07.371135 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:56:07.372539 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.460864, "process_user_time": 1.336565, "process_kernel_time": 0.178978, "process_mem_max_rss": "145080320", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:56:07.372999 [debug] [MainThread]: Command `dbt run` succeeded at 21:56:07.372919 after 3.46 seconds
[0m21:56:07.373276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121dda350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104972120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1218ff3b0>]}
[0m21:56:07.373521 [debug] [MainThread]: Flushing usage events
[0m21:56:55.148685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aefc50>]}


============================== 21:56:55.151029 | 9404ab04-9c7c-4f4a-ace9-72adf982428c ==============================
[0m21:56:55.151029 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:56:55.151531 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:56:55.326000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061fa190>]}
[0m21:56:55.352404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061786b0>]}
[0m21:56:55.353057 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:56:55.363986 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:56:55.423807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:56:55.424067 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:56:55.444253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106486b50>]}
[0m21:56:55.489531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061b4320>]}
[0m21:56:55.489805 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:56:55.489973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067e9550>]}
[0m21:56:55.490948 [info ] [MainThread]: 
[0m21:56:55.491231 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:56:55.493342 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:56:55.500689 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:56:55.500994 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:56:55.501185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:55.886957 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.386 seconds
[0m21:56:55.889970 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:56:55.993815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:56:56.004222 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:56:56.004657 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:56:56.004988 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:56:56.447848 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.443 seconds
[0m21:56:56.449391 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:56:56.535772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106918ae0>]}
[0m21:56:56.536362 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:56:56.536616 [info ] [MainThread]: 
[0m21:56:56.538709 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:56:56.539242 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:56:56.539599 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:56:56.539943 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:56:56.540234 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:56:56.540617 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:56:56.540913 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:56:56.541231 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:56:56.541713 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:56:56.549134 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:56:56.551906 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:56:56.552166 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:56:56.552396 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:56:56.554355 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:56:56.555992 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:56.556445 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:56:56.611622 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:56:56.614382 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:56:56.615635 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:56:56.615849 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:56:56.626086 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:56.626632 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:56:56.626835 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m21:56:56.626996 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:56:56.627470 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:56:56.627650 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:56:56.627826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:56:56.628978 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:56:56.629338 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:56:56.629685 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:56:57.031508 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.403 seconds
[0m21:56:57.056971 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:56:57.102856 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.476 seconds
[0m21:56:57.105016 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:56:57.145900 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107575850>]}
[0m21:56:57.147330 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.60s]
[0m21:56:57.148014 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:56:57.199841 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10498fee0>]}
[0m21:56:57.200890 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.66s]
[0m21:56:57.201478 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:56:57.540667 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.911 seconds
[0m21:56:57.544726 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:56:57.645513 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061df390>]}
[0m21:56:57.646504 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.10s]
[0m21:56:57.647291 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:56:57.648340 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:56:57.648960 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:56:57.649603 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:56:57.649995 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:56:57.654684 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:57.655921 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:56:57.658361 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:57.659619 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:56:57.660115 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:56:57.660593 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:56:58.104446 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.443 seconds
[0m21:56:58.108504 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:56:58.207045 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9404ab04-9c7c-4f4a-ace9-72adf982428c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065d60d0>]}
[0m21:56:58.208235 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.56s]
[0m21:56:58.208943 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:56:58.211075 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:56:58.211491 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:56:58.211784 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:56:58.212036 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:56:58.212273 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:56:58.212723 [info ] [MainThread]: 
[0m21:56:58.213076 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.72 seconds (2.72s).
[0m21:56:58.214131 [debug] [MainThread]: Command end result
[0m21:56:58.238171 [info ] [MainThread]: 
[0m21:56:58.238524 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:56:58.238733 [info ] [MainThread]: 
[0m21:56:58.238935 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:56:58.240135 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1227486, "process_user_time": 1.27671, "process_kernel_time": 0.191584, "process_mem_max_rss": "140967936", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:56:58.240546 [debug] [MainThread]: Command `dbt run` succeeded at 21:56:58.240471 after 3.12 seconds
[0m21:56:58.240816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b16350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10097e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1035c5190>]}
[0m21:56:58.241048 [debug] [MainThread]: Flushing usage events
[0m21:57:50.626483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10331e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d03ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d03c50>]}


============================== 21:57:50.628858 | 17edd412-3553-435d-8ecb-98500944b9eb ==============================
[0m21:57:50.628858 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:57:50.629198 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:57:50.789730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062f6190>]}
[0m21:57:50.811830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062786b0>]}
[0m21:57:50.812336 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:57:50.822613 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:57:50.881236 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:57:50.881714 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/hot_100_artists.sql
[0m21:57:50.981813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106793950>]}
[0m21:57:51.025374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b8320>]}
[0m21:57:51.025681 [info ] [MainThread]: Found 4 models, 4 data tests, 2 sources, 454 macros
[0m21:57:51.025848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d05010>]}
[0m21:57:51.026825 [info ] [MainThread]: 
[0m21:57:51.027115 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:57:51.029198 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:57:51.038519 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:57:51.038777 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:57:51.038919 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:51.579797 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.540 seconds
[0m21:57:51.582705 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:57:51.679309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:57:51.689982 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:57:51.690363 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:57:51.690631 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:52.079030 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.388 seconds
[0m21:57:52.080334 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:57:52.166320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cdc530>]}
[0m21:57:52.166882 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:52.167141 [info ] [MainThread]: 
[0m21:57:52.168890 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:57:52.169195 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m21:57:52.169586 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m21:57:52.169890 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m21:57:52.170195 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m21:57:52.170491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m21:57:52.170783 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m21:57:52.171122 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m21:57:52.171352 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:57:52.171619 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:57:52.171831 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m21:57:52.176190 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:57:52.178702 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:57:52.180257 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:57:52.181662 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:57:52.182394 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m21:57:52.182726 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:57:52.189245 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m21:57:52.206211 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:57:52.207399 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:57:52.217982 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m21:57:52.218783 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m21:57:52.219232 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:57:52.219416 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m21:57:52.219700 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:57:52.219868 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
    MIN(billboard_data.chart_position)
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m21:57:52.220031 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:57:52.220180 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m21:57:52.220322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:52.220682 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:57:52.609694 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b7e92d-0203-9739-0003-07620001c512
[0m21:57:52.610505 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002022 (42601): SQL compilation error:
Missing column specification
[0m21:57:52.611107 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:57:52.775479 [debug] [Thread-1 (]: Database Error in model hot_100_artists (models/hot_100_artists.sql)
  002022 (42601): SQL compilation error:
  Missing column specification
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:57:52.777590 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113a5310>]}
[0m21:57:52.778337 [error] [Thread-1 (]: 1 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_artists ................. [[31mERROR[0m in 0.61s]
[0m21:57:52.778957 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:57:52.886054 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.665 seconds
[0m21:57:52.911431 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m21:57:53.000411 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a67e30>]}
[0m21:57:53.001433 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.83s]
[0m21:57:53.002117 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m21:57:53.246428 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.026 seconds
[0m21:57:53.251051 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m21:57:53.346420 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114abed0>]}
[0m21:57:53.347391 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.18s]
[0m21:57:53.348189 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m21:57:53.349284 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m21:57:53.349961 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m21:57:53.350625 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m21:57:53.351023 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m21:57:53.354359 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:57:53.355608 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m21:57:53.359644 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m21:57:53.360877 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m21:57:53.361241 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m21:57:53.361554 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:57:53.889896 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.528 seconds
[0m21:57:53.891344 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m21:57:53.980711 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17edd412-3553-435d-8ecb-98500944b9eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10628bdd0>]}
[0m21:57:53.981360 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.63s]
[0m21:57:53.981759 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m21:57:53.982803 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:53.982994 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:57:53.983141 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m21:57:53.983278 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:57:53.983409 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m21:57:53.983616 [info ] [MainThread]: 
[0m21:57:53.983812 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 2.96 seconds (2.96s).
[0m21:57:53.984460 [debug] [MainThread]: Command end result
[0m21:57:54.004229 [info ] [MainThread]: 
[0m21:57:54.004647 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:57:54.004814 [info ] [MainThread]: 
[0m21:57:54.005029 [error] [MainThread]:   Database Error in model hot_100_artists (models/hot_100_artists.sql)
  002022 (42601): SQL compilation error:
  Missing column specification
  compiled code at target/run/billboard_hot_100/models/hot_100_artists.sql
[0m21:57:54.005188 [info ] [MainThread]: 
[0m21:57:54.005351 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m21:57:54.006442 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.409617, "process_user_time": 1.359686, "process_kernel_time": 0.180972, "process_mem_max_rss": "143556608", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:57:54.006833 [debug] [MainThread]: Command `dbt run` failed at 21:57:54.006769 after 3.41 seconds
[0m21:57:54.007048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d2a350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101572120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d17290>]}
[0m21:57:54.007238 [debug] [MainThread]: Flushing usage events
[0m13:07:32.405086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10517a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefc50>]}


============================== 13:07:32.407471 | 320ff169-4ee4-42b4-b2d0-09c80a6d0d5f ==============================
[0m13:07:32.407471 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:07:32.407803 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:07:32.676080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104fa190>]}
[0m13:07:32.698282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104786b0>]}
[0m13:07:32.698875 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:07:32.716303 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:07:32.767330 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:07:32.767716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107eae50>]}
[0m13:07:33.372635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b616d0>]}
[0m13:07:33.426125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113847070>]}
[0m13:07:33.426422 [info ] [MainThread]: Found 5 models, 4 data tests, 2 sources, 454 macros
[0m13:07:33.426596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ba3c70>]}
[0m13:07:33.427547 [info ] [MainThread]: 
[0m13:07:33.427813 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:07:33.429869 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:07:33.436316 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:07:33.436496 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:07:33.436619 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:34.255395 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.819 seconds
[0m13:07:34.258149 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:07:34.600759 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:07:34.610541 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:07:34.610869 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:07:34.611106 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:07:35.233266 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.622 seconds
[0m13:07:35.236861 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:07:35.353691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ba04d0>]}
[0m13:07:35.354460 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:07:35.354832 [info ] [MainThread]: 
[0m13:07:35.359481 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.my_first_dbt_model
[0m13:07:35.359904 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:07:35.360417 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.my_first_dbt_model ...................... [RUN]
[0m13:07:35.361018 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:07:35.361512 [info ] [Thread-3 (]: 3 of 4 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m13:07:35.362099 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_first_dbt_model'
[0m13:07:35.362535 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m13:07:35.363089 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:07:35.363473 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.my_first_dbt_model
[0m13:07:35.363825 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:07:35.364150 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:07:35.370930 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.my_first_dbt_model"
[0m13:07:35.371279 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:07:35.374137 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:07:35.376408 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:07:35.377028 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.my_first_dbt_model
[0m13:07:35.394704 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.my_first_dbt_model"
[0m13:07:35.395162 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:07:35.401379 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:07:35.405059 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:07:35.406339 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:07:35.406806 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.my_first_dbt_model"
[0m13:07:35.407096 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_first_dbt_model"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.my_first_dbt_model
         as
        (/*
    Welcome to your first dbt model!
    Did you know that you can also configure models directly within SQL files?
    This will override configurations stated in dbt_project.yml

    Try changing "table" to "view" below
*/



with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null
        );
[0m13:07:35.407280 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:07:35.408239 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:07:35.408468 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m13:07:35.409026 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:07:35.409317 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:07:35.409517 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m13:07:35.409729 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:07:35.936984 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.527 seconds
[0m13:07:35.952360 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:07:36.052978 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ca0e10>]}
[0m13:07:36.054104 [info ] [Thread-3 (]: 3 of 4 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.69s]
[0m13:07:36.054816 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:07:36.110383 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.700 seconds
[0m13:07:36.112526 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:07:36.201260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d3c9b0>]}
[0m13:07:36.201973 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.84s]
[0m13:07:36.202476 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:07:36.842421 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.434 seconds
[0m13:07:36.846850 [debug] [Thread-2 (]: On model.billboard_hot_100.my_first_dbt_model: Close
[0m13:07:36.938812 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bc3550>]}
[0m13:07:36.939274 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.my_first_dbt_model ................. [[32mSUCCESS 1[0m in 1.58s]
[0m13:07:36.939565 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.my_first_dbt_model
[0m13:07:36.939917 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.my_second_dbt_model
[0m13:07:36.940231 [info ] [Thread-4 (]: 4 of 4 START sql view model BB_SCHEMA.my_second_dbt_model ...................... [RUN]
[0m13:07:36.940575 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.my_second_dbt_model'
[0m13:07:36.940782 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.my_second_dbt_model
[0m13:07:36.942124 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.my_second_dbt_model"
[0m13:07:36.942634 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.my_second_dbt_model
[0m13:07:36.944325 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.my_second_dbt_model"
[0m13:07:36.944823 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.my_second_dbt_model"
[0m13:07:36.945012 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.my_second_dbt_model"} */
create or replace   view BB_DATABASE.BB_SCHEMA.my_second_dbt_model
  
   as (
    -- Use the `ref` function to select from other models

select *
from BB_DATABASE.BB_SCHEMA.my_first_dbt_model
where id = 1
  );
[0m13:07:36.945183 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:07:37.416003 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.470 seconds
[0m13:07:37.420151 [debug] [Thread-4 (]: On model.billboard_hot_100.my_second_dbt_model: Close
[0m13:07:37.522577 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '320ff169-4ee4-42b4-b2d0-09c80a6d0d5f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c4acf0>]}
[0m13:07:37.523741 [info ] [Thread-4 (]: 4 of 4 OK created sql view model BB_SCHEMA.my_second_dbt_model ................. [[32mSUCCESS 1[0m in 0.58s]
[0m13:07:37.524563 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.my_second_dbt_model
[0m13:07:37.526294 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:07:37.526607 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:07:37.526855 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_first_dbt_model' was properly closed.
[0m13:07:37.527081 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:07:37.527309 [debug] [MainThread]: Connection 'model.billboard_hot_100.my_second_dbt_model' was properly closed.
[0m13:07:37.527745 [info ] [MainThread]: 
[0m13:07:37.528079 [info ] [MainThread]: Finished running 3 view models, 1 table model in 0 hours 0 minutes and 4.10 seconds (4.10s).
[0m13:07:37.529127 [debug] [MainThread]: Command end result
[0m13:07:37.558746 [info ] [MainThread]: 
[0m13:07:37.559071 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:07:37.559255 [info ] [MainThread]: 
[0m13:07:37.559443 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m13:07:37.560583 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.1840916, "process_user_time": 1.782669, "process_kernel_time": 0.195927, "process_mem_max_rss": "146669568", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:07:37.560919 [debug] [MainThread]: Command `dbt run` succeeded at 13:07:37.560860 after 5.18 seconds
[0m13:07:37.561150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aaacf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10576c2f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c11b50>]}
[0m13:07:37.561363 [debug] [MainThread]: Flushing usage events
[0m13:07:56.881859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103b3c50>]}


============================== 13:07:56.884598 | 22da684c-1418-42b8-a07b-aa0697997259 ==============================
[0m13:07:56.884598 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:07:56.884932 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:07:57.058529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119f6190>]}
[0m13:07:57.084229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119786b0>]}
[0m13:07:57.084779 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:07:57.094022 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:07:57.155788 [debug] [MainThread]: Partial parsing enabled: 3 files deleted, 0 files added, 0 files changed.
[0m13:07:57.156159 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/example/my_first_dbt_model.sql
[0m13:07:57.156300 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/example/my_second_dbt_model.sql
[0m13:07:57.184964 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.billboard_hot_100.example
[0m13:07:57.190796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112567450>]}
[0m13:07:57.231668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119b8320>]}
[0m13:07:57.231967 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:07:57.232127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127a1550>]}
[0m13:07:57.233418 [info ] [MainThread]: 
[0m13:07:57.233733 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:07:57.235743 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:07:57.243138 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:07:57.243400 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:07:57.243538 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:07:57.824924 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.581 seconds
[0m13:07:57.826420 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:07:57.913744 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:07:57.918623 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:07:57.918871 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:07:57.919010 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:07:58.452216 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.533 seconds
[0m13:07:58.455472 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:07:58.556540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112795e60>]}
[0m13:07:58.557270 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:07:58.557563 [info ] [MainThread]: 
[0m13:07:58.560241 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m13:07:58.560642 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:07:58.561109 [info ] [Thread-2 (]: 2 of 2 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m13:07:58.561499 [info ] [Thread-1 (]: 1 of 2 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m13:07:58.561929 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:07:58.562209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:07:58.562465 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:07:58.562701 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:07:58.639486 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:07:58.640747 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:07:58.641306 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:07:58.647843 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m13:07:58.658577 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:07:58.660730 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:07:58.661463 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:07:58.661654 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m13:07:58.661950 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:07:58.662109 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:07:58.662270 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m13:07:58.662656 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:07:59.163245 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.501 seconds
[0m13:07:59.188455 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:07:59.199030 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.536 seconds
[0m13:07:59.200867 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m13:07:59.284167 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113349550>]}
[0m13:07:59.285073 [info ] [Thread-1 (]: 1 of 2 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.72s]
[0m13:07:59.285783 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:07:59.300973 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '22da684c-1418-42b8-a07b-aa0697997259', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f4fee0>]}
[0m13:07:59.301880 [info ] [Thread-2 (]: 2 of 2 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.74s]
[0m13:07:59.302754 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m13:07:59.304315 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:07:59.304702 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:07:59.304943 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:07:59.305277 [info ] [MainThread]: 
[0m13:07:59.305625 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.07 seconds (2.07s).
[0m13:07:59.306451 [debug] [MainThread]: Command end result
[0m13:07:59.327980 [info ] [MainThread]: 
[0m13:07:59.328327 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:07:59.328533 [info ] [MainThread]: 
[0m13:07:59.328732 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m13:07:59.329917 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4792519, "process_user_time": 1.199795, "process_kernel_time": 0.18245, "process_mem_max_rss": "141066240", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:07:59.330268 [debug] [MainThread]: Command `dbt run` succeeded at 13:07:59.330209 after 2.48 seconds
[0m13:07:59.330513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133653b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133dbd10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126684d0>]}
[0m13:07:59.330726 [debug] [MainThread]: Flushing usage events
[0m13:15:16.624500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065fe660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121cb3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121cb3c50>]}


============================== 13:15:16.627089 | 4c66701f-980d-4ee6-9776-f7ed9d4a88c5 ==============================
[0m13:15:16.627089 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:15:16.627395 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:15:16.842060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c66701f-980d-4ee6-9776-f7ed9d4a88c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1232f6190>]}
[0m13:15:16.864383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c66701f-980d-4ee6-9776-f7ed9d4a88c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1232786b0>]}
[0m13:15:16.865884 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:15:16.876562 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:15:16.940319 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m13:15:16.940674 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/transforms/hot_100_flat.py
[0m13:15:16.940813 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/hot_100_flattened.sql
[0m13:15:17.014124 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.billboard_hot_100.hot_100_flat' (models/transforms/hot_100_flat.py) depends on a node named 'billboard_hot_100' which was not found
[0m13:15:17.017021 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.42201558, "process_user_time": 0.830176, "process_kernel_time": 0.151131, "process_mem_max_rss": "126599168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:15:17.017325 [debug] [MainThread]: Command `dbt run` failed at 13:15:17.017275 after 0.42 seconds
[0m13:15:17.017525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1235eab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1235eaa50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1237f1f40>]}
[0m13:15:17.017689 [debug] [MainThread]: Flushing usage events
[0m13:16:33.266440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f72660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895bed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895bc50>]}


============================== 13:16:33.268901 | c783de8d-7c0d-411f-8eca-f7efcbabedda ==============================
[0m13:16:33.268901 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:16:33.269198 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:33.429306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c783de8d-7c0d-411f-8eca-f7efcbabedda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094da190>]}
[0m13:16:33.451621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c783de8d-7c0d-411f-8eca-f7efcbabedda', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094586b0>]}
[0m13:16:33.452021 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:16:33.462068 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:16:33.513341 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m13:16:33.513834 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/transforms/hot_100_flat.py
[0m13:16:33.513978 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/hot_100_flattened.sql
[0m13:16:33.587896 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.billboard_hot_100.hot_100_flat' (models/transforms/hot_100_flat.py) depends on a source named 'my_database.billboard_hot_100' which was not found
[0m13:16:33.589127 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.3517974, "process_user_time": 0.830409, "process_kernel_time": 0.130046, "process_mem_max_rss": "128434176", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:16:33.589432 [debug] [MainThread]: Command `dbt run` failed at 13:16:33.589378 after 0.35 seconds
[0m13:16:33.589644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a486a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a486b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a68e210>]}
[0m13:16:33.589809 [debug] [MainThread]: Flushing usage events
[0m13:17:21.743178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11823a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a9b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a9b7c50>]}


============================== 13:17:21.745372 | 0bb71350-e7d5-443d-965b-998a4220372b ==============================
[0m13:17:21.745372 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:17:21.745694 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:17:21.908913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11baf6190>]}
[0m13:17:21.931292 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ba786b0>]}
[0m13:17:21.931821 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:17:21.942584 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:17:21.993034 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m13:17:21.993359 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/transforms/hot_100_flat.py
[0m13:17:21.993505 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/hot_100_flattened.sql
[0m13:17:22.086248 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.billboard_hot_100.example
[0m13:17:22.092063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11be93750>]}
[0m13:17:22.137113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11babab70>]}
[0m13:17:22.137405 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:17:22.137564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cb3c9f0>]}
[0m13:17:22.138508 [info ] [MainThread]: 
[0m13:17:22.138804 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:17:22.140821 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:17:22.149093 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:17:22.149326 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:17:22.149458 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:17:22.733786 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.584 seconds
[0m13:17:22.736627 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:17:22.845164 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:17:22.855863 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:17:22.856299 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:17:22.856583 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:17:23.179818 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.323 seconds
[0m13:17:23.182764 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:17:23.279834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cab0d50>]}
[0m13:17:23.280500 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:17:23.280709 [info ] [MainThread]: 
[0m13:17:23.283772 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:17:23.284078 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:17:23.284409 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m13:17:23.284715 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:17:23.285051 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:17:23.285373 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:17:23.285665 [info ] [Thread-3 (]: 3 of 3 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m13:17:23.285975 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:17:23.286226 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:17:23.286558 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:17:23.286838 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:17:23.291466 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:17:23.294166 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:17:23.308757 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:17:23.311982 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:17:23.312647 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:17:23.312901 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:17:23.318828 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:17:23.341107 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:17:23.347378 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:17:23.353168 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:17:23.353822 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:17:23.354133 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:17:23.354789 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:17:23.354976 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m13:17:23.355194 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m13:17:23.355467 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:17:23.355746 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:23.355916 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:17:23.356073 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:17:23.780408 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.424 seconds
[0m13:17:23.793720 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:17:23.872178 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.516 seconds
[0m13:17:23.873959 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:17:23.883320 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ced8d10>]}
[0m13:17:23.883802 [info ] [Thread-3 (]: 3 of 3 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.60s]
[0m13:17:23.884235 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:17:23.956649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a84fee0>]}
[0m13:17:23.957467 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.67s]
[0m13:17:23.958079 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:17:32.204926 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 8.848 seconds
[0m13:17:32.208378 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:17:32.311621 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0bb71350-e7d5-443d-965b-998a4220372b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cff4b90>]}
[0m13:17:32.312635 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 9.03s]
[0m13:17:32.313335 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:17:32.315079 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:17:32.315395 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:17:32.315650 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:17:32.315885 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:17:32.316265 [info ] [MainThread]: 
[0m13:17:32.316588 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 10.18 seconds (10.18s).
[0m13:17:32.317529 [debug] [MainThread]: Command end result
[0m13:17:32.343110 [info ] [MainThread]: 
[0m13:17:32.343456 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:17:32.343658 [info ] [MainThread]: 
[0m13:17:32.343855 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:17:32.345099 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 10.632247, "process_user_time": 1.285141, "process_kernel_time": 0.181933, "process_mem_max_rss": "144261120", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:17:32.345386 [debug] [MainThread]: Command `dbt run` succeeded at 13:17:32.345341 after 10.63 seconds
[0m13:17:32.345588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bfe29d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bac5650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a9da350>]}
[0m13:17:32.345757 [debug] [MainThread]: Flushing usage events
[0m13:17:36.492644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111b3c50>]}


============================== 13:17:36.495056 | 2b2bddc9-00a2-45fc-98b2-f0a656b853eb ==============================
[0m13:17:36.495056 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:17:36.495415 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:17:36.653706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127f6190>]}
[0m13:17:36.675704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127786b0>]}
[0m13:17:36.676098 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:17:36.685503 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:17:36.734421 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:17:36.734663 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:17:36.737195 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.billboard_hot_100.example
[0m13:17:36.749218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c92550>]}
[0m13:17:36.789904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127bab70>]}
[0m13:17:36.790199 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:17:36.790364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112eb52b0>]}
[0m13:17:36.791629 [info ] [MainThread]: 
[0m13:17:36.791929 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:17:36.794012 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:17:36.801304 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:17:36.801521 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:17:36.801656 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:17:37.167888 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.366 seconds
[0m13:17:37.170834 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:17:37.273457 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:17:37.284231 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:17:37.284584 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:17:37.284853 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:17:37.689330 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.404 seconds
[0m13:17:37.693252 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:17:37.794307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e97450>]}
[0m13:17:37.795084 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:17:37.795456 [info ] [MainThread]: 
[0m13:17:37.798535 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:17:37.798956 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:17:37.799487 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:17:37.799927 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:17:37.800407 [info ] [Thread-3 (]: 3 of 3 START sql view model BB_SCHEMA.top_5 .................................... [RUN]
[0m13:17:37.801014 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:17:37.801831 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_artists .......................... [RUN]
[0m13:17:37.802477 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:17:37.802900 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:17:37.803280 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:17:37.803611 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:17:37.819426 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:17:37.827286 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:17:37.831168 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:17:37.878736 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:17:37.879480 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:17:37.885009 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:17:37.896450 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:17:37.896703 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:17:37.902578 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:17:37.908060 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:17:37.908691 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:17:37.908890 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_artists
  
   as (
    -- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
  );
[0m13:17:37.909061 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:17:37.909703 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:17:37.909967 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:17:37.910413 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:17:37.910877 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace   view BB_DATABASE.BB_SCHEMA.top_5
  
   as (
    -- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
  );
[0m13:17:37.911220 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:17:37.911403 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:17:38.420590 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.511 seconds
[0m13:17:38.435377 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:17:38.506737 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.595 seconds
[0m13:17:38.508376 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:17:38.551208 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bbd490>]}
[0m13:17:38.551847 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_artists ..................... [[32mSUCCESS 1[0m in 0.75s]
[0m13:17:38.552335 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:17:38.601442 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110353ee0>]}
[0m13:17:38.602118 [info ] [Thread-3 (]: 3 of 3 OK created sql view model BB_SCHEMA.top_5 ............................... [[32mSUCCESS 1[0m in 0.80s]
[0m13:17:38.602469 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:17:42.755095 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.843 seconds
[0m13:17:42.761295 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:17:42.854121 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b2bddc9-00a2-45fc-98b2-f0a656b853eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127aa850>]}
[0m13:17:42.854962 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 5.05s]
[0m13:17:42.855435 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:17:42.856758 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:17:42.856973 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:17:42.857160 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:17:42.857324 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:17:42.857589 [info ] [MainThread]: 
[0m13:17:42.857796 [info ] [MainThread]: Finished running 2 view models, 1 table model in 0 hours 0 minutes and 6.07 seconds (6.07s).
[0m13:17:42.858392 [debug] [MainThread]: Command end result
[0m13:17:42.876263 [info ] [MainThread]: 
[0m13:17:42.876577 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:17:42.876729 [info ] [MainThread]: 
[0m13:17:42.876877 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:17:42.877878 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.4154387, "process_user_time": 1.190971, "process_kernel_time": 0.160514, "process_mem_max_rss": "140492800", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:17:42.878177 [debug] [MainThread]: Command `dbt run` succeeded at 13:17:42.878127 after 6.42 seconds
[0m13:17:42.878366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c73b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063990d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111da350>]}
[0m13:17:42.878540 [debug] [MainThread]: Flushing usage events
[0m13:22:19.190646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10513a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115b7c50>]}


============================== 13:22:19.192846 | f9f8c274-3fd2-4eae-b631-c35acc7a1622 ==============================
[0m13:22:19.192846 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:22:19.193155 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:22:19.358581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122fa190>]}
[0m13:22:19.381127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122786b0>]}
[0m13:22:19.381541 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:22:19.390174 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:22:19.430325 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m13:22:19.430660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125e8450>]}
[0m13:22:19.937411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122bae40>]}
[0m13:22:19.973885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11280f930>]}
[0m13:22:19.974140 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:22:19.974309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11299bba0>]}
[0m13:22:19.975162 [info ] [MainThread]: 
[0m13:22:19.975428 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:22:19.977403 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:22:19.984005 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:22:19.984231 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:22:19.984364 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:20.549649 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.565 seconds
[0m13:22:20.552718 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:22:20.685557 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:22:20.695651 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:22:20.696098 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:22:20.696372 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:22:21.071719 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.375 seconds
[0m13:22:21.073880 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:22:21.170699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112aa6c90>]}
[0m13:22:21.171587 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:22:21.171974 [info ] [MainThread]: 
[0m13:22:21.175310 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:22:21.175815 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:22:21.176810 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:22:21.176435 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:22:21.177457 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:22:21.177900 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:22:21.178398 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:22:21.178894 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:22:21.179325 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:22:21.179690 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:22:21.180015 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:22:21.180307 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:22:21.188974 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:22:21.197341 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:22:21.206595 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:22:21.207431 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:22:21.213929 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:22:21.218837 [debug] [Thread-1 (]: Dropping relation "BB_DATABASE"."BB_SCHEMA"."HOT_100_ARTISTS" because it is of type view
[0m13:22:21.220052 [debug] [Thread-3 (]: Dropping relation "BB_DATABASE"."BB_SCHEMA"."TOP_5" because it is of type view
[0m13:22:21.220323 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:22:21.224862 [debug] [Thread-1 (]: Applying DROP to: "BB_DATABASE"."BB_SCHEMA"."HOT_100_ARTISTS"
[0m13:22:21.225975 [debug] [Thread-3 (]: Applying DROP to: "BB_DATABASE"."BB_SCHEMA"."TOP_5"
[0m13:22:21.234572 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:22:21.238309 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:22:21.238770 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:22:21.239004 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
drop view if exists "BB_DATABASE"."BB_SCHEMA"."HOT_100_ARTISTS" cascade
[0m13:22:21.239231 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
drop view if exists "BB_DATABASE"."BB_SCHEMA"."TOP_5" cascade
[0m13:22:21.239424 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:22:21.239579 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:22:21.241118 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:22:21.241513 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:22:21.241845 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:22:21.650838 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.411 seconds
[0m13:22:21.653371 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:22:21.655489 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:22:21.655958 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:22:21.694655 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.455 seconds
[0m13:22:21.697639 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:22:21.699231 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:22:21.699730 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:22:22.308604 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.608 seconds
[0m13:22:22.334314 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:22:22.437147 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140efc20>]}
[0m13:22:22.438146 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.26s]
[0m13:22:22.438838 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:22:22.444704 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.788 seconds
[0m13:22:22.447668 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:22:22.558016 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129f77f0>]}
[0m13:22:22.559367 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.38s]
[0m13:22:22.560182 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:22:25.170410 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.928 seconds
[0m13:22:25.172725 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:22:25.258573 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f9f8c274-3fd2-4eae-b631-c35acc7a1622', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134ef9d0>]}
[0m13:22:25.259535 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.08s]
[0m13:22:25.260156 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:22:25.261809 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:22:25.262137 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:22:25.262370 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:22:25.262581 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:22:25.262918 [info ] [MainThread]: 
[0m13:22:25.263207 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.29 seconds (5.29s).
[0m13:22:25.264041 [debug] [MainThread]: Command end result
[0m13:22:25.286625 [info ] [MainThread]: 
[0m13:22:25.286978 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:22:25.287189 [info ] [MainThread]: 
[0m13:22:25.287396 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:22:25.288598 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.1265335, "process_user_time": 1.674206, "process_kernel_time": 0.183003, "process_mem_max_rss": "146653184", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:22:25.288948 [debug] [MainThread]: Command `dbt run` succeeded at 13:22:25.288879 after 6.13 seconds
[0m13:22:25.289178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115da350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f02120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111f30b0>]}
[0m13:22:25.289402 [debug] [MainThread]: Flushing usage events
[0m13:23:38.892397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108defed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108defc50>]}


============================== 13:23:38.894701 | 5bdc6944-4313-43bf-8fbb-519395fbc239 ==============================
[0m13:23:38.894701 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:23:38.895000 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:23:39.067714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3fa190>]}
[0m13:23:39.092405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3786b0>]}
[0m13:23:39.093037 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:23:39.104110 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:23:39.154640 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:23:39.155036 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:23:39.251509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6eb750>]}
[0m13:23:39.290332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3bab70>]}
[0m13:23:39.290629 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:23:39.290791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac30910>]}
[0m13:23:39.291694 [info ] [MainThread]: 
[0m13:23:39.291973 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:23:39.293976 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:23:39.302164 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:23:39.302416 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:23:39.302547 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:23:39.799206 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.496 seconds
[0m13:23:39.802043 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:23:39.898127 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:23:39.908252 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:23:39.908622 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:23:39.908908 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:23:40.271053 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.362 seconds
[0m13:23:40.274767 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:23:40.372910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aba0d50>]}
[0m13:23:40.373741 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:23:40.374194 [info ] [MainThread]: 
[0m13:23:40.377497 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:23:40.377976 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:23:40.378396 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:23:40.378959 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:23:40.379505 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:23:40.380441 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:23:40.381321 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:23:40.381718 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:23:40.382130 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:23:40.382461 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:23:40.382759 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:23:40.383036 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:23:40.391695 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:23:40.400117 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:23:40.410072 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:23:40.411014 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:23:40.411363 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:23:40.417720 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:23:40.430841 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:23:40.436890 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:23:40.437972 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:23:40.438648 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:23:40.438880 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:23:40.439630 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:23:40.439802 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:23:40.440085 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    df["hello"] = "hello"

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:23:40.440599 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:23:40.441196 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:23:40.441564 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:23:40.442046 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:23:41.320892 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.880 seconds
[0m13:23:41.348694 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:23:41.422248 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.980 seconds
[0m13:23:41.424730 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:23:41.447684 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7d5a90>]}
[0m13:23:41.448395 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.06s]
[0m13:23:41.448993 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:23:41.525002 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c8fee0>]}
[0m13:23:41.525585 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.14s]
[0m13:23:41.525941 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:23:44.211526 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.770 seconds
[0m13:23:44.216557 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:23:44.306273 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5bdc6944-4313-43bf-8fbb-519395fbc239', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0b1810>]}
[0m13:23:44.307295 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 3.93s]
[0m13:23:44.307957 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:23:44.309642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:23:44.309998 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:23:44.310269 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:23:44.310510 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:23:44.310885 [info ] [MainThread]: 
[0m13:23:44.311208 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.02 seconds (5.02s).
[0m13:23:44.312202 [debug] [MainThread]: Command end result
[0m13:23:44.337189 [info ] [MainThread]: 
[0m13:23:44.337489 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:23:44.337637 [info ] [MainThread]: 
[0m13:23:44.337783 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:23:44.338994 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.478355, "process_user_time": 1.305067, "process_kernel_time": 0.17595, "process_mem_max_rss": "144850944", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:23:44.339298 [debug] [MainThread]: Command `dbt run` succeeded at 13:23:44.339245 after 5.48 seconds
[0m13:23:44.339499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a73fc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3b3ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e16350>]}
[0m13:23:44.339676 [debug] [MainThread]: Flushing usage events
[0m13:27:48.106819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f2a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104913ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104913c50>]}


============================== 13:27:48.108884 | e80bb5dd-d890-4947-9082-d8fb519512c5 ==============================
[0m13:27:48.108884 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:27:48.109187 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:27:48.270495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057f6190>]}
[0m13:27:48.292904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057786b0>]}
[0m13:27:48.293372 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:27:48.303689 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:27:48.353124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:27:48.353480 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:27:48.449391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aeb750>]}
[0m13:27:48.486786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b6b70>]}
[0m13:27:48.487077 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:27:48.487243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106960910>]}
[0m13:27:48.488188 [info ] [MainThread]: 
[0m13:27:48.488478 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:27:48.490556 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:27:48.498688 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:27:48.498929 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:27:48.499065 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:27:49.062260 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.563 seconds
[0m13:27:49.065001 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:27:49.171388 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:27:49.182086 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:27:49.182450 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:27:49.182723 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:27:49.571228 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.388 seconds
[0m13:27:49.574033 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:27:49.670073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068ccd50>]}
[0m13:27:49.670840 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:27:49.671219 [info ] [MainThread]: 
[0m13:27:49.674375 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:27:49.674870 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:27:49.675300 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:27:49.675862 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:27:49.676328 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:27:49.677078 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:27:49.677644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:27:49.678185 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:27:49.678617 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:27:49.678954 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:27:49.679242 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:27:49.679526 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:27:49.687387 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:27:49.689248 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:27:49.704626 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:27:49.705189 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:27:49.711731 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:27:49.717481 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:27:49.728704 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:27:49.730655 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:27:49.732956 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:27:49.734022 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:27:49.734476 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:27:49.734770 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['artist'] = df['artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    #df['artist'] = df['artist'].str.split(',')
    #df = df.explode('Artist')

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:27:49.735175 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:27:49.735357 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:27:49.735532 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:27:49.735688 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:27:49.735842 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:27:49.736429 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:27:50.714367 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.978 seconds
[0m13:27:50.735285 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.999 seconds
[0m13:27:50.741004 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:27:50.742504 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:27:50.838759 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069d3710>]}
[0m13:27:50.839400 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df2410>]}
[0m13:27:50.840116 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.16s]
[0m13:27:50.840781 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.16s]
[0m13:27:50.841413 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:27:50.841868 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:27:51.352178 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7eccf-0203-9896-0003-07620002708e
[0m13:27:51.352914 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 100357 (P0000): Python Interpreter Error:
Traceback (most recent call last):
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'artist'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "_udf_code.py", line 110, in main
    df = model(dbt, session)
  File "_udf_code.py", line 20, in model
    df['artist'] = df['artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
    raise KeyError(key) from err
KeyError: 'artist'
 in function HOT_100_FLAT__DBT_SP with handler main
[0m13:27:51.353470 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:27:51.853433 [debug] [Thread-2 (]: Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 110, in main
      df = model(dbt, session)
    File "_udf_code.py", line 20, in model
      df['artist'] = df['artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:27:51.854299 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e80bb5dd-d890-4947-9082-d8fb519512c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1202c1d10>]}
[0m13:27:51.854980 [error] [Thread-2 (]: 2 of 3 ERROR creating python table model BB_SCHEMA.hot_100_flat ................ [[31mERROR[0m in 2.18s]
[0m13:27:51.855642 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:27:51.857872 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:27:51.858144 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:27:51.858357 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:27:51.858558 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:27:51.858885 [info ] [MainThread]: 
[0m13:27:51.859167 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 3.37 seconds (3.37s).
[0m13:27:51.860000 [debug] [MainThread]: Command end result
[0m13:27:51.881080 [info ] [MainThread]: 
[0m13:27:51.881397 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:27:51.881589 [info ] [MainThread]: 
[0m13:27:51.881884 [error] [MainThread]:   Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 110, in main
      df = model(dbt, session)
    File "_udf_code.py", line 20, in model
      df['artist'] = df['artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:27:51.882155 [info ] [MainThread]: 
[0m13:27:51.882336 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:27:51.883739 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.8066, "process_user_time": 1.296555, "process_kernel_time": 0.169512, "process_mem_max_rss": "143163392", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:27:51.884070 [debug] [MainThread]: Command `dbt run` failed at 13:27:51.884014 after 3.81 seconds
[0m13:27:51.884289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d7a3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105de6ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104936350>]}
[0m13:27:51.884487 [debug] [MainThread]: Flushing usage events
[0m13:28:09.765364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029b6660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10439fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10439fc50>]}


============================== 13:28:09.767578 | 426f138b-677d-4a6d-9034-dfe1d052f490 ==============================
[0m13:28:09.767578 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:28:09.767881 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:28:09.924246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bf6190>]}
[0m13:28:09.946447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b786b0>]}
[0m13:28:09.946857 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:28:09.956744 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:28:10.006470 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:28:10.006870 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:28:10.108988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f93750>]}
[0m13:28:10.146238 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb6b70>]}
[0m13:28:10.146537 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:28:10.146710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106428910>]}
[0m13:28:10.147652 [info ] [MainThread]: 
[0m13:28:10.147956 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:28:10.150030 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:28:10.158672 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:28:10.158941 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:28:10.159080 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:28:10.559590 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.400 seconds
[0m13:28:10.562428 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:28:10.656206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:28:10.664957 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:28:10.665304 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:28:10.665530 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:28:11.080473 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.415 seconds
[0m13:28:11.085069 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:28:11.212285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106394d50>]}
[0m13:28:11.213043 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:28:11.213416 [info ] [MainThread]: 
[0m13:28:11.216531 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:28:11.217026 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:28:11.217412 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:28:11.217943 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:28:11.218444 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:28:11.219024 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:28:11.219740 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:28:11.220354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:28:11.220815 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:28:11.221149 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:28:11.221454 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:28:11.221721 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:28:11.230250 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:28:11.239015 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:28:11.250042 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:28:11.250887 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:28:11.251140 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:28:11.257483 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:28:11.274912 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:28:11.277652 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:28:11.278754 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:28:11.279389 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:28:11.280149 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:28:11.280336 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:28:11.280745 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:28:11.281006 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['Artist'] = df['Artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    #df['artist'] = df['artist'].str.split(',')
    #df = df.explode('Artist')

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:28:11.281258 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:28:11.281411 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:28:11.281562 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:28:11.281749 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:28:12.269994 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.989 seconds
[0m13:28:12.283335 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:28:12.364947 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.083 seconds
[0m13:28:12.366956 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:28:12.370495 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d5b50>]}
[0m13:28:12.371066 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.15s]
[0m13:28:12.371548 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:28:12.453814 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104103ee0>]}
[0m13:28:12.454565 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.23s]
[0m13:28:12.454939 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:28:13.034547 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ecd0-0203-989d-0003-07620002a0fa
[0m13:28:13.035136 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 100357 (P0000): Python Interpreter Error:
Traceback (most recent call last):
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'Artist'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "_udf_code.py", line 110, in main
    df = model(dbt, session)
  File "_udf_code.py", line 20, in model
    df['Artist'] = df['Artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
    raise KeyError(key) from err
KeyError: 'Artist'
 in function HOT_100_FLAT__DBT_SP with handler main
[0m13:28:13.035541 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:28:13.147468 [debug] [Thread-2 (]: Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'Artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 110, in main
      df = model(dbt, session)
    File "_udf_code.py", line 20, in model
      df['Artist'] = df['Artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'Artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:28:13.148213 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '426f138b-677d-4a6d-9034-dfe1d052f490', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067b1090>]}
[0m13:28:13.148926 [error] [Thread-2 (]: 2 of 3 ERROR creating python table model BB_SCHEMA.hot_100_flat ................ [[31mERROR[0m in 1.93s]
[0m13:28:13.149593 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:28:13.151804 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:28:13.152093 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:28:13.152327 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:28:13.152533 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:28:13.152861 [info ] [MainThread]: 
[0m13:28:13.153140 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 3.00 seconds (3.00s).
[0m13:28:13.154070 [debug] [MainThread]: Command end result
[0m13:28:13.175837 [info ] [MainThread]: 
[0m13:28:13.176178 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:28:13.176376 [info ] [MainThread]: 
[0m13:28:13.176681 [error] [MainThread]:   Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'Artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 110, in main
      df = model(dbt, session)
    File "_udf_code.py", line 20, in model
      df['Artist'] = df['Artist'].str.replace(r'&|Feat\.', ',;,', regex=True)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'Artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:28:13.177116 [info ] [MainThread]: 
[0m13:28:13.177362 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:28:13.178673 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.4419475, "process_user_time": 1.269098, "process_kernel_time": 0.156142, "process_mem_max_rss": "143736832", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:28:13.178994 [debug] [MainThread]: Command `dbt run` failed at 13:28:13.178936 after 3.44 seconds
[0m13:28:13.179226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bb3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e64250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043c6350>]}
[0m13:28:13.179434 [debug] [MainThread]: Flushing usage events
[0m13:28:22.627604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108523ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108523c50>]}


============================== 13:28:22.630023 | e82df8f2-4210-45b2-9981-7d6d970493c9 ==============================
[0m13:28:22.630023 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:28:22.630329 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:28:22.787623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10909e190>]}
[0m13:28:22.809824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10901c6b0>]}
[0m13:28:22.810334 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:28:22.820104 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:28:22.869373 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:28:22.869736 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:28:22.965924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f3750>]}
[0m13:28:23.003575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10905ab70>]}
[0m13:28:23.003878 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:28:23.004058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109928910>]}
[0m13:28:23.005047 [info ] [MainThread]: 
[0m13:28:23.005349 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:28:23.007501 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:28:23.016554 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:28:23.016809 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:28:23.016942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:28:23.427497 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.410 seconds
[0m13:28:23.430213 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:28:23.530750 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:28:23.538480 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:28:23.538758 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:28:23.538965 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:28:23.967613 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.428 seconds
[0m13:28:23.969913 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:28:24.067793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098a0d50>]}
[0m13:28:24.068540 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:28:24.068897 [info ] [MainThread]: 
[0m13:28:24.071963 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:28:24.072386 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:28:24.072709 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:28:24.073180 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:28:24.073624 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:28:24.074005 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:28:24.074504 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:28:24.074828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:28:24.075849 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:28:24.076302 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:28:24.076662 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:28:24.076957 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:28:24.084851 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:28:24.092883 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:28:24.102293 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:28:24.103058 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:28:24.103379 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:28:24.103612 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:28:24.123360 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:28:24.123564 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:28:24.124753 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:28:24.125792 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:28:24.126135 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:28:24.126455 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['ARTIST'] = df['ARTIST'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    #df['artist'] = df['artist'].str.split(',')
    #df = df.explode('Artist')

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:28:24.126981 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:28:24.127159 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:28:24.127329 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:28:24.127505 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:28:24.127671 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:28:24.127854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:28:25.018050 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.890 seconds
[0m13:28:25.043970 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:28:25.136651 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a3ad0>]}
[0m13:28:25.137541 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.06s]
[0m13:28:25.138352 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:28:25.231363 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.103 seconds
[0m13:28:25.234807 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:28:25.326878 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108283ee0>]}
[0m13:28:25.327878 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.25s]
[0m13:28:25.328703 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:28:28.024526 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.896 seconds
[0m13:28:28.029029 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:28:28.147214 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e82df8f2-4210-45b2-9981-7d6d970493c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7ac730>]}
[0m13:28:28.148250 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.07s]
[0m13:28:28.149053 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:28:28.150908 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:28:28.151219 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:28:28.151468 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:28:28.151696 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:28:28.152052 [info ] [MainThread]: 
[0m13:28:28.152378 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.15 seconds (5.15s).
[0m13:28:28.153298 [debug] [MainThread]: Command end result
[0m13:28:28.177181 [info ] [MainThread]: 
[0m13:28:28.177484 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:28:28.177634 [info ] [MainThread]: 
[0m13:28:28.177787 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:28:28.178816 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.580571, "process_user_time": 1.286254, "process_kernel_time": 0.159966, "process_mem_max_rss": "141819904", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:28:28.179094 [debug] [MainThread]: Command `dbt run` succeeded at 13:28:28.179048 after 5.58 seconds
[0m13:28:28.179280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090556d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085a50d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108546350>]}
[0m13:28:28.179446 [debug] [MainThread]: Flushing usage events
[0m13:29:00.890204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f66660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fb7c50>]}


============================== 13:29:00.892345 | ae7c982a-418a-4c4a-86f7-027f754735ae ==============================
[0m13:29:00.892345 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:29:00.892653 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:29:01.053845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105df6190>]}
[0m13:29:01.076091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d786b0>]}
[0m13:29:01.076510 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:29:01.086441 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:29:01.136085 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:29:01.136461 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:29:01.232220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060eb750>]}
[0m13:29:01.270559 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dbab70>]}
[0m13:29:01.270827 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:29:01.270981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106484910>]}
[0m13:29:01.271833 [info ] [MainThread]: 
[0m13:29:01.272105 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:29:01.274564 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:29:01.283047 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:29:01.283296 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:29:01.283430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:01.856468 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.573 seconds
[0m13:29:01.857487 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:29:01.947026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:29:01.953032 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:29:01.953294 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:29:01.953455 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:29:02.323500 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.370 seconds
[0m13:29:02.326629 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:29:02.432459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f8d50>]}
[0m13:29:02.433271 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:29:02.433643 [info ] [MainThread]: 
[0m13:29:02.436505 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:29:02.437005 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:29:02.437388 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:29:02.437881 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:29:02.438412 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:29:02.439138 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:29:02.439762 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:29:02.440226 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:29:02.440620 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:29:02.440937 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:29:02.441226 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:29:02.441501 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:29:02.448836 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:29:02.451136 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:02.466784 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:02.467500 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:29:02.473567 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:29:02.480186 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:29:02.491278 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:29:02.492910 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:02.494030 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:02.494689 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:29:02.494886 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:29:02.495059 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:29:02.495473 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:29:02.495713 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:29:02.496487 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:29:02.496906 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:29:02.497604 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['ARTIST'] = df['ARTIST'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    # Explode into new rows if multiple artists
    df['ARTIST'] = df['artist'].str.split(',;,')
    df = df.explode('ARTIST')

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:29:02.498076 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:29:03.418338 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.923 seconds
[0m13:29:03.419451 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.922 seconds
[0m13:29:03.449662 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:29:03.450498 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:29:03.538839 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070d9250>]}
[0m13:29:03.540108 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.10s]
[0m13:29:03.540856 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:29:03.542285 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070f2ba0>]}
[0m13:29:03.542777 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.10s]
[0m13:29:03.543202 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:29:04.115708 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ecd1-0203-9896-0003-0762000270d2
[0m13:29:04.116083 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 100357 (P0000): Python Interpreter Error:
Traceback (most recent call last):
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'artist'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "_udf_code.py", line 111, in main
    df = model(dbt, session)
  File "_udf_code.py", line 23, in model
    df['ARTIST'] = df['artist'].str.split(',;,')
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
    raise KeyError(key) from err
KeyError: 'artist'
 in function HOT_100_FLAT__DBT_SP with handler main
[0m13:29:04.116437 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:29:04.214336 [debug] [Thread-2 (]: Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 111, in main
      df = model(dbt, session)
    File "_udf_code.py", line 23, in model
      df['ARTIST'] = df['artist'].str.split(',;,')
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:29:04.214793 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae7c982a-418a-4c4a-86f7-027f754735ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107152350>]}
[0m13:29:04.215228 [error] [Thread-2 (]: 2 of 3 ERROR creating python table model BB_SCHEMA.hot_100_flat ................ [[31mERROR[0m in 1.77s]
[0m13:29:04.215663 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:29:04.217171 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:29:04.217523 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:29:04.217725 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:29:04.217888 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:29:04.218103 [info ] [MainThread]: 
[0m13:29:04.218317 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 2.95 seconds (2.95s).
[0m13:29:04.219032 [debug] [MainThread]: Command end result
[0m13:29:04.235128 [info ] [MainThread]: 
[0m13:29:04.235389 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:29:04.235545 [info ] [MainThread]: 
[0m13:29:04.235785 [error] [MainThread]:   Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 111, in main
      df = model(dbt, session)
    File "_udf_code.py", line 23, in model
      df['ARTIST'] = df['artist'].str.split(',;,')
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:29:04.236200 [info ] [MainThread]: 
[0m13:29:04.236442 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:29:04.237876 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.3784041, "process_user_time": 1.250962, "process_kernel_time": 0.168701, "process_mem_max_rss": "144637952", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:29:04.238222 [debug] [MainThread]: Command `dbt run` failed at 13:29:04.238163 after 3.38 seconds
[0m13:29:04.238455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061d23d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103247150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fda350>]}
[0m13:29:04.238653 [debug] [MainThread]: Flushing usage events
[0m13:29:08.235895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10313a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b3c50>]}


============================== 13:29:08.238085 | 842bdd96-1cd4-4cb8-89ef-366e5c7b6930 ==============================
[0m13:29:08.238085 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:29:08.238404 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:29:08.397518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070fa190>]}
[0m13:29:08.419835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070786b0>]}
[0m13:29:08.420374 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:29:08.431349 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:29:08.480934 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:29:08.481301 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:29:08.577162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107387750>]}
[0m13:29:08.614702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070b6b70>]}
[0m13:29:08.614996 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:29:08.615163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110230910>]}
[0m13:29:08.616096 [info ] [MainThread]: 
[0m13:29:08.616420 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:29:08.618604 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:29:08.626928 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:29:08.627176 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:29:08.627307 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:09.007883 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.380 seconds
[0m13:29:09.010824 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:29:09.110936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:29:09.121662 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:29:09.122072 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:29:09.122343 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:29:09.585715 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.463 seconds
[0m13:29:09.588688 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:29:09.695229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110098d50>]}
[0m13:29:09.696087 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:29:09.696530 [info ] [MainThread]: 
[0m13:29:09.699767 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:29:09.700244 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:29:09.700658 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:29:09.701214 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:29:09.701747 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:29:09.702563 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:29:09.703418 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:29:09.703900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:29:09.704342 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:29:09.704694 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:29:09.704993 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:29:09.705277 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:29:09.713223 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:09.730689 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:29:09.732337 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:09.732999 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:29:09.733289 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:29:09.733578 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:29:09.757743 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:09.758119 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:29:09.760632 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:09.761334 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:29:09.761796 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:29:09.761975 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:29:09.762695 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:29:09.762878 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:29:09.763049 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:29:09.763308 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['ARTIST'] = df['ARTIST'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    # Explode into new rows if multiple artists
    df['ARTIST'] = df['ARTIST'].str.split(',;,')
    df = df.explode('ARTIST')

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:29:09.763561 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:29:09.763968 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:29:10.578216 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.815 seconds
[0m13:29:10.600730 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:29:10.762836 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104d1b50>]}
[0m13:29:10.763898 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.06s]
[0m13:29:10.764599 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:29:10.830804 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.067 seconds
[0m13:29:10.833135 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:29:10.922760 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e53ee0>]}
[0m13:29:10.923862 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.22s]
[0m13:29:10.924669 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:29:14.337200 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.573 seconds
[0m13:29:14.341420 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:29:14.459765 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842bdd96-1cd4-4cb8-89ef-366e5c7b6930', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110493d90>]}
[0m13:29:14.460758 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.76s]
[0m13:29:14.461557 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:29:14.463274 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:29:14.463642 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:29:14.463857 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:29:14.464035 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:29:14.464302 [info ] [MainThread]: 
[0m13:29:14.464533 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.85 seconds (5.85s).
[0m13:29:14.465208 [debug] [MainThread]: Command end result
[0m13:29:14.489312 [info ] [MainThread]: 
[0m13:29:14.489682 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:29:14.489891 [info ] [MainThread]: 
[0m13:29:14.490080 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:29:14.491402 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.2840357, "process_user_time": 1.312661, "process_kernel_time": 0.162578, "process_mem_max_rss": "141819904", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:29:14.491838 [debug] [MainThread]: Command `dbt run` succeeded at 13:29:14.491774 after 6.28 seconds
[0m13:29:14.492043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11000b3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b72fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052da350>]}
[0m13:29:14.492224 [debug] [MainThread]: Flushing usage events
[0m13:29:48.515385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10503e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070f3c50>]}


============================== 13:29:48.517846 | 3b2b9e7e-ac44-4320-979d-12871b64f554 ==============================
[0m13:29:48.517846 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:29:48.518166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:29:48.680581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107efa190>]}
[0m13:29:48.702692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e786b0>]}
[0m13:29:48.703102 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:29:48.712953 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:29:48.762716 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:29:48.763068 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:29:48.858287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108393750>]}
[0m13:29:48.895799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ebab70>]}
[0m13:29:48.896097 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:29:48.896268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109330910>]}
[0m13:29:48.897286 [info ] [MainThread]: 
[0m13:29:48.897630 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:29:48.899770 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:29:48.908723 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:29:48.908966 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:29:48.909099 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:29:49.385722 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.476 seconds
[0m13:29:49.388496 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:29:49.480574 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:29:49.490829 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:29:49.491200 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:29:49.491473 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:29:49.835056 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.343 seconds
[0m13:29:49.838493 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:29:49.931456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090acd50>]}
[0m13:29:49.932426 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:29:49.932845 [info ] [MainThread]: 
[0m13:29:49.936124 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:29:49.936615 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:29:49.937025 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:29:49.937594 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:29:49.938085 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:29:49.939247 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:29:49.938613 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:29:49.939777 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:29:49.940151 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:29:49.940548 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:29:49.940850 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:29:49.946757 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:29:49.964638 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:49.966903 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:49.968672 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:29:49.969422 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:29:49.975764 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:29:49.982206 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:29:49.993512 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:29:49.993769 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:29:49.994869 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:29:49.995489 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:29:49.996260 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:29:49.996438 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:29:49.996856 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:29:49.997135 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    print(df.head())
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df['ARTIST'] = df['ARTIST'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    # Explode into new rows if multiple artists
    df['ARTIST'] = df['ARTIST'].str.split(',;,')
    df = df.explode('ARTIST')
    
    # Stip whitespaces
    df['ARTIST'] = df['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:29:49.997405 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:29:49.997569 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:29:49.997731 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:29:49.998289 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:29:50.828984 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.830 seconds
[0m13:29:50.830198 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.833 seconds
[0m13:29:50.860563 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:29:50.862343 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:29:50.954763 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094d50d0>]}
[0m13:29:50.955554 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.01s]
[0m13:29:50.956146 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:29:50.990672 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f8fe30>]}
[0m13:29:50.991452 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.05s]
[0m13:29:50.991911 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:29:53.954783 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.957 seconds
[0m13:29:53.958847 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:29:54.058106 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b2b9e7e-ac44-4320-979d-12871b64f554', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095b65d0>]}
[0m13:29:54.058938 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.12s]
[0m13:29:54.059520 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:29:54.061130 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:29:54.061472 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:29:54.061722 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:29:54.061949 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:29:54.062284 [info ] [MainThread]: 
[0m13:29:54.062575 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.16 seconds (5.16s).
[0m13:29:54.063409 [debug] [MainThread]: Command end result
[0m13:29:54.083975 [info ] [MainThread]: 
[0m13:29:54.084270 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:29:54.084422 [info ] [MainThread]: 
[0m13:29:54.084568 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:29:54.085807 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.599316, "process_user_time": 1.27948, "process_kernel_time": 0.170036, "process_mem_max_rss": "143015936", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:29:54.086268 [debug] [MainThread]: Command `dbt run` succeeded at 13:29:54.086190 after 5.60 seconds
[0m13:29:54.086536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ec79d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107174cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107116350>]}
[0m13:29:54.086780 [debug] [MainThread]: Flushing usage events
[0m13:31:19.430178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10453a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef3c50>]}


============================== 13:31:19.432576 | 20478086-02c6-4243-bbd4-ca7c8042f612 ==============================
[0m13:31:19.432576 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:31:19.432928 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:31:19.600007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103fa190>]}
[0m13:31:19.622887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103786b0>]}
[0m13:31:19.623391 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:31:19.632388 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:31:19.682480 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:31:19.682838 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:31:19.782657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111093750>]}
[0m13:31:19.823538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103bab70>]}
[0m13:31:19.823820 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:31:19.823977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11152c910>]}
[0m13:31:19.824871 [info ] [MainThread]: 
[0m13:31:19.825160 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:31:19.827541 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:31:19.836634 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:31:19.836834 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:31:19.836964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:31:20.380023 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.543 seconds
[0m13:31:20.381848 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:31:20.494313 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:31:20.504013 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:31:20.504494 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:31:20.504735 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:31:21.348169 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.843 seconds
[0m13:31:21.349847 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:31:21.448595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111497ba0>]}
[0m13:31:21.449392 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:31:21.449734 [info ] [MainThread]: 
[0m13:31:21.452548 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:31:21.452962 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:31:21.453267 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:31:21.453713 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:31:21.454139 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:31:21.454869 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:31:21.455508 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:31:21.455895 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:31:21.456181 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:31:21.456463 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:31:21.456719 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:31:21.456953 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:31:21.469428 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:31:21.478507 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:31:21.480343 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:31:21.481067 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:31:21.481379 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:31:21.487904 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:31:21.505867 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:31:21.506234 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:31:21.507536 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:31:21.508694 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:31:21.509076 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:31:21.509503 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:31:21.509791 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    # Load artist data
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Find artists with "&" or "Feat." and replace with new delimiter ,;,
    df_bb['ARTIST'] = df_bb['ARTIST'].str.replace(r'&|Feat\.', ',;,', regex=True)
    
    # Explode into new rows if multiple artists
    df_bb['ARTIST'] = df_bb['ARTIST'].str.split(',;,')
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:31:21.510079 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:31:21.510256 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:31:21.510422 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:31:21.510560 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:31:21.510713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:31:22.577080 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.066 seconds
[0m13:31:22.593984 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:31:22.611782 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.101 seconds
[0m13:31:22.613293 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:31:22.682150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116d4dd0>]}
[0m13:31:22.682821 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.23s]
[0m13:31:22.683328 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:31:22.700052 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d8fee0>]}
[0m13:31:22.700665 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.24s]
[0m13:31:22.701099 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:31:25.855424 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.345 seconds
[0m13:31:25.859684 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:31:25.963497 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20478086-02c6-4243-bbd4-ca7c8042f612', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117c23f0>]}
[0m13:31:25.964501 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.51s]
[0m13:31:25.965287 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:31:25.966840 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:31:25.967072 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:31:25.967226 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:31:25.967348 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:31:25.967536 [info ] [MainThread]: 
[0m13:31:25.967685 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.14 seconds (6.14s).
[0m13:31:25.968171 [debug] [MainThread]: Command end result
[0m13:31:25.991455 [info ] [MainThread]: 
[0m13:31:25.991813 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:31:25.992000 [info ] [MainThread]: 
[0m13:31:25.992179 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:31:25.993344 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.5978184, "process_user_time": 1.280187, "process_kernel_time": 0.175871, "process_mem_max_rss": "143982592", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:31:25.993654 [debug] [MainThread]: Command `dbt run` succeeded at 13:31:25.993605 after 6.60 seconds
[0m13:31:25.993847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103c76d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031027d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f16350>]}
[0m13:31:25.994024 [debug] [MainThread]: Flushing usage events
[0m13:35:46.858788 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefc50>]}


============================== 13:35:46.860909 | 7a188066-0ee8-47b5-9528-d5823766daa2 ==============================
[0m13:35:46.860909 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:35:46.861220 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:35:47.021071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113f6190>]}
[0m13:35:47.043422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113786b0>]}
[0m13:35:47.043850 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:35:47.054201 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:35:47.104413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:35:47.104818 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:35:47.203437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111687750>]}
[0m13:35:47.239403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113b6b70>]}
[0m13:35:47.239647 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:35:47.239812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b34910>]}
[0m13:35:47.240731 [info ] [MainThread]: 
[0m13:35:47.240987 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:35:47.242908 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:35:47.250917 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:35:47.251169 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:35:47.251304 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:35:47.830465 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.579 seconds
[0m13:35:47.831988 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:35:47.925626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:35:47.934551 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:35:47.934878 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:35:47.935108 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:35:48.323991 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.389 seconds
[0m13:35:48.325903 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:35:48.421715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111987ba0>]}
[0m13:35:48.422594 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:35:48.423045 [info ] [MainThread]: 
[0m13:35:48.426135 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:35:48.426623 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:35:48.427054 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:35:48.427615 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:35:48.428305 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:35:48.428886 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:35:48.429454 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:35:48.429802 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:35:48.430189 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:35:48.430491 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:35:48.430808 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:35:48.431068 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:35:48.445472 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:35:48.456498 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:35:48.458724 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:35:48.459371 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:35:48.459642 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:35:48.465386 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:35:48.484366 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:35:48.484670 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:35:48.485786 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:35:48.486476 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:35:48.487335 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:35:48.487528 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:35:48.487950 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:35:48.488264 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    # Load artist data
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['artist_name'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:35:48.488567 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:35:48.488737 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:35:48.488915 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:35:48.489296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:35:49.442196 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.953 seconds
[0m13:35:49.467496 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:35:49.556451 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127d9910>]}
[0m13:35:49.557410 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.12s]
[0m13:35:49.558087 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:35:49.633558 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.144 seconds
[0m13:35:49.636519 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:35:49.737826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b8fee0>]}
[0m13:35:49.739086 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.31s]
[0m13:35:49.739908 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:35:50.262980 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ecd7-0203-98a1-0003-07620002d0ba
[0m13:35:50.263364 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 100357 (P0000): Python Interpreter Error:
Traceback (most recent call last):
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
    return self._engine.get_loc(casted_key)
  File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'artist_name'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "_udf_code.py", line 127, in main
    df = model(dbt, session)
  File "_udf_code.py", line 21, in model
    artist_set = set(df_artist['artist_name'].str.lower())
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
    indexer = self.columns.get_loc(key)
  File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
    raise KeyError(key) from err
KeyError: 'artist_name'
 in function HOT_100_FLAT__DBT_SP with handler main
[0m13:35:50.263693 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:35:50.358555 [debug] [Thread-2 (]: Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist_name'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 127, in main
      df = model(dbt, session)
    File "_udf_code.py", line 21, in model
      artist_set = set(df_artist['artist_name'].str.lower())
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist_name'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:35:50.359030 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a188066-0ee8-47b5-9528-d5823766daa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128c1bd0>]}
[0m13:35:50.359438 [error] [Thread-2 (]: 2 of 3 ERROR creating python table model BB_SCHEMA.hot_100_flat ................ [[31mERROR[0m in 1.93s]
[0m13:35:50.359874 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:35:50.361180 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:35:50.361402 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:35:50.361567 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:35:50.361716 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:35:50.361899 [info ] [MainThread]: 
[0m13:35:50.362070 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 3.12 seconds (3.12s).
[0m13:35:50.362616 [debug] [MainThread]: Command end result
[0m13:35:50.379778 [info ] [MainThread]: 
[0m13:35:50.380102 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:35:50.380259 [info ] [MainThread]: 
[0m13:35:50.380513 [error] [MainThread]:   Database Error in model hot_100_flat (models/staging/hot_100_flat.py)
  100357 (P0000): Python Interpreter Error:
  Traceback (most recent call last):
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3653, in get_loc
      return self._engine.get_loc(casted_key)
    File "pandas/_libs/index.pyx", line 147, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/index.pyx", line 176, in pandas._libs.index.IndexEngine.get_loc
    File "pandas/_libs/hashtable_class_helper.pxi", line 7080, in pandas._libs.hashtable.PyObjectHashTable.get_item
    File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  KeyError: 'artist_name'
  
  The above exception was the direct cause of the following exception:
  
  Traceback (most recent call last):
    File "_udf_code.py", line 127, in main
      df = model(dbt, session)
    File "_udf_code.py", line 21, in model
      artist_set = set(df_artist['artist_name'].str.lower())
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/frame.py", line 3761, in __getitem__
      indexer = self.columns.get_loc(key)
    File "/usr/lib/python_udf/9c23ea02fe9a0a05519f728d7bbc8f546c3978737ff3c685ea2972a45e70b891/lib/python3.8/site-packages/pandas/core/indexes/base.py", line 3655, in get_loc
      raise KeyError(key) from err
  KeyError: 'artist_name'
   in function HOT_100_FLAT__DBT_SP with handler main
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat.py
[0m13:35:50.380781 [info ] [MainThread]: 
[0m13:35:50.380982 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:35:50.382273 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.5543668, "process_user_time": 1.276761, "process_kernel_time": 0.177447, "process_mem_max_rss": "142737408", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:35:50.382581 [debug] [MainThread]: Command `dbt run` failed at 13:35:50.382521 after 3.55 seconds
[0m13:35:50.382792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117d6ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113c52d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d16350>]}
[0m13:35:50.382982 [debug] [MainThread]: Flushing usage events
[0m13:36:03.176868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116f3c50>]}


============================== 13:36:03.179177 | 01d96776-8933-458f-872d-2bde5f6bcf56 ==============================
[0m13:36:03.179177 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:36:03.179478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:36:03.340072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125f6190>]}
[0m13:36:03.362325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125786b0>]}
[0m13:36:03.362725 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:36:03.372532 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:36:03.422458 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:36:03.422854 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:36:03.519771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128eb750>]}
[0m13:36:03.557363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125b6b70>]}
[0m13:36:03.557695 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:36:03.557895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113900910>]}
[0m13:36:03.558865 [info ] [MainThread]: 
[0m13:36:03.559153 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:36:03.561609 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:36:03.570393 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:36:03.570643 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:36:03.570794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:36:03.999829 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.429 seconds
[0m13:36:04.002522 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:36:04.102218 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:36:04.112882 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:36:04.113296 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:36:04.113563 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:36:04.526318 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.413 seconds
[0m13:36:04.529668 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:36:04.635087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11386bba0>]}
[0m13:36:04.635979 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:36:04.636384 [info ] [MainThread]: 
[0m13:36:04.639509 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:36:04.640056 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:36:04.640463 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m13:36:04.641040 [info ] [Thread-1 (]: 1 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:36:04.641512 [info ] [Thread-2 (]: 2 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:36:04.642365 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:36:04.643094 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_artists)
[0m13:36:04.643627 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat'
[0m13:36:04.644094 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:36:04.644456 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:36:04.645017 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:36:04.645380 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:36:04.657812 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:36:04.666036 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:36:04.671505 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:36:04.672310 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m13:36:04.672595 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:36:04.679191 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:36:04.696797 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:36:04.697176 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:36:04.699803 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:36:04.700600 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:36:04.701465 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:36:04.701661 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre,
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:36:04.701967 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:36:04.702261 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    
    # Load artist data
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:36:04.702569 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:36:04.702736 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:36:04.702887 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:36:04.703066 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:36:05.491901 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.789 seconds
[0m13:36:05.518037 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m13:36:05.526564 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.824 seconds
[0m13:36:05.528176 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:36:05.624040 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139837d0>]}
[0m13:36:05.624793 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111453ee0>]}
[0m13:36:05.625570 [info ] [Thread-1 (]: 1 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.98s]
[0m13:36:05.626175 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.98s]
[0m13:36:05.626773 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:36:05.627208 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m13:36:08.602027 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.898 seconds
[0m13:36:08.606866 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:36:08.705107 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01d96776-8933-458f-872d-2bde5f6bcf56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cc6b70>]}
[0m13:36:08.706157 [info ] [Thread-2 (]: 2 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.06s]
[0m13:36:08.706947 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:36:08.708847 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:36:08.709240 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:36:08.709519 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:36:08.709762 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:36:08.710143 [info ] [MainThread]: 
[0m13:36:08.710471 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 5.15 seconds (5.15s).
[0m13:36:08.711521 [debug] [MainThread]: Command end result
[0m13:36:08.735266 [info ] [MainThread]: 
[0m13:36:08.735620 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:36:08.735819 [info ] [MainThread]: 
[0m13:36:08.736007 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:36:08.737183 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.5892944, "process_user_time": 1.295234, "process_kernel_time": 0.162834, "process_mem_max_rss": "141688832", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:36:08.737534 [debug] [MainThread]: Command `dbt run` succeeded at 13:36:08.737468 after 5.59 seconds
[0m13:36:08.737764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112be6ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124e3950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111716350>]}
[0m13:36:08.737979 [debug] [MainThread]: Flushing usage events
[0m13:38:54.027562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119fefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119fefc50>]}


============================== 13:38:54.030274 | fc3670a6-bd15-4bd4-8efd-d4753203ccc7 ==============================
[0m13:38:54.030274 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:38:54.030586 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:38:54.263276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b5f2190>]}
[0m13:38:54.285546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b5786b0>]}
[0m13:38:54.286204 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:38:54.296668 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:38:54.362047 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m13:38:54.362398 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.py
[0m13:38:54.362573 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m13:38:54.464194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b887750>]}
[0m13:38:54.509967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b5b6b70>]}
[0m13:38:54.510260 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:38:54.510430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c02c910>]}
[0m13:38:54.511365 [info ] [MainThread]: 
[0m13:38:54.511667 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:38:54.513788 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:38:54.522122 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:38:54.522320 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:38:54.522455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:55.183874 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.661 seconds
[0m13:38:55.186880 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:38:55.350392 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:38:55.360915 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:38:55.361351 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:38:55.361629 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:38:55.760183 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.399 seconds
[0m13:38:55.761459 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:38:55.850833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ba73d40>]}
[0m13:38:55.854912 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:38:55.855302 [info ] [MainThread]: 
[0m13:38:55.856836 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m13:38:55.857063 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:38:55.859856 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:38:55.860484 [info ] [Thread-1 (]: 1 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:38:55.863681 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:38:55.863961 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m13:38:55.864236 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:38:55.864529 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:38:55.883615 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:38:55.884511 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:38:55.885049 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:38:55.885268 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m13:38:55.903223 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:38:55.904425 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:38:55.905754 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:38:55.906087 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:38:55.906435 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:38:55.906800 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:38:55.906978 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:55.907127 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:38:57.139937 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.233 seconds
[0m13:38:57.156024 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m13:38:57.241718 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1a1010>]}
[0m13:38:57.242331 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.38s]
[0m13:38:57.242820 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m13:39:00.521715 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.614 seconds
[0m13:39:00.526075 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:39:00.636871 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1edff0>]}
[0m13:39:00.637992 [info ] [Thread-1 (]: 1 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.77s]
[0m13:39:00.638703 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:39:00.639799 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:39:00.640444 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:39:00.641149 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m13:39:00.641548 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:39:00.645626 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:39:00.647048 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:39:00.650472 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:39:00.652118 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:39:00.652469 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:39:00.652772 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:39:01.705449 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.052 seconds
[0m13:39:01.709201 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:39:01.810600 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc3670a6-bd15-4bd4-8efd-d4753203ccc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c1bfa70>]}
[0m13:39:01.811513 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.17s]
[0m13:39:01.812201 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:39:01.813980 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:39:01.814379 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:39:01.814724 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:39:01.814980 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:39:01.815362 [info ] [MainThread]: 
[0m13:39:01.815700 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 7.30 seconds (7.30s).
[0m13:39:01.816595 [debug] [MainThread]: Command end result
[0m13:39:01.838912 [info ] [MainThread]: 
[0m13:39:01.839263 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:39:01.839464 [info ] [MainThread]: 
[0m13:39:01.839659 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:39:01.841474 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.844297, "process_user_time": 1.304494, "process_kernel_time": 0.213749, "process_mem_max_rss": "138952704", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:39:01.841864 [debug] [MainThread]: Command `dbt run` succeeded at 13:39:01.841798 after 7.84 seconds
[0m13:39:01.842107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11bab6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b820950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a016350>]}
[0m13:39:01.842329 [debug] [MainThread]: Flushing usage events
[0m13:42:06.420257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10743a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111df3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111df3c50>]}


============================== 13:42:06.422643 | 6f720c68-345e-411b-894c-d670e0144daa ==============================
[0m13:42:06.422643 [info ] [MainThread]: Running with dbt=1.8.8
[0m13:42:06.422960 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:42:06.584820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cfa190>]}
[0m13:42:06.607062 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c786b0>]}
[0m13:42:06.607500 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m13:42:06.616871 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m13:42:06.667980 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:42:06.668358 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m13:42:06.764554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113feb750>]}
[0m13:42:06.801446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113cbab70>]}
[0m13:42:06.801727 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m13:42:06.801895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147309f0>]}
[0m13:42:06.802806 [info ] [MainThread]: 
[0m13:42:06.803099 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:42:06.805170 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m13:42:06.814079 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m13:42:06.814332 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m13:42:06.814469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:42:07.424253 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.610 seconds
[0m13:42:07.426958 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m13:42:07.528088 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m13:42:07.538435 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m13:42:07.538894 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m13:42:07.539169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:42:07.905234 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.366 seconds
[0m13:42:07.907718 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m13:42:08.002748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114485300>]}
[0m13:42:08.003794 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:42:08.004269 [info ] [MainThread]: 
[0m13:42:08.007624 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m13:42:08.008099 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m13:42:08.008715 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m13:42:08.009270 [info ] [Thread-1 (]: 1 of 3 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m13:42:08.010281 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m13:42:08.010900 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m13:42:08.011288 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m13:42:08.011609 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m13:42:08.025536 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m13:42:08.037834 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m13:42:08.038483 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m13:42:08.051421 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m13:42:08.056271 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m13:42:08.059112 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m13:42:08.059885 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m13:42:08.060992 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m13:42:08.061224 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m13:42:08.061624 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m13:42:08.061991 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:42:08.062168 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:42:09.042914 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.980 seconds
[0m13:42:09.069603 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m13:42:09.162077 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148a0dd0>]}
[0m13:42:09.163141 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.15s]
[0m13:42:09.163824 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m13:42:12.322222 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.259 seconds
[0m13:42:12.328421 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m13:42:12.445743 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148edd30>]}
[0m13:42:12.446736 [info ] [Thread-1 (]: 1 of 3 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.43s]
[0m13:42:12.447492 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m13:42:12.448343 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m13:42:12.449024 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m13:42:12.449762 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m13:42:12.450161 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m13:42:12.454088 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m13:42:12.455277 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m13:42:12.458430 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m13:42:12.459714 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m13:42:12.460096 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m13:42:12.460432 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:42:13.636925 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.176 seconds
[0m13:42:13.640390 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m13:42:13.735471 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f720c68-345e-411b-894c-d670e0144daa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148cba70>]}
[0m13:42:13.736611 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.29s]
[0m13:42:13.737440 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m13:42:13.739242 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:42:13.739551 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m13:42:13.739808 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m13:42:13.740042 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m13:42:13.740393 [info ] [MainThread]: 
[0m13:42:13.740721 [info ] [MainThread]: Finished running 3 table models in 0 hours 0 minutes and 6.94 seconds (6.94s).
[0m13:42:13.741654 [debug] [MainThread]: Command end result
[0m13:42:13.766368 [info ] [MainThread]: 
[0m13:42:13.766745 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:42:13.766941 [info ] [MainThread]: 
[0m13:42:13.767143 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m13:42:13.768346 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.3769135, "process_user_time": 1.313597, "process_kernel_time": 0.176325, "process_mem_max_rss": "142540800", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:42:13.768750 [debug] [MainThread]: Command `dbt run` succeeded at 13:42:13.768652 after 7.38 seconds
[0m13:42:13.769050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140408d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a4d2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e16350>]}
[0m13:42:13.769294 [debug] [MainThread]: Flushing usage events
[0m14:26:51.155549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10383a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b7c50>]}


============================== 14:26:51.158376 | 854c3a89-d35a-4ce7-909a-85fdc85765a4 ==============================
[0m14:26:51.158376 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:26:51.158687 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:26:51.391521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '854c3a89-d35a-4ce7-909a-85fdc85765a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ff6190>]}
[0m14:26:51.414676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '854c3a89-d35a-4ce7-909a-85fdc85765a4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f786b0>]}
[0m14:26:51.415366 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:26:51.425543 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:26:51.491813 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m14:26:51.492153 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:26:51.568478 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.billboard_hot_100.hot_100_flat_SQL' (models/staging/hot_100_flat_SQL.sql) depends on a node named 'billboard_hot_100' which was not found
[0m14:26:51.570328 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.44699925, "process_user_time": 0.853414, "process_kernel_time": 0.16883, "process_mem_max_rss": "126550016", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:26:51.570640 [debug] [MainThread]: Command `dbt run` failed at 14:26:51.570582 after 0.45 seconds
[0m14:26:51.570869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111492c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111492d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116948c0>]}
[0m14:26:51.571086 [debug] [MainThread]: Flushing usage events
[0m14:27:27.585808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10863e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6f3c50>]}


============================== 14:27:27.587952 | c6e768b6-a997-4674-8787-57d0b128450c ==============================
[0m14:27:27.587952 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:27:27.588257 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:27:27.745686 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3fa190>]}
[0m14:27:27.767966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3786b0>]}
[0m14:27:27.768373 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:27:27.778641 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:27:27.829006 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m14:27:27.829340 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:27:27.927946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b687750>]}
[0m14:27:27.972005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bab70>]}
[0m14:27:27.972381 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:27:27.972571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c640ad0>]}
[0m14:27:27.973640 [info ] [MainThread]: 
[0m14:27:27.974018 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:27:27.976339 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:27:27.985108 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:27:27.985362 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:27:27.985499 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:27:28.977493 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.992 seconds
[0m14:27:28.978846 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:27:29.087221 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:27:29.093623 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:27:29.093857 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:27:29.094027 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:27:29.761540 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.667 seconds
[0m14:27:29.765136 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:27:29.892075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba872b0>]}
[0m14:27:29.892859 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:27:29.893183 [info ] [MainThread]: 
[0m14:27:29.897444 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:27:29.897802 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:27:29.898117 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:27:29.898562 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:27:29.898957 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:27:29.899329 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:27:29.899775 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:27:29.900141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:27:29.900479 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:27:29.900753 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:27:29.900993 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:27:29.901227 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:27:29.908833 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:27:29.923574 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:27:29.926277 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:27:29.927136 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:27:29.933666 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:27:29.939597 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:27:29.944645 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:27:29.956922 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:27:29.958196 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:27:29.959546 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:27:29.959888 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:27:29.960143 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    -- Step 1: Split artist names conditionally based on delimiters
    split_artists AS (
        SELECT
            b.*,
            CASE 
                WHEN REGEXP_SUBSTR(ARTIST, '[^&]+') IS NOT NULL AND REGEXP_SUBSTR(ARTIST, '[^Feat\.]+') IS NOT NULL
                    THEN SPLIT(ARTIST, ' & | Feat\.') -- Splits on both "&" and "Feat."
                ELSE ARRAY_CONSTRUCT(ARTIST) -- Keeps original artist if no match
            END AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),

    -- Step 2: Explode the artist_parts array
    exploded_artists AS (
        SELECT
            artist,
            chart_position,
            -- Flatten to create a row per split artist
            TRIM(a.value) AS split_artist
        FROM split_artists,
        TABLE(FLATTEN(input => artist_parts)) a
    ),

    -- Step 3: Validate split artists against the artist data table
    validated_artists AS (
        SELECT
            ea.artist,
            ea.chart_position,
            CASE 
                WHEN LOWER(va.artist_name) IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if none of the splits match
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )

SELECT DISTINCT
    final_artist AS artist,
    MIN(chart_position) AS top_rank
FROM validated_artists
GROUP BY final_artist
ORDER BY top_rank;
[0m14:27:29.960365 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:27:29.960561 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:27:29.961447 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:27:29.961617 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:27:29.961967 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:27:29.963157 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:27:30.576338 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed0b-0203-98a1-0003-07620002d162
[0m14:27:30.577025 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 49 at position 17 unexpected ';'.
[0m14:27:30.577586 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:27:30.693178 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  001003 (42000): SQL compilation error:
  syntax error line 49 at position 17 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:27:30.695045 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6bb950>]}
[0m14:27:30.695744 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.79s]
[0m14:27:30.696540 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:27:31.314210 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.352 seconds
[0m14:27:31.338768 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:27:31.498872 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a453e30>]}
[0m14:27:31.500076 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.60s]
[0m14:27:31.500925 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:27:37.659412 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 7.696 seconds
[0m14:27:37.662114 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:27:37.749487 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d452350>]}
[0m14:27:37.750040 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 7.85s]
[0m14:27:37.750403 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:27:37.750833 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:27:37.751155 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:27:37.751507 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:27:37.751699 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:27:37.753671 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:27:37.754173 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:27:37.755345 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:27:37.756010 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:27:37.756196 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:27:37.756359 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:27:38.753595 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.996 seconds
[0m14:27:38.758476 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:27:38.848383 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6e768b6-a997-4674-8787-57d0b128450c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8a88d0>]}
[0m14:27:38.848963 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.10s]
[0m14:27:38.849335 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:27:38.850196 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:38.850377 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:27:38.850514 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:27:38.850637 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:27:38.850760 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:27:38.850990 [info ] [MainThread]: 
[0m14:27:38.851161 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 10.88 seconds (10.88s).
[0m14:27:38.851715 [debug] [MainThread]: Command end result
[0m14:27:38.869417 [info ] [MainThread]: 
[0m14:27:38.869697 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:27:38.869899 [info ] [MainThread]: 
[0m14:27:38.870161 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  001003 (42000): SQL compilation error:
  syntax error line 49 at position 17 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:27:38.870390 [info ] [MainThread]: 
[0m14:27:38.870716 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:27:38.871719 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 11.31643, "process_user_time": 1.315693, "process_kernel_time": 0.178686, "process_mem_max_rss": "144211968", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:27:38.871997 [debug] [MainThread]: Command `dbt run` failed at 14:27:38.871942 after 11.32 seconds
[0m14:27:38.872194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ba120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d49a510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a497650>]}
[0m14:27:38.872362 [debug] [MainThread]: Flushing usage events
[0m14:32:24.561164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10533e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073efc50>]}


============================== 14:32:24.563289 | 48d12df9-9ad3-4cc5-bf96-2303f1896bea ==============================
[0m14:32:24.563289 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:32:24.563589 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:32:24.723774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101fa190>]}
[0m14:32:24.745956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101786b0>]}
[0m14:32:24.746379 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:32:24.755683 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:32:24.804931 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:32:24.805292 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:32:24.900113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104ea550>]}
[0m14:32:24.944332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101bab70>]}
[0m14:32:24.944680 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:32:24.944859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a2cad0>]}
[0m14:32:24.945827 [info ] [MainThread]: 
[0m14:32:24.946115 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:32:24.948143 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:32:24.957308 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:32:24.957551 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:32:24.957694 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:32:25.706999 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.749 seconds
[0m14:32:25.709541 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:32:25.869280 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:32:25.880203 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:32:25.880590 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:32:25.880866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:32:26.271098 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.390 seconds
[0m14:32:26.275508 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:32:26.377335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11098f1e0>]}
[0m14:32:26.378170 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:32:26.378612 [info ] [MainThread]: 
[0m14:32:26.383055 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:32:26.383581 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:32:26.384005 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:32:26.384592 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:32:26.385091 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:32:26.385501 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:32:26.386028 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:32:26.386427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:32:26.386865 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:32:26.387187 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:32:26.387463 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:32:26.387730 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:32:26.402089 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:32:26.410341 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:32:26.413390 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:32:26.414046 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:32:26.420607 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:32:26.420917 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:32:26.431242 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:32:26.441789 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:32:26.444077 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:32:26.445122 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:32:26.445455 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:32:26.446349 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:32:26.446557 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            CASE 
                WHEN REGEXP_LIKE(ARTIST, '&|Feat\.') THEN REGEXP_SPLIT_TO_ARRAY(ARTIST, ' & | Feat\.')
                ELSE ARRAY_CONSTRUCT(ARTIST)
            END AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            artist,
            chart_position,
            TRIM(a.value) AS split_artist
        FROM split_artists,
        LATERAL FLATTEN(input => artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.artist,
            ea.chart_position,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT DISTINCT
    final_artist AS artist,
    MIN(chart_position) AS top_rank
FROM validated_artists
GROUP BY final_artist
ORDER BY top_rank
  );
[0m14:32:26.446769 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:32:26.447080 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:32:26.447474 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:32:26.447639 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:32:26.447777 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:32:26.850502 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed10-0203-989f-0003-07620002b0fe
[0m14:32:26.851198 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002140 (42601): SQL compilation error:
Unknown function REGEXP_SPLIT_TO_ARRAY
[0m14:32:26.851770 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:32:26.977914 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  002140 (42601): SQL compilation error:
  Unknown function REGEXP_SPLIT_TO_ARRAY
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:32:26.979986 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110aa6e10>]}
[0m14:32:26.980727 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.59s]
[0m14:32:26.981356 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:32:27.661571 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.213 seconds
[0m14:32:27.686765 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:32:27.789330 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107293e30>]}
[0m14:32:27.790910 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.40s]
[0m14:32:27.791742 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:32:31.653623 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.205 seconds
[0m14:32:31.658634 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:32:31.783219 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101234d0>]}
[0m14:32:31.784241 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 5.40s]
[0m14:32:31.785055 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:32:31.786225 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:32:31.786983 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:32:31.787800 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:32:31.788215 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:32:31.792109 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:32:31.793535 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:32:31.797591 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:32:31.799344 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:32:31.799789 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:32:31.800094 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:32:33.218233 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.414 seconds
[0m14:32:33.222127 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:32:33.339118 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48d12df9-9ad3-4cc5-bf96-2303f1896bea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110da45d0>]}
[0m14:32:33.340326 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.55s]
[0m14:32:33.341140 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:32:33.343131 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:32:33.343519 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:32:33.343800 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:32:33.344047 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:32:33.344281 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:32:33.344681 [info ] [MainThread]: 
[0m14:32:33.345033 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 8.40 seconds (8.40s).
[0m14:32:33.346129 [debug] [MainThread]: Command end result
[0m14:32:33.371558 [info ] [MainThread]: 
[0m14:32:33.372127 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:32:33.372319 [info ] [MainThread]: 
[0m14:32:33.372603 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  002140 (42601): SQL compilation error:
  Unknown function REGEXP_SPLIT_TO_ARRAY
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:32:33.372802 [info ] [MainThread]: 
[0m14:32:33.373010 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:32:33.375238 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.846975, "process_user_time": 1.401129, "process_kernel_time": 0.186469, "process_mem_max_rss": "144687104", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:32:33.375754 [debug] [MainThread]: Command `dbt run` failed at 14:32:33.375684 after 8.85 seconds
[0m14:32:33.376069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107416350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10319a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a6210>]}
[0m14:32:33.376302 [debug] [MainThread]: Flushing usage events
[0m14:33:30.491155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107216660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bffed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bffc50>]}


============================== 14:33:30.493350 | 5ca73792-7603-4b66-a31a-f91b631df7b9 ==============================
[0m14:33:30.493350 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:33:30.493642 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:33:30.658265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10977a190>]}
[0m14:33:30.680382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096f86b0>]}
[0m14:33:30.680918 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:33:30.692416 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:33:30.744370 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:33:30.744731 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:33:30.841485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ace550>]}
[0m14:33:30.880711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109736b70>]}
[0m14:33:30.880986 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:33:30.881153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a12cad0>]}
[0m14:33:30.882083 [info ] [MainThread]: 
[0m14:33:30.882359 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:33:30.884394 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:33:30.893104 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:33:30.893347 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:33:30.893483 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:33:31.419591 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.526 seconds
[0m14:33:31.423004 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:33:31.531501 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:33:31.542264 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:33:31.542691 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:33:31.542962 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:33:31.930723 [debug] [ThreadPool]: SQL status: SUCCESS 7 in 0.387 seconds
[0m14:33:31.934597 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:33:32.042971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a08f1e0>]}
[0m14:33:32.043839 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:33:32.044209 [info ] [MainThread]: 
[0m14:33:32.047440 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:33:32.048008 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:33:32.048465 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:33:32.049065 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:33:32.049537 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:33:32.050119 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:33:32.050823 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:33:32.051238 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:33:32.051637 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:33:32.051960 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:33:32.052248 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:33:32.052509 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:33:32.072636 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:33:32.074199 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:33:32.079260 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:33:32.080090 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:33:32.080357 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:33:32.086897 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:33:32.103735 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:33:32.109107 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:33:32.111472 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:33:32.112599 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:33:32.112938 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:33:32.113156 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            artist,
            chart_position,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists,
        LATERAL FLATTEN(input => artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.artist,
            ea.chart_position,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT DISTINCT
    final_artist AS artist,
    MIN(chart_position) AS top_rank
FROM validated_artists
GROUP BY final_artist
ORDER BY top_rank
  );
[0m14:33:32.114055 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:33:32.114226 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:33:32.114387 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:33:32.114700 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:33:32.115010 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:33:32.115197 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:33:32.591866 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.477 seconds
[0m14:33:32.607021 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:33:32.717416 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adddd90>]}
[0m14:33:32.718109 [info ] [Thread-2 (]: 2 of 4 OK created sql view model BB_SCHEMA.hot_100_flat_SQL .................... [[32mSUCCESS 1[0m in 0.67s]
[0m14:33:32.718543 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:33:33.092357 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.977 seconds
[0m14:33:33.100070 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:33:33.262498 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895fee0>]}
[0m14:33:33.263805 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.21s]
[0m14:33:33.264561 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:33:36.772519 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.657 seconds
[0m14:33:36.774197 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:33:36.865673 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae92210>]}
[0m14:33:36.866339 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.81s]
[0m14:33:36.866837 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:33:36.867463 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:33:36.867941 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:33:36.868433 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:33:36.868745 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:33:36.871279 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:33:36.871982 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:33:36.874567 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:33:36.875692 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:33:36.875991 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:33:36.876256 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:33:37.908043 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.032 seconds
[0m14:33:37.911476 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:33:38.022765 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ca73792-7603-4b66-a31a-f91b631df7b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d7ad50>]}
[0m14:33:38.023981 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.15s]
[0m14:33:38.025107 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:33:38.026879 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:33:38.027311 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:33:38.027601 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:33:38.027851 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:33:38.028096 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:33:38.028485 [info ] [MainThread]: 
[0m14:33:38.028841 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 7.15 seconds (7.15s).
[0m14:33:38.029996 [debug] [MainThread]: Command end result
[0m14:33:38.052402 [info ] [MainThread]: 
[0m14:33:38.052741 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:33:38.052942 [info ] [MainThread]: 
[0m14:33:38.053148 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:33:38.054329 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.5914226, "process_user_time": 1.359716, "process_kernel_time": 0.178565, "process_mem_max_rss": "145358848", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:33:38.054657 [debug] [MainThread]: Command `dbt run` succeeded at 14:33:38.054596 after 7.59 seconds
[0m14:33:38.054889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c22350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10546a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a59f70>]}
[0m14:33:38.055103 [debug] [MainThread]: Flushing usage events
[0m14:37:24.564389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127b7c50>]}


============================== 14:37:24.567430 | 59b2d387-1e48-43cd-bf77-d09cb31ec3f7 ==============================
[0m14:37:24.567430 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:37:24.567753 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:37:24.788996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135f2190>]}
[0m14:37:24.812717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135786b0>]}
[0m14:37:24.814152 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:37:24.825001 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:37:24.887595 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:37:24.887960 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:37:24.987334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138ea550>]}
[0m14:37:25.028906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135bab70>]}
[0m14:37:25.029178 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:37:25.029345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c7cad0>]}
[0m14:37:25.030284 [info ] [MainThread]: 
[0m14:37:25.030565 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:37:25.032570 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:37:25.040894 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:37:25.041144 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:37:25.041278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:37:25.574813 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.533 seconds
[0m14:37:25.576239 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:37:25.672957 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:37:25.683455 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:37:25.683875 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:37:25.684158 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:37:26.011803 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.328 seconds
[0m14:37:26.014721 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:37:26.105970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113beb1e0>]}
[0m14:37:26.106509 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:37:26.106749 [info ] [MainThread]: 
[0m14:37:26.109392 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:37:26.109749 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:37:26.109978 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:37:26.110303 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:37:26.110700 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:37:26.111044 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:37:26.111353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:37:26.111617 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:37:26.111930 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:37:26.112150 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:37:26.112334 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:37:26.112676 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:37:26.124106 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:37:26.130949 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:37:26.132794 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:37:26.133469 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:37:26.133696 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:37:26.140169 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:37:26.155424 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:37:26.156714 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:37:26.167310 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:37:26.168052 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:37:26.168242 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:37:26.168404 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:37:26.169068 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:37:26.169282 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    final_artist AS artist,
    song_title,
    chart_date,
    chart_position
FROM validated_artists
ORDER BY chart_date, chart_position, artist;
[0m14:37:26.169479 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:37:26.171243 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:37:26.171574 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:37:26.171895 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:37:26.547076 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed15-0203-9896-0003-076200027186
[0m14:37:26.547582 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 37 at position 43 unexpected ';'.
[0m14:37:26.547972 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:37:26.667469 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  001003 (42000): SQL compilation error:
  syntax error line 37 at position 43 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:37:26.669313 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149dd310>]}
[0m14:37:26.670009 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.56s]
[0m14:37:26.670599 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:37:27.069073 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.899 seconds
[0m14:37:27.094666 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:37:27.190490 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112353e30>]}
[0m14:37:27.191387 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.08s]
[0m14:37:27.192052 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:37:30.851161 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.679 seconds
[0m14:37:30.852861 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:37:30.938603 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114aa7f70>]}
[0m14:37:30.939103 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.83s]
[0m14:37:30.939394 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:37:30.939798 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:37:30.940126 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:37:30.940509 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:37:30.940736 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:37:30.943062 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:37:30.943596 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:37:30.944708 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:37:30.945298 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:37:30.945473 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:37:30.945629 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:37:32.022884 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.077 seconds
[0m14:37:32.024495 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:37:32.117508 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59b2d387-1e48-43cd-bf77-d09cb31ec3f7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11036b350>]}
[0m14:37:32.118027 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.18s]
[0m14:37:32.118369 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:37:32.119433 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:37:32.119712 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:37:32.119865 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:37:32.120012 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:37:32.120138 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:37:32.120370 [info ] [MainThread]: 
[0m14:37:32.120555 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 7.09 seconds (7.09s).
[0m14:37:32.121146 [debug] [MainThread]: Command end result
[0m14:37:32.141272 [info ] [MainThread]: 
[0m14:37:32.141529 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:37:32.141669 [info ] [MainThread]: 
[0m14:37:32.141854 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  001003 (42000): SQL compilation error:
  syntax error line 37 at position 43 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:37:32.141991 [info ] [MainThread]: 
[0m14:37:32.142129 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:37:32.143449 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.6108522, "process_user_time": 1.346761, "process_kernel_time": 0.218652, "process_mem_max_rss": "142442496", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:37:32.143850 [debug] [MainThread]: Command `dbt run` failed at 14:37:32.143787 after 7.61 seconds
[0m14:37:32.144067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c1e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a72dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110773cb0>]}
[0m14:37:32.144279 [debug] [MainThread]: Flushing usage events
[0m14:38:27.040417 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f1e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10690bed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10690bc50>]}


============================== 14:38:27.043194 | 7817714a-bb02-42af-afb9-7285f9022eae ==============================
[0m14:38:27.043194 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:38:27.043553 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:38:27.261749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107482190>]}
[0m14:38:27.286074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074046b0>]}
[0m14:38:27.287523 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:38:27.297456 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:38:27.363651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:38:27.364063 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:38:27.463256 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077da550>]}
[0m14:38:27.505883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107446b70>]}
[0m14:38:27.506190 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:38:27.506357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b74ad0>]}
[0m14:38:27.507287 [info ] [MainThread]: 
[0m14:38:27.507569 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:38:27.509651 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:38:27.518210 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:38:27.518437 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:38:27.518570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:27.987895 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.469 seconds
[0m14:38:27.990077 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:38:28.087008 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:38:28.097779 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:38:28.098190 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:38:28.098487 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:28.512465 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.414 seconds
[0m14:38:28.515960 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:38:28.652540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ad71e0>]}
[0m14:38:28.653495 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:38:28.653894 [info ] [MainThread]: 
[0m14:38:28.658306 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:38:28.658716 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:28.659081 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:38:28.659561 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:38:28.660039 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:38:28.660442 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:38:28.661157 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:38:28.661688 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:38:28.662093 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:38:28.662421 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:38:28.662717 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:28.662992 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:38:28.675490 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:28.677303 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:38:28.689392 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:38:28.690055 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:28.696632 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:38:28.703217 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:38:28.713172 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:28.718364 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:38:28.720721 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:38:28.722095 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:38:28.722421 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:38:28.722740 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:38:28.723635 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:28.723803 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:38:28.723987 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:38:28.724202 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    final_artist AS artist,
    song_title,
    chart_date,
    chart_position
FROM validated_artists
ORDER BY chart_date, chart_position, artist
  );
[0m14:38:28.724386 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:38:28.724585 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:38:29.091309 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed16-0203-98a0-0003-07620002c1ba
[0m14:38:29.092032 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 33 at position 4
invalid identifier 'SONG_TITLE'
[0m14:38:29.092603 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:38:29.272473 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 33 at position 4
  invalid identifier 'SONG_TITLE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:38:29.274423 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d25190>]}
[0m14:38:29.275123 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.61s]
[0m14:38:29.275722 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:29.845708 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.121 seconds
[0m14:38:29.866072 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:38:29.977295 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10666be30>]}
[0m14:38:29.978064 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.32s]
[0m14:38:29.978534 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:38:32.929040 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.205 seconds
[0m14:38:32.934406 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:38:33.031477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dfbc50>]}
[0m14:38:33.032581 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.37s]
[0m14:38:33.033575 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:38:33.035080 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:38:33.035759 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:38:33.036458 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:38:33.036920 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:38:33.041409 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:38:33.042464 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:38:33.046197 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:38:33.047396 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:38:33.047734 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:38:33.048033 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:38:34.124795 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.077 seconds
[0m14:38:34.127211 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:38:34.220159 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7817714a-bb02-42af-afb9-7285f9022eae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068af550>]}
[0m14:38:34.220600 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.18s]
[0m14:38:34.220888 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:38:34.221731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:34.221946 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:38:34.222082 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:38:34.222440 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:38:34.222601 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:38:34.222873 [info ] [MainThread]: 
[0m14:38:34.223109 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 6.72 seconds (6.72s).
[0m14:38:34.224232 [debug] [MainThread]: Command end result
[0m14:38:34.243444 [info ] [MainThread]: 
[0m14:38:34.243719 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:38:34.244026 [info ] [MainThread]: 
[0m14:38:34.244277 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 33 at position 4
  invalid identifier 'SONG_TITLE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:38:34.244439 [info ] [MainThread]: 
[0m14:38:34.244597 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:38:34.246123 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.2355304, "process_user_time": 1.377021, "process_kernel_time": 0.212111, "process_mem_max_rss": "144457728", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:38:34.246436 [debug] [MainThread]: Command `dbt run` failed at 14:38:34.246381 after 7.24 seconds
[0m14:38:34.246641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103176120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ed9d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e53cb0>]}
[0m14:38:34.246816 [debug] [MainThread]: Flushing usage events
[0m14:38:57.880215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10693e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121b7c50>]}


============================== 14:38:57.882697 | 49cb0b2a-7fe6-497e-8d24-6c810fb11792 ==============================
[0m14:38:57.882697 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:38:57.882999 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:38:58.105426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131fa190>]}
[0m14:38:58.127807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131786b0>]}
[0m14:38:58.129278 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:38:58.139358 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:38:58.204301 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:38:58.204669 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:38:58.301664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11354e550>]}
[0m14:38:58.342175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1131b2b70>]}
[0m14:38:58.342438 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:38:58.342602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114404ad0>]}
[0m14:38:58.343528 [info ] [MainThread]: 
[0m14:38:58.343804 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:38:58.345778 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:38:58.370274 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:38:58.370533 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:38:58.370664 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:58.931252 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.560 seconds
[0m14:38:58.933867 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:38:59.041139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:38:59.051306 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:38:59.051677 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:38:59.051952 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:38:59.515463 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.463 seconds
[0m14:38:59.519029 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:38:59.623527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1138471e0>]}
[0m14:38:59.624297 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:38:59.624649 [info ] [MainThread]: 
[0m14:38:59.628934 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:38:59.629455 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:38:59.629865 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:59.630413 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:38:59.630947 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:38:59.632645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:38:59.631911 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:38:59.633300 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:38:59.633752 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:38:59.634337 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:38:59.634659 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:38:59.640590 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:59.648765 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:38:59.658414 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:38:59.660467 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:59.661250 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:38:59.668465 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:38:59.668718 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:38:59.681695 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:59.693553 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:38:59.693831 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:38:59.694769 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:38:59.694995 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    final_artist AS artist,
    song_title,
    chart_date,
    chart_position
FROM validated_artists
ORDER BY chart_date, chart_position, artist
  );
[0m14:38:59.695182 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:38:59.696055 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:38:59.696372 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:38:59.696672 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:38:59.696968 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:38:59.697144 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:38:59.697315 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:39:00.074702 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed16-0203-9896-0003-07620002718e
[0m14:39:00.075395 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 33 at position 4
invalid identifier 'SONG_TITLE'
[0m14:39:00.075965 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:39:00.182032 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 33 at position 4
  invalid identifier 'SONG_TITLE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:39:00.183995 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1151dcf50>]}
[0m14:39:00.184701 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.55s]
[0m14:39:00.185310 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:39:00.834622 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.137 seconds
[0m14:39:00.848600 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:39:00.944135 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110753e30>]}
[0m14:39:00.944711 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.31s]
[0m14:39:00.945147 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:39:04.979135 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.282 seconds
[0m14:39:04.980924 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:39:05.067648 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11525fbb0>]}
[0m14:39:05.068413 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 5.44s]
[0m14:39:05.068898 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:39:05.069412 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:39:05.069890 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:39:05.070374 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:39:05.070618 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:39:05.073414 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:39:05.073984 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:39:05.075800 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:39:05.076996 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:39:05.077271 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:39:05.077524 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:39:06.302562 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.225 seconds
[0m14:39:06.306045 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:39:06.398533 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49cb0b2a-7fe6-497e-8d24-6c810fb11792', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11352d750>]}
[0m14:39:06.399669 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.33s]
[0m14:39:06.400462 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:39:06.402213 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:39:06.402640 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:39:06.402935 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:39:06.403193 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:39:06.403432 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:39:06.403860 [info ] [MainThread]: 
[0m14:39:06.404193 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 8.06 seconds (8.06s).
[0m14:39:06.405380 [debug] [MainThread]: Command end result
[0m14:39:06.431980 [info ] [MainThread]: 
[0m14:39:06.432321 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:39:06.432518 [info ] [MainThread]: 
[0m14:39:06.432855 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 33 at position 4
  invalid identifier 'SONG_TITLE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:39:06.433072 [info ] [MainThread]: 
[0m14:39:06.433284 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:39:06.435155 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 8.584772, "process_user_time": 1.347422, "process_kernel_time": 0.201431, "process_mem_max_rss": "143540224", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:39:06.435494 [debug] [MainThread]: Command `dbt run` failed at 14:39:06.435432 after 8.59 seconds
[0m14:39:06.435736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1155a7230>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11029a810>]}
[0m14:39:06.435955 [debug] [MainThread]: Flushing usage events
[0m14:39:55.676110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10733e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af3c50>]}


============================== 14:39:55.678604 | 0fc48f8f-d45a-475e-ad2a-ba06c4742ad8 ==============================
[0m14:39:55.678604 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:39:55.678934 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:39:55.842923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129f6190>]}
[0m14:39:55.866008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129786b0>]}
[0m14:39:55.866427 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:39:55.875531 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:39:55.926845 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:39:55.927205 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:39:56.022124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112cea550>]}
[0m14:39:56.059584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129b6b70>]}
[0m14:39:56.059884 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:39:56.060052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113324ad0>]}
[0m14:39:56.061021 [info ] [MainThread]: 
[0m14:39:56.061310 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:39:56.063461 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:39:56.087754 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:39:56.088055 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:39:56.088211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:39:56.618812 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.530 seconds
[0m14:39:56.621497 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:39:56.720924 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:39:56.731509 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:39:56.731875 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:39:56.732156 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:39:57.151532 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.419 seconds
[0m14:39:57.154172 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:39:57.263308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ff31e0>]}
[0m14:39:57.264228 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:39:57.264634 [info ] [MainThread]: 
[0m14:39:57.267818 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:39:57.268331 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:39:57.268755 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:39:57.269335 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:39:57.269921 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:39:57.270613 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:39:57.271183 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:39:57.271677 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:39:57.272391 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:39:57.272805 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:39:57.273122 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:39:57.273407 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:39:57.281483 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:39:57.296480 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:39:57.300706 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:39:57.301345 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:39:57.301613 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:39:57.308003 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:39:57.326961 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:39:57.327219 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:39:57.337300 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:39:57.338803 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:39:57.339527 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:39:57.339874 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:39:57.340335 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:39:57.340556 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_date, chart_position, artist
  );
[0m14:39:57.340767 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:39:57.340936 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:39:57.341086 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:39:57.341256 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:39:57.726716 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b7ed17-0203-989e-0003-07620002e182
[0m14:39:57.727336 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 39 at position 9
invalid identifier 'CHART_DATE'
[0m14:39:57.727808 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:39:57.846641 [debug] [Thread-2 (]: Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 39 at position 9
  invalid identifier 'CHART_DATE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:39:57.848671 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133a77d0>]}
[0m14:39:57.849344 [error] [Thread-2 (]: 2 of 4 ERROR creating sql view model BB_SCHEMA.hot_100_flat_SQL ................ [[31mERROR[0m in 0.58s]
[0m14:39:57.850117 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:39:58.420529 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.079 seconds
[0m14:39:58.436858 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:39:58.630147 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111857e30>]}
[0m14:39:58.631124 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.36s]
[0m14:39:58.631936 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:40:01.400608 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.059 seconds
[0m14:40:01.405494 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:40:01.499879 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114da8eb0>]}
[0m14:40:01.500416 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.23s]
[0m14:40:01.500771 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:40:01.501445 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:40:01.501878 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:40:01.502276 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:40:01.502528 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:40:01.505070 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:01.505570 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:40:01.506782 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:01.507471 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:40:01.507709 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:40:01.507891 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:40:02.618354 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.110 seconds
[0m14:40:02.619855 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:40:02.707019 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0fc48f8f-d45a-475e-ad2a-ba06c4742ad8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114bb9250>]}
[0m14:40:02.707851 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.20s]
[0m14:40:02.708442 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:40:02.709694 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:40:02.710008 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:40:02.710212 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:40:02.710392 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:40:02.710564 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:40:02.710903 [info ] [MainThread]: 
[0m14:40:02.711144 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 6.65 seconds (6.65s).
[0m14:40:02.711933 [debug] [MainThread]: Command end result
[0m14:40:02.734000 [info ] [MainThread]: 
[0m14:40:02.734332 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:40:02.734504 [info ] [MainThread]: 
[0m14:40:02.734725 [error] [MainThread]:   Database Error in model hot_100_flat_SQL (models/staging/hot_100_flat_SQL.sql)
  000904 (42000): SQL compilation error: error line 39 at position 9
  invalid identifier 'CHART_DATE'
  compiled code at target/run/billboard_hot_100/models/staging/hot_100_flat_SQL.sql
[0m14:40:02.734891 [info ] [MainThread]: 
[0m14:40:02.735058 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:40:02.736453 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 7.0896087, "process_user_time": 1.367028, "process_kernel_time": 0.188529, "process_mem_max_rss": "145539072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:40:02.736784 [debug] [MainThread]: Command `dbt run` failed at 14:40:02.736726 after 7.09 seconds
[0m14:40:02.737012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046f6120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d7b380>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d82570>]}
[0m14:40:02.737211 [debug] [MainThread]: Flushing usage events
[0m14:40:22.739672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aefc50>]}


============================== 14:40:22.741817 | 1a0aa744-57ff-41e7-a22c-e027e5fd843b ==============================
[0m14:40:22.741817 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:40:22.742130 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:40:22.901356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069f6190>]}
[0m14:40:22.923415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069786b0>]}
[0m14:40:22.923828 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:40:22.934314 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:40:22.985378 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:40:22.985768 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:40:23.083637 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e92550>]}
[0m14:40:23.121422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b6b70>]}
[0m14:40:23.121723 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:40:23.121900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d04ad0>]}
[0m14:40:23.122917 [info ] [MainThread]: 
[0m14:40:23.123249 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:40:23.125438 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:40:23.135176 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:40:23.135441 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:40:23.135577 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:23.575329 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.439 seconds
[0m14:40:23.578426 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:40:23.680055 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:40:23.690482 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:40:23.690917 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:40:23.691194 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:40:24.065070 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.374 seconds
[0m14:40:24.067969 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:40:24.165174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c671e0>]}
[0m14:40:24.166108 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:40:24.166564 [info ] [MainThread]: 
[0m14:40:24.170026 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:40:24.170528 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:40:24.170910 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:24.171450 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:40:24.171948 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:40:24.172649 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:40:24.173418 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:40:24.173959 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:40:24.174373 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:40:24.174697 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:40:24.174988 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:40:24.175260 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:24.189722 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:40:24.203022 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:24.203881 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:24.204578 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:40:24.204826 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:40:24.211356 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:24.227096 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:40:24.229670 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:24.239924 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:24.240582 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:40:24.241492 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:40:24.241678 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:40:24.242282 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:24.242599 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:40:24.242907 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:40:24.243094 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position, artist
  );
[0m14:40:24.243285 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:40:24.243451 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:40:24.823286 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.580 seconds
[0m14:40:24.838338 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:40:24.943771 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fdcd10>]}
[0m14:40:24.944389 [info ] [Thread-2 (]: 2 of 4 OK created sql view model BB_SCHEMA.hot_100_flat_SQL .................... [[32mSUCCESS 1[0m in 0.77s]
[0m14:40:24.944780 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:25.046228 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.803 seconds
[0m14:40:25.048376 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:40:25.144884 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105853ee0>]}
[0m14:40:25.145988 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.97s]
[0m14:40:25.146663 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:40:29.591935 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 5.349 seconds
[0m14:40:29.594338 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:40:29.806751 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108b2cb0>]}
[0m14:40:29.807367 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 5.63s]
[0m14:40:29.807873 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:40:29.808452 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:40:29.808832 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:40:29.809297 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:40:29.809645 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:40:29.812014 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:29.812631 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:40:29.813945 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:29.814682 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:40:29.814903 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:40:29.815108 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:40:30.885141 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.069 seconds
[0m14:40:30.889268 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:40:30.978169 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a0aa744-57ff-41e7-a22c-e027e5fd843b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071f4450>]}
[0m14:40:30.979236 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.17s]
[0m14:40:30.979846 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:40:30.981422 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:40:30.981798 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:40:30.982048 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:40:30.982272 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:40:30.982484 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:40:30.982878 [info ] [MainThread]: 
[0m14:40:30.983204 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 7.86 seconds (7.86s).
[0m14:40:30.984262 [debug] [MainThread]: Command end result
[0m14:40:31.007973 [info ] [MainThread]: 
[0m14:40:31.008278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:40:31.008460 [info ] [MainThread]: 
[0m14:40:31.008638 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:40:31.009688 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 8.300784, "process_user_time": 1.328012, "process_kernel_time": 0.180456, "process_mem_max_rss": "143147008", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:40:31.009987 [debug] [MainThread]: Command `dbt run` succeeded at 14:40:31.009934 after 8.30 seconds
[0m14:40:31.010198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10117a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10719d630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058af050>]}
[0m14:40:31.010390 [debug] [MainThread]: Flushing usage events
[0m14:40:33.358791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104daa660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cefc50>]}


============================== 14:40:33.361003 | b90c4c74-51c2-4512-aeac-e8f0609cb33a ==============================
[0m14:40:33.361003 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:40:33.361349 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:40:33.532511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d0a190>]}
[0m14:40:33.556451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c8c6b0>]}
[0m14:40:33.556944 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:40:33.567879 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:40:33.616694 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:40:33.617227 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:40:33.713172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ffe550>]}
[0m14:40:33.751023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cceb70>]}
[0m14:40:33.751295 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:40:33.751465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10962cad0>]}
[0m14:40:33.752381 [info ] [MainThread]: 
[0m14:40:33.752663 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:40:33.754645 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:40:33.763320 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:40:33.763569 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:40:33.763707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:34.189749 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.426 seconds
[0m14:40:34.191799 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:40:34.322210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:40:34.326764 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:40:34.326989 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:40:34.327249 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:40:34.685022 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.358 seconds
[0m14:40:34.690108 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:40:34.798028 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10958f1e0>]}
[0m14:40:34.798423 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:40:34.798695 [info ] [MainThread]: 
[0m14:40:34.803217 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:40:34.805293 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:40:34.805594 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:34.807810 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:40:34.809952 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:40:34.810440 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:40:34.810861 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:40:34.811123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:40:34.811406 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:40:34.811711 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:40:34.812431 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:40:34.812810 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:34.817515 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:40:34.825451 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:34.831451 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:34.831903 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:40:34.840780 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:34.843927 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:40:34.877317 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:40:34.880394 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:34.882580 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:34.883903 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:34.884200 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position DESC, artist ASC
  );
[0m14:40:34.884446 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:40:34.884784 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:40:34.885778 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:40:34.886178 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:40:34.886761 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:40:34.887319 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:40:34.887586 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:40:35.406921 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.522 seconds
[0m14:40:35.434252 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:40:35.538996 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098ddd90>]}
[0m14:40:35.539470 [info ] [Thread-2 (]: 2 of 4 OK created sql view model BB_SCHEMA.hot_100_flat_SQL .................... [[32mSUCCESS 1[0m in 0.73s]
[0m14:40:35.539838 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:35.826115 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.939 seconds
[0m14:40:35.829342 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:40:35.953735 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a4fee0>]}
[0m14:40:35.955039 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.14s]
[0m14:40:35.955856 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:40:39.034276 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.147 seconds
[0m14:40:39.037255 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:40:39.159505 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098c8f50>]}
[0m14:40:39.160404 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.35s]
[0m14:40:39.160910 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:40:39.161957 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:40:39.162477 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:40:39.162992 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:40:39.163294 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:40:39.167150 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:39.168212 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:40:39.170281 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:40:39.171362 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:40:39.171685 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:40:39.171972 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:40:40.319253 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.147 seconds
[0m14:40:40.323189 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:40:40.418949 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b90c4c74-51c2-4512-aeac-e8f0609cb33a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f741d0>]}
[0m14:40:40.420074 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.26s]
[0m14:40:40.420922 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:40:40.422970 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:40:40.423464 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:40:40.423814 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:40:40.424135 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:40:40.424431 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:40:40.424955 [info ] [MainThread]: 
[0m14:40:40.425515 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 6.67 seconds (6.67s).
[0m14:40:40.426836 [debug] [MainThread]: Command end result
[0m14:40:40.458095 [info ] [MainThread]: 
[0m14:40:40.458574 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:40:40.458777 [info ] [MainThread]: 
[0m14:40:40.458975 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:40:40.460376 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 7.1322174, "process_user_time": 1.350299, "process_kernel_time": 0.195109, "process_mem_max_rss": "144097280", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:40:40.460858 [debug] [MainThread]: Command `dbt run` succeeded at 14:40:40.460777 after 7.13 seconds
[0m14:40:40.461106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103002120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092a1630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057cd610>]}
[0m14:40:40.461359 [debug] [MainThread]: Flushing usage events
[0m14:40:57.431878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10323a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c1fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c1fc50>]}


============================== 14:40:57.434518 | 5cb312e1-1629-4c85-8fdd-c3db8802c380 ==============================
[0m14:40:57.434518 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:40:57.434823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:40:57.621308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105796190>]}
[0m14:40:57.645560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10571c6b0>]}
[0m14:40:57.646072 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:40:57.655218 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:40:57.707128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:40:57.707518 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:40:57.806366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105af2550>]}
[0m14:40:57.843291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10575ab70>]}
[0m14:40:57.843562 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:40:57.843727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e8cad0>]}
[0m14:40:57.844639 [info ] [MainThread]: 
[0m14:40:57.844923 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:40:57.846912 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:40:57.855259 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:40:57.855509 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:40:57.855641 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:40:58.257466 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.402 seconds
[0m14:40:58.258819 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:40:58.359407 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:40:58.364651 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:40:58.364875 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:40:58.365023 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:40:58.700239 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.335 seconds
[0m14:40:58.702668 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:40:58.802466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105def1e0>]}
[0m14:40:58.803326 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:40:58.803716 [info ] [MainThread]: 
[0m14:40:58.806647 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:40:58.807109 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:40:58.807497 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:58.808005 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:40:58.808537 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:40:58.809136 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:40:58.809658 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:40:58.810132 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:40:58.810520 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:40:58.810833 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:40:58.811111 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:40:58.811376 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:58.830448 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:40:58.832518 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:58.836707 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:58.838165 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:58.838490 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:40:58.838757 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:40:58.867096 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:58.873728 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:40:58.874860 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:40:58.875847 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:40:58.876177 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:40:58.876395 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:40:58.876635 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:40:58.876959 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:40:58.877817 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:40:58.877970 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:40:58.878836 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:40:58.879513 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:40:59.435617 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.558 seconds
[0m14:40:59.462686 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:40:59.553462 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10603df10>]}
[0m14:40:59.554369 [info ] [Thread-2 (]: 2 of 4 OK created sql view model BB_SCHEMA.hot_100_flat_SQL .................... [[32mSUCCESS 1[0m in 0.74s]
[0m14:40:59.554993 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:40:59.850541 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.972 seconds
[0m14:40:59.855384 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:40:59.952902 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104983ee0>]}
[0m14:40:59.954046 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.14s]
[0m14:40:59.954865 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:41:03.038587 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.158 seconds
[0m14:41:03.043250 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:41:03.147379 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060b7430>]}
[0m14:41:03.148595 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.34s]
[0m14:41:03.149397 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:41:03.150300 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:41:03.151075 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:41:03.151731 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:41:03.152241 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:41:03.156910 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:41:03.157943 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:41:03.160129 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:41:03.161440 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:41:03.161806 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:41:03.162136 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:41:04.041037 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.878 seconds
[0m14:41:04.045079 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:41:04.154064 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5cb312e1-1629-4c85-8fdd-c3db8802c380', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bc1250>]}
[0m14:41:04.155113 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.00s]
[0m14:41:04.155896 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:41:04.157919 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:04.158313 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:41:04.158604 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:41:04.158870 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:41:04.159117 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:41:04.159587 [info ] [MainThread]: 
[0m14:41:04.159983 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 6.31 seconds (6.31s).
[0m14:41:04.161205 [debug] [MainThread]: Command end result
[0m14:41:04.188650 [info ] [MainThread]: 
[0m14:41:04.188986 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:41:04.189180 [info ] [MainThread]: 
[0m14:41:04.189375 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:41:04.190570 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.7939215, "process_user_time": 1.391587, "process_kernel_time": 0.187548, "process_mem_max_rss": "143294464", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:41:04.190906 [debug] [MainThread]: Command `dbt run` succeeded at 14:41:04.190846 after 6.79 seconds
[0m14:41:04.191141 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10148e120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105bfd630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10397c2f0>]}
[0m14:41:04.191351 [debug] [MainThread]: Flushing usage events
[0m14:41:27.792999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10530e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b7c50>]}


============================== 14:41:27.795425 | 1194b11c-e95a-4ef2-a663-446eddc6477e ==============================
[0m14:41:27.795425 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:41:27.795750 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:41:27.955569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bf6190>]}
[0m14:41:27.977634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b786b0>]}
[0m14:41:27.978026 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:41:27.986764 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:41:28.036302 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:41:28.036667 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat_SQL.sql
[0m14:41:28.131630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f92550>]}
[0m14:41:28.169259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bb6b70>]}
[0m14:41:28.169537 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:41:28.169707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11132cad0>]}
[0m14:41:28.170646 [info ] [MainThread]: 
[0m14:41:28.170938 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:41:28.173008 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:41:28.182021 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:41:28.182288 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:41:28.182427 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:41:28.633325 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.451 seconds
[0m14:41:28.636135 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:41:28.731569 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:41:28.742877 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:41:28.743330 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:41:28.743614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:41:29.095787 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.352 seconds
[0m14:41:29.097358 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:41:29.274932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11128f1e0>]}
[0m14:41:29.275584 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:41:29.275867 [info ] [MainThread]: 
[0m14:41:29.278286 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:41:29.278647 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:41:29.278977 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:41:29.279386 [info ] [Thread-1 (]: 1 of 4 START python table model BB_SCHEMA.hot_100_flat ......................... [RUN]
[0m14:41:29.279760 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:41:29.280086 [info ] [Thread-2 (]: 2 of 4 START sql view model BB_SCHEMA.hot_100_flat_SQL ......................... [RUN]
[0m14:41:29.280407 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:41:29.280847 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:41:29.281207 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_SQL'
[0m14:41:29.281485 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:41:29.281728 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:41:29.282185 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_SQL
[0m14:41:29.295017 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:41:29.303535 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:41:29.305722 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:41:29.306334 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_SQL
[0m14:41:29.312873 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:41:29.313125 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:41:29.322493 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:41:29.333247 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:41:29.335788 [debug] [Thread-1 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat"
[0m14:41:29.336490 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:41:29.337121 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_SQL"
[0m14:41:29.337298 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:41:29.338140 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:41:29.338337 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_SQL"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat_SQL
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:41:29.338578 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:41:29.338933 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
WITH hot_100_flat__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat__dbt_sp();
[0m14:41:29.339250 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:41:29.339456 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:41:29.889754 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.550 seconds
[0m14:41:29.916810 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_SQL: Close
[0m14:41:30.044513 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113a7f50>]}
[0m14:41:30.045598 [info ] [Thread-2 (]: 2 of 4 OK created sql view model BB_SCHEMA.hot_100_flat_SQL .................... [[32mSUCCESS 1[0m in 0.76s]
[0m14:41:30.046300 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_SQL
[0m14:41:30.189941 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.851 seconds
[0m14:41:30.194573 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:41:30.317924 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107553ee0>]}
[0m14:41:30.318958 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.04s]
[0m14:41:30.319770 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:41:33.244186 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 3.905 seconds
[0m14:41:33.246739 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:41:33.359396 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120a3f70>]}
[0m14:41:33.359952 [info ] [Thread-1 (]: 1 of 4 OK created python table model BB_SCHEMA.hot_100_flat .................... [[32mSUCCESS 1[0m in 4.08s]
[0m14:41:33.360349 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:41:33.360837 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:41:33.361196 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:41:33.361664 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:41:33.361884 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:41:33.364063 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:41:33.364563 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:41:33.365819 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:41:33.366586 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:41:33.367070 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:41:33.367358 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:41:34.471064 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.104 seconds
[0m14:41:34.472514 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:41:34.578578 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1194b11c-e95a-4ef2-a663-446eddc6477e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f08a50>]}
[0m14:41:34.579245 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.22s]
[0m14:41:34.579872 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:41:34.580965 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:41:34.581244 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:41:34.581431 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:41:34.581587 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_SQL' was properly closed.
[0m14:41:34.581746 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:41:34.582003 [info ] [MainThread]: 
[0m14:41:34.582311 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 6.41 seconds (6.41s).
[0m14:41:34.583017 [debug] [MainThread]: Command end result
[0m14:41:34.602214 [info ] [MainThread]: 
[0m14:41:34.602539 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:41:34.602713 [info ] [MainThread]: 
[0m14:41:34.602879 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:41:34.603998 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.8435626, "process_user_time": 1.322593, "process_kernel_time": 0.168731, "process_mem_max_rss": "144424960", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:41:34.604375 [debug] [MainThread]: Command `dbt run` succeeded at 14:41:34.604319 after 6.84 seconds
[0m14:41:34.604591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103562120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110a1630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120dd910>]}
[0m14:41:34.604799 [debug] [MainThread]: Flushing usage events
[0m14:45:06.439312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dbbed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dbbc50>]}


============================== 14:45:06.441981 | 35d38606-6957-490b-8eb3-f4cd9b8c7bb2 ==============================
[0m14:45:06.441981 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:45:06.442281 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:45:06.659991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35d38606-6957-490b-8eb3-f4cd9b8c7bb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bfa190>]}
[0m14:45:06.684596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35d38606-6957-490b-8eb3-f4cd9b8c7bb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118b786b0>]}
[0m14:45:06.685549 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:45:06.696432 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:45:06.738524 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:45:06.738854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '35d38606-6957-490b-8eb3-f4cd9b8c7bb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ee8e50>]}
[0m14:45:07.184150 [error] [MainThread]: Encountered an error:
Compilation Error
  dbt found two models with the name "hot_100_flat".
  
  Since these resources have the same name, dbt will be unable to find the correct resource
  when looking for ref("hot_100_flat").
  
  To fix this, change the name of one of these resources:
  - model.billboard_hot_100.hot_100_flat (models/decomission/hot_100_flat.py)
  - model.billboard_hot_100.hot_100_flat (models/staging/hot_100_flat.sql)
[0m14:45:07.185594 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.7769029, "process_user_time": 1.211713, "process_kernel_time": 0.167666, "process_mem_max_rss": "129761280", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:45:07.185860 [debug] [MainThread]: Command `dbt run` failed at 14:45:07.185811 after 0.78 seconds
[0m14:45:07.186034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f44410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f44c80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107adfe70>]}
[0m14:45:07.186183 [debug] [MainThread]: Flushing usage events
[0m14:46:36.487940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108fb7c50>]}


============================== 14:46:36.490151 | 06fcc284-81d7-400a-984b-5d7ff03a7a1b ==============================
[0m14:46:36.490151 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:46:36.490456 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:46:36.652739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cfa190>]}
[0m14:46:36.674795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c786b0>]}
[0m14:46:36.675199 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:46:36.685284 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:46:36.727974 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:46:36.728274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fe8e50>]}
[0m14:46:37.307157 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.billboard_hot_100.deprecated
[0m14:46:37.312271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cb5d60>]}
[0m14:46:37.355193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d124050>]}
[0m14:46:37.355472 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m14:46:37.355631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a15c460>]}
[0m14:46:37.356496 [info ] [MainThread]: 
[0m14:46:37.356756 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:46:37.358772 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:46:37.365142 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:46:37.365368 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:46:37.365496 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:46:37.854129 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.488 seconds
[0m14:46:37.857065 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:46:37.978357 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:46:37.989021 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:46:37.989386 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:46:37.989663 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:46:38.398846 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.409 seconds
[0m14:46:38.401755 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:46:38.500701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1e3a10>]}
[0m14:46:38.501341 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:46:38.501591 [info ] [MainThread]: 
[0m14:46:38.504619 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:46:38.504964 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.top_5
[0m14:46:38.505259 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_flat_depr
[0m14:46:38.505696 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m14:46:38.506046 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:46:38.506443 [info ] [Thread-2 (]: 2 of 4 START python table model BB_SCHEMA.hot_100_flat_depr .................... [RUN]
[0m14:46:38.506815 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:46:38.507394 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:46:38.508038 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_flat_depr'
[0m14:46:38.508403 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:46:38.508713 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:46:38.508996 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_flat_depr
[0m14:46:38.517182 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:46:38.519215 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:46:38.535679 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat_depr"
[0m14:46:38.536188 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:46:38.542808 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.top_5
[0m14:46:38.555195 [debug] [Thread-1 (]: Dropping relation "BB_DATABASE"."BB_SCHEMA"."HOT_100_FLAT" because it is of type table
[0m14:46:38.564720 [debug] [Thread-1 (]: Applying DROP to: "BB_DATABASE"."BB_SCHEMA"."HOT_100_FLAT"
[0m14:46:38.564942 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_flat_depr
[0m14:46:38.565190 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:46:38.568134 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:46:38.570520 [debug] [Thread-2 (]: Writing runtime python for node "model.billboard_hot_100.hot_100_flat_depr"
[0m14:46:38.570774 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
drop table if exists "BB_DATABASE"."BB_SCHEMA"."HOT_100_FLAT" cascade
[0m14:46:38.571038 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:46:38.571353 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:46:38.571638 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:46:38.572325 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:46:38.573543 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat_depr"
[0m14:46:38.573885 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_depr: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat_depr"} */
WITH hot_100_flat_depr__dbt_sp AS PROCEDURE ()

RETURNS STRING
LANGUAGE PYTHON
RUNTIME_VERSION = '3.8'
PACKAGES = ('snowflake-snowpark-python')



HANDLER = 'main'
EXECUTE AS CALLER
AS
$$

import sys
sys._xoptions['snowflake_partner_attribution'].append("dbtLabs_dbtPython")


  
    
# DEPRECATED: This Python model has been replaced by an SQL model (hot_100_flat.sql).
# The functionality remains the same, but the SQL model is more efficient.

import pandas as pd
import re

def model(dbt, session):
    
    # Load the billboard dataset
    """
    Process the billboard and artist datasets to flatten and split artist information.

    This function loads data from two sources: 'billboard_hot_100' and 'artist_data'.
    It then processes the artist names by conditionally splitting them based on the 
    presence of '&' or 'Feat.' and checks against a known set of artist names. Artists 
    are split into separate rows, and whitespace is stripped from artist names.

    Args:
        dbt: The dbt object for interacting with the database.
        session: The database session object.

    Returns:
        pd.DataFrame: A pandas DataFrame with one row per artist per entry in the 
        'billboard_hot_100' dataset.
    """
    
    # Load tables from snowflake
    df_bb = dbt.source('my_snowflake_source', 'billboard_hot_100').to_pandas()
    df_artist = dbt.source('my_snowflake_source', 'artist_data').to_pandas()
    
    # Convert artist names to a set for faster membership testing
    artist_set = set(df_artist['ARTIST_NAME'].str.lower())
    
    # Define a function to conditionally split artists
    def conditional_split(artist):
        # Split artist by & or Feat.
        potential_artists = re.split(r' & | Feat\. ', artist)
        # Check if any split part is in artist_set
        if any(part.strip().lower() in artist_set for part in potential_artists):
            return potential_artists  # Return list if any part is recognized
        else:
            return [artist]  # Return original artist as a single-item list if no matches
    
    # Apply the conditional split function
    df_bb['ARTIST'] = df_bb['ARTIST'].apply(conditional_split)
    
    # Explode into new rows if multiple artists
    df_bb = df_bb.explode('ARTIST')
    
    # Stip whitespaces
    df_bb['ARTIST'] = df_bb['ARTIST'].str.strip()

    # Return the flattened DataFrame
    return df_bb


# This part is user provided model code
# you will need to copy the next section to run the code
# COMMAND ----------
# this part is dbt logic for get ref work, do not modify

def ref(*args, **kwargs):
    refs = {}
    key = '.'.join(args)
    version = kwargs.get("v") or kwargs.get("version")
    if version:
        key += f".v{version}"
    dbt_load_df_function = kwargs.get("dbt_load_df_function")
    return dbt_load_df_function(refs[key])


def source(*args, dbt_load_df_function):
    sources = {"my_snowflake_source.artist_data": "BB_DATABASE.BB_SCHEMA.artist_data", "my_snowflake_source.billboard_hot_100": "BB_DATABASE.BB_SCHEMA.billboard_hot_100"}
    key = '.'.join(args)
    return dbt_load_df_function(sources[key])


config_dict = {}


class config:
    def __init__(self, *args, **kwargs):
        pass

    @staticmethod
    def get(key, default=None):
        return config_dict.get(key, default)

class this:
    """dbt.this() or dbt.this.identifier"""
    database = "BB_DATABASE"
    schema = "BB_SCHEMA"
    identifier = "hot_100_flat_depr"
    
    def __repr__(self):
        return 'BB_DATABASE.BB_SCHEMA.hot_100_flat_depr'


class dbtObj:
    def __init__(self, load_df_function) -> None:
        self.source = lambda *args: source(*args, dbt_load_df_function=load_df_function)
        self.ref = lambda *args, **kwargs: ref(*args, **kwargs, dbt_load_df_function=load_df_function)
        self.config = config
        self.this = this()
        self.is_incremental = False

# COMMAND ----------

# To run this in snowsight, you need to select entry point to be main
# And you may have to modify the return type to text to get the result back
# def main(session):
#     dbt = dbtObj(session.table)
#     df = model(dbt, session)
#     return df.collect()

# to run this in local notebook, you need to create a session following examples https://github.com/Snowflake-Labs/sfguide-getting-started-snowpark-python
# then you can do the following to run model
# dbt = dbtObj(session.table)
# df = model(dbt, session)


def materialize(session, df, target_relation):
    # make sure pandas exists
    import importlib.util
    package_name = 'pandas'
    if importlib.util.find_spec(package_name):
        import pandas
        if isinstance(df, pandas.core.frame.DataFrame):
          session.use_database(target_relation.database)
          session.use_schema(target_relation.schema)
          # session.write_pandas does not have overwrite function
          df = session.createDataFrame(df)
    
    df.write.mode("overwrite").save_as_table('BB_DATABASE.BB_SCHEMA.hot_100_flat_depr', table_type='transient')

def main(session):
    dbt = dbtObj(session.table)
    df = model(dbt, session)
    materialize(session, df, dbt.this)
    return "OK"

  
$$
CALL hot_100_flat_depr__dbt_sp();
[0m14:46:38.574282 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:46:38.972414 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.401 seconds
[0m14:46:38.985966 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m14:46:38.987840 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:46:38.988211 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:46:39.346012 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.773 seconds
[0m14:46:39.371670 [debug] [Thread-3 (]: On model.billboard_hot_100.top_5: Close
[0m14:46:39.441252 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.453 seconds
[0m14:46:39.443750 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:46:39.461668 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d4b7cd0>]}
[0m14:46:39.462421 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.95s]
[0m14:46:39.463030 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.top_5
[0m14:46:39.537456 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5b31b0>]}
[0m14:46:39.538188 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 1.03s]
[0m14:46:39.538530 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:46:39.538974 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:46:39.539180 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:46:39.539540 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:46:39.539691 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:46:39.541121 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:46:39.541505 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:46:39.542884 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:46:39.543464 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:46:39.543635 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:46:39.543790 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:46:40.460064 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.916 seconds
[0m14:46:40.464020 [debug] [Thread-4 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:46:40.584815 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aeefdd0>]}
[0m14:46:40.585896 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.05s]
[0m14:46:40.586655 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:46:42.620174 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 4.046 seconds
[0m14:46:42.623939 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_flat_depr: Close
[0m14:46:42.723303 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06fcc284-81d7-400a-984b-5d7ff03a7a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d577cb0>]}
[0m14:46:42.724372 [info ] [Thread-2 (]: 2 of 4 OK created python table model BB_SCHEMA.hot_100_flat_depr ............... [[32mSUCCESS 1[0m in 4.22s]
[0m14:46:42.725191 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_flat_depr
[0m14:46:42.727167 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:46:42.727564 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:46:42.727847 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:46:42.728097 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat_depr' was properly closed.
[0m14:46:42.728337 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:46:42.728725 [info ] [MainThread]: 
[0m14:46:42.729065 [info ] [MainThread]: Finished running 3 table models, 1 view model in 0 hours 0 minutes and 5.37 seconds (5.37s).
[0m14:46:42.730266 [debug] [MainThread]: Command end result
[0m14:46:42.756017 [info ] [MainThread]: 
[0m14:46:42.756355 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:46:42.756559 [info ] [MainThread]: 
[0m14:46:42.756767 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:46:42.757990 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.2989454, "process_user_time": 1.752988, "process_kernel_time": 0.204782, "process_mem_max_rss": "145375232", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:46:42.758339 [debug] [MainThread]: Command `dbt run` succeeded at 14:46:42.758277 after 6.30 seconds
[0m14:46:42.758571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10810d970>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d81c530>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d81c2f0>]}
[0m14:46:42.758793 [debug] [MainThread]: Flushing usage events
[0m14:47:58.949570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bb7c50>]}


============================== 14:47:58.952104 | 926d7a32-c770-43e8-a586-0b154738de00 ==============================
[0m14:47:58.952104 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:47:58.952423 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:47:59.115036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100fa190>]}
[0m14:47:59.138092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100786b0>]}
[0m14:47:59.138631 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:47:59.149451 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:47:59.190213 [info ] [MainThread]: Unable to do partial parsing because a project config has changed
[0m14:47:59.190557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110384e50>]}
[0m14:47:59.725624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1100b5d60>]}
[0m14:47:59.761628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111c2c050>]}
[0m14:47:59.761895 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m14:47:59.762061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11068aa90>]}
[0m14:47:59.762883 [info ] [MainThread]: 
[0m14:47:59.763145 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:47:59.765127 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:47:59.771304 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:47:59.771505 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:47:59.771627 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:00.346876 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.575 seconds
[0m14:48:00.349774 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:48:00.462128 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:48:00.472500 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:48:00.473068 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:48:00.473370 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:00.848595 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.375 seconds
[0m14:48:00.852219 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:48:00.945409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ceb950>]}
[0m14:48:00.946179 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:48:00.946525 [info ] [MainThread]: 
[0m14:48:00.948916 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m14:48:00.949383 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:48:00.949946 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:48:00.951175 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:48:00.950654 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m14:48:00.951645 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:48:00.952032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:48:00.957270 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:48:00.959753 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:00.961958 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:48:00.962652 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:48:00.983019 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:00.983382 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m14:48:00.995385 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:48:00.996584 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:48:00.996918 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:48:00.997311 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:48:00.997514 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:00.997708 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:48:00.998020 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:48:01.754260 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.755 seconds
[0m14:48:01.781087 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:48:01.874183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200b6e60>]}
[0m14:48:01.875091 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.92s]
[0m14:48:01.875900 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:48:01.876722 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:48:01.877330 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:48:01.877841 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:48:01.878160 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:48:01.880877 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:01.881725 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:48:01.884574 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:01.885791 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:48:01.886122 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:48:01.886411 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:48:01.997007 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.999 seconds
[0m14:48:01.998775 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m14:48:02.083256 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1200bead0>]}
[0m14:48:02.084032 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.13s]
[0m14:48:02.084583 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m14:48:02.979667 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.093 seconds
[0m14:48:02.982507 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:48:03.074900 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '926d7a32-c770-43e8-a586-0b154738de00', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110db850>]}
[0m14:48:03.075974 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.20s]
[0m14:48:03.076768 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:48:03.078660 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:03.079010 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:48:03.079272 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:48:03.079528 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:48:03.079893 [info ] [MainThread]: 
[0m14:48:03.080209 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 3.32 seconds (3.32s).
[0m14:48:03.081137 [debug] [MainThread]: Command end result
[0m14:48:03.106008 [info ] [MainThread]: 
[0m14:48:03.106351 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:48:03.106646 [info ] [MainThread]: 
[0m14:48:03.106965 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:48:03.108332 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.1876864, "process_user_time": 1.683479, "process_kernel_time": 0.182776, "process_mem_max_rss": "146554880", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:48:03.108746 [debug] [MainThread]: Command `dbt run` succeeded at 14:48:03.108671 after 4.19 seconds
[0m14:48:03.108989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bda350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028ae120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106702b70>]}
[0m14:48:03.109223 [debug] [MainThread]: Flushing usage events
[0m14:48:13.102683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10793a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bb3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bb3c50>]}


============================== 14:48:13.105169 | 4e34fa1d-ca48-4775-8335-3528cdebe853 ==============================
[0m14:48:13.105169 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:48:13.105488 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:48:13.270499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127f6190>]}
[0m14:48:13.293402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127786b0>]}
[0m14:48:13.293852 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:48:13.304148 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:48:13.354696 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m14:48:13.355043 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/decommission/hot_100_flat.py
[0m14:48:13.355179 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/decommission/hot_100_flat_depr.py
[0m14:48:13.451622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112aea550>]}
[0m14:48:13.487589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127ba7b0>]}
[0m14:48:13.487859 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m14:48:13.488022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113124ad0>]}
[0m14:48:13.488873 [info ] [MainThread]: 
[0m14:48:13.489142 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:48:13.491061 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:48:13.499343 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:48:13.499590 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:48:13.499720 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:13.885474 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.386 seconds
[0m14:48:13.888274 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:48:13.995310 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:48:14.006085 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:48:14.006447 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:48:14.006709 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:14.380779 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.374 seconds
[0m14:48:14.384177 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:48:14.483987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112fa3c70>]}
[0m14:48:14.484729 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:48:14.485107 [info ] [MainThread]: 
[0m14:48:14.488312 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:48:14.488816 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m14:48:14.489387 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m14:48:14.489960 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:48:14.490497 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:48:14.491488 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:48:14.491928 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:48:14.492242 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:48:14.500764 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:48:14.503866 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:14.504887 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:48:14.505195 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m14:48:14.538165 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:14.540677 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:48:14.541729 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:48:14.541981 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:48:14.542194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:14.542578 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:48:14.543272 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:48:14.543752 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:48:15.160226 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.618 seconds
[0m14:48:15.176635 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:48:15.259936 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ca9190>]}
[0m14:48:15.260554 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.77s]
[0m14:48:15.260998 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:48:15.261421 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:48:15.261718 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:48:15.262058 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:48:15.262282 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:48:15.264337 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:15.264910 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:48:15.266945 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:15.268121 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:48:15.268468 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:48:15.268720 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:48:15.390438 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.847 seconds
[0m14:48:15.392422 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m14:48:15.488577 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111753ee0>]}
[0m14:48:15.489640 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.00s]
[0m14:48:15.490427 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m14:48:16.189854 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.921 seconds
[0m14:48:16.194295 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:48:16.291944 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4e34fa1d-ca48-4775-8335-3528cdebe853', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d67070>]}
[0m14:48:16.292819 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.03s]
[0m14:48:16.293491 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:48:16.295227 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:16.295531 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:48:16.295786 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:48:16.296015 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:48:16.296380 [info ] [MainThread]: 
[0m14:48:16.296714 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 2.81 seconds (2.81s).
[0m14:48:16.297668 [debug] [MainThread]: Command end result
[0m14:48:16.322139 [info ] [MainThread]: 
[0m14:48:16.322616 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:48:16.322822 [info ] [MainThread]: 
[0m14:48:16.323042 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:48:16.324363 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.2516904, "process_user_time": 1.295794, "process_kernel_time": 0.175484, "process_mem_max_rss": "143441920", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:48:16.324684 [debug] [MainThread]: Command `dbt run` succeeded at 14:48:16.324626 after 3.25 seconds
[0m14:48:16.324919 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113128050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110eb4ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111bda350>]}
[0m14:48:16.325137 [debug] [MainThread]: Flushing usage events
[0m14:48:28.944055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10375e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059b3c50>]}


============================== 14:48:28.946243 | eb5fd0a4-dced-4877-8fbb-8c1a8cca4674 ==============================
[0m14:48:28.946243 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:48:28.946606 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:48:29.103576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066fa190>]}
[0m14:48:29.126044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066786b0>]}
[0m14:48:29.126525 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:48:29.136081 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:48:29.186072 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:48:29.186333 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:48:29.200663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b75050>]}
[0m14:48:29.237396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066b6b70>]}
[0m14:48:29.237668 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m14:48:29.237828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d9d390>]}
[0m14:48:29.239011 [info ] [MainThread]: 
[0m14:48:29.239290 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:48:29.241223 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:48:29.248513 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:48:29.248752 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:48:29.248888 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:29.600537 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.351 seconds
[0m14:48:29.602604 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:48:29.722214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:48:29.732659 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:48:29.733041 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:48:29.733311 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:30.330435 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.597 seconds
[0m14:48:30.333752 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:48:30.440771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d7df30>]}
[0m14:48:30.441755 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:48:30.442199 [info ] [MainThread]: 
[0m14:48:30.445872 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:48:30.446444 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m14:48:30.447157 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m14:48:30.448011 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:48:30.448704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:48:30.449267 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:48:30.449638 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:48:30.449978 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:48:30.461474 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:48:30.464723 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:30.465648 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:48:30.466011 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m14:48:30.539883 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m14:48:30.538613 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:48:30.540857 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:48:30.541650 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:48:30.541858 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:48:30.542124 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:48:30.542322 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:48:30.542471 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:31.003677 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.461 seconds
[0m14:48:31.026143 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:48:31.117572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106faa210>]}
[0m14:48:31.118322 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.67s]
[0m14:48:31.118893 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:48:31.119442 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:48:31.119924 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:48:31.120404 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:48:31.120699 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:48:31.123953 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:31.124702 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:48:31.126523 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:48:31.127584 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:48:31.127900 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:48:31.128180 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:48:31.525738 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.983 seconds
[0m14:48:31.529050 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m14:48:31.634403 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c736a0>]}
[0m14:48:31.635471 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.19s]
[0m14:48:31.636208 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m14:48:32.140978 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.012 seconds
[0m14:48:32.145157 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:48:32.229947 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eb5fd0a4-dced-4877-8fbb-8c1a8cca4674', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066d8eb0>]}
[0m14:48:32.230427 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.11s]
[0m14:48:32.230825 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:48:32.231684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:32.231837 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:48:32.231959 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:48:32.232073 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:48:32.232259 [info ] [MainThread]: 
[0m14:48:32.232415 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 2.99 seconds (2.99s).
[0m14:48:32.232886 [debug] [MainThread]: Command end result
[0m14:48:32.247702 [info ] [MainThread]: 
[0m14:48:32.247975 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:48:32.248125 [info ] [MainThread]: 
[0m14:48:32.248273 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:48:32.249196 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3340719, "process_user_time": 1.20417, "process_kernel_time": 0.158673, "process_mem_max_rss": "139067392", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:48:32.249461 [debug] [MainThread]: Command `dbt run` succeeded at 14:48:32.249416 after 3.33 seconds
[0m14:48:32.249636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b73e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa4450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059da350>]}
[0m14:48:32.249798 [debug] [MainThread]: Flushing usage events
[0m14:51:06.387112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10413e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060f7c50>]}


============================== 14:51:06.389446 | 8e2d9da7-3fa3-4122-9179-2e9901c2df91 ==============================
[0m14:51:06.389446 [info ] [MainThread]: Running with dbt=1.8.8
[0m14:51:06.389769 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:51:06.555859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ef6190>]}
[0m14:51:06.578638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e786b0>]}
[0m14:51:06.579080 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m14:51:06.589356 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m14:51:06.639667 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:51:06.639925 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:51:06.654522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071e9050>]}
[0m14:51:06.692937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ebab70>]}
[0m14:51:06.693187 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m14:51:06.693349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075ad390>]}
[0m14:51:06.694561 [info ] [MainThread]: 
[0m14:51:06.694894 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:51:06.696904 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m14:51:06.704537 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m14:51:06.704778 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m14:51:06.704913 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:51:07.269187 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.564 seconds
[0m14:51:07.271363 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m14:51:07.366398 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m14:51:07.376208 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m14:51:07.376632 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m14:51:07.376911 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:51:07.757527 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.380 seconds
[0m14:51:07.760926 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m14:51:07.871600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10757df30>]}
[0m14:51:07.872453 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:51:07.872824 [info ] [MainThread]: 
[0m14:51:07.875695 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m14:51:07.876148 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m14:51:07.876747 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m14:51:07.877270 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m14:51:07.877842 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m14:51:07.878382 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m14:51:07.878705 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m14:51:07.878991 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m14:51:07.890233 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m14:51:07.893464 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m14:51:07.894326 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m14:51:07.901114 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m14:51:07.957526 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m14:51:07.964669 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m14:51:07.965347 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m14:51:07.965546 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m14:51:07.965707 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:51:07.966930 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m14:51:07.967147 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m14:51:07.967323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:51:08.523711 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.556 seconds
[0m14:51:08.547277 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m14:51:08.636304 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ab1d0>]}
[0m14:51:08.637390 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.76s]
[0m14:51:08.638093 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m14:51:08.638814 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m14:51:08.639270 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m14:51:08.639749 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m14:51:08.640052 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m14:51:08.643015 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m14:51:08.643980 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m14:51:08.647011 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m14:51:08.648350 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m14:51:08.648770 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m14:51:08.649213 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:51:08.871187 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.905 seconds
[0m14:51:08.874463 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m14:51:09.276331 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077d1a70>]}
[0m14:51:09.277100 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.40s]
[0m14:51:09.277537 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m14:51:09.860950 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.212 seconds
[0m14:51:09.863819 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m14:51:09.980487 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e2d9da7-3fa3-4122-9179-2e9901c2df91', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e85f90>]}
[0m14:51:09.981476 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.34s]
[0m14:51:09.982143 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m14:51:09.984273 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:51:09.984724 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m14:51:09.985069 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m14:51:09.985384 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m14:51:09.985886 [info ] [MainThread]: 
[0m14:51:09.986296 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m14:51:09.987279 [debug] [MainThread]: Command end result
[0m14:51:10.013306 [info ] [MainThread]: 
[0m14:51:10.013872 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:51:10.014083 [info ] [MainThread]: 
[0m14:51:10.014286 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:51:10.015974 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6621125, "process_user_time": 1.238159, "process_kernel_time": 0.173889, "process_mem_max_rss": "142196736", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:51:10.016344 [debug] [MainThread]: Command `dbt run` succeeded at 14:51:10.016283 after 3.66 seconds
[0m14:51:10.016607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071cbe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b72fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106116350>]}
[0m14:51:10.016830 [debug] [MainThread]: Flushing usage events
[0m20:23:41.625482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e62660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ff3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ff3c50>]}


============================== 20:23:41.628390 | 67dbf668-f435-429f-914e-fe03569a0158 ==============================
[0m20:23:41.628390 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:23:41.628685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:23:41.891561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108df6190>]}
[0m20:23:41.914124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d786b0>]}
[0m20:23:41.914898 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:23:41.930691 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:23:42.008647 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:23:42.009170 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:23:42.033780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090f5050>]}
[0m20:23:42.081977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dbab70>]}
[0m20:23:42.082270 [info ] [MainThread]: Found 3 models, 2 sources, 454 macros
[0m20:23:42.082440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094a9390>]}
[0m20:23:42.083805 [info ] [MainThread]: 
[0m20:23:42.084149 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:23:42.086268 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:23:42.093514 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:23:42.093739 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:23:42.093876 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:23:43.247331 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 1.153 seconds
[0m20:23:43.250152 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:23:43.438192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:23:43.448665 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:23:43.449032 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:23:43.449313 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:23:43.795924 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.346 seconds
[0m20:23:43.799943 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:23:43.957446 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10947dbf0>]}
[0m20:23:43.958459 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:23:43.958912 [info ] [MainThread]: 
[0m20:23:43.963624 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:23:43.964149 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:23:43.964754 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:23:43.965304 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:23:43.965847 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:23:43.966505 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:23:43.966987 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:23:43.967307 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:23:44.041317 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:23:44.042543 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:23:44.043867 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:23:44.050709 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:23:44.064241 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:23:44.067898 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:23:44.068528 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:23:44.068708 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:23:44.068864 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:23:44.069842 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:23:44.070056 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:23:44.070234 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:23:44.838445 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.768 seconds
[0m20:23:44.853352 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:23:44.960821 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8af710>]}
[0m20:23:44.961308 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.99s]
[0m20:23:44.961642 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:23:44.962171 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:23:44.962464 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:23:44.962761 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:23:44.962950 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:23:44.964802 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:23:44.965446 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:23:44.967416 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:23:44.968258 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:23:44.968476 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:23:44.968669 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:23:45.686209 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.617 seconds
[0m20:23:45.689507 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:23:45.791115 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e8fee0>]}
[0m20:23:45.791732 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.82s]
[0m20:23:45.792160 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:23:46.488060 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.519 seconds
[0m20:23:46.491623 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:23:46.584610 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67dbf668-f435-429f-914e-fe03569a0158', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc29450>]}
[0m20:23:46.585281 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.62s]
[0m20:23:46.585779 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:23:46.586851 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:23:46.587060 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:23:46.587226 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:23:46.587378 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:23:46.587604 [info ] [MainThread]: 
[0m20:23:46.587805 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m20:23:46.588552 [debug] [MainThread]: Command end result
[0m20:23:46.609382 [info ] [MainThread]: 
[0m20:23:46.609703 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:23:46.609883 [info ] [MainThread]: 
[0m20:23:46.610059 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m20:23:46.620590 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.0298595, "process_user_time": 1.317533, "process_kernel_time": 0.28597, "process_mem_max_rss": "142557184", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:23:46.621036 [debug] [MainThread]: Command `dbt run` succeeded at 20:23:46.620973 after 5.03 seconds
[0m20:23:46.621258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090cbdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093de3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080162e0>]}
[0m20:23:46.621459 [debug] [MainThread]: Flushing usage events
[0m20:32:25.452398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084f3c50>]}


============================== 20:32:25.454751 | 0045e4d1-95b6-474c-b37c-c87d6b42c5d1 ==============================
[0m20:32:25.454751 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:32:25.455058 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:32:25.620903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f6190>]}
[0m20:32:25.643293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093786b0>]}
[0m20:32:25.643747 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:32:25.653748 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:32:25.705551 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 1 files added, 0 files changed.
[0m20:32:25.705892 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/analytics/summary_stats.sql
[0m20:32:25.804285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109686550>]}
[0m20:32:25.842053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093b8410>]}
[0m20:32:25.842328 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m20:32:25.842492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a440ad0>]}
[0m20:32:25.843399 [info ] [MainThread]: 
[0m20:32:25.843680 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:32:25.845678 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:32:25.853854 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:32:25.854089 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:32:25.854225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:32:26.436062 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.581 seconds
[0m20:32:26.439466 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:32:26.543013 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:32:26.553181 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:32:26.555299 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:32:26.555575 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:32:26.959266 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.403 seconds
[0m20:32:26.963198 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:32:27.057312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099832b0>]}
[0m20:32:27.057923 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:32:27.058243 [info ] [MainThread]: 
[0m20:32:27.061021 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:32:27.061443 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:32:27.061996 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:32:27.062490 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:32:27.063012 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:32:27.063438 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:32:27.063753 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:32:27.064468 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:32:27.072677 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:32:27.075093 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:32:27.076254 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:32:27.076673 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:32:27.108443 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:32:27.110608 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:32:27.111289 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:32:27.111940 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:32:27.112123 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:32:27.112336 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:32:27.112524 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:32:27.112664 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:32:27.677314 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.565 seconds
[0m20:32:27.693688 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:32:27.776592 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4bb650>]}
[0m20:32:27.777206 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.71s]
[0m20:32:27.777723 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:32:27.778303 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:32:27.778734 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:32:27.779159 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:32:27.779435 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:32:27.781777 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:32:27.782448 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:32:27.784772 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:32:27.785895 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:32:27.786285 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:32:27.786819 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:32:27.909397 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.797 seconds
[0m20:32:27.911453 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:32:28.010206 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10838fee0>]}
[0m20:32:28.011266 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.95s]
[0m20:32:28.011986 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:32:28.613144 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.825 seconds
[0m20:32:28.617519 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:32:28.712735 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b08ad50>]}
[0m20:32:28.713787 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.93s]
[0m20:32:28.714409 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:32:28.715215 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.summary_stats
[0m20:32:28.715638 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.summary_stats ........................... [RUN]
[0m20:32:28.716119 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.summary_stats'
[0m20:32:28.716599 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.summary_stats
[0m20:32:28.719480 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.summary_stats"
[0m20:32:28.720498 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.summary_stats
[0m20:32:28.722718 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.summary_stats"
[0m20:32:28.723727 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.summary_stats"
[0m20:32:28.724030 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.summary_stats"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.summary_stats
         as
        (-- models/summary_statistics.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:32:28.724292 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:32:29.761781 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.037 seconds
[0m20:32:29.763715 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: Close
[0m20:32:29.853572 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0045e4d1-95b6-474c-b37c-c87d6b42c5d1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10787d8d0>]}
[0m20:32:29.854682 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.summary_stats ...................... [[32mSUCCESS 1[0m in 1.14s]
[0m20:32:29.855381 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.summary_stats
[0m20:32:29.857059 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:32:29.857416 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:32:29.857684 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:32:29.857932 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:32:29.858163 [debug] [MainThread]: Connection 'model.billboard_hot_100.summary_stats' was properly closed.
[0m20:32:29.858580 [info ] [MainThread]: 
[0m20:32:29.858915 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 4.01 seconds (4.01s).
[0m20:32:29.859990 [debug] [MainThread]: Command end result
[0m20:32:29.883685 [info ] [MainThread]: 
[0m20:32:29.884045 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:32:29.884238 [info ] [MainThread]: 
[0m20:32:29.884436 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:32:29.885669 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.461991, "process_user_time": 1.360282, "process_kernel_time": 0.18762, "process_mem_max_rss": "141131776", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:32:29.886065 [debug] [MainThread]: Command `dbt run` succeeded at 20:32:29.885992 after 4.46 seconds
[0m20:32:29.886317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085162e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028c2120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065cadb0>]}
[0m20:32:29.886538 [debug] [MainThread]: Flushing usage events
[0m20:41:29.107246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fb2660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eefc50>]}


============================== 20:41:29.109634 | 53797f6b-1fc1-46df-aa27-b046ddb5edec ==============================
[0m20:41:29.109634 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:41:29.109970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:41:29.271221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cfa190>]}
[0m20:41:29.293501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c786b0>]}
[0m20:41:29.293902 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:41:29.302563 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:41:29.353748 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:41:29.354107 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m20:41:29.452460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106192550>]}
[0m20:41:29.490421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cb6990>]}
[0m20:41:29.490715 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m20:41:29.490877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e449f0>]}
[0m20:41:29.492039 [info ] [MainThread]: 
[0m20:41:29.492396 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:41:29.494445 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:41:29.502720 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:41:29.502947 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:41:29.503078 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:41:30.009542 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.506 seconds
[0m20:41:30.012538 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:41:30.167617 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:41:30.177782 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:41:30.178232 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:41:30.178508 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:41:30.583350 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.405 seconds
[0m20:41:30.587094 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:41:30.710999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064531e0>]}
[0m20:41:30.711801 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:41:30.712164 [info ] [MainThread]: 
[0m20:41:30.715265 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:41:30.715838 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:41:30.716465 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:41:30.717011 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:41:30.717429 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:41:30.717939 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:41:30.718441 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:41:30.718938 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:41:30.728262 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:41:30.730239 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:41:30.731258 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:41:30.731585 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:41:30.759626 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:41:30.766094 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:41:30.767525 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:41:30.767924 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:41:30.768204 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:41:30.768483 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:41:30.768686 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:41:30.768848 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:41:31.652006 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.883 seconds
[0m20:41:31.677587 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:41:31.762495 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ff0ad0>]}
[0m20:41:31.763374 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 1.04s]
[0m20:41:31.764031 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:41:31.764743 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:41:31.765165 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:41:31.765634 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:41:31.765931 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:41:31.768715 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:41:31.769525 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:41:31.772179 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:41:31.773406 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:41:31.773731 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS num_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.num_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:41:31.774021 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:41:31.852617 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.084 seconds
[0m20:41:31.854372 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:41:31.940536 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eaeba0>]}
[0m20:41:31.941237 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.22s]
[0m20:41:31.941778 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:41:33.320718 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.546 seconds
[0m20:41:33.325582 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:41:33.425521 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f622b0>]}
[0m20:41:33.426590 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.66s]
[0m20:41:33.427410 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:41:33.428628 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.summary_stats
[0m20:41:33.429378 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.summary_stats ........................... [RUN]
[0m20:41:33.429993 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.summary_stats'
[0m20:41:33.430336 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.summary_stats
[0m20:41:33.433552 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.summary_stats"
[0m20:41:33.434717 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.summary_stats
[0m20:41:33.438773 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.summary_stats"
[0m20:41:33.440034 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.summary_stats"
[0m20:41:33.440398 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.summary_stats"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.summary_stats
         as
        (-- models/summary_statistics.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:41:33.440720 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:41:34.300229 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.859 seconds
[0m20:41:34.303746 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: Close
[0m20:41:34.402823 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '53797f6b-1fc1-46df-aa27-b046ddb5edec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061487d0>]}
[0m20:41:34.403934 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.summary_stats ...................... [[32mSUCCESS 1[0m in 0.97s]
[0m20:41:34.404727 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.summary_stats
[0m20:41:34.406430 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:41:34.406845 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:41:34.407141 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:41:34.407401 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:41:34.407649 [debug] [MainThread]: Connection 'model.billboard_hot_100.summary_stats' was properly closed.
[0m20:41:34.408089 [info ] [MainThread]: 
[0m20:41:34.408431 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 4.92 seconds (4.92s).
[0m20:41:34.409502 [debug] [MainThread]: Command end result
[0m20:41:34.433550 [info ] [MainThread]: 
[0m20:41:34.433919 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:41:34.434122 [info ] [MainThread]: 
[0m20:41:34.434322 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:41:34.435537 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.3606453, "process_user_time": 1.390797, "process_kernel_time": 0.187869, "process_mem_max_rss": "143769600", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:41:34.435874 [debug] [MainThread]: Command `dbt run` succeeded at 20:41:34.435812 after 5.36 seconds
[0m20:41:34.436109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f162e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101206120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1025efe90>]}
[0m20:41:34.436332 [debug] [MainThread]: Flushing usage events
[0m20:43:39.252463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033c2660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dabed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dabc50>]}


============================== 20:43:39.254626 | fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d ==============================
[0m20:43:39.254626 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:43:39.254968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:43:39.415168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10592a190>]}
[0m20:43:39.437435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a86b0>]}
[0m20:43:39.437851 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:43:39.446296 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:43:39.497034 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:43:39.497519 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m20:43:39.593067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c7e550>]}
[0m20:43:39.631110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058ea990>]}
[0m20:43:39.631411 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m20:43:39.631582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106018ad0>]}
[0m20:43:39.632603 [info ] [MainThread]: 
[0m20:43:39.632908 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:43:39.635249 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:43:39.643996 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:43:39.644255 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:43:39.644389 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:43:40.121572 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.477 seconds
[0m20:43:40.125492 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:43:40.225081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:43:40.234237 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:43:40.234558 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:43:40.234804 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:43:40.621309 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.386 seconds
[0m20:43:40.625051 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:43:40.728109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f771e0>]}
[0m20:43:40.728720 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:43:40.728987 [info ] [MainThread]: 
[0m20:43:40.731382 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:43:40.731752 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:43:40.732167 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:43:40.732548 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:43:40.732898 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:43:40.733243 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:43:40.733493 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:43:40.733722 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:43:40.741484 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:43:40.744496 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:43:40.745364 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:43:40.745728 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:43:40.777401 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:43:40.780049 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:43:40.781140 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:43:40.781404 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:43:40.781796 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:43:40.781981 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:43:40.782172 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:43:40.782595 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:43:41.242381 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.460 seconds
[0m20:43:41.273945 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:43:41.370498 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061c9610>]}
[0m20:43:41.371576 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.64s]
[0m20:43:41.372369 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:43:41.373069 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:43:41.373530 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:43:41.374062 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:43:41.374408 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:43:41.378020 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:43:41.379161 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:43:41.382237 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:43:41.383926 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:43:41.384463 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:43:41.384846 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:43:41.565490 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.783 seconds
[0m20:43:41.568121 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:43:41.665620 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b0fee0>]}
[0m20:43:41.666300 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.93s]
[0m20:43:41.666802 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:43:42.153653 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.768 seconds
[0m20:43:42.157694 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:43:42.255271 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106172e90>]}
[0m20:43:42.256195 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.88s]
[0m20:43:42.256862 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:43:42.257659 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.summary_stats
[0m20:43:42.258285 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.summary_stats ........................... [RUN]
[0m20:43:42.258850 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.summary_stats'
[0m20:43:42.259207 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.summary_stats
[0m20:43:42.262016 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.summary_stats"
[0m20:43:42.263084 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.summary_stats
[0m20:43:42.265227 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.summary_stats"
[0m20:43:42.266088 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.summary_stats"
[0m20:43:42.266392 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.summary_stats"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.summary_stats
         as
        (-- models/summary_statistics.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:43:42.266659 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:43:43.095070 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.828 seconds
[0m20:43:43.099956 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: Close
[0m20:43:43.208494 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fa6bfd5f-e4ce-4519-bac6-21b8ef1a851d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10433ba50>]}
[0m20:43:43.209436 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.summary_stats ...................... [[32mSUCCESS 1[0m in 0.95s]
[0m20:43:43.210235 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.summary_stats
[0m20:43:43.212121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:43:43.212602 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:43:43.212943 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:43:43.213242 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:43:43.213526 [debug] [MainThread]: Connection 'model.billboard_hot_100.summary_stats' was properly closed.
[0m20:43:43.213949 [info ] [MainThread]: 
[0m20:43:43.214301 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 3.58 seconds (3.58s).
[0m20:43:43.215825 [debug] [MainThread]: Command end result
[0m20:43:43.240514 [info ] [MainThread]: 
[0m20:43:43.240881 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:43:43.241096 [info ] [MainThread]: 
[0m20:43:43.241312 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:43:43.242552 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.018988, "process_user_time": 1.403579, "process_kernel_time": 0.179042, "process_mem_max_rss": "142114816", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:43:43.242909 [debug] [MainThread]: Command `dbt run` succeeded at 20:43:43.242843 after 4.02 seconds
[0m20:43:43.243152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dd22e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10161a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b0bad0>]}
[0m20:43:43.243370 [debug] [MainThread]: Flushing usage events
[0m20:44:05.587681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102626660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10400fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10400fc50>]}


============================== 20:44:05.590187 | cb695e43-5f0b-46f9-b83b-8f0d8c38ca44 ==============================
[0m20:44:05.590187 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:44:05.590516 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:44:05.762432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dfa190>]}
[0m20:44:05.786730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d786b0>]}
[0m20:44:05.787252 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:44:05.797032 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:44:05.848831 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:44:05.849070 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:44:05.864262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105291050>]}
[0m20:44:05.903350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dbab70>]}
[0m20:44:05.903647 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m20:44:05.903811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055ad390>]}
[0m20:44:05.905027 [info ] [MainThread]: 
[0m20:44:05.905319 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:44:05.907332 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:44:05.914860 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:44:05.915048 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:44:05.915179 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:44:06.281080 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.366 seconds
[0m20:44:06.282694 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:44:06.368266 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:44:06.374193 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:44:06.374681 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:44:06.375078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:44:06.739063 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.364 seconds
[0m20:44:06.746706 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:44:06.854106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105569bf0>]}
[0m20:44:06.854992 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:44:06.855363 [info ] [MainThread]: 
[0m20:44:06.858305 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:44:06.858856 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:44:06.859415 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:44:06.859932 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:44:06.860422 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:44:06.860860 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:44:06.861161 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:44:06.861426 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:44:06.869326 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:44:06.876425 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:44:06.877205 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:44:06.877498 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:44:06.940871 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:44:06.945173 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:44:06.945893 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:44:06.946085 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:44:06.946240 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:44:06.947220 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:44:06.947438 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:44:06.947622 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:44:07.391224 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.443 seconds
[0m20:44:07.405004 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:44:07.506603 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fda5d0>]}
[0m20:44:07.507177 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.65s]
[0m20:44:07.507548 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:44:07.507915 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:44:07.508176 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:44:07.508954 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:44:07.509510 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:44:07.513049 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:44:07.513909 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:44:07.517001 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:44:07.518440 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:44:07.518879 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:44:07.519151 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:44:07.732780 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.786 seconds
[0m20:44:07.734692 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:44:07.831278 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103d6fee0>]}
[0m20:44:07.832284 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.97s]
[0m20:44:07.832895 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:44:08.496114 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.976 seconds
[0m20:44:08.499867 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:44:08.609499 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dd9b30>]}
[0m20:44:08.610682 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.10s]
[0m20:44:08.611357 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:44:08.612406 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.summary_stats
[0m20:44:08.612951 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.summary_stats ........................... [RUN]
[0m20:44:08.613498 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.summary_stats'
[0m20:44:08.613852 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.summary_stats
[0m20:44:08.616805 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.summary_stats"
[0m20:44:08.617777 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.summary_stats
[0m20:44:08.620366 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.summary_stats"
[0m20:44:08.621574 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.summary_stats"
[0m20:44:08.622143 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.summary_stats"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.summary_stats
         as
        (-- models/summary_statistics.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:44:08.622437 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:44:09.784049 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.162 seconds
[0m20:44:09.786145 [debug] [Thread-4 (]: On model.billboard_hot_100.summary_stats: Close
[0m20:44:09.880567 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cb695e43-5f0b-46f9-b83b-8f0d8c38ca44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052087d0>]}
[0m20:44:09.881745 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.summary_stats ...................... [[32mSUCCESS 1[0m in 1.27s]
[0m20:44:09.882562 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.summary_stats
[0m20:44:09.884174 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:44:09.884520 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:44:09.884773 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:44:09.885009 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:44:09.885235 [debug] [MainThread]: Connection 'model.billboard_hot_100.summary_stats' was properly closed.
[0m20:44:09.885631 [info ] [MainThread]: 
[0m20:44:09.885960 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 3.98 seconds (3.98s).
[0m20:44:09.887003 [debug] [MainThread]: Command end result
[0m20:44:09.910905 [info ] [MainThread]: 
[0m20:44:09.911272 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:44:09.911471 [info ] [MainThread]: 
[0m20:44:09.911672 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m20:44:09.912882 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3570356, "process_user_time": 1.273655, "process_kernel_time": 0.171974, "process_mem_max_rss": "139247616", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:44:09.913217 [debug] [MainThread]: Command `dbt run` succeeded at 20:44:09.913156 after 4.36 seconds
[0m20:44:09.913443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10087a120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040322e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c1f530>]}
[0m20:44:09.913651 [debug] [MainThread]: Flushing usage events
[0m20:49:14.270497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d52660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104743ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104743c50>]}


============================== 20:49:14.272866 | b27ca34b-6241-40c8-833a-d075c25d0d10 ==============================
[0m20:49:14.272866 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:49:14.273396 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m20:49:14.451430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053fa190>]}
[0m20:49:14.475900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053786b0>]}
[0m20:49:14.476525 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:49:14.486249 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:49:14.538151 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 0 files changed.
[0m20:49:14.538492 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/analytics/countries.sql
[0m20:49:14.538652 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/analytics/genres.sql
[0m20:49:14.538773 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/analytics/summary_stats.sql
[0m20:49:14.637383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10574f750>]}
[0m20:49:14.675782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053b4410>]}
[0m20:49:14.676053 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m20:49:14.676212 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d2c9f0>]}
[0m20:49:14.677197 [info ] [MainThread]: 
[0m20:49:14.677473 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:49:14.679518 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:49:14.687769 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:49:14.688024 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:49:14.688156 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:49:15.142439 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.454 seconds
[0m20:49:15.145156 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:49:15.242214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:49:15.252873 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:49:15.253352 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:49:15.253628 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:49:15.590568 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.337 seconds
[0m20:49:15.592201 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:49:15.684582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b80390>]}
[0m20:49:15.685207 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:49:15.685508 [info ] [MainThread]: 
[0m20:49:15.688003 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:49:15.688456 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:49:15.689029 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:49:15.689650 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:49:15.690341 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:49:15.690957 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:49:15.691331 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:49:15.691639 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:49:15.698584 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:49:15.701013 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:49:15.701743 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:49:15.702096 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:49:15.734049 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:49:15.734520 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:49:15.735674 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:49:15.736038 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:49:15.736270 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:49:15.736505 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:49:15.736688 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:15.736845 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:49:16.267713 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.531 seconds
[0m20:49:16.287043 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:49:16.383340 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ec8e90>]}
[0m20:49:16.383877 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.69s]
[0m20:49:16.384269 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:49:16.384722 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:49:16.385063 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:49:16.385393 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:49:16.385603 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:49:16.387585 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:49:16.388107 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:49:16.390054 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:49:16.391117 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:49:16.391425 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:49:16.391658 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:49:16.600872 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.864 seconds
[0m20:49:16.602786 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:49:16.692002 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10449fee0>]}
[0m20:49:16.692519 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.00s]
[0m20:49:16.692854 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:49:17.384362 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.993 seconds
[0m20:49:17.387288 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:49:17.482194 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f4ad50>]}
[0m20:49:17.482894 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.10s]
[0m20:49:17.483368 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:49:17.484209 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m20:49:17.484601 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m20:49:17.485070 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m20:49:17.485732 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m20:49:17.486315 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m20:49:17.486632 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m20:49:17.486884 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m20:49:17.487106 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m20:49:17.489170 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m20:49:17.491067 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m20:49:17.492052 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m20:49:17.493010 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m20:49:17.494722 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m20:49:17.496037 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m20:49:17.496898 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m20:49:17.497365 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m20:49:17.497621 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

SELECT DISTINCT
COUNTRY
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:49:17.497952 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:49:17.498200 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:49:17.498393 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:49:18.326274 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.828 seconds
[0m20:49:18.327717 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m20:49:18.341149 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.843 seconds
[0m20:49:18.342549 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m20:49:18.410980 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c2eb50>]}
[0m20:49:18.411432 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.92s]
[0m20:49:18.411721 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m20:49:18.537481 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b27ca34b-6241-40c8-833a-d075c25d0d10', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e489f0>]}
[0m20:49:18.538037 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.05s]
[0m20:49:18.538564 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m20:49:18.539675 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:49:18.539914 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m20:49:18.540061 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:49:18.540191 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:49:18.540321 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m20:49:18.540556 [info ] [MainThread]: 
[0m20:49:18.540743 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 3.86 seconds (3.86s).
[0m20:49:18.541414 [debug] [MainThread]: Command end result
[0m20:49:18.565571 [info ] [MainThread]: 
[0m20:49:18.565956 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:49:18.566205 [info ] [MainThread]: 
[0m20:49:18.566431 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m20:49:18.567682 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.3294845, "process_user_time": 1.345779, "process_kernel_time": 0.186592, "process_mem_max_rss": "144228352", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:49:18.568037 [debug] [MainThread]: Command `dbt run` succeeded at 20:49:18.567971 after 4.33 seconds
[0m20:49:18.568296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10334e510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f9e8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f9cc50>]}
[0m20:49:18.568529 [debug] [MainThread]: Flushing usage events
[0m20:58:38.541910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10763a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9b3c50>]}


============================== 20:58:38.544080 | e0cf40a3-2a61-4b01-8963-9713d3af3397 ==============================
[0m20:58:38.544080 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:58:38.544394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:58:38.712363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0f6190>]}
[0m20:58:38.735568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0786b0>]}
[0m20:58:38.736052 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:58:38.745612 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:58:38.796775 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:58:38.797150 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m20:58:38.894092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccc3550>]}
[0m20:58:38.932438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0b8410>]}
[0m20:58:38.932721 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m20:58:38.932888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d060c90>]}
[0m20:58:38.933805 [info ] [MainThread]: 
[0m20:58:38.934083 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:58:38.936140 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:58:38.944239 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:58:38.944473 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:58:38.944609 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:58:39.704475 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.760 seconds
[0m20:58:39.706401 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:58:39.798066 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:58:39.807891 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:58:39.808274 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:58:39.808547 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:58:40.222892 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.414 seconds
[0m20:58:40.224710 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:58:40.332843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf85b20>]}
[0m20:58:40.333638 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:58:40.334040 [info ] [MainThread]: 
[0m20:58:40.336668 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:58:40.337085 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:58:40.337574 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:58:40.338046 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:58:40.338463 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:58:40.338877 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:58:40.339258 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:58:40.339570 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:58:40.347495 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:58:40.349343 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:58:40.350280 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:58:40.350636 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:58:40.382224 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:58:40.382502 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:58:40.383208 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:58:40.384103 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:58:40.384307 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:58:40.384544 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:58:40.384762 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:58:40.384916 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:58:40.887297 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.502 seconds
[0m20:58:40.912103 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:58:41.002119 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0d3b90>]}
[0m20:58:41.003035 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.66s]
[0m20:58:41.003724 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:58:41.004429 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:58:41.004898 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:58:41.005427 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:58:41.005780 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:58:41.008904 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:58:41.009891 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:58:41.013052 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:58:41.014938 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:58:41.015468 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:58:41.015786 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:58:41.401278 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.016 seconds
[0m20:58:41.406977 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:58:41.500777 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a84fee0>]}
[0m20:58:41.501612 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.16s]
[0m20:58:41.502225 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:58:42.130928 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.115 seconds
[0m20:58:42.138620 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:58:42.255314 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d3b5f90>]}
[0m20:58:42.255857 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.25s]
[0m20:58:42.256228 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:58:42.256898 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m20:58:42.257233 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m20:58:42.257580 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m20:58:42.257934 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m20:58:42.258257 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m20:58:42.258511 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m20:58:42.258773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m20:58:42.260554 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m20:58:42.260761 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m20:58:42.262748 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m20:58:42.263289 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m20:58:42.264922 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m20:58:42.265226 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m20:58:42.266631 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m20:58:42.267309 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m20:58:42.267565 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

SELECT DISTINCT
    COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT artist) AS unique_artists,
    SUM(top10_entries) AS top_10_entries,
    MIN(top_rank) AS top_rank
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:58:42.267853 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:58:42.268698 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m20:58:42.269182 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:58:42.269372 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:58:42.582055 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f432-0103-989e-0003-07620002e26a
[0m20:58:42.582638 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 000979 (42601): SQL compilation error:
[HOT_100_ARTISTS.COUNTRY] is not a valid group by expression
[0m20:58:42.583067 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m20:58:42.681173 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  000979 (42601): SQL compilation error:
  [HOT_100_ARTISTS.COUNTRY] is not a valid group by expression
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m20:58:42.681880 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d069c50>]}
[0m20:58:42.682674 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.42s]
[0m20:58:42.683263 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m20:58:43.088178 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.818 seconds
[0m20:58:43.092458 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m20:58:43.193345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e0cf40a3-2a61-4b01-8963-9713d3af3397', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d38a890>]}
[0m20:58:43.194341 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.93s]
[0m20:58:43.195003 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m20:58:43.196984 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:58:43.197297 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m20:58:43.197555 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:58:43.197795 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:58:43.198030 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m20:58:43.198459 [info ] [MainThread]: 
[0m20:58:43.198780 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.26 seconds (4.26s).
[0m20:58:43.199989 [debug] [MainThread]: Command end result
[0m20:58:43.229946 [info ] [MainThread]: 
[0m20:58:43.230505 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:58:43.230704 [info ] [MainThread]: 
[0m20:58:43.230974 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  000979 (42601): SQL compilation error:
  [HOT_100_ARTISTS.COUNTRY] is not a valid group by expression
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m20:58:43.231164 [info ] [MainThread]: 
[0m20:58:43.231357 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:58:43.232619 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.721931, "process_user_time": 1.440368, "process_kernel_time": 0.186334, "process_mem_max_rss": "143589376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:58:43.232922 [debug] [MainThread]: Command `dbt run` failed at 20:58:43.232870 after 4.72 seconds
[0m20:58:43.233156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9c75f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e993bf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e993b90>]}
[0m20:58:43.233359 [debug] [MainThread]: Flushing usage events
[0m20:59:25.171980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e3a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096efc50>]}


============================== 20:59:25.174217 | e5eb59fe-7955-4c1e-9abb-2fb9bfd896de ==============================
[0m20:59:25.174217 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:59:25.174541 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m20:59:25.338422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acfa190>]}
[0m20:59:25.360883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac786b0>]}
[0m20:59:25.361329 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:59:25.373388 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:59:25.427140 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:59:25.427543 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m20:59:25.555511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af84b50>]}
[0m20:59:25.597373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10acb4410>]}
[0m20:59:25.597660 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m20:59:25.597821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c624c90>]}
[0m20:59:25.598787 [info ] [MainThread]: 
[0m20:59:25.599064 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:59:25.601224 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:59:25.609718 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:59:25.609880 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:59:25.610008 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:59:26.091944 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.482 seconds
[0m20:59:26.095723 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:59:26.202823 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:59:26.213518 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:59:26.213960 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:59:26.214234 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:59:26.604149 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.390 seconds
[0m20:59:26.607583 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:59:26.705776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c255cc0>]}
[0m20:59:26.706641 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:59:26.707030 [info ] [MainThread]: 
[0m20:59:26.710043 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:59:26.710551 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:59:26.711132 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:59:26.712036 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:59:26.712765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:59:26.713478 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:59:26.713840 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:59:26.714151 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:59:26.722896 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:59:26.725937 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:59:26.727167 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:59:26.727543 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:59:26.759364 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:59:26.759738 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:59:26.760820 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:59:26.761194 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:59:26.761439 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:59:26.761675 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:59:26.761854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:59:26.762011 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:59:27.556430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.794 seconds
[0m20:59:27.576212 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:59:27.663553 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6a7350>]}
[0m20:59:27.664095 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.95s]
[0m20:59:27.664484 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:59:27.664899 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:59:27.665190 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:59:27.665504 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:59:27.665708 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:59:27.667726 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:59:27.668342 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:59:27.670254 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:59:27.671136 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:59:27.671375 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:59:27.671591 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:59:28.025884 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.263 seconds
[0m20:59:28.030997 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:59:28.140961 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10958bee0>]}
[0m20:59:28.141717 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.43s]
[0m20:59:28.142304 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:59:28.511423 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.839 seconds
[0m20:59:28.515421 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:59:28.612988 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da06f30>]}
[0m20:59:28.614517 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.95s]
[0m20:59:28.615476 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:59:28.616727 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m20:59:28.617271 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m20:59:28.617861 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m20:59:28.618352 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m20:59:28.618915 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m20:59:28.619290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m20:59:28.619640 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m20:59:28.619954 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m20:59:28.623499 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m20:59:28.625952 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m20:59:28.627156 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m20:59:28.627659 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m20:59:28.630959 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m20:59:28.632637 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m20:59:28.633790 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m20:59:28.634591 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m20:59:28.635086 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:59:28.635471 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

SELECT DISTINCT
    COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT artist) AS unique_artists,
    SUM(top10_entries) AS top_10_entries,
    MIN(top_rank) AS top_rank
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
GROUP BY COUNTRY;
[0m20:59:28.635765 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:59:28.636007 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:59:28.977789 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f433-0103-989d-0003-07620002a2e6
[0m20:59:28.978501 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 12 at position 16 unexpected ';'.
[0m20:59:28.979043 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m20:59:29.091891 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 16 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m20:59:29.092580 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c636650>]}
[0m20:59:29.093281 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.47s]
[0m20:59:29.093839 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m20:59:29.877050 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.241 seconds
[0m20:59:29.880059 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m20:59:29.975704 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5eb59fe-7955-4c1e-9abb-2fb9bfd896de', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10da16b30>]}
[0m20:59:29.978912 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.36s]
[0m20:59:29.982478 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m20:59:29.984739 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:59:29.985236 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m20:59:29.985580 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m20:59:29.985882 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:59:29.986162 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m20:59:29.986591 [info ] [MainThread]: 
[0m20:59:29.986983 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m20:59:29.988378 [debug] [MainThread]: Command end result
[0m20:59:30.015840 [info ] [MainThread]: 
[0m20:59:30.016157 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m20:59:30.016330 [info ] [MainThread]: 
[0m20:59:30.016525 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 12 at position 16 unexpected ';'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m20:59:30.016680 [info ] [MainThread]: 
[0m20:59:30.016826 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m20:59:30.017857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.874449, "process_user_time": 1.459496, "process_kernel_time": 0.195388, "process_mem_max_rss": "144130048", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:59:30.018155 [debug] [MainThread]: Command `dbt run` failed at 20:59:30.018105 after 4.87 seconds
[0m20:59:30.018363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108054cb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd7bbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd7bb90>]}
[0m20:59:30.018545 [debug] [MainThread]: Flushing usage events
[0m20:59:36.097344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102852660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10423fed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10423fc50>]}


============================== 20:59:36.099496 | eebf5cf8-3a04-4699-a8b1-2896778891f3 ==============================
[0m20:59:36.099496 [info ] [MainThread]: Running with dbt=1.8.8
[0m20:59:36.099796 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m20:59:36.255787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104dba190>]}
[0m20:59:36.277987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d386b0>]}
[0m20:59:36.278404 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m20:59:36.288362 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m20:59:36.341209 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:59:36.341644 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m20:59:36.437491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10510cb50>]}
[0m20:59:36.475035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d78410>]}
[0m20:59:36.475334 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m20:59:36.475503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106184c90>]}
[0m20:59:36.476468 [info ] [MainThread]: 
[0m20:59:36.476782 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m20:59:36.478931 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m20:59:36.487541 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m20:59:36.487802 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m20:59:36.487937 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:59:36.822920 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.335 seconds
[0m20:59:36.824879 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m20:59:36.921111 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m20:59:36.931741 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m20:59:36.932180 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m20:59:36.932465 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:59:37.331736 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.399 seconds
[0m20:59:37.336322 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m20:59:37.435461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105555cc0>]}
[0m20:59:37.436230 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:59:37.436609 [info ] [MainThread]: 
[0m20:59:37.439513 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m20:59:37.439952 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m20:59:37.440449 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m20:59:37.440888 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m20:59:37.441370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m20:59:37.441906 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m20:59:37.442245 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m20:59:37.442524 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m20:59:37.450467 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m20:59:37.453283 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m20:59:37.454031 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m20:59:37.460449 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m20:59:37.485941 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m20:59:37.486328 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m20:59:37.487036 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m20:59:37.487277 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m20:59:37.488000 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m20:59:37.488182 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m20:59:37.488382 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m20:59:37.488621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:59:38.425557 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.937 seconds
[0m20:59:38.452479 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m20:59:38.527601 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.039 seconds
[0m20:59:38.530412 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m20:59:38.541300 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064d8710>]}
[0m20:59:38.542025 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.10s]
[0m20:59:38.542636 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m20:59:38.629429 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103f9fee0>]}
[0m20:59:38.630273 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 1.19s]
[0m20:59:38.630652 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m20:59:38.631228 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m20:59:38.631604 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m20:59:38.631982 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m20:59:38.632173 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m20:59:38.634356 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m20:59:38.635073 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m20:59:38.637268 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m20:59:38.638323 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m20:59:38.638568 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m20:59:38.638855 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m20:59:39.469947 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.831 seconds
[0m20:59:39.474455 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m20:59:39.574678 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106543bb0>]}
[0m20:59:39.575661 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.94s]
[0m20:59:39.576396 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m20:59:39.577404 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m20:59:39.577865 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.genres
[0m20:59:39.578317 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m20:59:39.578781 [info ] [Thread-2 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m20:59:39.579332 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m20:59:39.579736 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.top_5, now model.billboard_hot_100.genres)
[0m20:59:39.580107 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m20:59:39.580442 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.genres
[0m20:59:39.583886 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m20:59:39.586341 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m20:59:39.587450 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.genres
[0m20:59:39.587912 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m20:59:39.591052 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m20:59:39.593303 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m20:59:39.594460 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m20:59:39.595189 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m20:59:39.595538 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m20:59:39.595872 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

SELECT DISTINCT
    COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT artist) AS unique_artists,
    SUM(top10_entries) AS top_10_entries,
    MIN(top_rank) AS top_rank
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
GROUP BY COUNTRY
        );
[0m20:59:39.596130 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:59:39.596362 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:59:40.376436 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.780 seconds
[0m20:59:40.378011 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m20:59:40.473878 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106196ed0>]}
[0m20:59:40.474522 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 0.89s]
[0m20:59:40.475031 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m20:59:40.614566 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.018 seconds
[0m20:59:40.617342 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: Close
[0m20:59:40.706738 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'eebf5cf8-3a04-4699-a8b1-2896778891f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10644be00>]}
[0m20:59:40.707780 [info ] [Thread-2 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.13s]
[0m20:59:40.708495 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.genres
[0m20:59:40.710196 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:59:40.710517 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m20:59:40.710772 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m20:59:40.711005 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m20:59:40.711236 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m20:59:40.711629 [info ] [MainThread]: 
[0m20:59:40.711962 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 4.23 seconds (4.23s).
[0m20:59:40.713148 [debug] [MainThread]: Command end result
[0m20:59:40.739911 [info ] [MainThread]: 
[0m20:59:40.740264 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:59:40.740467 [info ] [MainThread]: 
[0m20:59:40.740671 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m20:59:40.741857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.672338, "process_user_time": 1.428877, "process_kernel_time": 0.171773, "process_mem_max_rss": "142196736", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m20:59:40.742206 [debug] [MainThread]: Command `dbt run` succeeded at 20:59:40.742145 after 4.67 seconds
[0m20:59:40.742445 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103015df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106599910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106598fb0>]}
[0m20:59:40.742663 [debug] [MainThread]: Flushing usage events
[0m21:03:16.777471 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086f7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086f7c50>]}


============================== 21:03:16.779607 | 07e52ac0-0299-4541-87c1-f9a7c2270caa ==============================
[0m21:03:16.779607 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:03:16.779909 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:03:16.940689 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f6190>]}
[0m21:03:16.963082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093786b0>]}
[0m21:03:16.963544 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:03:16.974168 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:03:17.025747 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:03:17.026177 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:03:17.122578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e8b50>]}
[0m21:03:17.168209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093b4410>]}
[0m21:03:17.169634 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:03:17.170681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a644c90>]}
[0m21:03:17.175159 [info ] [MainThread]: 
[0m21:03:17.177125 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:03:17.180242 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:03:17.194006 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:03:17.194260 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:03:17.194398 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:03:17.759582 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.565 seconds
[0m21:03:17.760935 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:03:17.847209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:03:17.852208 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:03:17.852405 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:03:17.852558 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:03:18.306692 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.454 seconds
[0m21:03:18.309917 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:03:18.473272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b55cc0>]}
[0m21:03:18.474171 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:03:18.474544 [info ] [MainThread]: 
[0m21:03:18.477722 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:03:18.478171 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:03:18.478689 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:03:18.479133 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:03:18.479551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:03:18.479951 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:03:18.480250 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:03:18.480524 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:03:18.489621 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:03:18.491381 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:03:18.492471 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:03:18.492923 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:03:18.512812 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:03:18.524653 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:03:18.525425 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:03:18.526314 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:03:18.526526 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:03:18.526769 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:03:18.526993 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:03:18.527155 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:19.135924 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.608 seconds
[0m21:03:19.163229 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:03:19.257141 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abd93d0>]}
[0m21:03:19.258059 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.78s]
[0m21:03:19.258764 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:03:19.259534 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:03:19.260001 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:03:19.260509 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:03:19.260809 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:03:19.263732 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:03:19.264699 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:03:19.267418 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:03:19.268759 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:03:19.269092 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:03:19.269400 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:03:19.536123 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.009 seconds
[0m21:03:19.539517 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:03:19.870044 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108457ee0>]}
[0m21:03:19.871069 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.39s]
[0m21:03:19.871855 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:03:20.147608 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.878 seconds
[0m21:03:20.152039 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:03:20.251619 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10abae170>]}
[0m21:03:20.252967 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.99s]
[0m21:03:20.253899 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:03:20.255322 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:03:20.256053 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:03:20.256785 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:03:20.257339 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:03:20.257951 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:03:20.258487 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:03:20.259025 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:03:20.259630 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:03:20.263668 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:03:20.267559 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:03:20.268472 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:03:20.268825 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:03:20.270812 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:03:20.272512 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:03:20.273598 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:03:20.274111 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:03:20.274408 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT DISTINCT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
        );
[0m21:03:20.274656 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:03:20.274832 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:03:20.275010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:03:21.143005 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.867 seconds
[0m21:03:21.148298 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:03:21.165398 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.890 seconds
[0m21:03:21.167591 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:03:21.241243 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10869bcd0>]}
[0m21:03:21.242345 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.98s]
[0m21:03:21.243092 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:03:21.258763 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07e52ac0-0299-4541-87c1-f9a7c2270caa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab4ca60>]}
[0m21:03:21.259533 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.00s]
[0m21:03:21.260075 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:03:21.261792 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:03:21.262253 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:03:21.262519 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:03:21.262733 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:03:21.262949 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:03:21.263348 [info ] [MainThread]: 
[0m21:03:21.263667 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.09 seconds (4.09s).
[0m21:03:21.264728 [debug] [MainThread]: Command end result
[0m21:03:21.289134 [info ] [MainThread]: 
[0m21:03:21.289482 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:03:21.289666 [info ] [MainThread]: 
[0m21:03:21.289839 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:03:21.290981 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.541571, "process_user_time": 1.434231, "process_kernel_time": 0.187799, "process_mem_max_rss": "142999552", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:03:21.291336 [debug] [MainThread]: Command `dbt run` succeeded at 21:03:21.291275 after 4.54 seconds
[0m21:03:21.291581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c8be90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aca2330>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aca23f0>]}
[0m21:03:21.291791 [debug] [MainThread]: Flushing usage events
[0m21:06:44.445175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102cc6660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bb7c50>]}


============================== 21:06:44.447764 | 9d109e91-5b6b-4c85-a9fc-00246b421a3c ==============================
[0m21:06:44.447764 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:06:44.448122 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:06:44.606626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058fa190>]}
[0m21:06:44.630621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058786b0>]}
[0m21:06:44.631079 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:06:44.640891 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:06:44.693427 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:06:44.693816 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:06:44.799883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d90b50>]}
[0m21:06:44.840599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058b4410>]}
[0m21:06:44.840885 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:06:44.841049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c30c90>]}
[0m21:06:44.841990 [info ] [MainThread]: 
[0m21:06:44.842292 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:06:44.844407 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:06:44.852599 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:06:44.852837 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:06:44.853004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:06:45.394442 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.541 seconds
[0m21:06:45.395896 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:06:45.490635 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:06:45.498727 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:06:45.499081 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:06:45.499288 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:06:45.900503 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.401 seconds
[0m21:06:45.902321 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:06:46.016872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106055cc0>]}
[0m21:06:46.017450 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:06:46.017786 [info ] [MainThread]: 
[0m21:06:46.019786 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:06:46.020134 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:06:46.020571 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:06:46.021030 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:06:46.021430 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:06:46.021778 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:06:46.022017 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:06:46.022232 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:06:46.028688 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:06:46.031284 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:06:46.031936 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:06:46.032196 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:06:46.057274 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:06:46.062520 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:06:46.063202 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:06:46.063893 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:06:46.064091 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:06:46.064318 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:06:46.064557 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:06:46.064752 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:06:47.089108 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.024 seconds
[0m21:06:47.090695 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.026 seconds
[0m21:06:47.123014 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:06:47.123203 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:06:47.215807 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ca7890>]}
[0m21:06:47.216547 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.19s]
[0m21:06:47.217155 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:06:47.225649 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104753ee0>]}
[0m21:06:47.226407 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 1.20s]
[0m21:06:47.227410 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:06:47.228327 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:06:47.228982 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:06:47.229551 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:06:47.229850 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:06:47.232446 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:06:47.233154 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:06:47.235632 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:06:47.236847 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:06:47.237166 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:06:47.237434 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:06:48.931333 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.693 seconds
[0m21:06:48.936628 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:06:49.030606 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e9b570>]}
[0m21:06:49.031626 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.80s]
[0m21:06:49.032315 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:06:49.033365 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:06:49.033809 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.genres
[0m21:06:49.034349 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:06:49.034872 [info ] [Thread-2 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:06:49.035509 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:06:49.036009 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.top_5, now model.billboard_hot_100.genres)
[0m21:06:49.036399 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:06:49.036689 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.genres
[0m21:06:49.040241 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:06:49.042765 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:06:49.043971 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:06:49.044989 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.genres
[0m21:06:49.047260 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:06:49.048853 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:06:49.049631 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:06:49.049899 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:06:49.050129 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:06:49.050970 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:06:49.051813 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT DISTINCT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY a.total_entries DESC
        );
[0m21:06:49.052090 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:06:49.482198 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f43a-0103-989f-0003-07620002b346
[0m21:06:49.482619 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 002024 (42601): SQL compilation error:
[A.TOTAL_ENTRIES] is not a valid order by expression
[0m21:06:49.483009 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:06:49.616220 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  002024 (42601): SQL compilation error:
  [A.TOTAL_ENTRIES] is not a valid order by expression
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:06:49.617018 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c35bd0>]}
[0m21:06:49.617777 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.58s]
[0m21:06:49.618471 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:06:50.465111 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.415 seconds
[0m21:06:50.469046 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: Close
[0m21:06:50.585066 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d109e91-5b6b-4c85-a9fc-00246b421a3c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e4ca60>]}
[0m21:06:50.585893 [info ] [Thread-2 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.55s]
[0m21:06:50.586389 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.genres
[0m21:06:50.587838 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:06:50.588193 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:06:50.588388 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:06:50.588555 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:06:50.588710 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:06:50.589021 [info ] [MainThread]: 
[0m21:06:50.589343 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 5.75 seconds (5.75s).
[0m21:06:50.590385 [debug] [MainThread]: Command end result
[0m21:06:50.612664 [info ] [MainThread]: 
[0m21:06:50.612947 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:06:50.613108 [info ] [MainThread]: 
[0m21:06:50.613306 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  002024 (42601): SQL compilation error:
  [A.TOTAL_ENTRIES] is not a valid order by expression
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:06:50.613462 [info ] [MainThread]: 
[0m21:06:50.613616 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:06:50.614616 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.1986246, "process_user_time": 1.386364, "process_kernel_time": 0.183515, "process_mem_max_rss": "144310272", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:06:50.614905 [debug] [MainThread]: Command `dbt run` failed at 21:06:50.614846 after 6.20 seconds
[0m21:06:50.615121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103055df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d483c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d483bf0>]}
[0m21:06:50.615330 [debug] [MainThread]: Flushing usage events
[0m21:08:07.669339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10386a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061b7c50>]}


============================== 21:08:07.671769 | e45da756-56cb-4de1-a589-51e3ee6389e2 ==============================
[0m21:08:07.671769 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:08:07.672090 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m21:08:07.838842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079fa190>]}
[0m21:08:07.862802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079786b0>]}
[0m21:08:07.863339 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:08:07.873752 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:08:07.923054 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:08:07.923416 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:08:08.020003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ce8b50>]}
[0m21:08:08.057808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079b4410>]}
[0m21:08:08.058073 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:08:08.058233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d28c90>]}
[0m21:08:08.059125 [info ] [MainThread]: 
[0m21:08:08.059399 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:08:08.061394 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:08:08.070023 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:08:08.070277 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:08:08.070408 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:08.498089 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.427 seconds
[0m21:08:08.501028 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:08:08.624118 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:08:08.634497 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:08:08.634878 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:08:08.635162 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:08:09.519419 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.884 seconds
[0m21:08:09.523695 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:08:09.616696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108255cc0>]}
[0m21:08:09.617595 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:08:09.617972 [info ] [MainThread]: 
[0m21:08:09.620913 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:08:09.621339 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:08:09.621870 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:08:09.622320 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:08:09.622819 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:08:09.623139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:08:09.623435 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:08:09.623706 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:08:09.632213 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:09.634618 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:08:09.635448 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:08:09.641542 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:08:09.666454 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:09.669777 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:08:09.670845 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:08:09.671207 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:08:09.671431 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:08:09.671640 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:08:09.671799 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:09.671933 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:08:10.335994 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.664 seconds
[0m21:08:10.359862 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:08:10.452921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098d8890>]}
[0m21:08:10.453841 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.83s]
[0m21:08:10.454507 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:08:10.455154 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:08:10.455622 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:08:10.456151 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:08:10.456496 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:08:10.459521 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:10.460564 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:08:10.463684 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:10.465138 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:08:10.465501 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:08:10.465838 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:08:10.761686 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.089 seconds
[0m21:08:10.768931 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:08:10.874269 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106053ee0>]}
[0m21:08:10.874821 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.25s]
[0m21:08:10.875206 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:08:11.361203 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.895 seconds
[0m21:08:11.365420 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:08:11.473551 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109946f30>]}
[0m21:08:11.475198 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.02s]
[0m21:08:11.476096 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:08:11.477198 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:08:11.477651 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:08:11.478180 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:08:11.478686 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:08:11.479280 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:08:11.479666 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:08:11.480027 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:08:11.480357 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:08:11.483857 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:08:11.486127 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:08:11.487422 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:08:11.488772 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:08:11.491018 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:08:11.493210 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:08:11.494278 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:08:11.495198 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:08:11.495481 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:08:11.495786 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries
        );
[0m21:08:11.496067 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:11.496279 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:08:12.489845 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.993 seconds
[0m21:08:12.496255 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:08:12.499779 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.003 seconds
[0m21:08:12.502536 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:08:12.600352 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079c4ed0>]}
[0m21:08:12.601416 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.12s]
[0m21:08:12.601896 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:08:12.603765 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e45da756-56cb-4de1-a589-51e3ee6389e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10984cfa0>]}
[0m21:08:12.604172 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.12s]
[0m21:08:12.604526 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:08:12.605660 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:12.605852 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:08:12.606002 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:08:12.606138 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:08:12.606270 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:08:12.606549 [info ] [MainThread]: 
[0m21:08:12.606749 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.55 seconds (4.55s).
[0m21:08:12.607530 [debug] [MainThread]: Command end result
[0m21:08:12.628227 [info ] [MainThread]: 
[0m21:08:12.628547 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:12.628699 [info ] [MainThread]: 
[0m21:08:12.628899 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:08:12.630043 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.992888, "process_user_time": 1.437367, "process_kernel_time": 0.187318, "process_mem_max_rss": "141639680", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:08:12.630457 [debug] [MainThread]: Command `dbt run` succeeded at 21:08:12.630338 after 4.99 seconds
[0m21:08:12.630734 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043cbfb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099755b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109975910>]}
[0m21:08:12.630930 [debug] [MainThread]: Flushing usage events
[0m21:08:32.534068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10803a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbb7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbb7c50>]}


============================== 21:08:32.536256 | 231e72e2-f08a-4f0c-99f2-e439f662770d ==============================
[0m21:08:32.536256 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:08:32.536557 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:08:32.704528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9f6190>]}
[0m21:08:32.727112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9786b0>]}
[0m21:08:32.727528 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:08:32.736628 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:08:32.788075 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:08:32.788378 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:08:32.803560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cc85050>]}
[0m21:08:32.842937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c9b6f30>]}
[0m21:08:32.843197 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:08:32.843356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cea5390>]}
[0m21:08:32.844601 [info ] [MainThread]: 
[0m21:08:32.844908 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:08:32.846940 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:08:32.854271 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:08:32.854481 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:08:32.854611 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:33.288138 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.433 seconds
[0m21:08:33.291092 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:08:33.449164 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:08:33.456908 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:08:33.457172 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:08:33.457365 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:08:33.832165 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.374 seconds
[0m21:08:33.836639 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:08:33.959382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce75bf0>]}
[0m21:08:33.960255 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:08:33.960618 [info ] [MainThread]: 
[0m21:08:33.963539 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:08:33.964029 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:08:33.964652 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:08:33.965414 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:08:33.966033 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:08:33.966618 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:08:33.966959 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:08:33.967241 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:08:33.975118 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:33.981675 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:08:33.982728 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:08:33.983109 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:08:34.039952 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:08:34.050070 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:34.050761 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:08:34.051501 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:08:34.051708 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:08:34.051955 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:08:34.052196 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:08:34.052337 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:34.603516 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.551 seconds
[0m21:08:34.628422 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:08:34.722021 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cfa3f50>]}
[0m21:08:34.722465 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.76s]
[0m21:08:34.722772 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:08:34.723083 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:08:34.723290 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:08:34.723527 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:08:34.723681 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:08:34.725366 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:34.725852 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:08:34.727333 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:34.728058 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:08:34.728260 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:08:34.728445 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:08:35.085623 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.033 seconds
[0m21:08:35.088499 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:08:35.183673 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cfc9de0>]}
[0m21:08:35.184839 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.22s]
[0m21:08:35.185658 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:08:35.645658 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.917 seconds
[0m21:08:35.649869 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:08:35.739636 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cbf5950>]}
[0m21:08:35.740919 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.02s]
[0m21:08:35.741763 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:08:35.743004 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:08:35.743346 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:08:35.743619 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:08:35.743911 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:08:35.744285 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:08:35.744514 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:08:35.744685 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:08:35.744843 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:08:35.747743 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:08:35.749680 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:08:35.750513 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:08:35.750905 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:08:35.753986 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:08:35.755895 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:08:35.757217 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:08:35.757677 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries
        );
[0m21:08:35.758109 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:08:35.758640 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:08:35.759049 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:08:35.759323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:36.624808 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.865 seconds
[0m21:08:36.630464 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:08:36.740030 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd28e50>]}
[0m21:08:36.741029 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.00s]
[0m21:08:36.741554 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:08:36.756753 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.999 seconds
[0m21:08:36.758392 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:08:37.165969 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '231e72e2-f08a-4f0c-99f2-e439f662770d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1bfb60>]}
[0m21:08:37.167111 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.42s]
[0m21:08:37.167795 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:08:37.169666 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:37.170084 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:08:37.170366 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:08:37.170613 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:08:37.170854 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:08:37.171292 [info ] [MainThread]: 
[0m21:08:37.171632 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.33 seconds (4.33s).
[0m21:08:37.173115 [debug] [MainThread]: Command end result
[0m21:08:37.196682 [info ] [MainThread]: 
[0m21:08:37.197033 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:37.197231 [info ] [MainThread]: 
[0m21:08:37.197425 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:08:37.198733 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6965084, "process_user_time": 1.349525, "process_kernel_time": 0.184469, "process_mem_max_rss": "140558336", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:08:37.199088 [debug] [MainThread]: Command `dbt run` succeeded at 21:08:37.199026 after 4.70 seconds
[0m21:08:37.199326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baf3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db63c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db63bf0>]}
[0m21:08:37.199544 [debug] [MainThread]: Flushing usage events
[0m21:08:46.679501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c72660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106657ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106657c50>]}


============================== 21:08:46.681730 | 4b458a33-8206-4c9f-bf0c-e5c6bf728aa2 ==============================
[0m21:08:46.681730 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:08:46.682038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:08:46.856552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d6190>]}
[0m21:08:46.880591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071546b0>]}
[0m21:08:46.881109 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:08:46.890574 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:08:46.943109 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:08:46.943507 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:08:47.044908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107528b50>]}
[0m21:08:47.082181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107194410>]}
[0m21:08:47.082442 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:08:47.082609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a28c90>]}
[0m21:08:47.083532 [info ] [MainThread]: 
[0m21:08:47.083805 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:08:47.085928 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:08:47.094461 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:08:47.094701 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:08:47.094852 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:08:47.477861 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.383 seconds
[0m21:08:47.480269 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:08:47.597735 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:08:47.605295 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:08:47.605612 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:08:47.605801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:08:48.049254 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.443 seconds
[0m21:08:48.052623 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:08:48.151991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107955cc0>]}
[0m21:08:48.152559 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:08:48.152900 [info ] [MainThread]: 
[0m21:08:48.155076 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:08:48.155436 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:08:48.155841 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:08:48.156307 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:08:48.156733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:08:48.157131 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:08:48.157404 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:08:48.157624 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:08:48.163756 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:08:48.166408 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:48.167111 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:08:48.184615 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:08:48.185013 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:08:48.196467 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:08:48.197221 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:08:48.197487 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:08:48.198164 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:08:48.198348 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:08:48.198567 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:08:48.198802 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:48.736606 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.537 seconds
[0m21:08:48.762084 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:08:48.872302 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087d9310>]}
[0m21:08:48.873146 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.71s]
[0m21:08:48.873802 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:08:48.874465 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:08:48.874922 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:08:48.875429 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:08:48.875785 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:08:48.878805 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:48.879636 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:08:48.882730 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:08:48.884296 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:08:48.884811 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:08:48.885174 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:08:48.981384 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.783 seconds
[0m21:08:48.983311 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:08:49.076715 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063bbee0>]}
[0m21:08:49.077312 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.92s]
[0m21:08:49.077746 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:08:49.860926 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.976 seconds
[0m21:08:49.863292 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:08:49.977704 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087a3070>]}
[0m21:08:49.978756 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.10s]
[0m21:08:49.979524 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:08:49.980667 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:08:49.981177 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:08:49.981734 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:08:49.982302 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:08:49.982886 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:08:49.983403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:08:49.983897 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:08:49.984419 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:08:49.987993 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:08:49.990033 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:08:49.991000 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:08:49.991354 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:08:49.994517 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:08:49.996438 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:08:49.997683 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:08:49.998672 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:08:49.998986 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:08:49.999382 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries ASC
        );
[0m21:08:49.999758 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:08:50.000086 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:08:51.091306 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.091 seconds
[0m21:08:51.094829 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:08:51.190351 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071728d0>]}
[0m21:08:51.190814 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.21s]
[0m21:08:51.191126 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:08:51.348228 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.348 seconds
[0m21:08:51.351050 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:08:51.449728 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4b458a33-8206-4c9f-bf0c-e5c6bf728aa2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10874ca60>]}
[0m21:08:51.450894 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.47s]
[0m21:08:51.451528 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:08:51.453212 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:08:51.453610 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:08:51.453901 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:08:51.454160 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:08:51.454410 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:08:51.454824 [info ] [MainThread]: 
[0m21:08:51.455168 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.37 seconds (4.37s).
[0m21:08:51.456469 [debug] [MainThread]: Command end result
[0m21:08:51.482281 [info ] [MainThread]: 
[0m21:08:51.482636 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:08:51.482841 [info ] [MainThread]: 
[0m21:08:51.483033 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:08:51.484222 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8336616, "process_user_time": 1.387891, "process_kernel_time": 0.185594, "process_mem_max_rss": "143622144", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:08:51.484566 [debug] [MainThread]: Command `dbt run` succeeded at 21:08:51.484503 after 4.83 seconds
[0m21:08:51.484799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ec30b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d89d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d89e3f0>]}
[0m21:08:51.485014 [debug] [MainThread]: Flushing usage events
[0m21:09:16.143740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10713e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111efc50>]}


============================== 21:09:16.146075 | 5562233a-ee85-448a-b789-297ece0f0901 ==============================
[0m21:09:16.146075 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:09:16.146385 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:09:16.308809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ffa190>]}
[0m21:09:16.330922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f786b0>]}
[0m21:09:16.331334 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:09:16.340636 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:09:16.392645 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:09:16.393003 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:09:16.488647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112490b50>]}
[0m21:09:16.526874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fb8410>]}
[0m21:09:16.527159 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:09:16.527338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113430c90>]}
[0m21:09:16.528268 [info ] [MainThread]: 
[0m21:09:16.528560 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:09:16.530632 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:09:16.539591 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:09:16.539846 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:09:16.539984 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:09:17.020482 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.480 seconds
[0m21:09:17.021689 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:09:17.109824 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:09:17.116673 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:09:17.116956 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:09:17.117145 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:09:17.491920 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.375 seconds
[0m21:09:17.493461 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:09:17.578245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113169cc0>]}
[0m21:09:17.578645 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:09:17.578960 [info ] [MainThread]: 
[0m21:09:17.580569 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:09:17.580831 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:09:17.581129 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:09:17.581403 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:09:17.581740 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:09:17.581999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:09:17.582244 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:09:17.582459 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:09:17.586922 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:09:17.588239 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:09:17.588688 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:09:17.588870 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:09:17.611286 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:09:17.617425 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:09:17.618570 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:09:17.618950 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:09:17.619221 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:09:17.619461 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:09:17.619641 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:17.619795 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:09:18.224714 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.605 seconds
[0m21:09:18.238847 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:09:18.322969 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134a3350>]}
[0m21:09:18.323599 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.74s]
[0m21:09:18.324178 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:09:18.324629 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:09:18.325013 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:09:18.325366 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:09:18.325576 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:09:18.327402 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:09:18.327901 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:09:18.329527 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:09:18.330407 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:09:18.330638 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:09:18.330852 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:09:18.593298 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.973 seconds
[0m21:09:18.596829 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:09:18.693653 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11108bee0>]}
[0m21:09:18.694610 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.11s]
[0m21:09:18.695434 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:09:19.354885 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.024 seconds
[0m21:09:19.358545 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:09:19.454670 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137ab2f0>]}
[0m21:09:19.455807 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.13s]
[0m21:09:19.456605 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:09:19.457904 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:09:19.458429 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:09:19.459018 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:09:19.459671 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:09:19.460289 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:09:19.460731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:09:19.461107 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:09:19.461435 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:09:19.464952 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:09:19.467195 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:09:19.468240 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:09:19.468704 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:09:19.471764 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:09:19.473851 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:09:19.475582 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:09:19.476135 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:09:19.476536 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
        );
[0m21:09:19.476864 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:09:19.477191 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:09:19.477498 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:09:20.388269 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.911 seconds
[0m21:09:20.391786 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:09:20.451220 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.973 seconds
[0m21:09:20.454384 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:09:20.481198 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111fc74d0>]}
[0m21:09:20.482271 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.02s]
[0m21:09:20.483293 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:09:20.548722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5562233a-ee85-448a-b789-297ece0f0901', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114069780>]}
[0m21:09:20.549773 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.09s]
[0m21:09:20.550438 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:09:20.552066 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:09:20.552373 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:09:20.552591 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:09:20.552794 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:09:20.552996 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:09:20.553363 [info ] [MainThread]: 
[0m21:09:20.553641 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.02 seconds (4.02s).
[0m21:09:20.554655 [debug] [MainThread]: Command end result
[0m21:09:20.579956 [info ] [MainThread]: 
[0m21:09:20.580305 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:09:20.580506 [info ] [MainThread]: 
[0m21:09:20.580705 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:09:20.581910 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4675207, "process_user_time": 1.361483, "process_kernel_time": 0.182157, "process_mem_max_rss": "145375232", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:09:20.582289 [debug] [MainThread]: Command `dbt run` succeeded at 21:09:20.582227 after 4.47 seconds
[0m21:09:20.582518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11109a090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114072d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114072c30>]}
[0m21:09:20.582742 [debug] [MainThread]: Flushing usage events
[0m21:10:22.784394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10553a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076bbed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076bbc50>]}


============================== 21:10:22.786856 | 354ce3f1-3709-48d1-a2b5-e58629fee5c0 ==============================
[0m21:10:22.786856 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:10:22.787176 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:10:22.954398 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114fa190>]}
[0m21:10:22.976731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114786b0>]}
[0m21:10:22.977165 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:10:22.987455 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:10:23.041054 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:10:23.041433 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:10:23.165607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111790b50>]}
[0m21:10:23.206607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114b8410>]}
[0m21:10:23.206959 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:10:23.207151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114130c90>]}
[0m21:10:23.208107 [info ] [MainThread]: 
[0m21:10:23.208400 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:10:23.210551 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:10:23.218740 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:10:23.218975 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:10:23.219108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:10:23.806693 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.587 seconds
[0m21:10:23.809199 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:10:23.918720 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:10:23.928244 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:10:23.928691 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:10:23.928925 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:10:24.376129 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.447 seconds
[0m21:10:24.380180 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:10:24.482032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114055cc0>]}
[0m21:10:24.482760 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:10:24.483065 [info ] [MainThread]: 
[0m21:10:24.485565 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:10:24.485986 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:10:24.486485 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:10:24.486942 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:10:24.487370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:10:24.487869 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:10:24.488205 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:10:24.488513 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:10:24.496550 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:10:24.499070 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:10:24.499920 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:10:24.500235 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:10:24.528089 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:10:24.535452 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:10:24.536457 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:10:24.536827 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:10:24.537064 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:10:24.537330 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:10:24.537503 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:10:24.537653 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:10:25.091090 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.553 seconds
[0m21:10:25.116693 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:10:25.242983 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143d9490>]}
[0m21:10:25.244013 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.75s]
[0m21:10:25.244684 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:10:25.245432 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:10:25.246030 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:10:25.246618 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:10:25.246999 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:10:25.250190 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:10:25.251342 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:10:25.254488 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:10:25.255865 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:10:25.256206 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:10:25.256544 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:10:25.460550 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.923 seconds
[0m21:10:25.464094 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:10:25.561261 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107553ee0>]}
[0m21:10:25.562410 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.07s]
[0m21:10:25.563228 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:10:26.319828 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.063 seconds
[0m21:10:26.321766 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:10:26.840207 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1143b3250>]}
[0m21:10:26.841533 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.59s]
[0m21:10:26.842468 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:10:26.843666 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:10:26.844152 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:10:26.844661 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:10:26.845188 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:10:26.845953 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:10:26.846435 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:10:26.846853 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:10:26.847254 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:10:26.850619 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:10:26.852797 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:10:26.853991 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:10:26.854390 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:10:26.857075 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:10:26.858693 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:10:26.860130 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:10:26.860664 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:10:26.860994 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS unique_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:10:26.861331 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:10:26.861592 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:10:26.861838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:10:27.752688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.890 seconds
[0m21:10:27.756884 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:10:27.807410 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.946 seconds
[0m21:10:27.810439 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:10:27.866281 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111708150>]}
[0m21:10:27.867348 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.02s]
[0m21:10:27.868007 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:10:27.905608 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '354ce3f1-3709-48d1-a2b5-e58629fee5c0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11434ca60>]}
[0m21:10:27.906794 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.06s]
[0m21:10:27.907478 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:10:27.909300 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:10:27.909634 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:10:27.909886 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:10:27.910146 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:10:27.910362 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:10:27.910714 [info ] [MainThread]: 
[0m21:10:27.910993 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.70 seconds (4.70s).
[0m21:10:27.912022 [debug] [MainThread]: Command end result
[0m21:10:27.938014 [info ] [MainThread]: 
[0m21:10:27.938387 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:10:27.938593 [info ] [MainThread]: 
[0m21:10:27.938800 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:10:27.939923 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.18703, "process_user_time": 1.441805, "process_kernel_time": 0.198498, "process_mem_max_rss": "144064512", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:10:27.940388 [debug] [MainThread]: Command `dbt run` succeeded at 21:10:27.940307 after 5.19 seconds
[0m21:10:27.940659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f577d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114486c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114486e70>]}
[0m21:10:27.940887 [debug] [MainThread]: Flushing usage events
[0m21:11:26.871025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10499a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106383ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106383c50>]}


============================== 21:11:26.873638 | 66107798-885f-481d-8fe7-c2fd5e3ddce1 ==============================
[0m21:11:26.873638 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:11:26.874165 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:11:27.048597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071f2190>]}
[0m21:11:27.071677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071786b0>]}
[0m21:11:27.072151 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:11:27.082142 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:11:27.136486 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:11:27.136886 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:11:27.240739 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107590b50>]}
[0m21:11:27.280220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071b8410>]}
[0m21:11:27.280503 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:11:27.280666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10852cc90>]}
[0m21:11:27.281608 [info ] [MainThread]: 
[0m21:11:27.281908 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:11:27.284012 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:11:27.292077 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:11:27.292299 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:11:27.292428 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:11:27.708428 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.416 seconds
[0m21:11:27.710342 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:11:27.804684 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:11:27.814091 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:11:27.814508 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:11:27.814750 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:11:28.172523 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.358 seconds
[0m21:11:28.173835 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:11:28.263345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107849cc0>]}
[0m21:11:28.263845 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:11:28.264067 [info ] [MainThread]: 
[0m21:11:28.265635 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:11:28.265937 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:11:28.266252 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:11:28.266587 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:11:28.267012 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:11:28.267442 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:11:28.267692 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:11:28.267902 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:11:28.273411 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:11:28.275390 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:11:28.276023 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:11:28.276258 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:11:28.299534 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:11:28.304905 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:11:28.305729 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:11:28.306488 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:11:28.306738 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:11:28.306974 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:11:28.307158 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:11:28.307298 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:11:28.883888 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.576 seconds
[0m21:11:28.908250 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:11:28.995568 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086d8d10>]}
[0m21:11:28.996367 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.73s]
[0m21:11:28.996877 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:11:28.997373 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:11:28.997674 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:11:28.998016 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:11:28.998227 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:11:29.000214 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:11:29.000846 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:11:29.002642 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:11:29.003677 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:11:29.004003 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:11:29.004233 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:11:29.054743 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.748 seconds
[0m21:11:29.056117 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:11:29.145456 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1060e7ee0>]}
[0m21:11:29.145985 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.88s]
[0m21:11:29.146439 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:11:30.016061 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m21:11:30.020913 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:11:30.130543 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086b7070>]}
[0m21:11:30.131711 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.13s]
[0m21:11:30.132529 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:11:30.133769 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:11:30.134242 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:11:30.134704 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:11:30.135174 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:11:30.135768 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:11:30.136168 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:11:30.136522 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:11:30.136837 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:11:30.140254 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:11:30.142539 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:11:30.143671 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:11:30.144116 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:11:30.147157 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:11:30.148992 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:11:30.150167 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:11:30.151204 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:11:30.151497 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:11:30.151826 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        COUNTRY,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:11:30.152105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:11:30.152345 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:11:31.040146 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.888 seconds
[0m21:11:31.043556 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:11:31.169228 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107195a50>]}
[0m21:11:31.170395 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.03s]
[0m21:11:31.171069 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:11:31.182939 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.031 seconds
[0m21:11:31.185220 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:11:31.281451 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66107798-885f-481d-8fe7-c2fd5e3ddce1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10864ca60>]}
[0m21:11:31.282707 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.15s]
[0m21:11:31.283759 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:11:31.285819 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:11:31.286299 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:11:31.286585 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:11:31.287093 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:11:31.287406 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:11:31.287879 [info ] [MainThread]: 
[0m21:11:31.288262 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.01 seconds (4.01s).
[0m21:11:31.289560 [debug] [MainThread]: Command end result
[0m21:11:31.317112 [info ] [MainThread]: 
[0m21:11:31.317462 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:11:31.317658 [info ] [MainThread]: 
[0m21:11:31.317855 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:11:31.319020 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.4791265, "process_user_time": 1.380289, "process_kernel_time": 0.19012, "process_mem_max_rss": "143556608", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:11:31.319364 [debug] [MainThread]: Command `dbt run` succeeded at 21:11:31.319304 after 4.48 seconds
[0m21:11:31.319588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c7ddf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879e9f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879ea50>]}
[0m21:11:31.319802 [debug] [MainThread]: Flushing usage events
[0m21:15:03.343121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10246e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e5bed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e5bc50>]}


============================== 21:15:03.345723 | 7145c5b2-0a29-4365-96ae-9c5f0151e994 ==============================
[0m21:15:03.345723 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:15:03.346025 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:15:03.510538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052f6190>]}
[0m21:15:03.535791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052786b0>]}
[0m21:15:03.536237 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:15:03.545233 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:15:03.595829 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:15:03.596269 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:15:03.703812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105790b50>]}
[0m21:15:03.743213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052b7e30>]}
[0m21:15:03.743513 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:15:03.743681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e30c90>]}
[0m21:15:03.744682 [info ] [MainThread]: 
[0m21:15:03.744972 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:15:03.746991 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:15:03.755565 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:15:03.755779 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:15:03.755914 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:15:04.432541 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.676 seconds
[0m21:15:04.438288 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:15:04.536686 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:15:04.548216 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:15:04.548647 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:15:04.548919 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:15:05.224157 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.675 seconds
[0m21:15:05.226389 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:15:05.316252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a55cc0>]}
[0m21:15:05.316940 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:15:05.317272 [info ] [MainThread]: 
[0m21:15:05.319846 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:15:05.320189 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:15:05.320648 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:15:05.321048 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:15:05.321477 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:15:05.321765 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:15:05.322034 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:15:05.322281 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:15:05.330776 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:15:05.332899 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:15:05.333753 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:15:05.334125 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:15:05.358485 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:15:05.366626 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:15:05.367610 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:15:05.367955 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:15:05.368162 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:15:05.368396 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:15:05.368593 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:15:05.368744 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:15:05.924503 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.555 seconds
[0m21:15:05.952517 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:15:06.050465 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ad8890>]}
[0m21:15:06.051507 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.73s]
[0m21:15:06.052329 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:15:06.053187 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:15:06.053868 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:15:06.054559 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:15:06.055007 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:15:06.058583 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:15:06.059788 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:15:06.063084 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:15:06.065018 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:15:06.065484 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:15:06.065835 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:15:06.206841 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.838 seconds
[0m21:15:06.208949 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:15:06.303322 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103bbbee0>]}
[0m21:15:06.304411 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.98s]
[0m21:15:06.305224 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:15:07.101867 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.035 seconds
[0m21:15:07.107686 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:15:07.199769 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b4ae90>]}
[0m21:15:07.200686 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.15s]
[0m21:15:07.201362 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:15:07.202690 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:15:07.203357 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:15:07.204011 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:15:07.204743 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:15:07.205414 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:15:07.205782 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:15:07.206102 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:15:07.206378 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:15:07.209900 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:15:07.212161 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:15:07.213413 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:15:07.213838 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:15:07.216759 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:15:07.218507 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:15:07.219632 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:15:07.220712 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:15:07.220985 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:15:07.221297 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
genre_count AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS genre_rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.COUNTRY,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:15:07.221581 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:15:07.221811 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:15:08.229582 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.007 seconds
[0m21:15:08.234765 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:15:08.355737 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058abc50>]}
[0m21:15:08.356849 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.15s]
[0m21:15:08.357629 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:15:08.615521 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.394 seconds
[0m21:15:08.617427 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:15:08.711831 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7145c5b2-0a29-4365-96ae-9c5f0151e994', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a4fe00>]}
[0m21:15:08.712875 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.51s]
[0m21:15:08.713664 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:15:08.715521 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:15:08.715920 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:15:08.716198 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:15:08.716446 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:15:08.716686 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:15:08.717104 [info ] [MainThread]: 
[0m21:15:08.717437 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.97 seconds (4.97s).
[0m21:15:08.718635 [debug] [MainThread]: Command end result
[0m21:15:08.746411 [info ] [MainThread]: 
[0m21:15:08.746739 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:15:08.746923 [info ] [MainThread]: 
[0m21:15:08.747110 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:15:08.748323 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.434366, "process_user_time": 1.50407, "process_kernel_time": 0.190471, "process_mem_max_rss": "144031744", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:15:08.748666 [debug] [MainThread]: Command `dbt run` succeeded at 21:15:08.748600 after 5.43 seconds
[0m21:15:08.748894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033b6db0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b76090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b769f0>]}
[0m21:15:08.749133 [debug] [MainThread]: Flushing usage events
[0m21:18:52.095692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c62660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108647ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108647c50>]}


============================== 21:18:52.098433 | a50d7f98-67e2-4027-939b-a1a872e78fcf ==============================
[0m21:18:52.098433 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:18:52.098783 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:18:52.260813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091c2190>]}
[0m21:18:52.283230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091446b0>]}
[0m21:18:52.283615 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:18:52.293630 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:18:52.344311 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:18:52.344708 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:18:52.440846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109518b50>]}
[0m21:18:52.480745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109187e30>]}
[0m21:18:52.481030 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:18:52.481196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098b4c90>]}
[0m21:18:52.482206 [info ] [MainThread]: 
[0m21:18:52.482616 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:18:52.484721 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:18:52.493186 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:18:52.493463 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:18:52.493607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:18:53.129660 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.636 seconds
[0m21:18:53.133244 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:18:53.271377 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:18:53.281703 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:18:53.282073 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:18:53.282339 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:18:53.677585 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.395 seconds
[0m21:18:53.680711 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:18:53.802479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ddcc0>]}
[0m21:18:53.802817 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:18:53.802967 [info ] [MainThread]: 
[0m21:18:53.804442 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:18:53.804715 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:18:53.804943 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:18:53.805208 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:18:53.805519 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:18:53.805902 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:18:53.806158 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:18:53.809583 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:18:53.811321 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:18:53.812967 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:18:53.813729 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:18:53.826457 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:18:53.831474 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:18:53.843476 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:18:53.844245 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:18:53.844549 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:18:53.844774 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:18:53.845510 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:18:53.846235 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:18:53.846779 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:54.355705 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.509 seconds
[0m21:18:54.377621 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:18:54.460367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10992f350>]}
[0m21:18:54.461096 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.65s]
[0m21:18:54.461651 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:18:54.462218 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:18:54.462710 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:18:54.463202 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:18:54.463523 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:18:54.466073 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:18:54.466724 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:18:54.469107 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:18:54.470483 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:18:54.470776 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:18:54.471037 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:18:54.896778 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.052 seconds
[0m21:18:54.900755 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:18:54.991235 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083abee0>]}
[0m21:18:54.992068 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.18s]
[0m21:18:54.992607 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:18:55.451694 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.980 seconds
[0m21:18:55.456045 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:18:55.550668 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a06fd0>]}
[0m21:18:55.552140 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.09s]
[0m21:18:55.552976 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:18:55.554167 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:18:55.554741 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:18:55.555427 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:18:55.556141 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:18:55.556914 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:18:55.557357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:18:55.557742 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:18:55.558076 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:18:55.561688 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:18:55.563965 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:18:55.565279 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:18:55.565632 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:18:55.568473 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:18:55.570432 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:18:55.571999 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:18:55.572490 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:18:55.572790 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
LEFT JOIN ranked_genres AS rg
ON a.country = ra.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:18:55.573087 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:18:55.573337 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:18:55.573591 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:18:55.885444 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f446-0103-989f-0003-07620002b38e
[0m21:18:55.886249 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 29 at position 4 unexpected 'MAX'.
syntax error line 33 at position 3 unexpected 'a'.
[0m21:18:55.886810 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:18:55.980428 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 33 at position 3 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:18:55.981027 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098bbb50>]}
[0m21:18:55.981741 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.42s]
[0m21:18:55.982344 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:18:56.388611 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.815 seconds
[0m21:18:56.391020 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:18:56.506063 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a50d7f98-67e2-4027-939b-a1a872e78fcf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b20670>]}
[0m21:18:56.507211 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.95s]
[0m21:18:56.507882 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:18:56.509763 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:18:56.510313 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:18:56.510613 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:18:56.510867 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:18:56.511279 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:18:56.511756 [info ] [MainThread]: 
[0m21:18:56.512115 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.03 seconds (4.03s).
[0m21:18:56.513336 [debug] [MainThread]: Command end result
[0m21:18:56.540881 [info ] [MainThread]: 
[0m21:18:56.541216 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:18:56.541407 [info ] [MainThread]: 
[0m21:18:56.541662 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 33 at position 3 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:18:56.541854 [info ] [MainThread]: 
[0m21:18:56.542045 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:18:56.543154 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.4789896, "process_user_time": 1.454305, "process_kernel_time": 0.186627, "process_mem_max_rss": "141934592", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:18:56.543466 [debug] [MainThread]: Command `dbt run` failed at 21:18:56.543409 after 4.48 seconds
[0m21:18:56.543758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bc80b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074def30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c0fcb0>]}
[0m21:18:56.544013 [debug] [MainThread]: Flushing usage events
[0m21:19:22.231895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10633a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093efc50>]}


============================== 21:19:22.234697 | c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e ==============================
[0m21:19:22.234697 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:19:22.235054 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:19:22.413550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1fa190>]}
[0m21:19:22.438038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1786b0>]}
[0m21:19:22.438551 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:19:22.448415 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:19:22.500483 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:19:22.500857 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:19:22.606378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a790b50>]}
[0m21:19:22.644717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1bbe30>]}
[0m21:19:22.645024 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:19:22.645357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b630c90>]}
[0m21:19:22.646373 [info ] [MainThread]: 
[0m21:19:22.646705 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:22.648862 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:19:22.657209 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:19:22.657412 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:19:22.657538 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:23.150874 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.493 seconds
[0m21:19:23.152553 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:19:23.241599 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:19:23.249750 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:19:23.250097 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:19:23.250328 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:19:23.590558 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.340 seconds
[0m21:19:23.592491 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:19:23.690160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b369cc0>]}
[0m21:19:23.690816 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:19:23.691247 [info ] [MainThread]: 
[0m21:19:23.694253 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:19:23.694773 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:19:23.695334 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:19:23.695954 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:19:23.696550 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:19:23.696865 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:19:23.697153 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:19:23.697404 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:19:23.704353 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:23.706472 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:19:23.707192 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:19:23.707505 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:19:23.732077 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:19:23.738992 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:23.739705 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:19:23.739951 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:19:23.740711 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:19:23.740965 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:19:23.741243 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:19:23.741558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:24.197578 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.456 seconds
[0m21:19:24.224236 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:19:24.311818 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6a77d0>]}
[0m21:19:24.312597 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.61s]
[0m21:19:24.313227 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:19:24.313835 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:19:24.314270 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:19:24.314713 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:19:24.314958 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:19:24.317187 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:24.317963 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:19:24.320180 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:24.321293 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:19:24.321586 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:19:24.321844 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:24.557347 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.816 seconds
[0m21:19:24.560517 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:19:24.647041 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928bee0>]}
[0m21:19:24.647527 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.95s]
[0m21:19:24.647913 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:19:25.217937 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.896 seconds
[0m21:19:25.219200 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:19:25.318174 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba42e90>]}
[0m21:19:25.318839 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.00s]
[0m21:19:25.319308 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:19:25.319905 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:19:25.320208 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:19:25.320503 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:19:25.320859 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:19:25.321215 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:19:25.321460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:19:25.321723 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:19:25.321935 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:19:25.324088 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:19:25.325941 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:19:25.326771 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:19:25.327032 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:19:25.329121 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:19:25.330313 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:19:25.331448 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:19:25.331855 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:19:25.332125 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra
ON a.country = ra.country
LEFT JOIN ranked_genres AS rg
ON a.country = rg.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:19:25.332381 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:19:25.332582 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:19:25.332759 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:25.634311 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f447-0103-98a1-0003-07620002d32a
[0m21:19:25.634944 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 29 at position 4 unexpected 'MAX'.
syntax error line 32 at position 3 unexpected 'a'.
[0m21:19:25.635421 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:19:25.724697 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 32 at position 3 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:25.725240 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6374d0>]}
[0m21:19:25.725745 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.40s]
[0m21:19:25.726201 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:19:26.128852 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.796 seconds
[0m21:19:26.131667 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:19:26.216365 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c65d5ac6-bb43-4d1b-bf7c-2a8886f5a77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b98e510>]}
[0m21:19:26.216840 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.89s]
[0m21:19:26.217104 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:19:26.218260 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:19:26.218430 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:19:26.218554 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:19:26.218662 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:19:26.218763 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:19:26.218966 [info ] [MainThread]: 
[0m21:19:26.219111 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 3.57 seconds (3.57s).
[0m21:19:26.219627 [debug] [MainThread]: Command end result
[0m21:19:26.236260 [info ] [MainThread]: 
[0m21:19:26.236641 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:19:26.236797 [info ] [MainThread]: 
[0m21:19:26.236983 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 32 at position 3 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:26.237119 [info ] [MainThread]: 
[0m21:19:26.237258 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:19:26.238151 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0390205, "process_user_time": 1.392204, "process_kernel_time": 0.197579, "process_mem_max_rss": "144310272", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:19:26.238407 [debug] [MainThread]: Command `dbt run` failed at 21:19:26.238364 after 4.04 seconds
[0m21:19:26.238584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108dab3b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be7fcb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be7fc50>]}
[0m21:19:26.238738 [debug] [MainThread]: Flushing usage events
[0m21:19:28.620015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028ba660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042a7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1042a7c50>]}


============================== 21:19:28.622193 | defcb590-6ee4-41e0-b31b-ed71b3bb3750 ==============================
[0m21:19:28.622193 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:19:28.622486 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:19:28.778849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e1e190>]}
[0m21:19:28.801838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da06b0>]}
[0m21:19:28.802282 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:19:28.811384 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:19:28.861949 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:19:28.862333 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:19:28.967719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105174b50>]}
[0m21:19:29.006703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104de3e30>]}
[0m21:19:29.007011 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:19:29.007179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105628c90>]}
[0m21:19:29.008101 [info ] [MainThread]: 
[0m21:19:29.008390 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:29.010479 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:19:29.019125 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:19:29.019365 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:19:29.019503 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:29.395529 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.376 seconds
[0m21:19:29.397667 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:19:29.488325 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:19:29.498712 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:19:29.499253 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:19:29.499573 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:19:29.775948 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.276 seconds
[0m21:19:29.778851 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:19:29.948991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105439cc0>]}
[0m21:19:29.949836 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:19:29.950219 [info ] [MainThread]: 
[0m21:19:29.952817 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:19:29.953263 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:19:29.953853 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:19:29.954416 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:19:29.955016 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:19:29.955609 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:19:29.956005 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:19:29.956328 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:19:29.965023 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:29.967318 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:19:29.968242 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:19:29.968619 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:19:30.001259 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:30.004061 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:19:30.005174 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:19:30.005578 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:19:30.005844 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:19:30.006097 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:19:30.006301 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:30.006468 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:19:30.458853 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.452 seconds
[0m21:19:30.487304 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:19:30.581127 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056a3a10>]}
[0m21:19:30.582005 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.63s]
[0m21:19:30.582554 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:19:30.583137 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:19:30.583581 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:19:30.584041 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:19:30.584338 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:19:30.587143 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:30.588090 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:19:30.590536 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:30.591829 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:19:30.592121 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:19:30.592391 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:30.788467 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.782 seconds
[0m21:19:30.790901 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:19:30.881769 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104007ee0>]}
[0m21:19:30.882778 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.93s]
[0m21:19:30.883336 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:19:31.488394 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.896 seconds
[0m21:19:31.490565 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:19:31.577609 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106276490>]}
[0m21:19:31.578619 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.99s]
[0m21:19:31.579196 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:19:31.580050 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:19:31.580411 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:19:31.580953 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:19:31.581511 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:19:31.582026 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:19:31.582383 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:19:31.582692 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:19:31.582973 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:19:31.585998 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:19:31.588521 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:19:31.589332 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:19:31.589645 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:19:31.591414 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:19:31.593350 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:19:31.594239 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:19:31.595349 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:19:31.595629 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:19:31.595935 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.country = rg.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:19:31.596211 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:31.596418 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:19:31.885773 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f447-0103-989f-0003-07620002b39a
[0m21:19:31.886111 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 29 at position 4 unexpected 'MAX'.
syntax error line 31 at position 34 unexpected 'a'.
[0m21:19:31.886408 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:19:31.971608 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 31 at position 34 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:31.971969 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10563a7d0>]}
[0m21:19:31.972340 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.39s]
[0m21:19:31.972679 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:19:32.399602 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.803 seconds
[0m21:19:32.401197 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:19:32.489987 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'defcb590-6ee4-41e0-b31b-ed71b3bb3750', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10627ecf0>]}
[0m21:19:32.490486 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.91s]
[0m21:19:32.490812 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:19:32.491642 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:19:32.491811 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:19:32.491931 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:19:32.492035 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:19:32.492135 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:19:32.492307 [info ] [MainThread]: 
[0m21:19:32.492450 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 3.48 seconds (3.48s).
[0m21:19:32.492967 [debug] [MainThread]: Command end result
[0m21:19:32.508816 [info ] [MainThread]: 
[0m21:19:32.509060 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:19:32.509192 [info ] [MainThread]: 
[0m21:19:32.509363 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  001003 (42000): SQL compilation error:
  syntax error line 29 at position 4 unexpected 'MAX'.
  syntax error line 31 at position 34 unexpected 'a'.
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:32.509491 [info ] [MainThread]: 
[0m21:19:32.509622 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:19:32.510491 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.9194727, "process_user_time": 1.36496, "process_kernel_time": 0.170804, "process_mem_max_rss": "144506880", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:19:32.510724 [debug] [MainThread]: Command `dbt run` failed at 21:19:32.510684 after 3.92 seconds
[0m21:19:32.510892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1040000b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106793c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106793bf0>]}
[0m21:19:32.511040 [debug] [MainThread]: Flushing usage events
[0m21:19:34.084337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10353e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ff3c50>]}


============================== 21:19:34.086502 | 66a7df1e-d57b-4db3-90c6-a251167d142f ==============================
[0m21:19:34.086502 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:19:34.086815 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:19:34.244048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106df6190>]}
[0m21:19:34.266735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d786b0>]}
[0m21:19:34.267212 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:19:34.277880 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:19:34.328090 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:19:34.328479 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:19:34.424738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070e8b50>]}
[0m21:19:34.461770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dbbe30>]}
[0m21:19:34.462066 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:19:34.462237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110130c90>]}
[0m21:19:34.463182 [info ] [MainThread]: 
[0m21:19:34.463498 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:34.465642 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:19:34.474596 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:19:34.474868 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:19:34.475004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:34.839265 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.364 seconds
[0m21:19:34.841595 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:19:34.957628 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:19:34.968810 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:19:34.969176 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:19:34.969455 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:19:35.380806 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.411 seconds
[0m21:19:35.382440 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:19:35.470184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107555cc0>]}
[0m21:19:35.470816 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:19:35.471063 [info ] [MainThread]: 
[0m21:19:35.472612 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:19:35.472900 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:19:35.473290 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:19:35.473592 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:19:35.473858 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:19:35.474142 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:19:35.474356 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:19:35.474545 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:19:35.480784 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:19:35.482895 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:35.483561 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:19:35.483841 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:19:35.506945 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:19:35.512619 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:35.513675 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:19:35.514014 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:19:35.514225 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:19:35.514433 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:19:35.514597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:35.514737 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:19:36.231869 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.717 seconds
[0m21:19:36.255845 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:19:36.286688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.772 seconds
[0m21:19:36.288453 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:19:36.347257 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101a3a10>]}
[0m21:19:36.348112 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.87s]
[0m21:19:36.348732 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:19:36.374220 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e8fee0>]}
[0m21:19:36.375106 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.90s]
[0m21:19:36.375627 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:19:36.376664 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:19:36.377116 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:19:36.377576 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:19:36.377861 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:19:36.380729 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:36.381416 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:19:36.384167 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:36.385483 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:19:36.385816 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:19:36.386105 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:37.230487 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.844 seconds
[0m21:19:37.234358 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:19:37.326673 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110397bb0>]}
[0m21:19:37.328189 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 0.95s]
[0m21:19:37.329366 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:19:37.330571 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:19:37.331016 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.genres
[0m21:19:37.331626 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:19:37.332186 [info ] [Thread-2 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:19:37.332797 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:19:37.333196 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.top_5, now model.billboard_hot_100.genres)
[0m21:19:37.333563 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:19:37.333965 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.genres
[0m21:19:37.337911 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:19:37.340073 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:19:37.341278 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:19:37.341731 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.genres
[0m21:19:37.345076 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:19:37.346812 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:19:37.348696 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:19:37.349268 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:19:37.349694 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.country = rg.country
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:19:37.350183 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:19:37.350509 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:19:37.350738 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:19:37.706349 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b7f447-0103-99c5-0003-07620002f0d6
[0m21:19:37.707148 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 32 at position 45
invalid identifier 'RG.COUNTRY'
[0m21:19:37.707796 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:19:37.810850 [debug] [Thread-4 (]: Database Error in model countries (models/analytics/countries.sql)
  000904 (42000): SQL compilation error: error line 32 at position 45
  invalid identifier 'RG.COUNTRY'
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:37.811412 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075bd4d0>]}
[0m21:19:37.812079 [error] [Thread-4 (]: 4 of 5 ERROR creating sql table model BB_SCHEMA.countries ...................... [[31mERROR[0m in 0.48s]
[0m21:19:37.812652 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:19:38.254293 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.903 seconds
[0m21:19:38.260398 [debug] [Thread-2 (]: On model.billboard_hot_100.genres: Close
[0m21:19:38.358167 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66a7df1e-d57b-4db3-90c6-a251167d142f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033747c0>]}
[0m21:19:38.359304 [info ] [Thread-2 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 1.02s]
[0m21:19:38.360094 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.genres
[0m21:19:38.361902 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:19:38.362237 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:19:38.362495 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:19:38.362776 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:19:38.363067 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:19:38.363489 [info ] [MainThread]: 
[0m21:19:38.363933 [info ] [MainThread]: Finished running 4 table models, 1 view model in 0 hours 0 minutes and 3.90 seconds (3.90s).
[0m21:19:38.365432 [debug] [MainThread]: Command end result
[0m21:19:38.392247 [info ] [MainThread]: 
[0m21:19:38.392612 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:19:38.392804 [info ] [MainThread]: 
[0m21:19:38.393047 [error] [MainThread]:   Database Error in model countries (models/analytics/countries.sql)
  000904 (42000): SQL compilation error: error line 32 at position 45
  invalid identifier 'RG.COUNTRY'
  compiled code at target/run/billboard_hot_100/models/analytics/countries.sql
[0m21:19:38.393235 [info ] [MainThread]: 
[0m21:19:38.393422 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m21:19:38.394624 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.339136, "process_user_time": 1.410105, "process_kernel_time": 0.166775, "process_mem_max_rss": "143589376", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:19:38.394959 [debug] [MainThread]: Command `dbt run` failed at 21:19:38.394894 after 4.34 seconds
[0m21:19:38.395203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10404da30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11197fbf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11197fb90>]}
[0m21:19:38.395413 [debug] [MainThread]: Flushing usage events
[0m21:19:57.263329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10613e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101cfed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101cfc50>]}


============================== 21:19:57.265781 | 160b5682-dd09-48b8-ac06-e5c6cdc0b7e6 ==============================
[0m21:19:57.265781 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:19:57.266105 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:19:57.423095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133f6190>]}
[0m21:19:57.446078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133786b0>]}
[0m21:19:57.446642 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:19:57.456446 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:19:57.506928 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:19:57.507309 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:19:57.603156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113790b50>]}
[0m21:19:57.640390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133b7e30>]}
[0m21:19:57.640671 [info ] [MainThread]: Found 5 models, 2 sources, 454 macros
[0m21:19:57.640847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114630c90>]}
[0m21:19:57.641797 [info ] [MainThread]: 
[0m21:19:57.642090 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:19:57.644206 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:19:57.652827 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:19:57.653083 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:19:57.653220 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:19:58.246029 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.592 seconds
[0m21:19:58.249698 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:19:58.353717 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:19:58.364541 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:19:58.365011 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:19:58.365285 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:19:58.729409 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.364 seconds
[0m21:19:58.733283 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:19:58.844898 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114355cc0>]}
[0m21:19:58.845676 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:19:58.846052 [info ] [MainThread]: 
[0m21:19:58.849072 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:19:58.849550 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:19:58.850147 [info ] [Thread-1 (]: 1 of 5 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:19:58.850681 [info ] [Thread-2 (]: 2 of 5 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:19:58.851129 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:19:58.851674 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:19:58.852092 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:19:58.852409 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:19:58.860682 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:19:58.863265 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:58.864506 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:19:58.865071 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:19:58.897498 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:19:58.897924 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:19:58.898654 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:19:58.899388 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:19:58.899597 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:19:58.899830 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:19:58.900038 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:19:58.900193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:19:59.447893 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.547 seconds
[0m21:19:59.476266 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:19:59.592030 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148d90d0>]}
[0m21:19:59.592660 [info ] [Thread-1 (]: 1 of 5 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.74s]
[0m21:19:59.593107 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:19:59.593553 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:19:59.593853 [info ] [Thread-3 (]: 3 of 5 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:19:59.594189 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:19:59.594415 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:19:59.596661 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:59.597395 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:19:59.599467 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:19:59.600563 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:19:59.600862 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON billboard_data.artist = artist_data.artist_name
        );
[0m21:19:59.601105 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:19:59.675692 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.776 seconds
[0m21:19:59.677490 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:19:59.771549 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e53ee0>]}
[0m21:19:59.772392 [info ] [Thread-2 (]: 2 of 5 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 0.92s]
[0m21:19:59.772930 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:20:00.763557 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.162 seconds
[0m21:20:00.769093 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:20:00.863145 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114946f30>]}
[0m21:20:00.864171 [info ] [Thread-3 (]: 3 of 5 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.27s]
[0m21:20:00.864964 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:20:00.866188 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:20:00.866759 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.genres
[0m21:20:00.867320 [info ] [Thread-4 (]: 4 of 5 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:20:00.868171 [info ] [Thread-1 (]: 5 of 5 START sql table model BB_SCHEMA.genres .................................. [RUN]
[0m21:20:00.868883 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:20:00.869283 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now model.billboard_hot_100.genres)
[0m21:20:00.869515 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:20:00.869691 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.genres
[0m21:20:00.871901 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:20:00.873019 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.genres"
[0m21:20:00.874168 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:20:00.874596 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.genres
[0m21:20:00.877741 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.genres"
[0m21:20:00.880149 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:20:00.881103 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.genres"
[0m21:20:00.882274 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:20:00.882594 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.genres"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.genres
         as
        (-- models/genres.sql

SELECT *
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
        );
[0m21:20:00.882949 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.genre = rg.genre
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:20:00.883256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:00.883485 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:20:01.757442 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.874 seconds
[0m21:20:01.761861 [debug] [Thread-1 (]: On model.billboard_hot_100.genres: Close
[0m21:20:01.832796 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.949 seconds
[0m21:20:01.835620 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:20:01.862260 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137089d0>]}
[0m21:20:01.863185 [info ] [Thread-1 (]: 5 of 5 OK created sql table model BB_SCHEMA.genres ............................. [[32mSUCCESS 1[0m in 0.99s]
[0m21:20:01.863949 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.genres
[0m21:20:01.933551 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '160b5682-dd09-48b8-ac06-e5c6cdc0b7e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f107c0>]}
[0m21:20:01.934437 [info ] [Thread-4 (]: 4 of 5 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.06s]
[0m21:20:01.934893 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:20:01.936272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:01.936536 [debug] [MainThread]: Connection 'model.billboard_hot_100.genres' was properly closed.
[0m21:20:01.936728 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:20:01.936897 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:20:01.937062 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:20:01.937382 [info ] [MainThread]: 
[0m21:20:01.937609 [info ] [MainThread]: Finished running 1 view model, 4 table models in 0 hours 0 minutes and 4.30 seconds (4.30s).
[0m21:20:01.938445 [debug] [MainThread]: Command end result
[0m21:20:01.964422 [info ] [MainThread]: 
[0m21:20:01.964745 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:20:01.964942 [info ] [MainThread]: 
[0m21:20:01.965136 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m21:20:01.966373 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.7343225, "process_user_time": 1.41775, "process_kernel_time": 0.174019, "process_mem_max_rss": "143867904", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:20:01.966770 [debug] [MainThread]: Command `dbt run` succeeded at 21:20:01.966711 after 4.73 seconds
[0m21:20:01.967007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065b5070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149a0590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149a1c10>]}
[0m21:20:01.967229 [debug] [MainThread]: Flushing usage events
[0m21:21:52.195572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10373a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b3c50>]}


============================== 21:21:52.197875 | dc1eba23-a5a2-4bf1-9742-f7e4627e58e6 ==============================
[0m21:21:52.197875 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:21:52.198231 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:21:52.359538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106efa190>]}
[0m21:21:52.381696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e786b0>]}
[0m21:21:52.382139 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:21:52.392298 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:21:52.443731 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 1 files changed.
[0m21:21:52.444091 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/analytics/genres.sql
[0m21:21:52.444309 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m21:21:52.540962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071eb550>]}
[0m21:21:52.579260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eb4410>]}
[0m21:21:52.579552 [info ] [MainThread]: Found 4 models, 2 sources, 454 macros
[0m21:21:52.579719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b249f0>]}
[0m21:21:52.580634 [info ] [MainThread]: 
[0m21:21:52.580919 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:21:52.582950 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:21:52.591291 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:21:52.591513 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:21:52.591638 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:21:53.409715 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.818 seconds
[0m21:21:53.413157 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:21:53.515795 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:21:53.524453 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:21:53.524798 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:21:53.525038 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:21:53.886230 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.361 seconds
[0m21:21:53.888934 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:21:53.991511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076531e0>]}
[0m21:21:53.992272 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:21:53.992638 [info ] [MainThread]: 
[0m21:21:53.995766 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:21:53.996282 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.top_5
[0m21:21:53.996855 [info ] [Thread-1 (]: 1 of 4 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:21:53.997369 [info ] [Thread-2 (]: 2 of 4 START sql table model BB_SCHEMA.top_5 ................................... [RUN]
[0m21:21:53.998109 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:21:53.999040 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.top_5'
[0m21:21:53.999426 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:21:53.999735 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.top_5
[0m21:21:54.008299 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.top_5"
[0m21:21:54.011350 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:21:54.012484 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:21:54.012948 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.top_5
[0m21:21:54.037790 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:21:54.045282 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.top_5"
[0m21:21:54.046196 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:21:54.046412 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:21:54.046599 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:21:54.047264 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.top_5"
[0m21:21:54.047437 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.top_5"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.top_5
         as
        (-- models/top_5.sql

WITH 
    source_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100
    )

SELECT *
FROM source_data
LIMIT 5
        );
[0m21:21:54.047588 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:21:54.639643 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.592 seconds
[0m21:21:54.662854 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:21:54.751657 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110edd250>]}
[0m21:21:54.752479 [info ] [Thread-1 (]: 1 of 4 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.75s]
[0m21:21:54.753055 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:21:54.753649 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:21:54.754148 [info ] [Thread-3 (]: 3 of 4 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:21:54.754656 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:21:54.754976 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:21:54.757552 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:21:54.758327 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:21:54.761036 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:21:54.762753 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:21:54.763199 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON LOWER(billboard_data.artist) = LOWER(artist_data.artist_name)
        );
[0m21:21:54.763515 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:21:54.915915 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.868 seconds
[0m21:21:54.917414 [debug] [Thread-2 (]: On model.billboard_hot_100.top_5: Close
[0m21:21:55.009084 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105453ee0>]}
[0m21:21:55.010293 [info ] [Thread-2 (]: 2 of 4 OK created sql table model BB_SCHEMA.top_5 .............................. [[32mSUCCESS 1[0m in 1.01s]
[0m21:21:55.011145 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.top_5
[0m21:21:55.800874 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.037 seconds
[0m21:21:55.802316 [debug] [Thread-3 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:21:55.899549 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e82f30>]}
[0m21:21:55.900167 [info ] [Thread-3 (]: 3 of 4 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.14s]
[0m21:21:55.900587 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:21:55.901091 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:21:55.901541 [info ] [Thread-4 (]: 4 of 4 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:21:55.901971 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:21:55.902265 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:21:55.904533 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:21:55.905130 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:21:55.906541 [debug] [Thread-4 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:21:55.907753 [debug] [Thread-4 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:21:55.908058 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.genre = rg.genre
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:21:55.908373 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:21:57.206213 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.298 seconds
[0m21:21:57.207959 [debug] [Thread-4 (]: On model.billboard_hot_100.countries: Close
[0m21:21:57.298367 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dc1eba23-a5a2-4bf1-9742-f7e4627e58e6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b7d7d0>]}
[0m21:21:57.299222 [info ] [Thread-4 (]: 4 of 4 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.40s]
[0m21:21:57.299873 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:21:57.301617 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:21:57.302000 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:21:57.302288 [debug] [MainThread]: Connection 'model.billboard_hot_100.top_5' was properly closed.
[0m21:21:57.302538 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:21:57.302782 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:21:57.303200 [info ] [MainThread]: 
[0m21:21:57.303516 [info ] [MainThread]: Finished running 1 view model, 3 table models in 0 hours 0 minutes and 4.72 seconds (4.72s).
[0m21:21:57.304465 [debug] [MainThread]: Command end result
[0m21:21:57.326272 [info ] [MainThread]: 
[0m21:21:57.326625 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:21:57.326820 [info ] [MainThread]: 
[0m21:21:57.327008 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m21:21:57.328214 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.162515, "process_user_time": 1.36937, "process_kernel_time": 0.180327, "process_mem_max_rss": "143753216", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:21:57.328544 [debug] [MainThread]: Command `dbt run` succeeded at 21:21:57.328487 after 5.16 seconds
[0m21:21:57.328812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101532120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057da2e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034e03b0>]}
[0m21:21:57.329046 [debug] [MainThread]: Flushing usage events
[0m21:51:58.892217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10523a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072efc50>]}


============================== 21:51:58.894307 | 08d36638-fca5-4d69-b57c-83c5d7c39d4d ==============================
[0m21:51:58.894307 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:51:58.894602 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:51:59.063222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188f6190>]}
[0m21:51:59.085965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188786b0>]}
[0m21:51:59.086413 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:51:59.095051 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:51:59.147909 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 2 files added, 0 files changed.
[0m21:51:59.148266 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/analytics/schema.yml
[0m21:51:59.148423 [debug] [MainThread]: Partial parsing: added file: billboard_hot_100://models/staging/schema.yml
[0m21:51:59.148543 [debug] [MainThread]: Partial parsing: deleted file: billboard_hot_100://models/analytics/top_5.sql
[0m21:51:59.172604 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m21:51:59.172865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bead50>]}
[0m21:51:59.276502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188bb3e0>]}
[0m21:51:59.356085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118bcfe70>]}
[0m21:51:59.356390 [info ] [MainThread]: Found 3 models, 14 data tests, 2 sources, 454 macros
[0m21:51:59.356557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10708b2b0>]}
[0m21:51:59.357576 [info ] [MainThread]: 
[0m21:51:59.357844 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:51:59.359809 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:51:59.366174 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:51:59.366391 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:51:59.366522 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:51:59.862098 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.495 seconds
[0m21:51:59.864200 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:51:59.957001 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:51:59.967702 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:51:59.968184 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:51:59.968485 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:52:00.358319 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.390 seconds
[0m21:52:00.361999 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:52:00.466273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1191c3a10>]}
[0m21:52:00.467034 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:52:00.467432 [info ] [MainThread]: 
[0m21:52:00.470578 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:52:00.471178 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:52:00.471656 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:52:00.472017 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:52:00.480301 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:52:00.481227 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:52:00.503512 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:52:00.504672 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:52:00.504904 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:52:00.505104 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:52:01.063175 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.558 seconds
[0m21:52:01.087034 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:52:01.178717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195085d0>]}
[0m21:52:01.179390 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.71s]
[0m21:52:01.179720 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:52:01.180336 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:52:01.180577 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:52:01.180837 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:52:01.181006 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:52:01.183068 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:52:01.184448 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:52:01.195568 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:52:01.196755 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:52:01.197040 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON LOWER(billboard_data.artist) = LOWER(artist_data.artist_name)
        );
[0m21:52:01.197236 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:52:02.397203 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.199 seconds
[0m21:52:02.401384 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:52:02.498715 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x119781a90>]}
[0m21:52:02.499971 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.32s]
[0m21:52:02.500840 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:52:02.502052 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.countries
[0m21:52:02.502658 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:52:02.503219 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:52:02.503575 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.countries
[0m21:52:02.507517 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:52:02.509983 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.countries
[0m21:52:02.512619 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:52:02.514892 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:52:02.515407 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.genre = rg.genre
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:52:02.515766 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:52:03.632392 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.116 seconds
[0m21:52:03.637698 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: Close
[0m21:52:03.739009 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08d36638-fca5-4d69-b57c-83c5d7c39d4d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118edf850>]}
[0m21:52:03.740121 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.24s]
[0m21:52:03.740957 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.countries
[0m21:52:03.743046 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:52:03.743545 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:52:03.743883 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:52:03.744142 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:52:03.744579 [info ] [MainThread]: 
[0m21:52:03.744929 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m21:52:03.745897 [debug] [MainThread]: Command end result
[0m21:52:03.776013 [info ] [MainThread]: 
[0m21:52:03.776281 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:52:03.776431 [info ] [MainThread]: 
[0m21:52:03.776569 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:52:03.777536 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.913445, "process_user_time": 1.354864, "process_kernel_time": 0.176823, "process_mem_max_rss": "141967360", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:52:03.777794 [debug] [MainThread]: Command `dbt run` succeeded at 21:52:03.777742 after 4.91 seconds
[0m21:52:03.777984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103082120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1195bfa10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067a72f0>]}
[0m21:52:03.778151 [debug] [MainThread]: Flushing usage events
[0m21:54:18.708683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114efed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114efc50>]}


============================== 21:54:18.711058 | 43311779-a9c2-471b-9781-f26e1eb9fca2 ==============================
[0m21:54:18.711058 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:54:18.711389 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m21:54:18.884764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123f6190>]}
[0m21:54:18.911314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123786b0>]}
[0m21:54:18.911848 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:54:18.923356 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:54:18.986362 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:54:18.987461 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/schema.yml
[0m21:54:19.015638 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m21:54:19.016019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126e8750>]}
[0m21:54:19.106533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112aedd60>]}
[0m21:54:19.185862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112afaeb0>]}
[0m21:54:19.186159 [info ] [MainThread]: Found 3 models, 20 data tests, 2 sources, 454 macros
[0m21:54:19.186319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11128b2b0>]}
[0m21:54:19.187345 [info ] [MainThread]: 
[0m21:54:19.187608 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:54:19.189715 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:54:19.196507 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:54:19.196711 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:54:19.196838 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:54:19.773346 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.576 seconds
[0m21:54:19.776632 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:54:19.879138 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:54:19.889892 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:54:19.890384 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:54:19.890660 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:54:20.263397 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.373 seconds
[0m21:54:20.266256 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:54:20.373072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a9fd10>]}
[0m21:54:20.373522 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:54:20.373726 [info ] [MainThread]: 
[0m21:54:20.376210 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:54:20.376554 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:54:20.376820 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:54:20.377018 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:54:20.382065 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:54:20.382659 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:54:20.406499 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:54:20.407956 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:54:20.408286 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:54:20.408558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:54:20.934139 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.526 seconds
[0m21:54:20.948551 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:54:21.038643 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111253e30>]}
[0m21:54:21.039192 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.66s]
[0m21:54:21.039589 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:54:21.040147 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:54:21.040518 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:54:21.040857 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:54:21.041068 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:54:21.043224 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:54:21.043812 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:54:21.057842 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:54:21.058961 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:54:21.059195 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON LOWER(billboard_data.artist) = LOWER(artist_data.artist_name)
        );
[0m21:54:21.059395 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:54:22.071025 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.011 seconds
[0m21:54:22.075573 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:54:22.170317 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c86350>]}
[0m21:54:22.171198 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.13s]
[0m21:54:22.171673 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:54:22.172313 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.countries
[0m21:54:22.172640 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:54:22.173069 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:54:22.173404 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.countries
[0m21:54:22.176363 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:54:22.177243 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.countries
[0m21:54:22.178965 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:54:22.180347 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:54:22.180688 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.genre = rg.genre
GROUP BY a.COUNTRY
ORDER BY total_entries DESC
        );
[0m21:54:22.181007 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:54:23.191100 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.010 seconds
[0m21:54:23.193531 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: Close
[0m21:54:23.291623 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43311779-a9c2-471b-9781-f26e1eb9fca2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072adfd0>]}
[0m21:54:23.292820 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.12s]
[0m21:54:23.293478 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.countries
[0m21:54:23.295092 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:54:23.295412 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:54:23.295670 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:54:23.295914 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:54:23.296300 [info ] [MainThread]: 
[0m21:54:23.296627 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 4.11 seconds (4.11s).
[0m21:54:23.297539 [debug] [MainThread]: Command end result
[0m21:54:23.326592 [info ] [MainThread]: 
[0m21:54:23.326970 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:54:23.327189 [info ] [MainThread]: 
[0m21:54:23.327389 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:54:23.328550 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6506834, "process_user_time": 1.393126, "process_kernel_time": 0.191691, "process_mem_max_rss": "143523840", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:54:23.328887 [debug] [MainThread]: Command `dbt run` succeeded at 21:54:23.328825 after 4.65 seconds
[0m21:54:23.329135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bee120>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ca5d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11124c0b0>]}
[0m21:54:23.329357 [debug] [MainThread]: Flushing usage events
[0m21:55:19.428461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e12660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f3c50>]}


============================== 21:55:19.430527 | 53aa8348-7078-4e5d-bd27-d4696d4f366b ==============================
[0m21:55:19.430527 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:55:19.430824 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt test', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:55:19.600834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111fa190>]}
[0m21:55:19.626229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111786b0>]}
[0m21:55:19.626810 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:55:19.636716 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:55:19.699422 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:55:19.699784 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:55:19.720619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111693750>]}
[0m21:55:19.778777 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bfe030>]}
[0m21:55:19.779064 [info ] [MainThread]: Found 3 models, 20 data tests, 2 sources, 454 macros
[0m21:55:19.779236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b27770>]}
[0m21:55:19.780509 [info ] [MainThread]: 
[0m21:55:19.780819 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:55:19.783129 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m21:55:19.791225 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:55:19.791452 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:55:19.791588 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:20.693395 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.902 seconds
[0m21:55:20.696559 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:55:20.791708 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '53aa8348-7078-4e5d-bd27-d4696d4f366b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c4f6c0>]}
[0m21:55:20.792439 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:55:20.792801 [info ] [MainThread]: 
[0m21:55:20.796116 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:20.796633 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:20.797007 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:20.797306 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:20.797629 [info ] [Thread-1 (]: 1 of 20 START test not_null_countries_country .................................. [RUN]
[0m21:55:20.797967 [info ] [Thread-3 (]: 3 of 20 START test not_null_countries_top_artist ............................... [RUN]
[0m21:55:20.798378 [info ] [Thread-4 (]: 4 of 20 START test not_null_countries_top_genre ................................ [RUN]
[0m21:55:20.798793 [info ] [Thread-2 (]: 2 of 20 START test not_null_countries_top_10_entries ........................... [RUN]
[0m21:55:20.799568 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m21:55:20.800085 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_artist.febc298eb0'
[0m21:55:20.800744 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_genre.aa91751aed'
[0m21:55:20.801201 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354'
[0m21:55:20.801544 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:20.801845 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:20.802132 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:20.802400 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:20.823060 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:20.823544 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:20.826357 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:20.828476 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:20.829243 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:20.835545 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:20.841969 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:20.843241 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:20.843443 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:20.843628 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:20.844793 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:20.846008 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:20.846563 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:20.846807 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_country.69e1905e51"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select country
from BB_DATABASE.BB_SCHEMA.countries
where country is null



      
    ) dbt_internal_test
[0m21:55:20.847178 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:20.847351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:20.847565 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_artist
from BB_DATABASE.BB_SCHEMA.countries
where top_artist is null



      
    ) dbt_internal_test
[0m21:55:20.847935 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:20.848339 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:20.848502 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:55:20.848877 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_10_entries
from BB_DATABASE.BB_SCHEMA.countries
where top_10_entries is null



      
    ) dbt_internal_test
[0m21:55:20.849252 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_genre
from BB_DATABASE.BB_SCHEMA.countries
where top_genre is null



      
    ) dbt_internal_test
[0m21:55:20.849742 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:55:20.850196 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:55:21.264018 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.414 seconds
[0m21:55:21.281077 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: Close
[0m21:55:21.304356 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.456 seconds
[0m21:55:21.306633 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: Close
[0m21:55:21.383473 [info ] [Thread-2 (]: 2 of 20 PASS not_null_countries_top_10_entries ................................. [[32mPASS[0m in 0.58s]
[0m21:55:21.383956 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:21.384258 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:21.384582 [info ] [Thread-2 (]: 5 of 20 START test not_null_countries_top_rank ................................. [RUN]
[0m21:55:21.384932 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m21:55:21.385162 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:21.388076 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:21.388667 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:21.389846 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:21.390453 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:21.391246 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.countries
where top_rank is null



      
    ) dbt_internal_test
[0m21:55:21.391494 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:21.402717 [info ] [Thread-3 (]: 3 of 20 PASS not_null_countries_top_artist ..................................... [[32mPASS[0m in 0.60s]
[0m21:55:21.403117 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:21.403334 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:21.403574 [info ] [Thread-3 (]: 6 of 20 START test not_null_countries_total_artists ............................ [RUN]
[0m21:55:21.403845 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m21:55:21.404043 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:21.406029 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:21.406440 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:21.407418 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:21.407936 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:21.408179 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_artists
from BB_DATABASE.BB_SCHEMA.countries
where total_artists is null



      
    ) dbt_internal_test
[0m21:55:21.408387 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:21.436437 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.589 seconds
[0m21:55:21.437638 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: Close
[0m21:55:21.441968 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.592 seconds
[0m21:55:21.442862 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: Close
[0m21:55:21.576018 [info ] [Thread-1 (]: 1 of 20 PASS not_null_countries_country ........................................ [[32mPASS[0m in 0.78s]
[0m21:55:21.576586 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:21.576863 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:21.577144 [info ] [Thread-1 (]: 7 of 20 START test not_null_countries_total_entries ............................ [RUN]
[0m21:55:21.577483 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m21:55:21.577739 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:21.580497 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:21.581154 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:21.582262 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:21.583024 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:21.583321 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.countries
where total_entries is null



      
    ) dbt_internal_test
[0m21:55:21.583524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:21.592370 [info ] [Thread-4 (]: 4 of 20 PASS not_null_countries_top_genre ...................................... [[32mPASS[0m in 0.79s]
[0m21:55:21.592758 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:21.592995 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:21.593315 [info ] [Thread-4 (]: 8 of 20 START test not_null_hot_100_artists_artist ............................. [RUN]
[0m21:55:21.593689 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m21:55:21.593918 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:21.596642 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:21.597098 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:21.598144 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:21.598683 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:21.598919 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is null



      
    ) dbt_internal_test
[0m21:55:21.599099 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:21.742221 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m21:55:21.743722 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: Close
[0m21:55:21.840363 [info ] [Thread-2 (]: 5 of 20 PASS not_null_countries_top_rank ....................................... [[32mPASS[0m in 0.46s]
[0m21:55:21.840974 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:21.841341 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:21.841750 [info ] [Thread-2 (]: 9 of 20 START test not_null_hot_100_artists_top10_entries ...................... [RUN]
[0m21:55:21.842154 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m21:55:21.842423 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:21.845412 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:21.846319 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:21.847854 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:21.848662 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:21.849058 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top10_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top10_entries is null



      
    ) dbt_internal_test
[0m21:55:21.849383 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:21.911000 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.327 seconds
[0m21:55:21.912582 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: Close
[0m21:55:21.921633 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.322 seconds
[0m21:55:21.922998 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: Close
[0m21:55:21.982347 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.574 seconds
[0m21:55:21.983917 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: Close
[0m21:55:22.005295 [info ] [Thread-1 (]: 7 of 20 PASS not_null_countries_total_entries .................................. [[32mPASS[0m in 0.43s]
[0m21:55:22.005813 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:22.006073 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:22.006338 [info ] [Thread-1 (]: 10 of 20 START test not_null_hot_100_artists_top_rank .......................... [RUN]
[0m21:55:22.006657 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m21:55:22.006905 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:22.009820 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:22.010410 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:22.011591 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:22.012012 [info ] [Thread-4 (]: 8 of 20 PASS not_null_hot_100_artists_artist ................................... [[32mPASS[0m in 0.42s]
[0m21:55:22.012468 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:22.012741 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:22.012944 [info ] [Thread-4 (]: 11 of 20 START test not_null_hot_100_artists_total_entries ..................... [RUN]
[0m21:55:22.013185 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m21:55:22.013399 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:22.013791 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:22.018850 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:22.019133 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top_rank is null



      
    ) dbt_internal_test
[0m21:55:22.019554 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:22.020568 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:22.021825 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:22.023341 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:22.023679 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where total_entries is null



      
    ) dbt_internal_test
[0m21:55:22.024058 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:22.072495 [info ] [Thread-3 (]: 6 of 20 PASS not_null_countries_total_artists .................................. [[32mPASS[0m in 0.67s]
[0m21:55:22.072891 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:22.073095 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:22.073304 [info ] [Thread-3 (]: 12 of 20 START test not_null_hot_100_flat_artist ............................... [RUN]
[0m21:55:22.073557 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6, now test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e)
[0m21:55:22.073734 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:22.076129 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:22.076648 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:22.077631 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:22.078159 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:22.078341 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where artist is null



      
    ) dbt_internal_test
[0m21:55:22.078500 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:22.251275 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.402 seconds
[0m21:55:22.253043 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: Close
[0m21:55:22.340527 [info ] [Thread-2 (]: 9 of 20 PASS not_null_hot_100_artists_top10_entries ............................ [[32mPASS[0m in 0.50s]
[0m21:55:22.341369 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:22.341778 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:22.342214 [info ] [Thread-2 (]: 13 of 20 START test not_null_hot_100_flat_chart_position ....................... [RUN]
[0m21:55:22.342728 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa)
[0m21:55:22.343381 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:22.347818 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:22.348704 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.329 seconds
[0m21:55:22.350885 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: Close
[0m21:55:22.352984 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:22.355503 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:22.356598 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:22.356964 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select chart_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where chart_position is null



      
    ) dbt_internal_test
[0m21:55:22.357257 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:22.369479 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.345 seconds
[0m21:55:22.371022 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: Close
[0m21:55:22.437067 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.358 seconds
[0m21:55:22.438621 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: Close
[0m21:55:22.440350 [info ] [Thread-1 (]: 10 of 20 PASS not_null_hot_100_artists_top_rank ................................ [[32mPASS[0m in 0.43s]
[0m21:55:22.440882 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:22.441297 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123
[0m21:55:22.441681 [info ] [Thread-1 (]: 14 of 20 START test not_null_hot_100_flat_last_week ............................ [RUN]
[0m21:55:22.442097 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123)
[0m21:55:22.442329 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123
[0m21:55:22.445122 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123"
[0m21:55:22.446668 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123
[0m21:55:22.448492 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123"
[0m21:55:22.449236 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123"
[0m21:55:22.449451 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_week
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where last_week is null



      
    ) dbt_internal_test
[0m21:55:22.449640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:22.462440 [info ] [Thread-4 (]: 11 of 20 PASS not_null_hot_100_artists_total_entries ........................... [[32mPASS[0m in 0.45s]
[0m21:55:22.462898 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:22.463120 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:22.463357 [info ] [Thread-4 (]: 15 of 20 START test not_null_hot_100_flat_peak_position ........................ [RUN]
[0m21:55:22.463644 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m21:55:22.463848 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:22.466110 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:22.466592 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:22.467667 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:22.468168 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:22.468362 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select peak_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where peak_position is null



      
    ) dbt_internal_test
[0m21:55:22.468540 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:22.528364 [info ] [Thread-3 (]: 12 of 20 PASS not_null_hot_100_flat_artist ..................................... [[32mPASS[0m in 0.45s]
[0m21:55:22.528774 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:22.528980 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:22.529196 [info ] [Thread-3 (]: 16 of 20 START test not_null_hot_100_flat_song ................................. [RUN]
[0m21:55:22.529455 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m21:55:22.529636 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:22.532102 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:22.532590 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:22.533599 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:22.534129 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:22.534344 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select song
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where song is null



      
    ) dbt_internal_test
[0m21:55:22.534517 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:22.751717 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.394 seconds
[0m21:55:22.753642 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: Close
[0m21:55:22.802877 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.334 seconds
[0m21:55:22.803688 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.354 seconds
[0m21:55:22.805788 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: Close
[0m21:55:22.807458 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123: Close
[0m21:55:22.842931 [info ] [Thread-2 (]: 13 of 20 PASS not_null_hot_100_flat_chart_position ............................. [[32mPASS[0m in 0.50s]
[0m21:55:22.843743 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:22.844200 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:22.844676 [info ] [Thread-2 (]: 17 of 20 START test not_null_hot_100_flat_weeks_on_chart ....................... [RUN]
[0m21:55:22.845190 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m21:55:22.845584 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:22.850250 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:22.853687 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.319 seconds
[0m21:55:22.856000 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: Close
[0m21:55:22.857730 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:22.859841 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:22.861220 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:22.861529 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select weeks_on_chart
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where weeks_on_chart is null



      
    ) dbt_internal_test
[0m21:55:22.861782 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:22.918606 [info ] [Thread-4 (]: 15 of 20 PASS not_null_hot_100_flat_peak_position .............................. [[32mPASS[0m in 0.45s]
[0m21:55:22.919080 [error] [Thread-1 (]: 14 of 20 FAIL 30 not_null_hot_100_flat_last_week ............................... [[31mFAIL 30[0m in 0.48s]
[0m21:55:22.919448 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:22.919736 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123
[0m21:55:22.920021 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:22.920285 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:22.920527 [info ] [Thread-4 (]: 18 of 20 START test unique_countries_country ................................... [RUN]
[0m21:55:22.920791 [info ] [Thread-1 (]: 19 of 20 START test unique_countries_top_artist ................................ [RUN]
[0m21:55:22.921157 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m21:55:22.921391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_last_week.cfab12b123, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m21:55:22.921603 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:22.921784 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:22.927023 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:22.929732 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:22.930512 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:22.930743 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:22.942058 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:22.943451 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:22.944378 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:22.946578 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:22.947000 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_country.6b59afdd31"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    country as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where country is not null
group by country
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:22.947335 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_top_artist.00910d9681"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    top_artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where top_artist is not null
group by top_artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:22.948031 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:22.948231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:22.953695 [info ] [Thread-3 (]: 16 of 20 PASS not_null_hot_100_flat_song ....................................... [[32mPASS[0m in 0.42s]
[0m21:55:22.954039 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:22.954220 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:22.954427 [info ] [Thread-3 (]: 20 of 20 START test unique_hot_100_artists_artist .............................. [RUN]
[0m21:55:22.954606 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m21:55:22.954756 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:22.957651 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:22.958113 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:22.959224 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:22.959807 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:22.959986 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is not null
group by artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:22.960144 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:23.245222 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.383 seconds
[0m21:55:23.246610 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: Close
[0m21:55:23.248627 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.300 seconds
[0m21:55:23.249794 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: Close
[0m21:55:23.262227 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.302 seconds
[0m21:55:23.263480 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: Close
[0m21:55:23.282799 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.335 seconds
[0m21:55:23.284001 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: Close
[0m21:55:23.337182 [info ] [Thread-1 (]: 19 of 20 PASS unique_countries_top_artist ...................................... [[32mPASS[0m in 0.42s]
[0m21:55:23.337589 [info ] [Thread-2 (]: 17 of 20 PASS not_null_hot_100_flat_weeks_on_chart ............................. [[32mPASS[0m in 0.49s]
[0m21:55:23.338817 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:23.339193 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:23.352099 [info ] [Thread-3 (]: 20 of 20 PASS unique_hot_100_artists_artist .................................... [[32mPASS[0m in 0.40s]
[0m21:55:23.352714 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:23.369013 [info ] [Thread-4 (]: 18 of 20 PASS unique_countries_country ......................................... [[32mPASS[0m in 0.45s]
[0m21:55:23.369440 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:23.370863 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:55:23.371122 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m21:55:23.371250 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45' was properly closed.
[0m21:55:23.371358 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m21:55:23.371460 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd' was properly closed.
[0m21:55:23.371639 [info ] [MainThread]: 
[0m21:55:23.371793 [info ] [MainThread]: Finished running 20 data tests in 0 hours 0 minutes and 3.59 seconds (3.59s).
[0m21:55:23.373096 [debug] [MainThread]: Command end result
[0m21:55:23.398921 [info ] [MainThread]: 
[0m21:55:23.399304 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m21:55:23.399493 [info ] [MainThread]: 
[0m21:55:23.399737 [error] [MainThread]: [31mFailure in test not_null_hot_100_flat_last_week (models/staging/schema.yml)[0m
[0m21:55:23.399951 [error] [MainThread]:   Got 30 results, configured to fail if != 0
[0m21:55:23.400110 [info ] [MainThread]: 
[0m21:55:23.400310 [info ] [MainThread]:   compiled code at target/compiled/billboard_hot_100/models/staging/schema.yml/not_null_hot_100_flat_last_week.sql
[0m21:55:23.400485 [info ] [MainThread]: 
[0m21:55:23.400668 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=1 SKIP=0 TOTAL=20
[0m21:55:23.401901 [debug] [MainThread]: Resource report: {"command_name": "test", "command_wall_clock_time": 4.002678, "process_user_time": 1.790177, "process_kernel_time": 0.248451, "process_mem_max_rss": "150175744", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:55:23.402229 [debug] [MainThread]: Command `dbt test` failed at 21:55:23.402171 after 4.00 seconds
[0m21:55:23.402464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ddcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115227e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1152d9440>]}
[0m21:55:23.402677 [debug] [MainThread]: Flushing usage events
[0m21:55:42.687695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10298a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104377ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104377c50>]}


============================== 21:55:42.690082 | 5d1f2c1a-57a8-482c-8f67-dba407b61e24 ==============================
[0m21:55:42.690082 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:55:42.690426 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:55:42.845619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eee190>]}
[0m21:55:42.869790 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e706b0>]}
[0m21:55:42.870323 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:55:42.879571 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:55:42.938549 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m21:55:42.939083 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/schema.yml
[0m21:55:43.035103 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m21:55:43.035488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105458750>]}
[0m21:55:43.118279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eb37a0>]}
[0m21:55:43.201542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104127d90>]}
[0m21:55:43.201800 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m21:55:43.201959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a3110>]}
[0m21:55:43.203192 [info ] [MainThread]: 
[0m21:55:43.203472 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:55:43.205457 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m21:55:43.212903 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:55:43.213120 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:55:43.213252 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:55:43.754154 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.540 seconds
[0m21:55:43.759109 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:55:43.851132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5d1f2c1a-57a8-482c-8f67-dba407b61e24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105557350>]}
[0m21:55:43.851744 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:55:43.851990 [info ] [MainThread]: 
[0m21:55:43.854450 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:43.854800 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:43.855096 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:43.855343 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:43.855619 [info ] [Thread-3 (]: 3 of 19 START test not_null_countries_top_artist ............................... [RUN]
[0m21:55:43.855912 [info ] [Thread-1 (]: 1 of 19 START test not_null_countries_country .................................. [RUN]
[0m21:55:43.856162 [info ] [Thread-4 (]: 4 of 19 START test not_null_countries_top_genre ................................ [RUN]
[0m21:55:43.856427 [info ] [Thread-2 (]: 2 of 19 START test not_null_countries_top_10_entries ........................... [RUN]
[0m21:55:43.856806 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_artist.febc298eb0'
[0m21:55:43.857049 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m21:55:43.857308 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_genre.aa91751aed'
[0m21:55:43.857553 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354'
[0m21:55:43.857762 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:43.857948 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:43.858492 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:43.858810 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:43.872649 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:43.874046 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:43.876371 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:43.878666 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:43.879446 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:43.879661 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:43.879856 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:43.885964 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:43.890531 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:43.891731 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:43.892673 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:43.893735 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:43.894368 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:55:43.894710 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:55:43.894905 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_artist
from BB_DATABASE.BB_SCHEMA.countries
where top_artist is null



      
    ) dbt_internal_test
[0m21:55:43.895250 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:55:43.895550 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:55:43.895714 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_country.69e1905e51"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select country
from BB_DATABASE.BB_SCHEMA.countries
where country is null



      
    ) dbt_internal_test
[0m21:55:43.895891 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:55:43.896058 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_genre
from BB_DATABASE.BB_SCHEMA.countries
where top_genre is null



      
    ) dbt_internal_test
[0m21:55:43.896236 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_10_entries
from BB_DATABASE.BB_SCHEMA.countries
where top_10_entries is null



      
    ) dbt_internal_test
[0m21:55:43.896391 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:43.896576 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:55:43.896721 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:55:44.204989 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.308 seconds
[0m21:55:44.215882 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: Close
[0m21:55:44.229524 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.334 seconds
[0m21:55:44.231467 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: Close
[0m21:55:44.308479 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.412 seconds
[0m21:55:44.311502 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: Close
[0m21:55:44.315853 [info ] [Thread-3 (]: 3 of 19 PASS not_null_countries_top_artist ..................................... [[32mPASS[0m in 0.46s]
[0m21:55:44.316610 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:55:44.317082 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:44.317567 [info ] [Thread-3 (]: 5 of 19 START test not_null_countries_top_rank ................................. [RUN]
[0m21:55:44.318440 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m21:55:44.319149 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.422 seconds
[0m21:55:44.319529 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:44.321203 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: Close
[0m21:55:44.326620 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:44.328930 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:44.330979 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:44.332759 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:55:44.333229 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.countries
where top_rank is null



      
    ) dbt_internal_test
[0m21:55:44.333579 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:44.334372 [info ] [Thread-4 (]: 4 of 19 PASS not_null_countries_top_genre ...................................... [[32mPASS[0m in 0.48s]
[0m21:55:44.335406 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:55:44.335758 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:44.336232 [info ] [Thread-4 (]: 6 of 19 START test not_null_countries_total_artists ............................ [RUN]
[0m21:55:44.336549 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m21:55:44.336970 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:44.339670 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:44.340275 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:44.342108 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:44.342765 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:55:44.343002 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_artists
from BB_DATABASE.BB_SCHEMA.countries
where total_artists is null



      
    ) dbt_internal_test
[0m21:55:44.343212 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:44.399963 [info ] [Thread-1 (]: 1 of 19 PASS not_null_countries_country ........................................ [[32mPASS[0m in 0.54s]
[0m21:55:44.400507 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:55:44.400750 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:44.400996 [info ] [Thread-1 (]: 7 of 19 START test not_null_countries_total_entries ............................ [RUN]
[0m21:55:44.401287 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m21:55:44.401505 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:44.404092 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:44.404613 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:44.406027 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:44.406558 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:55:44.406756 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.countries
where total_entries is null



      
    ) dbt_internal_test
[0m21:55:44.406927 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:44.415304 [info ] [Thread-2 (]: 2 of 19 PASS not_null_countries_top_10_entries ................................. [[32mPASS[0m in 0.56s]
[0m21:55:44.415709 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:55:44.415922 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:44.416143 [info ] [Thread-2 (]: 8 of 19 START test not_null_hot_100_artists_artist ............................. [RUN]
[0m21:55:44.416421 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m21:55:44.416612 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:44.418828 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:44.419267 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:44.420312 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:44.420826 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:55:44.421004 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is null



      
    ) dbt_internal_test
[0m21:55:44.421175 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:44.694790 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.351 seconds
[0m21:55:44.696854 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: Close
[0m21:55:44.698659 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.292 seconds
[0m21:55:44.699961 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: Close
[0m21:55:44.703778 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.370 seconds
[0m21:55:44.704822 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: Close
[0m21:55:44.708167 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.287 seconds
[0m21:55:44.709226 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: Close
[0m21:55:44.787745 [info ] [Thread-4 (]: 6 of 19 PASS not_null_countries_total_artists .................................. [[32mPASS[0m in 0.45s]
[0m21:55:44.788470 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:55:44.788863 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:44.789384 [info ] [Thread-1 (]: 7 of 19 PASS not_null_countries_total_entries .................................. [[32mPASS[0m in 0.39s]
[0m21:55:44.790356 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:55:44.790712 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:44.789778 [info ] [Thread-4 (]: 9 of 19 START test not_null_hot_100_artists_top10_entries ...................... [RUN]
[0m21:55:44.791137 [info ] [Thread-1 (]: 10 of 19 START test not_null_hot_100_artists_top_rank .......................... [RUN]
[0m21:55:44.791989 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m21:55:44.792377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m21:55:44.792736 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:44.793041 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:44.797421 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:44.801805 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:44.798199 [info ] [Thread-3 (]: 5 of 19 PASS not_null_countries_top_rank ....................................... [[32mPASS[0m in 0.48s]
[0m21:55:44.803325 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:55:44.803741 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:44.804037 [info ] [Thread-3 (]: 11 of 19 START test not_null_hot_100_artists_total_entries ..................... [RUN]
[0m21:55:44.804484 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m21:55:44.804815 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:44.806846 [info ] [Thread-2 (]: 8 of 19 PASS not_null_hot_100_artists_artist ................................... [[32mPASS[0m in 0.39s]
[0m21:55:44.807501 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:55:44.807834 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:44.808108 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:44.808445 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:44.810993 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:44.812756 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:44.814370 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:44.814782 [info ] [Thread-2 (]: 12 of 19 START test not_null_hot_100_flat_artist ............................... [RUN]
[0m21:55:44.815463 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e)
[0m21:55:44.815799 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:44.818798 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:44.819242 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:44.820780 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:44.821316 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:55:44.821801 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:55:44.822117 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:44.822420 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top_rank is null



      
    ) dbt_internal_test
[0m21:55:44.822736 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top10_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top10_entries is null



      
    ) dbt_internal_test
[0m21:55:44.824536 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:44.825000 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:55:44.825219 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:44.825462 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:44.825785 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where total_entries is null



      
    ) dbt_internal_test
[0m21:55:44.827156 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:55:44.827649 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:44.828223 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where artist is null



      
    ) dbt_internal_test
[0m21:55:44.828974 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:45.101907 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.276 seconds
[0m21:55:45.104332 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: Close
[0m21:55:45.147151 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.319 seconds
[0m21:55:45.149812 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: Close
[0m21:55:45.171191 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.342 seconds
[0m21:55:45.173746 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: Close
[0m21:55:45.175429 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.350 seconds
[0m21:55:45.177113 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: Close
[0m21:55:45.194438 [info ] [Thread-4 (]: 9 of 19 PASS not_null_hot_100_artists_top10_entries ............................ [[32mPASS[0m in 0.40s]
[0m21:55:45.195111 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:55:45.195531 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:45.195942 [info ] [Thread-4 (]: 13 of 19 START test not_null_hot_100_flat_chart_position ....................... [RUN]
[0m21:55:45.196388 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa)
[0m21:55:45.196720 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:45.200504 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:45.201462 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:45.210910 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:45.212323 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:55:45.212583 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select chart_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where chart_position is null



      
    ) dbt_internal_test
[0m21:55:45.212795 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:45.242916 [info ] [Thread-3 (]: 11 of 19 PASS not_null_hot_100_artists_total_entries ........................... [[32mPASS[0m in 0.44s]
[0m21:55:45.243458 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:55:45.243935 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:45.244177 [info ] [Thread-3 (]: 14 of 19 START test not_null_hot_100_flat_peak_position ........................ [RUN]
[0m21:55:45.244453 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m21:55:45.244680 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:45.247260 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:45.248149 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:45.249961 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:45.251041 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:55:45.251401 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select peak_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where peak_position is null



      
    ) dbt_internal_test
[0m21:55:45.251645 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:45.257895 [info ] [Thread-1 (]: 10 of 19 PASS not_null_hot_100_artists_top_rank ................................ [[32mPASS[0m in 0.47s]
[0m21:55:45.258399 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:55:45.258790 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:45.259034 [info ] [Thread-1 (]: 15 of 19 START test not_null_hot_100_flat_song ................................. [RUN]
[0m21:55:45.259352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m21:55:45.259593 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:45.261986 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:45.262912 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:45.264179 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:45.264872 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:55:45.265127 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select song
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where song is null



      
    ) dbt_internal_test
[0m21:55:45.265323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:45.274421 [info ] [Thread-2 (]: 12 of 19 PASS not_null_hot_100_flat_artist ..................................... [[32mPASS[0m in 0.46s]
[0m21:55:45.274832 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:55:45.275196 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:45.275461 [info ] [Thread-2 (]: 16 of 19 START test not_null_hot_100_flat_weeks_on_chart ....................... [RUN]
[0m21:55:45.275710 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m21:55:45.275895 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:45.278360 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:45.278877 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:45.279997 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:45.280822 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:55:45.281127 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select weeks_on_chart
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where weeks_on_chart is null



      
    ) dbt_internal_test
[0m21:55:45.281470 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:55:45.520935 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.308 seconds
[0m21:55:45.523430 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: Close
[0m21:55:45.544203 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.292 seconds
[0m21:55:45.545697 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: Close
[0m21:55:45.550773 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.285 seconds
[0m21:55:45.551879 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: Close
[0m21:55:45.571104 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.290 seconds
[0m21:55:45.572347 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: Close
[0m21:55:45.620900 [info ] [Thread-4 (]: 13 of 19 PASS not_null_hot_100_flat_chart_position ............................. [[32mPASS[0m in 0.42s]
[0m21:55:45.621413 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:55:45.621648 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:45.621902 [info ] [Thread-4 (]: 17 of 19 START test unique_countries_country ................................... [RUN]
[0m21:55:45.622207 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m21:55:45.622414 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:45.626064 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:45.627863 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:45.629021 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:45.630050 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:55:45.630272 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_country.6b59afdd31"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    country as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where country is not null
group by country
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:45.630535 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:55:45.630994 [info ] [Thread-3 (]: 14 of 19 PASS not_null_hot_100_flat_peak_position .............................. [[32mPASS[0m in 0.39s]
[0m21:55:45.631825 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:55:45.632243 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:45.632517 [info ] [Thread-3 (]: 18 of 19 START test unique_countries_top_artist ................................ [RUN]
[0m21:55:45.633052 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m21:55:45.633243 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:45.636093 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:45.636543 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:45.637664 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:45.638025 [info ] [Thread-1 (]: 15 of 19 PASS not_null_hot_100_flat_song ....................................... [[32mPASS[0m in 0.38s]
[0m21:55:45.638576 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:55:45.638828 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:45.639046 [info ] [Thread-1 (]: 19 of 19 START test unique_hot_100_artists_artist .............................. [RUN]
[0m21:55:45.639521 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:55:45.639740 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m21:55:45.639948 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_top_artist.00910d9681"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    top_artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where top_artist is not null
group by top_artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:45.640147 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:45.640319 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:55:45.642296 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:45.643164 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:45.644564 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:45.645300 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:55:45.645479 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is not null
group by artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:55:45.645634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:55:45.658923 [info ] [Thread-2 (]: 16 of 19 PASS not_null_hot_100_flat_weeks_on_chart ............................. [[32mPASS[0m in 0.38s]
[0m21:55:45.659324 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:55:45.900311 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.270 seconds
[0m21:55:45.902676 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: Close
[0m21:55:45.911245 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.266 seconds
[0m21:55:45.912697 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: Close
[0m21:55:45.914683 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.274 seconds
[0m21:55:45.916216 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: Close
[0m21:55:45.991092 [info ] [Thread-4 (]: 17 of 19 PASS unique_countries_country ......................................... [[32mPASS[0m in 0.37s]
[0m21:55:45.991914 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:55:46.024486 [info ] [Thread-1 (]: 19 of 19 PASS unique_hot_100_artists_artist .................................... [[32mPASS[0m in 0.38s]
[0m21:55:46.026742 [info ] [Thread-3 (]: 18 of 19 PASS unique_countries_top_artist ...................................... [[32mPASS[0m in 0.39s]
[0m21:55:46.028580 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:55:46.029911 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:55:46.034027 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:55:46.034333 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45' was properly closed.
[0m21:55:46.034459 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m21:55:46.034560 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m21:55:46.034659 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd' was properly closed.
[0m21:55:46.034850 [info ] [MainThread]: 
[0m21:55:46.035027 [info ] [MainThread]: Finished running 19 data tests in 0 hours 0 minutes and 2.83 seconds (2.83s).
[0m21:55:46.036283 [debug] [MainThread]: Command end result
[0m21:55:46.053730 [info ] [MainThread]: 
[0m21:55:46.053984 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:55:46.054125 [info ] [MainThread]: 
[0m21:55:46.054261 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=0 SKIP=0 TOTAL=19
[0m21:55:46.055140 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.3982153, "process_user_time": 1.889942, "process_kernel_time": 0.232978, "process_mem_max_rss": "150962176", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:55:46.055378 [debug] [MainThread]: Command `dbt test` succeeded at 21:55:46.055336 after 3.40 seconds
[0m21:55:46.055541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10667e200>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10292b6b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10661d950>]}
[0m21:55:46.055692 [debug] [MainThread]: Flushing usage events
[0m21:56:00.357196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10883e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aab7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aab7d90>]}


============================== 21:56:00.359453 | 228e9b3b-ef5e-465f-baa0-ab931bf241e3 ==============================
[0m21:56:00.359453 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:56:00.359778 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt docs generate', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:56:00.518298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7f62c0>]}
[0m21:56:00.540735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7786b0>]}
[0m21:56:00.541148 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:56:00.550308 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:56:00.610873 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:56:00.611240 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:56:00.630468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10baf7750>]}
[0m21:56:00.639534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be997c0>]}
[0m21:56:00.639790 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m21:56:00.639954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b780ad0>]}
[0m21:56:00.641084 [info ] [MainThread]: 
[0m21:56:00.641355 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:56:00.643357 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m21:56:00.653155 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:56:00.653399 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:56:00.653531 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:01.006205 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.352 seconds
[0m21:56:01.009952 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:56:01.137147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '228e9b3b-ef5e-465f-baa0-ab931bf241e3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf10870>]}
[0m21:56:01.137733 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:56:01.138008 [info ] [MainThread]: 
[0m21:56:01.140660 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:56:01.141121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:56:01.141439 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:56:01.148769 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:56:01.149555 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:56:01.150294 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:56:01.151098 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:56:01.151458 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:56:01.151834 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:56:01.152163 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:56:01.152532 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e'
[0m21:56:01.152901 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:56:01.153153 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m21:56:01.153423 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa'
[0m21:56:01.153638 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:56:01.153837 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:56:01.154046 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:56:01.154408 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:56:01.156975 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:56:01.164077 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:56:01.166098 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:56:01.169246 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:56:01.169981 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:56:01.170229 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:56:01.170430 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:56:01.170837 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:56:01.171010 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:56:01.171365 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:56:01.171690 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:56:01.171909 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:56:01.172277 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:56:01.172534 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:56:01.172746 [debug] [Thread-4 (]: Began running node model.billboard_hot_100.countries
[0m21:56:01.172961 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_artists, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m21:56:01.173154 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:56:01.173335 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m21:56:01.173537 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now model.billboard_hot_100.countries)
[0m21:56:01.173714 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:56:01.173889 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m21:56:01.174060 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:56:01.174226 [debug] [Thread-4 (]: Began compiling node model.billboard_hot_100.countries
[0m21:56:01.176180 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:56:01.176369 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:56:01.178270 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:56:01.180215 [debug] [Thread-4 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:56:01.182060 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:56:01.182529 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:56:01.182883 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:56:01.183046 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:56:01.183207 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:56:01.183401 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:56:01.183576 [debug] [Thread-4 (]: Began executing node model.billboard_hot_100.countries
[0m21:56:01.183848 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:56:01.184125 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:56:01.184294 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m21:56:01.184589 [debug] [Thread-4 (]: Finished running node model.billboard_hot_100.countries
[0m21:56:01.184765 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:56:01.184949 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:56:01.185121 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:56:01.185285 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:56:01.185474 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m21:56:01.185681 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m21:56:01.189867 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:56:01.190106 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.countries, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m21:56:01.190278 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:56:01.190442 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:56:01.190624 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:56:01.192313 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:56:01.193889 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:56:01.227701 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:56:01.230520 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:56:01.230995 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:56:01.231284 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:56:01.231459 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:56:01.231629 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:56:01.231814 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:56:01.232078 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:56:01.232267 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m21:56:01.232543 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:56:01.232837 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:56:01.233015 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:56:01.233162 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:56:01.233335 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:56:01.233485 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:56:01.233651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354)
[0m21:56:01.235254 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:56:01.235425 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_countries_top_artist.febc298eb0)
[0m21:56:01.235588 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45, now test.billboard_hot_100.not_null_countries_top_genre.aa91751aed)
[0m21:56:01.235747 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:56:01.235910 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:56:01.236063 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:56:01.237880 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:56:01.239385 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:56:01.239539 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:56:01.241037 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:56:01.241393 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:56:01.241625 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:56:01.241807 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m21:56:01.242005 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:56:01.242149 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:56:01.242457 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:56:01.242660 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:56:01.244566 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:56:01.244726 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:56:01.244914 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:56:01.245203 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:56:01.245488 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:56:01.245651 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m21:56:01.245827 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:56:01.246023 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:56:01.246163 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:56:01.246309 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:56:01.246459 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m21:56:01.246620 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m21:56:01.246879 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:56:01.248390 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:56:01.248560 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:56:01.248713 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:56:01.248879 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:56:01.250646 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:56:01.252211 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:56:01.252388 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m21:56:01.252624 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:56:01.252799 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:56:01.254413 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:56:01.254719 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:56:01.254871 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:56:01.255232 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:56:01.255393 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:56:01.255684 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:56:01.255829 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:56:01.256133 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:56:01.256680 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:56:01.256808 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6' was properly closed.
[0m21:56:01.256915 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f' was properly closed.
[0m21:56:01.257012 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m21:56:01.257102 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m21:56:01.258296 [debug] [MainThread]: Command end result
[0m21:56:01.300485 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m21:56:01.300677 [info ] [MainThread]: Building catalog
[0m21:56:01.304924 [debug] [ThreadPool]: Acquiring new snowflake connection 'BB_DATABASE.information_schema'
[0m21:56:01.312381 [debug] [ThreadPool]: Using snowflake connection "BB_DATABASE.information_schema"
[0m21:56:01.312701 [debug] [ThreadPool]: On BB_DATABASE.information_schema: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "BB_DATABASE.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from BB_DATABASE.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'countries' and upper("table_name") = upper('countries')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_flat' and upper("table_name") = upper('hot_100_flat')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'billboard_hot_100' and upper("table_name") = upper('billboard_hot_100')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'artist_data' and upper("table_name") = upper('artist_data')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_artists' and upper("table_name") = upper('hot_100_artists')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from BB_DATABASE.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'countries' and upper("table_name") = upper('countries')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_flat' and upper("table_name") = upper('hot_100_flat')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'billboard_hot_100' and upper("table_name") = upper('billboard_hot_100')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'artist_data' and upper("table_name") = upper('artist_data')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_artists' and upper("table_name") = upper('hot_100_artists')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m21:56:01.312968 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:56:03.655907 [debug] [ThreadPool]: SQL status: SUCCESS 28 in 2.343 seconds
[0m21:56:03.668305 [debug] [ThreadPool]: On BB_DATABASE.information_schema: Close
[0m21:56:03.802903 [info ] [MainThread]: Catalog written to /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/target/catalog.json
[0m21:56:03.804113 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 3.4765491, "process_user_time": 1.128998, "process_kernel_time": 0.163448, "process_mem_max_rss": "139362304", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:56:03.804487 [debug] [MainThread]: Command `dbt docs generate` succeeded at 21:56:03.804427 after 3.48 seconds
[0m21:56:03.804685 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m21:56:03.804822 [debug] [MainThread]: Connection 'BB_DATABASE.information_schema' was properly closed.
[0m21:56:03.805005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6a1cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca3fac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca3fee0>]}
[0m21:56:03.805204 [debug] [MainThread]: Flushing usage events
[0m21:56:10.655688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ce6660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106befed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106befd90>]}


============================== 21:56:10.658658 | 4af895e9-354d-488d-a008-de4cb627814e ==============================
[0m21:56:10.658658 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:56:10.658982 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:56:10.826715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4af895e9-354d-488d-a008-de4cb627814e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107afa2c0>]}
[0m21:56:10.852102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4af895e9-354d-488d-a008-de4cb627814e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a5c7c0>]}
[0m21:57:21.559180 [error] [MainThread]: Encountered an error:

[0m21:57:21.568935 [error] [MainThread]: Traceback (most recent call last):
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/requires.py", line 138, in wrapper
    result, success = func(*args, **kwargs)
                      ~~~~^^^^^^^^^^^^^^^^^
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/requires.py", line 101, in wrapper
    return func(*args, **kwargs)
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/requires.py", line 218, in wrapper
    return func(*args, **kwargs)
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/requires.py", line 247, in wrapper
    return func(*args, **kwargs)
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/requires.py", line 294, in wrapper
    return func(*args, **kwargs)
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/cli/main.py", line 303, in docs_serve
    results = task.run()
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/site-packages/dbt/task/docs/serve.py", line 29, in run
    httpd.serve_forever()
    ~~~~~~~~~~~~~~~~~~~^^
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/socketserver.py", line 235, in serve_forever
    ready = selector.select(poll_interval)
  File "/Users/maxhilsdorf/opt/miniconda3/envs/dbt_billboard/lib/python3.13/selectors.py", line 398, in select
    fd_event_list = self._selector.poll(timeout)
KeyboardInterrupt

[0m21:57:21.572112 [debug] [MainThread]: Resource report: {"command_name": "serve", "command_wall_clock_time": 70.94739, "process_user_time": 0.752901, "process_kernel_time": 0.136263, "process_mem_max_rss": "122978304", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:57:21.573145 [debug] [MainThread]: Command `dbt docs serve` failed at 21:57:21.573016 after 70.95 seconds
[0m21:57:21.573781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dce650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dcf050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107abbe30>]}
[0m21:57:21.574229 [debug] [MainThread]: Flushing usage events
[0m21:57:24.894539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10343e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053f3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053f3c50>]}


============================== 21:57:24.896811 | 0944600d-c522-4670-a684-385ecf154672 ==============================
[0m21:57:24.896811 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:57:24.897125 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m21:57:25.061036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063fa190>]}
[0m21:57:25.083215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063786b0>]}
[0m21:57:25.083631 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:57:25.093020 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:57:25.151431 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 4 files changed.
[0m21:57:25.152023 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/sources.yml
[0m21:57:25.152193 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/hot_100_artists.sql
[0m21:57:25.152327 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/analytics/countries.sql
[0m21:57:25.152456 [debug] [MainThread]: Partial parsing: updated file: billboard_hot_100://models/staging/hot_100_flat.sql
[0m21:57:25.251297 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m21:57:25.251630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '0944600d-c522-4670-a684-385ecf154672', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106892750>]}
[0m21:57:25.416698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aca5d0>]}
[0m21:57:25.465385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053f5c50>]}
[0m21:57:25.465648 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m21:57:25.465805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110133d40>]}
[0m21:57:25.466936 [info ] [MainThread]: 
[0m21:57:25.467207 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:57:25.469164 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m21:57:25.477061 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:57:25.477284 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:57:25.477405 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:25.999600 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.522 seconds
[0m21:57:26.002144 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:57:26.097357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0944600d-c522-4670-a684-385ecf154672', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110317590>]}
[0m21:57:26.098249 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:26.098623 [info ] [MainThread]: 
[0m21:57:26.102198 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:26.102717 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:26.103157 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:26.103523 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:26.103921 [info ] [Thread-1 (]: 1 of 19 START test not_null_countries_country .................................. [RUN]
[0m21:57:26.104373 [info ] [Thread-3 (]: 3 of 19 START test not_null_countries_top_artist ............................... [RUN]
[0m21:57:26.104918 [info ] [Thread-4 (]: 4 of 19 START test not_null_countries_top_genre ................................ [RUN]
[0m21:57:26.105445 [info ] [Thread-2 (]: 2 of 19 START test not_null_countries_top_10_entries ........................... [RUN]
[0m21:57:26.105973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m21:57:26.106406 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_artist.febc298eb0'
[0m21:57:26.106775 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_genre.aa91751aed'
[0m21:57:26.107125 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354'
[0m21:57:26.107427 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:26.107709 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:26.107973 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:26.108235 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:26.125655 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:57:26.126662 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:57:26.129314 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:57:26.131498 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:57:26.132318 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:26.132687 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:26.132946 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:26.138954 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:26.147268 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:57:26.147604 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:57:26.148706 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:57:26.149891 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:57:26.150747 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:57:26.151181 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:57:26.151567 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:57:26.151884 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:57:26.152084 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_artist
from BB_DATABASE.BB_SCHEMA.countries
where top_artist is null



      
    ) dbt_internal_test
[0m21:57:26.152322 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_genre
from BB_DATABASE.BB_SCHEMA.countries
where top_genre is null



      
    ) dbt_internal_test
[0m21:57:26.152566 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_10_entries
from BB_DATABASE.BB_SCHEMA.countries
where top_10_entries is null



      
    ) dbt_internal_test
[0m21:57:26.152764 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_country.69e1905e51"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select country
from BB_DATABASE.BB_SCHEMA.countries
where country is null



      
    ) dbt_internal_test
[0m21:57:26.152961 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:57:26.153120 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:57:26.153281 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:57:26.153439 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:26.467993 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.315 seconds
[0m21:57:26.475313 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: Close
[0m21:57:26.487576 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.334 seconds
[0m21:57:26.488998 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: Close
[0m21:57:26.528515 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.375 seconds
[0m21:57:26.529768 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: Close
[0m21:57:26.569202 [info ] [Thread-4 (]: 4 of 19 PASS not_null_countries_top_genre ...................................... [[32mPASS[0m in 0.46s]
[0m21:57:26.569689 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:26.569951 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:26.570224 [info ] [Thread-4 (]: 5 of 19 START test not_null_countries_top_rank ................................. [RUN]
[0m21:57:26.570524 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m21:57:26.570749 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:26.573068 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:57:26.573574 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:26.574713 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:57:26.575702 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:57:26.576031 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.countries
where top_rank is null



      
    ) dbt_internal_test
[0m21:57:26.576265 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:57:26.588420 [info ] [Thread-2 (]: 2 of 19 PASS not_null_countries_top_10_entries ................................. [[32mPASS[0m in 0.48s]
[0m21:57:26.588835 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:26.589045 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:26.589275 [info ] [Thread-2 (]: 6 of 19 START test not_null_countries_total_artists ............................ [RUN]
[0m21:57:26.589537 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m21:57:26.589726 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:26.591825 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:57:26.592294 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:26.593397 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:57:26.593926 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:57:26.594118 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_artists
from BB_DATABASE.BB_SCHEMA.countries
where total_artists is null



      
    ) dbt_internal_test
[0m21:57:26.594295 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:57:26.616834 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.464 seconds
[0m21:57:26.618017 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: Close
[0m21:57:26.620185 [info ] [Thread-1 (]: 1 of 19 PASS not_null_countries_country ........................................ [[32mPASS[0m in 0.51s]
[0m21:57:26.620494 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:26.620687 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:26.620881 [info ] [Thread-1 (]: 7 of 19 START test not_null_countries_total_entries ............................ [RUN]
[0m21:57:26.621106 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m21:57:26.621274 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:26.623461 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:57:26.623899 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:26.624823 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:57:26.625364 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:57:26.625538 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.countries
where total_entries is null



      
    ) dbt_internal_test
[0m21:57:26.625693 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:26.704866 [info ] [Thread-3 (]: 3 of 19 PASS not_null_countries_top_artist ..................................... [[32mPASS[0m in 0.60s]
[0m21:57:26.705270 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:26.705505 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:26.705757 [info ] [Thread-3 (]: 8 of 19 START test not_null_hot_100_artists_artist ............................. [RUN]
[0m21:57:26.706008 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m21:57:26.706184 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:26.708436 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:57:26.708948 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:26.709909 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:57:26.710356 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:57:26.710523 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is null



      
    ) dbt_internal_test
[0m21:57:26.710678 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:57:26.846224 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.270 seconds
[0m21:57:26.847512 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: Close
[0m21:57:26.887004 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m21:57:26.888324 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: Close
[0m21:57:26.901234 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.275 seconds
[0m21:57:26.902514 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: Close
[0m21:57:26.937428 [info ] [Thread-4 (]: 5 of 19 PASS not_null_countries_top_rank ....................................... [[32mPASS[0m in 0.37s]
[0m21:57:26.938236 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:26.938616 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:26.939003 [info ] [Thread-4 (]: 9 of 19 START test not_null_hot_100_artists_top10_entries ...................... [RUN]
[0m21:57:26.939447 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m21:57:26.939730 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:26.943024 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:57:26.944815 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:26.946608 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:57:26.947554 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:57:26.947876 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top10_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top10_entries is null



      
    ) dbt_internal_test
[0m21:57:26.948107 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:57:26.975444 [info ] [Thread-2 (]: 6 of 19 PASS not_null_countries_total_artists .................................. [[32mPASS[0m in 0.39s]
[0m21:57:26.976017 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:26.976350 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:26.976653 [info ] [Thread-2 (]: 10 of 19 START test not_null_hot_100_artists_top_rank .......................... [RUN]
[0m21:57:26.976985 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m21:57:26.977219 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:26.980503 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:57:26.981183 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:26.982619 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:57:26.983314 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:57:26.983544 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top_rank is null



      
    ) dbt_internal_test
[0m21:57:26.983759 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:57:26.992571 [info ] [Thread-1 (]: 7 of 19 PASS not_null_countries_total_entries .................................. [[32mPASS[0m in 0.37s]
[0m21:57:26.992988 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:26.993321 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:26.993843 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.283 seconds
[0m21:57:26.994086 [info ] [Thread-1 (]: 11 of 19 START test not_null_hot_100_artists_total_entries ..................... [RUN]
[0m21:57:26.995224 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: Close
[0m21:57:26.995460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m21:57:26.996269 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:26.998956 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:57:26.999865 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:27.001149 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:57:27.002087 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:57:27.002404 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where total_entries is null



      
    ) dbt_internal_test
[0m21:57:27.002680 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:27.090879 [info ] [Thread-3 (]: 8 of 19 PASS not_null_hot_100_artists_artist ................................... [[32mPASS[0m in 0.38s]
[0m21:57:27.091289 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:27.091491 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:27.091704 [info ] [Thread-3 (]: 12 of 19 START test not_null_hot_100_flat_artist ............................... [RUN]
[0m21:57:27.091953 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e)
[0m21:57:27.092128 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:27.094292 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:57:27.094761 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:27.096026 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:57:27.096526 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:57:27.096716 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where artist is null



      
    ) dbt_internal_test
[0m21:57:27.096966 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:57:27.218452 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.270 seconds
[0m21:57:27.219948 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: Close
[0m21:57:27.272119 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.269 seconds
[0m21:57:27.273466 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: Close
[0m21:57:27.280171 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.296 seconds
[0m21:57:27.281287 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: Close
[0m21:57:27.303963 [info ] [Thread-4 (]: 9 of 19 PASS not_null_hot_100_artists_top10_entries ............................ [[32mPASS[0m in 0.36s]
[0m21:57:27.304476 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:27.304779 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:27.305116 [info ] [Thread-4 (]: 13 of 19 START test not_null_hot_100_flat_chart_position ....................... [RUN]
[0m21:57:27.305474 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa)
[0m21:57:27.305741 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:27.308400 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:57:27.308966 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:27.310770 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:57:27.311505 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:57:27.311783 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select chart_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where chart_position is null



      
    ) dbt_internal_test
[0m21:57:27.312053 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:57:27.375658 [info ] [Thread-1 (]: 11 of 19 PASS not_null_hot_100_artists_total_entries ........................... [[32mPASS[0m in 0.38s]
[0m21:57:27.376146 [info ] [Thread-2 (]: 10 of 19 PASS not_null_hot_100_artists_top_rank ................................ [[32mPASS[0m in 0.40s]
[0m21:57:27.376572 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:27.376899 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:27.377146 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:27.377357 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:27.377588 [info ] [Thread-1 (]: 14 of 19 START test not_null_hot_100_flat_peak_position ........................ [RUN]
[0m21:57:27.377796 [info ] [Thread-2 (]: 15 of 19 START test not_null_hot_100_flat_song ................................. [RUN]
[0m21:57:27.378041 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m21:57:27.378248 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m21:57:27.378438 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:27.378607 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:27.381105 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:57:27.383122 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:57:27.384130 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:27.384372 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:27.386093 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:57:27.387440 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:57:27.388208 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:57:27.388616 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:57:27.388856 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select song
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where song is null



      
    ) dbt_internal_test
[0m21:57:27.389082 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select peak_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where peak_position is null



      
    ) dbt_internal_test
[0m21:57:27.389273 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:57:27.389431 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:27.421462 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.324 seconds
[0m21:57:27.422794 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: Close
[0m21:57:27.517916 [info ] [Thread-3 (]: 12 of 19 PASS not_null_hot_100_flat_artist ..................................... [[32mPASS[0m in 0.43s]
[0m21:57:27.518338 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:27.518565 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:27.518798 [info ] [Thread-3 (]: 16 of 19 START test not_null_hot_100_flat_weeks_on_chart ....................... [RUN]
[0m21:57:27.519059 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m21:57:27.519248 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:27.521413 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:57:27.521854 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:27.522911 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:57:27.523664 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:57:27.523868 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select weeks_on_chart
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where weeks_on_chart is null



      
    ) dbt_internal_test
[0m21:57:27.524049 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:57:27.658354 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.346 seconds
[0m21:57:27.659715 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: Close
[0m21:57:27.722151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.333 seconds
[0m21:57:27.723321 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: Close
[0m21:57:27.747774 [info ] [Thread-4 (]: 13 of 19 PASS not_null_hot_100_flat_chart_position ............................. [[32mPASS[0m in 0.44s]
[0m21:57:27.748292 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:27.748554 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:27.748730 [info ] [Thread-4 (]: 17 of 19 START test unique_countries_country ................................... [RUN]
[0m21:57:27.748944 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m21:57:27.749168 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:27.752888 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:57:27.753430 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:27.754375 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:57:27.755212 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:57:27.755386 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_country.6b59afdd31"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    country as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where country is not null
group by country
having count(*) > 1



      
    ) dbt_internal_test
[0m21:57:27.755635 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:57:27.782904 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.394 seconds
[0m21:57:27.784078 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: Close
[0m21:57:27.815877 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.292 seconds
[0m21:57:27.816897 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: Close
[0m21:57:27.826967 [info ] [Thread-1 (]: 14 of 19 PASS not_null_hot_100_flat_peak_position .............................. [[32mPASS[0m in 0.45s]
[0m21:57:27.827297 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:27.827490 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:27.827645 [info ] [Thread-1 (]: 18 of 19 START test unique_countries_top_artist ................................ [RUN]
[0m21:57:27.827911 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m21:57:27.828110 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:27.830618 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:57:27.831086 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:27.831986 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:57:27.832454 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:57:27.832627 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_top_artist.00910d9681"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    top_artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where top_artist is not null
group by top_artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:57:27.832785 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:27.869775 [info ] [Thread-2 (]: 15 of 19 PASS not_null_hot_100_flat_song ....................................... [[32mPASS[0m in 0.49s]
[0m21:57:27.870118 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:27.870300 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:27.870449 [info ] [Thread-2 (]: 19 of 19 START test unique_hot_100_artists_artist .............................. [RUN]
[0m21:57:27.870742 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m21:57:27.871040 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:27.873241 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:57:27.874881 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:27.876030 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:57:27.876909 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:57:27.877107 [debug] [Thread-2 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is not null
group by artist
having count(*) > 1



      
    ) dbt_internal_test
[0m21:57:27.877271 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:57:27.910163 [info ] [Thread-3 (]: 16 of 19 PASS not_null_hot_100_flat_weeks_on_chart ............................. [[32mPASS[0m in 0.39s]
[0m21:57:27.910663 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:28.010129 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.254 seconds
[0m21:57:28.011344 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: Close
[0m21:57:28.085379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.253 seconds
[0m21:57:28.086873 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: Close
[0m21:57:28.105213 [info ] [Thread-4 (]: 17 of 19 PASS unique_countries_country ......................................... [[32mPASS[0m in 0.36s]
[0m21:57:28.105962 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:28.170407 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.293 seconds
[0m21:57:28.173306 [debug] [Thread-2 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: Close
[0m21:57:28.183153 [info ] [Thread-1 (]: 18 of 19 PASS unique_countries_top_artist ...................................... [[32mPASS[0m in 0.36s]
[0m21:57:28.183556 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:28.263702 [info ] [Thread-2 (]: 19 of 19 PASS unique_hot_100_artists_artist .................................... [[32mPASS[0m in 0.39s]
[0m21:57:28.264801 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:28.266902 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:28.267387 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m21:57:28.267746 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd' was properly closed.
[0m21:57:28.268023 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m21:57:28.268268 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45' was properly closed.
[0m21:57:28.268607 [info ] [MainThread]: 
[0m21:57:28.268950 [info ] [MainThread]: Finished running 19 data tests in 0 hours 0 minutes and 2.80 seconds (2.80s).
[0m21:57:28.272434 [debug] [MainThread]: Command end result
[0m21:57:28.302389 [info ] [MainThread]: 
[0m21:57:28.302743 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:57:28.302942 [info ] [MainThread]: 
[0m21:57:28.303132 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=0 SKIP=0 TOTAL=19
[0m21:57:28.304281 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 3.4398007, "process_user_time": 1.892967, "process_kernel_time": 0.239103, "process_mem_max_rss": "153796608", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:57:28.304592 [debug] [MainThread]: Command `dbt test` succeeded at 21:57:28.304538 after 3.44 seconds
[0m21:57:28.304807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110361650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105d5630>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105d5130>]}
[0m21:57:28.304998 [debug] [MainThread]: Flushing usage events
[0m21:57:31.777426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10343a660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105befed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105befc50>]}


============================== 21:57:31.779602 | 00af19cf-5992-4bec-9ab9-de6c19e22f1c ==============================
[0m21:57:31.779602 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:57:31.779907 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:57:31.941985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069fa190>]}
[0m21:57:31.964852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069786b0>]}
[0m21:57:31.965413 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:57:31.974922 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:57:32.033455 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:57:32.033713 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:57:32.053143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d4f750>]}
[0m21:57:32.097645 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069bb6b0>]}
[0m21:57:32.097896 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m21:57:32.098059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070c6510>]}
[0m21:57:32.099082 [info ] [MainThread]: 
[0m21:57:32.099361 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:57:32.101308 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE'
[0m21:57:32.108501 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE"
[0m21:57:32.108719 [debug] [ThreadPool]: On list_BB_DATABASE: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE"} */
show terse schemas in database BB_DATABASE
    limit 10000
[0m21:57:32.108857 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:32.820483 [debug] [ThreadPool]: SQL status: SUCCESS 3 in 0.712 seconds
[0m21:57:32.822123 [debug] [ThreadPool]: On list_BB_DATABASE: Close
[0m21:57:32.912128 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_BB_DATABASE, now list_BB_DATABASE_BB_SCHEMA)
[0m21:57:32.927041 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:57:32.927434 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:57:32.927667 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:57:33.268618 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.341 seconds
[0m21:57:33.272611 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:57:33.403880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10712e270>]}
[0m21:57:33.404777 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:33.405150 [info ] [MainThread]: 
[0m21:57:33.408504 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:57:33.409125 [info ] [Thread-1 (]: 1 of 3 START sql view model BB_SCHEMA.hot_100_flat ............................. [RUN]
[0m21:57:33.409584 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:57:33.409894 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:57:33.418575 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:57:33.419780 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:57:33.485821 [debug] [Thread-1 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_flat"
[0m21:57:33.487161 [debug] [Thread-1 (]: Using snowflake connection "model.billboard_hot_100.hot_100_flat"
[0m21:57:33.487387 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_flat"} */
create or replace   view BB_DATABASE.BB_SCHEMA.hot_100_flat
  
   as (
    -- models/hot_100_flat_SQL.sql

WITH
    split_artists AS (
        SELECT
            b.*,
            SPLIT(REGEXP_REPLACE(ARTIST, ' & | Feat\\.', '|'), '|') AS artist_parts
        FROM BB_DATABASE.BB_SCHEMA.billboard_hot_100 b
    ),
    exploded_artists AS (
        SELECT
            b.*,
            TRIM(a.value::STRING) AS split_artist
        FROM split_artists b,
        LATERAL FLATTEN(input => b.artist_parts) a
    ),
    validated_artists AS (
        SELECT
            ea.*,
            CASE 
                WHEN va.artist_name IS NOT NULL THEN ea.split_artist
                ELSE ea.artist  -- Keep original artist if validation fails
            END AS final_artist
        FROM exploded_artists ea
        LEFT JOIN BB_DATABASE.BB_SCHEMA.artist_data va 
            ON LOWER(ea.split_artist) = LOWER(va.artist_name)
    )
SELECT
    chart_position,
    song,
    final_artist AS artist,
    last_week,
    peak_position,
    weeks_on_chart
FROM validated_artists
ORDER BY chart_position ASC, artist ASC
  );
[0m21:57:33.487576 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:57:34.058294 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.570 seconds
[0m21:57:34.084668 [debug] [Thread-1 (]: On model.billboard_hot_100.hot_100_flat: Close
[0m21:57:34.212742 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071df7d0>]}
[0m21:57:34.213827 [info ] [Thread-1 (]: 1 of 3 OK created sql view model BB_SCHEMA.hot_100_flat ........................ [[32mSUCCESS 1[0m in 0.80s]
[0m21:57:34.214692 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:57:34.215974 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:57:34.216633 [info ] [Thread-2 (]: 2 of 3 START sql table model BB_SCHEMA.hot_100_artists ......................... [RUN]
[0m21:57:34.217303 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:57:34.217670 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:57:34.221452 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:57:34.222706 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:57:34.241836 [debug] [Thread-2 (]: Writing runtime sql for node "model.billboard_hot_100.hot_100_artists"
[0m21:57:34.243245 [debug] [Thread-2 (]: Using snowflake connection "model.billboard_hot_100.hot_100_artists"
[0m21:57:34.243525 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.hot_100_artists"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.hot_100_artists
         as
        (-- models/hot_100_artists.sql

WITH 
    billboard_data AS (
        SELECT artist,
            MIN(chart_position) AS top_rank,
            COUNT(*) AS total_entries,
            COUNT(CASE WHEN chart_position <= 10 THEN 1 END) AS top10_entries
        FROM BB_DATABASE.BB_SCHEMA.hot_100_flat
        GROUP BY artist
    ),
    artist_data AS (
        SELECT * FROM BB_DATABASE.BB_SCHEMA.artist_data
    )

SELECT DISTINCT
    billboard_data.artist,
    billboard_data.top_rank,
    billboard_data.total_entries,
    billboard_data.top10_entries,
    artist_data.country,
    artist_data.genre
FROM billboard_data
LEFT JOIN artist_data
    ON LOWER(billboard_data.artist) = LOWER(artist_data.artist_name)
        );
[0m21:57:34.243766 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m21:57:35.167184 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.923 seconds
[0m21:57:35.172208 [debug] [Thread-2 (]: On model.billboard_hot_100.hot_100_artists: Close
[0m21:57:35.263494 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105953ee0>]}
[0m21:57:35.264371 [info ] [Thread-2 (]: 2 of 3 OK created sql table model BB_SCHEMA.hot_100_artists .................... [[32mSUCCESS 1[0m in 1.05s]
[0m21:57:35.265041 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:57:35.265952 [debug] [Thread-3 (]: Began running node model.billboard_hot_100.countries
[0m21:57:35.266520 [info ] [Thread-3 (]: 3 of 3 START sql table model BB_SCHEMA.countries ............................... [RUN]
[0m21:57:35.267073 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.billboard_hot_100.countries'
[0m21:57:35.267394 [debug] [Thread-3 (]: Began compiling node model.billboard_hot_100.countries
[0m21:57:35.270863 [debug] [Thread-3 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:57:35.271971 [debug] [Thread-3 (]: Began executing node model.billboard_hot_100.countries
[0m21:57:35.274806 [debug] [Thread-3 (]: Writing runtime sql for node "model.billboard_hot_100.countries"
[0m21:57:35.277180 [debug] [Thread-3 (]: Using snowflake connection "model.billboard_hot_100.countries"
[0m21:57:35.277651 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "model.billboard_hot_100.countries"} */
create or replace transient table BB_DATABASE.BB_SCHEMA.countries
         as
        (-- models/countries.sql

WITH ranked_artists AS (
    SELECT
        country,
        artist,
        top_rank,
        ROW_NUMBER() OVER (PARTITION BY COUNTRY ORDER BY top_rank ASC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
),
ranked_genres AS (
    SELECT 
        genre,
        COUNT(*) as genre_count,
        ROW_NUMBER() OVER (PARTITION BY country ORDER BY COUNT(*) DESC) AS rank
    FROM BB_DATABASE.BB_SCHEMA.hot_100_artists
    GROUP BY country, genre
)

SELECT
    a.country,
    COUNT(*) AS total_entries,
    COUNT(DISTINCT a.artist) AS total_artists,
    SUM(a.top10_entries) AS top_10_entries,
    MIN(a.top_rank) AS top_rank,
    MAX(CASE WHEN ra.rank = 1 THEN ra.artist END) AS top_artist,
    MAX(CASE WHEN rg.rank = 1 THEN rg.genre END) AS top_genre
FROM BB_DATABASE.BB_SCHEMA.hot_100_artists AS a
LEFT JOIN ranked_artists AS ra ON a.country = ra.country
LEFT JOIN ranked_genres AS rg ON a.genre = rg.genre
GROUP BY a.country
ORDER BY total_entries DESC
        );
[0m21:57:35.277985 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m21:57:36.325420 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.047 seconds
[0m21:57:36.329369 [debug] [Thread-3 (]: On model.billboard_hot_100.countries: Close
[0m21:57:36.640287 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '00af19cf-5992-4bec-9ab9-de6c19e22f1c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069da670>]}
[0m21:57:36.641088 [info ] [Thread-3 (]: 3 of 3 OK created sql table model BB_SCHEMA.countries .......................... [[32mSUCCESS 1[0m in 1.37s]
[0m21:57:36.641602 [debug] [Thread-3 (]: Finished running node model.billboard_hot_100.countries
[0m21:57:36.642981 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:36.643285 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_flat' was properly closed.
[0m21:57:36.643508 [debug] [MainThread]: Connection 'model.billboard_hot_100.hot_100_artists' was properly closed.
[0m21:57:36.643701 [debug] [MainThread]: Connection 'model.billboard_hot_100.countries' was properly closed.
[0m21:57:36.644043 [info ] [MainThread]: 
[0m21:57:36.644300 [info ] [MainThread]: Finished running 1 view model, 2 table models in 0 hours 0 minutes and 4.54 seconds (4.54s).
[0m21:57:36.645047 [debug] [MainThread]: Command end result
[0m21:57:36.666888 [info ] [MainThread]: 
[0m21:57:36.667205 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:57:36.667392 [info ] [MainThread]: 
[0m21:57:36.667570 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m21:57:36.668686 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.9205203, "process_user_time": 1.280657, "process_kernel_time": 0.164719, "process_mem_max_rss": "140181504", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:57:36.668990 [debug] [MainThread]: Command `dbt run` succeeded at 21:57:36.668932 after 4.92 seconds
[0m21:57:36.669206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10699b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059fa8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c16350>]}
[0m21:57:36.669396 [debug] [MainThread]: Flushing usage events
[0m21:57:39.965797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10323e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aefed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aefd90>]}


============================== 21:57:39.968738 | bb4d411d-0f76-4935-98f4-49539c05f346 ==============================
[0m21:57:39.968738 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:57:39.969052 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt docs generate', 'send_anonymous_usage_stats': 'True'}
[0m21:57:40.122769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068f62c0>]}
[0m21:57:40.145328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068786b0>]}
[0m21:57:40.145737 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m21:57:40.155307 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m21:57:40.213380 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:57:40.213635 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:57:40.233088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d93750>]}
[0m21:57:40.240203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fb57c0>]}
[0m21:57:40.240437 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m21:57:40.240597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10687f070>]}
[0m21:57:40.241714 [info ] [MainThread]: 
[0m21:57:40.241981 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m21:57:40.243928 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m21:57:40.254369 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m21:57:40.254623 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m21:57:40.254763 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:40.625961 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.371 seconds
[0m21:57:40.629531 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m21:57:40.747910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb4d411d-0f76-4935-98f4-49539c05f346', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107010870>]}
[0m21:57:40.748685 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:57:40.749051 [info ] [MainThread]: 
[0m21:57:40.752257 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.hot_100_flat
[0m21:57:40.752787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now model.billboard_hot_100.hot_100_flat)
[0m21:57:40.753142 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.hot_100_flat
[0m21:57:40.761100 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_flat"
[0m21:57:40.762366 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.hot_100_flat
[0m21:57:40.763647 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.hot_100_flat
[0m21:57:40.764477 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:40.764834 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:40.765193 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:40.765618 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa'
[0m21:57:40.765941 [debug] [Thread-2 (]: Began running node model.billboard_hot_100.hot_100_artists
[0m21:57:40.766354 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e'
[0m21:57:40.766646 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_flat, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m21:57:40.766899 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:40.767201 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.billboard_hot_100.hot_100_artists'
[0m21:57:40.767448 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:40.767786 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:40.768926 [debug] [Thread-2 (]: Began compiling node model.billboard_hot_100.hot_100_artists
[0m21:57:40.777474 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m21:57:40.779876 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m21:57:40.782300 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m21:57:40.783755 [debug] [Thread-2 (]: Writing injected SQL for node "model.billboard_hot_100.hot_100_artists"
[0m21:57:40.784399 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:40.784692 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:40.785126 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m21:57:40.785337 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:40.785738 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m21:57:40.785943 [debug] [Thread-2 (]: Began executing node model.billboard_hot_100.hot_100_artists
[0m21:57:40.786149 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:40.786548 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m21:57:40.786773 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:40.787135 [debug] [Thread-2 (]: Finished running node model.billboard_hot_100.hot_100_artists
[0m21:57:40.787345 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m21:57:40.787616 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m21:57:40.787959 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:40.788151 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:40.788331 [debug] [Thread-1 (]: Began running node model.billboard_hot_100.countries
[0m21:57:40.788520 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:40.790849 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m21:57:40.791080 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.hot_100_artists, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m21:57:40.791277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now model.billboard_hot_100.countries)
[0m21:57:40.793728 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m21:57:40.794075 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:40.794326 [debug] [Thread-1 (]: Began compiling node model.billboard_hot_100.countries
[0m21:57:40.796590 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m21:57:40.798263 [debug] [Thread-1 (]: Writing injected SQL for node "model.billboard_hot_100.countries"
[0m21:57:40.798936 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:40.799124 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:40.799292 [debug] [Thread-1 (]: Began executing node model.billboard_hot_100.countries
[0m21:57:40.799635 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m21:57:40.799794 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:40.800263 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m21:57:40.800622 [debug] [Thread-1 (]: Finished running node model.billboard_hot_100.countries
[0m21:57:40.800840 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:40.801243 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m21:57:40.801483 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:40.801710 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:40.801917 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m21:57:40.804735 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:40.804971 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m21:57:40.805150 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.billboard_hot_100.countries, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m21:57:40.805316 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:40.805479 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m21:57:40.805632 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:40.805783 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:40.807587 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m21:57:40.807767 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:40.809530 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m21:57:40.846581 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m21:57:40.849399 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m21:57:40.849885 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:40.850084 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:40.850430 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m21:57:40.850570 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:40.850734 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:40.850983 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m21:57:40.851154 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:40.851405 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m21:57:40.851666 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m21:57:40.851823 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:40.851977 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m21:57:40.852147 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:40.852297 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:40.852460 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354)
[0m21:57:40.852598 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:40.852736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_countries_top_artist.febc298eb0)
[0m21:57:40.852873 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_countries_top_genre.aa91751aed)
[0m21:57:40.853008 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:40.854761 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m21:57:40.854924 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:40.855090 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:40.856800 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m21:57:40.858394 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m21:57:40.860113 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m21:57:40.860520 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:40.860822 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m21:57:40.860992 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:40.861153 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m21:57:40.861342 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:40.861502 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:40.861807 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m21:57:40.861956 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:40.862100 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:40.863666 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m21:57:40.863863 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:40.864170 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m21:57:40.864430 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m21:57:40.864635 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m21:57:40.864825 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:40.864998 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:40.865135 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:40.865271 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:40.865422 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m21:57:40.865585 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m21:57:40.865844 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m21:57:40.867650 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m21:57:40.867826 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:40.867970 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:40.868136 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:40.869642 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m21:57:40.871200 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m21:57:40.871375 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m21:57:40.871615 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:40.873371 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m21:57:40.873565 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:40.873711 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:40.873990 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m21:57:40.874176 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:40.874450 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m21:57:40.874758 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m21:57:40.874896 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:40.875253 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m21:57:40.875762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:57:40.875884 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m21:57:40.875993 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f' was properly closed.
[0m21:57:40.876084 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6' was properly closed.
[0m21:57:40.876173 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m21:57:40.877366 [debug] [MainThread]: Command end result
[0m21:57:40.920828 [debug] [MainThread]: Acquiring new snowflake connection 'generate_catalog'
[0m21:57:40.921063 [info ] [MainThread]: Building catalog
[0m21:57:40.925775 [debug] [ThreadPool]: Acquiring new snowflake connection 'BB_DATABASE.information_schema'
[0m21:57:40.933491 [debug] [ThreadPool]: Using snowflake connection "BB_DATABASE.information_schema"
[0m21:57:40.933892 [debug] [ThreadPool]: On BB_DATABASE.information_schema: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "BB_DATABASE.information_schema"} */
with tables as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",
        case
            when is_dynamic = 'YES' and table_type = 'BASE TABLE' THEN 'DYNAMIC TABLE'
            else table_type
        end as "table_type",
        comment as "table_comment",

        -- note: this is the _role_ that owns the table
        table_owner as "table_owner",

        'Clustering Key' as "stats:clustering_key:label",
        clustering_key as "stats:clustering_key:value",
        'The key used to cluster this table' as "stats:clustering_key:description",
        (clustering_key is not null) as "stats:clustering_key:include",

        'Row Count' as "stats:row_count:label",
        row_count as "stats:row_count:value",
        'An approximate count of rows in this table' as "stats:row_count:description",
        (row_count is not null) as "stats:row_count:include",

        'Approximate Size' as "stats:bytes:label",
        bytes as "stats:bytes:value",
        'Approximate size of the table as reported by Snowflake' as "stats:bytes:description",
        (bytes is not null) as "stats:bytes:include",

        'Last Modified' as "stats:last_modified:label",
        to_varchar(convert_timezone('UTC', last_altered), 'yyyy-mm-dd HH24:MI'||'UTC') as "stats:last_modified:value",
        'The timestamp for last update/change' as "stats:last_modified:description",
        (last_altered is not null and table_type='BASE TABLE') as "stats:last_modified:include"
    from BB_DATABASE.INFORMATION_SCHEMA.tables
            where (
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'billboard_hot_100' and upper("table_name") = upper('billboard_hot_100')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_flat' and upper("table_name") = upper('hot_100_flat')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'countries' and upper("table_name") = upper('countries')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'artist_data' and upper("table_name") = upper('artist_data')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_artists' and upper("table_name") = upper('hot_100_artists')

                )
            )
        ),
        columns as (
            select
        table_catalog as "table_database",
        table_schema as "table_schema",
        table_name as "table_name",

        column_name as "column_name",
        ordinal_position as "column_index",
        data_type as "column_type",
        comment as "column_comment"
    from BB_DATABASE.INFORMATION_SCHEMA.columns
            where (
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'billboard_hot_100' and upper("table_name") = upper('billboard_hot_100')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_flat' and upper("table_name") = upper('hot_100_flat')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'countries' and upper("table_name") = upper('countries')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'artist_data' and upper("table_name") = upper('artist_data')

                )
             or 
                (
                    
    "table_schema" ilike 'BB_SCHEMA' and upper("table_schema") = upper('BB_SCHEMA')

                    and 
    "table_name" ilike 'hot_100_artists' and upper("table_name") = upper('hot_100_artists')

                )
            )
        )
        select *
    from tables
    join columns using ("table_database", "table_schema", "table_name")
    order by "column_index"
[0m21:57:40.934176 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:57:43.313293 [debug] [ThreadPool]: SQL status: SUCCESS 28 in 2.379 seconds
[0m21:57:43.325236 [debug] [ThreadPool]: On BB_DATABASE.information_schema: Close
[0m21:57:43.452222 [info ] [MainThread]: Catalog written to /Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/target/catalog.json
[0m21:57:43.453501 [debug] [MainThread]: Resource report: {"command_name": "generate", "command_success": true, "command_wall_clock_time": 3.517679, "process_user_time": 1.125167, "process_kernel_time": 0.148706, "process_mem_max_rss": "138788864", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m21:57:43.453875 [debug] [MainThread]: Command `dbt docs generate` succeeded at 21:57:43.453816 after 3.52 seconds
[0m21:57:43.454071 [debug] [MainThread]: Connection 'generate_catalog' was properly closed.
[0m21:57:43.454233 [debug] [MainThread]: Connection 'BB_DATABASE.information_schema' was properly closed.
[0m21:57:43.454418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058a1cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107267960>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107267a10>]}
[0m21:57:43.454634 [debug] [MainThread]: Flushing usage events
[0m21:57:47.936033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e3e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068b7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068b7d90>]}


============================== 21:57:47.938384 | e0107e3d-98b6-4e3c-9e05-cb4ce26dcb08 ==============================
[0m21:57:47.938384 [info ] [MainThread]: Running with dbt=1.8.8
[0m21:57:47.938708 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m21:57:48.108015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e0107e3d-98b6-4e3c-9e05-cb4ce26dcb08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075f62c0>]}
[0m21:57:48.133611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e0107e3d-98b6-4e3c-9e05-cb4ce26dcb08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075607c0>]}
[0m22:32:12.929428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10338e660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b3c50>]}


============================== 22:32:12.931628 | 85aad3d3-a04e-4d3e-8902-a7fed5d46f38 ==============================
[0m22:32:12.931628 [info ] [MainThread]: Running with dbt=1.8.8
[0m22:32:12.931968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'version_check': 'True', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt test', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m22:32:13.197085 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106bfa190>]}
[0m22:32:13.219110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b786b0>]}
[0m22:32:13.219700 [info ] [MainThread]: Registered adapter: snowflake=1.8.4
[0m22:32:13.236003 [debug] [MainThread]: checksum: ec53e341a936509427e16df1c646386a84befec52c1957e3f4359fbc36fc93f5, vars: {}, profile: , target: , version: 1.8.8
[0m22:32:13.310450 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:32:13.310714 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:32:13.329731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e87750>]}
[0m22:32:13.392679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107326030>]}
[0m22:32:13.392964 [info ] [MainThread]: Found 3 models, 19 data tests, 2 sources, 454 macros
[0m22:32:13.393142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10724f690>]}
[0m22:32:13.394343 [info ] [MainThread]: 
[0m22:32:13.394638 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m22:32:13.396620 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_BB_DATABASE_BB_SCHEMA'
[0m22:32:13.404969 [debug] [ThreadPool]: Using snowflake connection "list_BB_DATABASE_BB_SCHEMA"
[0m22:32:13.405206 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "connection_name": "list_BB_DATABASE_BB_SCHEMA"} */
show objects in BB_DATABASE.BB_SCHEMA limit 10000
[0m22:32:13.405341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:32:14.189186 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.784 seconds
[0m22:32:14.192870 [debug] [ThreadPool]: On list_BB_DATABASE_BB_SCHEMA: Close
[0m22:32:14.403885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85aad3d3-a04e-4d3e-8902-a7fed5d46f38', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073776c0>]}
[0m22:32:14.404722 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:32:14.405085 [info ] [MainThread]: 
[0m22:32:14.409750 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m22:32:14.410203 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m22:32:14.410562 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m22:32:14.410975 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m22:32:14.411362 [info ] [Thread-4 (]: 4 of 19 START test not_null_countries_top_genre ................................ [RUN]
[0m22:32:14.411890 [info ] [Thread-3 (]: 3 of 19 START test not_null_countries_top_artist ............................... [RUN]
[0m22:32:14.412235 [info ] [Thread-1 (]: 1 of 19 START test not_null_countries_country .................................. [RUN]
[0m22:32:14.412539 [info ] [Thread-2 (]: 2 of 19 START test not_null_countries_top_10_entries ........................... [RUN]
[0m22:32:14.413023 [debug] [Thread-4 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_genre.aa91751aed'
[0m22:32:14.413367 [debug] [Thread-3 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_artist.febc298eb0'
[0m22:32:14.413645 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_BB_DATABASE_BB_SCHEMA, now test.billboard_hot_100.not_null_countries_country.69e1905e51)
[0m22:32:14.413956 [debug] [Thread-2 (]: Acquiring new snowflake connection 'test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354'
[0m22:32:14.414218 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m22:32:14.414460 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m22:32:14.414693 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m22:32:14.414922 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m22:32:14.431782 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m22:32:14.432219 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m22:32:14.434432 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m22:32:14.436698 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m22:32:14.437825 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m22:32:14.443873 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m22:32:14.444163 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m22:32:14.449806 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m22:32:14.450185 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m22:32:14.451589 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m22:32:14.452739 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m22:32:14.454219 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m22:32:14.454969 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"
[0m22:32:14.455221 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_10_entries
from BB_DATABASE.BB_SCHEMA.countries
where top_10_entries is null



      
    ) dbt_internal_test
[0m22:32:14.455423 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m22:32:14.456334 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"
[0m22:32:14.456985 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"
[0m22:32:14.457217 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_artist.febc298eb0"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_artist
from BB_DATABASE.BB_SCHEMA.countries
where top_artist is null



      
    ) dbt_internal_test
[0m22:32:14.457528 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_genre.aa91751aed"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_genre
from BB_DATABASE.BB_SCHEMA.countries
where top_genre is null



      
    ) dbt_internal_test
[0m22:32:14.457889 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_country.69e1905e51"
[0m22:32:14.458294 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m22:32:14.458689 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:32:14.458915 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_country.69e1905e51"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select country
from BB_DATABASE.BB_SCHEMA.countries
where country is null



      
    ) dbt_internal_test
[0m22:32:14.460027 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:15.228697 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.773 seconds
[0m22:32:15.243187 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.784 seconds
[0m22:32:15.243920 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.784 seconds
[0m22:32:15.246885 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_genre.aa91751aed: Close
[0m22:32:15.247474 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.789 seconds
[0m22:32:15.247800 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354: Close
[0m22:32:15.249181 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_country.69e1905e51: Close
[0m22:32:15.251640 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_countries_top_artist.febc298eb0: Close
[0m22:32:15.344496 [info ] [Thread-4 (]: 4 of 19 PASS not_null_countries_top_genre ...................................... [[32mPASS[0m in 0.93s]
[0m22:32:15.345267 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_genre.aa91751aed
[0m22:32:15.345870 [info ] [Thread-1 (]: 1 of 19 PASS not_null_countries_country ........................................ [[32mPASS[0m in 0.93s]
[0m22:32:15.346397 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m22:32:15.347516 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_country.69e1905e51
[0m22:32:15.347925 [info ] [Thread-4 (]: 5 of 19 START test not_null_countries_top_rank ................................. [RUN]
[0m22:32:15.348432 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m22:32:15.348930 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_genre.aa91751aed, now test.billboard_hot_100.not_null_countries_top_rank.714d47b80e)
[0m22:32:15.349386 [info ] [Thread-1 (]: 6 of 19 START test not_null_countries_total_artists ............................ [RUN]
[0m22:32:15.349807 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m22:32:15.350918 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_country.69e1905e51, now test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6)
[0m22:32:15.350499 [info ] [Thread-2 (]: 2 of 19 PASS not_null_countries_top_10_entries ................................. [[32mPASS[0m in 0.94s]
[0m22:32:15.354879 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m22:32:15.355262 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m22:32:15.355761 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354
[0m22:32:15.358981 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m22:32:15.359470 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m22:32:15.360314 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m22:32:15.360033 [info ] [Thread-2 (]: 7 of 19 START test not_null_countries_total_entries ............................ [RUN]
[0m22:32:15.361666 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_10_entries.7b736dd354, now test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f)
[0m22:32:15.362043 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m22:32:15.362421 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m22:32:15.365560 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m22:32:15.367436 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m22:32:15.369032 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m22:32:15.370577 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m22:32:15.372066 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m22:32:15.373213 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"
[0m22:32:15.372625 [info ] [Thread-3 (]: 3 of 19 PASS not_null_countries_top_artist ..................................... [[32mPASS[0m in 0.96s]
[0m22:32:15.373624 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_artists
from BB_DATABASE.BB_SCHEMA.countries
where total_artists is null



      
    ) dbt_internal_test
[0m22:32:15.374137 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"
[0m22:32:15.375097 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_countries_top_artist.febc298eb0
[0m22:32:15.375383 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:15.375858 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"
[0m22:32:15.376090 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_top_rank.714d47b80e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.countries
where top_rank is null



      
    ) dbt_internal_test
[0m22:32:15.376380 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m22:32:15.376700 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.countries
where total_entries is null



      
    ) dbt_internal_test
[0m22:32:15.377425 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:32:15.377980 [info ] [Thread-3 (]: 8 of 19 START test not_null_hot_100_artists_artist ............................. [RUN]
[0m22:32:15.378352 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:15.379292 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_artist.febc298eb0, now test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344)
[0m22:32:15.380011 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m22:32:15.382685 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m22:32:15.383974 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m22:32:15.385604 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m22:32:15.386718 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"
[0m22:32:15.387007 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is null



      
    ) dbt_internal_test
[0m22:32:15.387222 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:32:15.721158 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.346 seconds
[0m22:32:15.722707 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6: Close
[0m22:32:15.733801 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.347 seconds
[0m22:32:15.735121 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344: Close
[0m22:32:15.807785 [info ] [Thread-1 (]: 6 of 19 PASS not_null_countries_total_artists .................................. [[32mPASS[0m in 0.46s]
[0m22:32:15.808353 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6
[0m22:32:15.808613 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m22:32:15.808930 [info ] [Thread-1 (]: 9 of 19 START test not_null_hot_100_artists_top10_entries ...................... [RUN]
[0m22:32:15.809264 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_artists.10e461d9f6, now test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18)
[0m22:32:15.809500 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m22:32:15.812378 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m22:32:15.814539 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m22:32:15.815800 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m22:32:15.817367 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"
[0m22:32:15.817687 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top10_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top10_entries is null



      
    ) dbt_internal_test
[0m22:32:15.817902 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:15.824672 [info ] [Thread-3 (]: 8 of 19 PASS not_null_hot_100_artists_artist ................................... [[32mPASS[0m in 0.45s]
[0m22:32:15.825046 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344
[0m22:32:15.825261 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m22:32:15.825472 [info ] [Thread-3 (]: 10 of 19 START test not_null_hot_100_artists_top_rank .......................... [RUN]
[0m22:32:15.825684 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_artist.3ae13e6344, now test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae)
[0m22:32:15.825862 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m22:32:15.828429 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m22:32:15.829418 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m22:32:15.830681 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m22:32:15.831633 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"
[0m22:32:15.831839 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select top_rank
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where top_rank is null



      
    ) dbt_internal_test
[0m22:32:15.832022 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:32:15.997393 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.620 seconds
[0m22:32:15.999108 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_countries_top_rank.714d47b80e: Close
[0m22:32:16.027970 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.650 seconds
[0m22:32:16.029295 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f: Close
[0m22:32:16.097710 [info ] [Thread-4 (]: 5 of 19 PASS not_null_countries_top_rank ....................................... [[32mPASS[0m in 0.75s]
[0m22:32:16.098519 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_countries_top_rank.714d47b80e
[0m22:32:16.098998 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m22:32:16.099487 [info ] [Thread-4 (]: 11 of 19 START test not_null_hot_100_artists_total_entries ..................... [RUN]
[0m22:32:16.099982 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_top_rank.714d47b80e, now test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd)
[0m22:32:16.100331 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m22:32:16.104663 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m22:32:16.106868 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m22:32:16.108797 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m22:32:16.112059 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"
[0m22:32:16.112533 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select total_entries
from BB_DATABASE.BB_SCHEMA.hot_100_artists
where total_entries is null



      
    ) dbt_internal_test
[0m22:32:16.112951 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:32:16.134457 [info ] [Thread-2 (]: 7 of 19 PASS not_null_countries_total_entries .................................. [[32mPASS[0m in 0.77s]
[0m22:32:16.135004 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f
[0m22:32:16.135340 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m22:32:16.135639 [info ] [Thread-2 (]: 12 of 19 START test not_null_hot_100_flat_artist ............................... [RUN]
[0m22:32:16.135973 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_countries_total_entries.81ef2d247f, now test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e)
[0m22:32:16.136281 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m22:32:16.142925 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m22:32:16.144303 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m22:32:16.145733 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m22:32:16.146466 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"
[0m22:32:16.146708 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select artist
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where artist is null



      
    ) dbt_internal_test
[0m22:32:16.146927 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:16.152789 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.335 seconds
[0m22:32:16.154049 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18: Close
[0m22:32:16.252206 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.420 seconds
[0m22:32:16.253618 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae: Close
[0m22:32:16.284600 [info ] [Thread-1 (]: 9 of 19 PASS not_null_hot_100_artists_top10_entries ............................ [[32mPASS[0m in 0.48s]
[0m22:32:16.285009 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18
[0m22:32:16.285278 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m22:32:16.285504 [info ] [Thread-1 (]: 13 of 19 START test not_null_hot_100_flat_chart_position ....................... [RUN]
[0m22:32:16.285838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top10_entries.7a1445ab18, now test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa)
[0m22:32:16.286114 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m22:32:16.288708 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m22:32:16.289285 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m22:32:16.290535 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m22:32:16.291307 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"
[0m22:32:16.291577 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select chart_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where chart_position is null



      
    ) dbt_internal_test
[0m22:32:16.292330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:16.366806 [info ] [Thread-3 (]: 10 of 19 PASS not_null_hot_100_artists_top_rank ................................ [[32mPASS[0m in 0.54s]
[0m22:32:16.367268 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae
[0m22:32:16.367523 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m22:32:16.367795 [info ] [Thread-3 (]: 14 of 19 START test not_null_hot_100_flat_peak_position ........................ [RUN]
[0m22:32:16.368076 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_top_rank.0907da27ae, now test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203)
[0m22:32:16.368287 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m22:32:16.371227 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m22:32:16.372983 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m22:32:16.374169 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m22:32:16.374883 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"
[0m22:32:16.375100 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select peak_position
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where peak_position is null



      
    ) dbt_internal_test
[0m22:32:16.375273 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:32:16.555413 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.442 seconds
[0m22:32:16.557325 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd: Close
[0m22:32:16.589750 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.443 seconds
[0m22:32:16.591271 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e: Close
[0m22:32:16.649058 [info ] [Thread-4 (]: 11 of 19 PASS not_null_hot_100_artists_total_entries ........................... [[32mPASS[0m in 0.55s]
[0m22:32:16.649846 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd
[0m22:32:16.650294 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m22:32:16.650765 [info ] [Thread-4 (]: 15 of 19 START test not_null_hot_100_flat_song ................................. [RUN]
[0m22:32:16.651305 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_artists_total_entries.fafda59cbd, now test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987)
[0m22:32:16.651693 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m22:32:16.656579 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m22:32:16.657752 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m22:32:16.659755 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m22:32:16.660799 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"
[0m22:32:16.661265 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select song
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where song is null



      
    ) dbt_internal_test
[0m22:32:16.661605 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:32:16.711670 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.336 seconds
[0m22:32:16.713124 [debug] [Thread-3 (]: On test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203: Close
[0m22:32:16.756981 [info ] [Thread-2 (]: 12 of 19 PASS not_null_hot_100_flat_artist ..................................... [[32mPASS[0m in 0.62s]
[0m22:32:16.757472 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e
[0m22:32:16.757757 [debug] [Thread-2 (]: Began running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m22:32:16.758049 [info ] [Thread-2 (]: 16 of 19 START test not_null_hot_100_flat_weeks_on_chart ....................... [RUN]
[0m22:32:16.758372 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_artist.ccb591bb4e, now test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd)
[0m22:32:16.758624 [debug] [Thread-2 (]: Began compiling node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m22:32:16.762082 [debug] [Thread-2 (]: Writing injected SQL for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m22:32:16.762753 [debug] [Thread-2 (]: Began executing node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m22:32:16.764167 [debug] [Thread-2 (]: Writing runtime sql for node "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m22:32:16.765514 [debug] [Thread-2 (]: Using snowflake connection "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"
[0m22:32:16.765770 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select weeks_on_chart
from BB_DATABASE.BB_SCHEMA.hot_100_flat
where weeks_on_chart is null



      
    ) dbt_internal_test
[0m22:32:16.766008 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:32:16.795772 [info ] [Thread-3 (]: 14 of 19 PASS not_null_hot_100_flat_peak_position .............................. [[32mPASS[0m in 0.43s]
[0m22:32:16.796243 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203
[0m22:32:16.796491 [debug] [Thread-3 (]: Began running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m22:32:16.796753 [info ] [Thread-3 (]: 17 of 19 START test unique_countries_country ................................... [RUN]
[0m22:32:16.797059 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_peak_position.78314a5203, now test.billboard_hot_100.unique_countries_country.6b59afdd31)
[0m22:32:16.797292 [debug] [Thread-3 (]: Began compiling node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m22:32:16.801190 [debug] [Thread-3 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m22:32:16.801660 [debug] [Thread-3 (]: Began executing node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m22:32:16.802988 [debug] [Thread-3 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m22:32:16.804158 [debug] [Thread-3 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_country.6b59afdd31"
[0m22:32:16.804451 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_country.6b59afdd31"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    country as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where country is not null
group by country
having count(*) > 1



      
    ) dbt_internal_test
[0m22:32:16.804662 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:32:17.017420 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.725 seconds
[0m22:32:17.019690 [debug] [Thread-1 (]: On test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa: Close
[0m22:32:17.026445 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.365 seconds
[0m22:32:17.027918 [debug] [Thread-4 (]: On test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987: Close
[0m22:32:17.182318 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.416 seconds
[0m22:32:17.186518 [debug] [Thread-2 (]: On test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd: Close
[0m22:32:17.191024 [info ] [Thread-4 (]: 15 of 19 PASS not_null_hot_100_flat_song ....................................... [[32mPASS[0m in 0.54s]
[0m22:32:17.191889 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987
[0m22:32:17.192383 [debug] [Thread-4 (]: Began running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m22:32:17.192863 [info ] [Thread-4 (]: 18 of 19 START test unique_countries_top_artist ................................ [RUN]
[0m22:32:17.193408 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_song.f3d987a987, now test.billboard_hot_100.unique_countries_top_artist.00910d9681)
[0m22:32:17.193809 [debug] [Thread-4 (]: Began compiling node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m22:32:17.198811 [debug] [Thread-4 (]: Writing injected SQL for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m22:32:17.201619 [debug] [Thread-4 (]: Began executing node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m22:32:17.203797 [debug] [Thread-4 (]: Writing runtime sql for node "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m22:32:17.204941 [debug] [Thread-4 (]: Using snowflake connection "test.billboard_hot_100.unique_countries_top_artist.00910d9681"
[0m22:32:17.205250 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_countries_top_artist.00910d9681"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    top_artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.countries
where top_artist is not null
group by top_artist
having count(*) > 1



      
    ) dbt_internal_test
[0m22:32:17.205541 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:32:17.211834 [info ] [Thread-1 (]: 13 of 19 PASS not_null_hot_100_flat_chart_position ............................. [[32mPASS[0m in 0.93s]
[0m22:32:17.212310 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa
[0m22:32:17.212589 [debug] [Thread-1 (]: Began running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m22:32:17.212940 [info ] [Thread-1 (]: 19 of 19 START test unique_hot_100_artists_artist .............................. [RUN]
[0m22:32:17.213353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.billboard_hot_100.not_null_hot_100_flat_chart_position.5df57c4bfa, now test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45)
[0m22:32:17.213604 [debug] [Thread-1 (]: Began compiling node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m22:32:17.218004 [debug] [Thread-1 (]: Writing injected SQL for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m22:32:17.218695 [debug] [Thread-1 (]: Began executing node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m22:32:17.220232 [debug] [Thread-1 (]: Writing runtime sql for node "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m22:32:17.221514 [debug] [Thread-1 (]: Using snowflake connection "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"
[0m22:32:17.221849 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: /* {"app": "dbt", "dbt_version": "1.8.8", "profile_name": "billboard_hot_100", "target_name": "dev", "node_id": "test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

select
    artist as unique_field,
    count(*) as n_records

from BB_DATABASE.BB_SCHEMA.hot_100_artists
where artist is not null
group by artist
having count(*) > 1



      
    ) dbt_internal_test
[0m22:32:17.222087 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:32:17.293263 [info ] [Thread-2 (]: 16 of 19 PASS not_null_hot_100_flat_weeks_on_chart ............................. [[32mPASS[0m in 0.53s]
[0m22:32:17.293688 [debug] [Thread-2 (]: Finished running node test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd
[0m22:32:17.341390 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.537 seconds
[0m22:32:17.342645 [debug] [Thread-3 (]: On test.billboard_hot_100.unique_countries_country.6b59afdd31: Close
[0m22:32:17.453925 [info ] [Thread-3 (]: 17 of 19 PASS unique_countries_country ......................................... [[32mPASS[0m in 0.66s]
[0m22:32:17.454679 [debug] [Thread-3 (]: Finished running node test.billboard_hot_100.unique_countries_country.6b59afdd31
[0m22:32:17.533829 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.328 seconds
[0m22:32:17.536391 [debug] [Thread-4 (]: On test.billboard_hot_100.unique_countries_top_artist.00910d9681: Close
[0m22:32:17.637058 [info ] [Thread-4 (]: 18 of 19 PASS unique_countries_top_artist ...................................... [[32mPASS[0m in 0.44s]
[0m22:32:17.637992 [debug] [Thread-4 (]: Finished running node test.billboard_hot_100.unique_countries_top_artist.00910d9681
[0m22:32:17.671782 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.449 seconds
[0m22:32:17.674654 [debug] [Thread-1 (]: On test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45: Close
[0m22:32:17.764730 [info ] [Thread-1 (]: 19 of 19 PASS unique_hot_100_artists_artist .................................... [[32mPASS[0m in 0.55s]
[0m22:32:17.765361 [debug] [Thread-1 (]: Finished running node test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45
[0m22:32:17.766732 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:32:17.766945 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_hot_100_artists_artist.5b9a850d45' was properly closed.
[0m22:32:17.767111 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_top_artist.00910d9681' was properly closed.
[0m22:32:17.767261 [debug] [MainThread]: Connection 'test.billboard_hot_100.unique_countries_country.6b59afdd31' was properly closed.
[0m22:32:17.767426 [debug] [MainThread]: Connection 'test.billboard_hot_100.not_null_hot_100_flat_weeks_on_chart.53c4b23bfd' was properly closed.
[0m22:32:17.767645 [info ] [MainThread]: 
[0m22:32:17.767850 [info ] [MainThread]: Finished running 19 data tests in 0 hours 0 minutes and 4.37 seconds (4.37s).
[0m22:32:17.769754 [debug] [MainThread]: Command end result
[0m22:32:17.792221 [info ] [MainThread]: 
[0m22:32:17.792534 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:32:17.792708 [info ] [MainThread]: 
[0m22:32:17.792949 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=0 SKIP=0 TOTAL=19
[0m22:32:17.793960 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 4.8925047, "process_user_time": 1.77651, "process_kernel_time": 0.243416, "process_mem_max_rss": "149340160", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m22:32:17.794252 [debug] [MainThread]: Command `dbt test` succeeded at 22:32:17.794200 after 4.89 seconds
[0m22:32:17.794454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051a1cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158278b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115827e30>]}
[0m22:32:17.794644 [debug] [MainThread]: Flushing usage events
[0m22:32:29.953878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b36660>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108523ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108523d90>]}


============================== 22:32:29.955996 | 61c72bf5-25d6-4b0d-932d-3973a0b20f84 ==============================
[0m22:32:29.955996 [info ] [MainThread]: Running with dbt=1.8.8
[0m22:32:29.956293 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/maxhilsdorf/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/maxhilsdorf/Projekte/fortbildung/dbt_schibsted/data_pipeline_repo/dbt/billboard_hot_100/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt docs serve', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m22:32:30.109288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '61c72bf5-25d6-4b0d-932d-3973a0b20f84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10909e2c0>]}
[0m22:32:30.131287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '61c72bf5-25d6-4b0d-932d-3973a0b20f84', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090047c0>]}
